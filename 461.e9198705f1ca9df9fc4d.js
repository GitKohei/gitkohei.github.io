(self.webpackChunkudonarium_lily_gk=self.webpackChunkudonarium_lily_gk||[]).push([[461],{461:function(Xe,Je,Ze){Ze(4656),Opal.modules["i18n/backend/fallbacks"]=function(e){function H(N,$){return"number"==typeof N&&"number"==typeof $?N-$:N["$-"]($)}var $,h,B,v,K,I,Z,R=[],r=e.nil,c=e.$$$,u=e.$$,re=e.module,o=e.truthy,U=e.send,z=e.send2,t=e.hash2;return $=R,Z=[I=re(R[0],"I18n")].concat($),e.class_variable_set(Z[0],"@@fallbacks",r),h=e.get_singleton_class(I),K=[h].concat(Z),e.def(h,"$fallbacks",B=function(){var G,n,d;return e.class_variable_set(K[1],"@@fallbacks",o(d=null==(G=K[1].$$cvars["@@fallbacks"])?r:G)?d:c(c(u(K,"I18n"),"Locale"),"Fallbacks").$new()),o(n=u(K,"Thread").$current()["$[]"]("i18n_fallbacks"))?n:null==(G=K[1].$$cvars["@@fallbacks"])?r:G},B.$$arity=0),e.def(h,"$fallbacks=",v=function(G){var L,n;return e.class_variable_set(K[1],"@@fallbacks",o(G["$is_a?"](u(K,"Array")))?c(c(u(K,"I18n"),"Locale"),"Fallbacks").$new(G):G),n=["i18n_fallbacks",null==(L=K[1].$$cvars["@@fallbacks"])?r:L],U(u(K,"Thread").$current(),"[]=",e.to_a(n)),n[H(n.length,1)]},v.$$arity=1),void function(h,k){var B=[re(h,"Backend")].concat(k);!function(v,V){var d,n,m,a,G=re(v,"Fallbacks"),L=[G].concat(V);e.def(G,"$translate",d=function(D,_,f){try{var b,C=d.$$p,E=this,y=r,l=r,w=r,g=r,P=r,s=r;for(C&&(d.$$p=null),P=0,s=arguments.length,g=new Array(s);P<s;P++)g[P]=arguments[P];return null==f&&(f=u(L,"EMPTY_HASH")),!o(f.$fetch("fallback",!0))||o(f["$[]"]("fallback_in_progress"))?z(E,e.find_super_dispatcher(E,"translate",d,!1,!0),"translate",g,C):(o(f["$[]"]("default"))&&(y=E["$extract_non_symbol_default!"](f)),l=f.$merge(t(["fallback_in_progress"],{fallback_in_progress:!0})),U(u(L,"I18n").$fallbacks()["$[]"](D),"each",[],((b=function(W){var ue,ae=null==b.$$s?this:b.$$s;null==W&&(W=r);try{return U(ae,"catch",["exception"],((ue=function(){var be=null==ue.$$s?this:ue.$$s,pe=r;if(pe=z(be,e.find_iter_super_dispatcher(be,"translate",ue.$$def||b.$$def||d,!1,!1),"translate",[W,_,l],null),o(pe["$nil?"]()))return r;o(D.$to_s()["$!="](W.$to_s()))&&be.$on_fallback(D,W,_,f),e.ret(pe)}).$$s=ae,ue.$$arity=0,ue))}catch(ye){if(!e.rescue(ye,[c(u(L,"I18n"),"InvalidLocale")]))throw ye;try{return r}finally{e.pop_exception()}}}).$$s=E,b.$$arity=1,b)),o(o(w=f["$key?"]("default"))?f["$[]"]("default")["$nil?"]():w)?r:o(y)?z(E,e.find_super_dispatcher(E,"translate",d,!1,!0),"translate",[D,r,f.$merge(t(["default"],{default:y}))],null):E.$throw("exception",c(u(L,"I18n"),"MissingTranslation").$new(D,_,f)))}catch(T){if(T===e.returner)return T.$v;throw T}},d.$$arity=-3),e.def(G,"$extract_non_symbol_default!",n=function(D){var _,C,b=r,Y=r;return b=[D["$[]"]("default")].$flatten(),C=U(b,"detect",[],((_=function(y){return null==y&&(y=r),y["$is_a?"](u(L,"Symbol"))["$!"]()}).$$s=this,_.$$arity=1,_)),o(C)&&(Y=["default",b["$[]"](0,b.$index(C))],U(D,"[]=",e.to_a(Y)),H(Y.length,1)),C},n.$$arity=1),e.def(G,"$exists?",m=function(D,_,f){try{var b,C=m.$$p,E=this,y=r,l=r,w=r;for(C&&(m.$$p=null),l=0,w=arguments.length,y=new Array(w);l<w;l++)y[l]=arguments[l];return null==f&&(f=u(L,"EMPTY_HASH")),o(f.$fetch("fallback",!0))?(U(u(L,"I18n").$fallbacks()["$[]"](D),"each",[],((b=function(P){var s=null==b.$$s?this:b.$$s;null==P&&(P=r);try{if(!o(z(s,e.find_iter_super_dispatcher(s,"exists?",b.$$def||m,!1,!1),"exists?",[P,_],null)))return r;e.ret(!0)}catch(T){if(!e.rescue(T,[c(u(L,"I18n"),"InvalidLocale")]))throw T;try{return r}finally{e.pop_exception()}}}).$$s=E,b.$$arity=1,b)),!1):z(E,e.find_super_dispatcher(E,"exists?",m,!1,!0),"exists?",y,C)}catch(g){if(g===e.returner)return g.$v;throw g}},m.$$arity=-3),G.$private(),e.def(G,"$on_fallback",a=function(D,_,f,b){return r},a.$$arity=4)}(B[0],B)}(Z[0],Z)},Opal.modules["bcdice/randomizer"]=function(e){function H(h,k){return"number"==typeof h&&"number"==typeof k?h>k:h["$>"](k)}function X(h,k){return"number"==typeof h&&"number"==typeof k?h+k:h["$+"](k)}function R(h,k){return"number"==typeof h&&"number"==typeof k?h<=k:h["$<="](k)}function r(h,k){return"number"==typeof h&&"number"==typeof k?h-k:h["$-"](k)}function c(h,k){return"number"==typeof h&&"number"==typeof k?h*k:h["$*"](k)}var k,G,n,m,a,p,D,_,f,b,C,Y,E,L,d,B,o=[],U=e.nil,z=e.$$$,t=e.$$,$=e.klass,I=e.truthy,Z=e.send;return k=o,G=B=[(0,e.module)(o[0],"BCDice")].concat(k),L=$(B[0],null,"Randomizer"),d=[L].concat(G),L.$$prototype.rand_results=L.$$prototype.detailed_rand_results=U,e.const_set(d[0],"UPPER_LIMIT_DICE_TIMES",200),e.const_set(d[0],"UPPER_LIMIT_DICE_SIDES",1e3),e.const_set(d[0],"UPPER_LIMIT_RANDS",1e4),e.def(L,"$initialize",n=function(){return this.rand_results=[],this.detailed_rand_results=[]},n.$$arity=0),L.$attr_reader("rand_results"),L.$attr_reader("detailed_rand_results"),e.const_set(d[0],"DetailedRandResult",t(d,"Struct").$new("kind","sides","value")),e.def(L,"$roll_barabara",m=function(l,w){var g,s,P=this;return I(H(X(P.rand_results.$size(),l),t(d,"UPPER_LIMIT_RANDS")))&&P.$raise(t(d,"TooManyRandsError")),I(I(s=R(l,0))?s:H(l,t(d,"UPPER_LIMIT_DICE_TIMES")))?[]:Z(t(d,"Array"),"new",[l],((g=function(){return(null==g.$$s?this:g.$$s).$roll_once(w)}).$$s=P,g.$$arity=0,g))},m.$$arity=2),e.def(L,"$roll_sum",a=function(l,w){return this.$roll_barabara(l,w).$sum()},a.$$arity=2),e.def(L,"$roll_once",p=function(l){var g,P=U;return I(I(g=R(l,0))?g:H(l,t(d,"UPPER_LIMIT_DICE_SIDES")))?0:(P=this.$rand_inner(l),this.$push_to_detail("normal",l,P),P)},p.$$arity=1),e.def(L,"$roll_index",D=function(l){return r(this.$roll_once(l),1)},D.$$arity=1),e.def(L,"$roll_tens_d10",_=function(){var g,w=U;return(w=this.$rand_inner(10))["$=="](10)&&(w=0),g=c(w,10),this.$push_to_detail("tens_d10",10,g),g},_.$$arity=0),e.def(L,"$roll_d9",f=function(){var w;return w=r(this.$rand_inner(10),1),this.$push_to_detail("d9",10,w),w},f.$$arity=0),e.def(L,"$roll_d66",b=function(l){var w,s,P=U;return P=Z(t(d,"Array"),"new",[2],((w=function(){return(null==w.$$s?this:w.$$s).$roll_once(6)}).$$s=this,w.$$arity=0,w)),s=l,z(t(d,"D66SortType"),"ASC")["$==="](s)?P["$sort!"]():z(t(d,"D66SortType"),"DESC")["$==="](s)&&P["$sort!"]()["$reverse!"](),X(c(P["$[]"](0),10),P["$[]"](1))},b.$$arity=1),L.$private(),e.def(L,"$rand_inner",C=function(l){var g,w=this;return I(function(h,k){return"number"==typeof h&&"number"==typeof k?h>=k:h["$>="](k)}(w.rand_results.$size(),t(d,"UPPER_LIMIT_RANDS")))&&w.$raise(t(d,"TooManyRandsError")),g=w.$random(l),w.rand_results["$<<"]([g,l]),g},C.$$arity=1),e.def(L,"$random",Y=function(l){return X(t(d,"Kernel").$rand(l),1)},Y.$$arity=1),e.def(L,"$push_to_detail",E=function(l,w,g){var s;return s=t(d,"DetailedRandResult").$new(l,w,g),this.detailed_rand_results.$push(s)},E.$$arity=3),void function(v,V,G){[$(v,V,"TooManyRandsError")].concat(G)}(B[0],t(B,"StandardError"),B)},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var z,I,B,G,L,d,n,v,V,h,N,X=[],R=e.nil,c=e.$$,u=e.module,re=e.klass,o=e.truthy;return z=X,I=N=[u(X[0],"BCDice")].concat(z),B=h=[u(N[0],"DiceTable")].concat(I),v=re(h[0],null,"RollResult"),V=[v].concat(B),v.$$prototype.table_name=v.$$prototype.value=v.$$prototype.body=R,e.def(v,"$initialize",G=function(a,p,D){var _=this;return _.table_name=a,_.value=p,_.body=D},G.$$arity=3),v.$attr_reader("table_name"),v.$attr_reader("value"),v.$attr_reader("body"),e.def(v,"$to_s",L=function(){var a=this;return a.table_name+"("+a.value+") \uff1e "+a.body},L.$$arity=0),e.def(v,"$last_body",d=function(){var a=this;return o(a.body["$is_a?"](c(V,"RollResult")))?a.body.$last_body():a.body},d.$$arity=0),void e.def(v,"$empty?",n=function(){return!1},n.$$arity=0)},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var t,Z,v,L,d,V,G,k,$,R=[],r=e.nil,u=e.$$,re=e.module,o=e.klass,U=e.truthy;return t=R,Z=$=[re(R[0],"BCDice")].concat(t),v=k=[re($[0],"DiceTable")].concat(Z),V=o(k[0],null,"ChainTable"),G=[V].concat(v),V.$$prototype.times=V.$$prototype.sides=V.$$prototype.items=V.$$prototype.name=r,e.def(V,"$initialize",L=function(m,a,p){var D=this,_=r;return D.name=m,D.items=p.$freeze(),_=/(\d+)D(\d+)/i.$match(a),U(_)||D.$raise(u(G,"ArgumentError"),"Unexpected table type: "+a),D.times=_["$[]"](1).$to_i(),D.sides=_["$[]"](2).$to_i()},L.$$arity=3),void e.def(V,"$roll",d=function(m){var p,D,a=this,_=r;return D=function(z,t){return"number"==typeof z&&"number"==typeof t?z-t:z["$-"](t)}(p=m.$roll_sum(a.times,a.sides),a.times),_=a.items["$[]"](D),U(_["$respond_to?"]("roll"))&&(_=_.$roll(m)),u(G,"RollResult").$new(a.name,p,_)},d.$$arity=1)},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){function R(N,$){return"number"==typeof N&&"number"==typeof $?N-$:N["$-"]($)}var $,k,G,n,m,a,L,d,B,Z,c=[],u=e.nil,o=e.$$,U=e.module,z=e.klass,t=e.hash2;return $=c,k=Z=[U(c[0],"BCDice")].concat($),G=B=[U(Z[0],"DiceTable")].concat(k),L=z(B[0],null,"D66GridTable"),d=[L].concat(G),L.$$prototype.name=L.$$prototype.items=u,e.defs(L,"$from_i18n",n=function(D,_){var b=u;return b=o(d,"I18n").$t(D,t(["locale","raise"],{locale:_,raise:!0})),this.$new(b["$[]"]("name"),b["$[]"]("items"))},n.$$arity=2),e.def(L,"$initialize",m=function(D,_){return this.name=D,this.items=_.$freeze()},m.$$arity=2),void e.def(L,"$roll",a=function(D){var f,b,C,Y,E,N;return f=D.$roll_once(6),b=D.$roll_once(6),C=function(N,$){return"number"==typeof N&&"number"==typeof $?N+$:N["$+"]($)}("number"==typeof(N=f)?10*N:N["$*"](10),b),Y=R(f,1),E=R(b,1),o(d,"RollResult").$new(this.name,C,this.items["$[]"](Y)["$[]"](E))},a.$$arity=1)},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var z,I,B,G,L,v,V,h,N,X=[],R=e.nil,c=e.$$,u=e.module,re=e.klass,o=e.hash2;return e.top.$require("bcdice/dice_table/d66_grid_table"),z=X,I=N=[u(X[0],"BCDice")].concat(z),B=h=[u(N[0],"DiceTable")].concat(I),v=re(h[0],c(h,"D66GridTable"),"D66HalfGridTable"),V=[v].concat(B),e.defs(v,"$from_i18n",G=function(n,m){var p=R;return p=c(V,"I18n").$t(n,o(["locale","raise"],{locale:m,raise:!0})),this.$new(p["$[]"]("name"),p["$[]"]("items_1_2_3"),p["$[]"]("items_4_5_6"))},G.$$arity=2),void e.def(v,"$initialize",L=function(n,m,a){return this.name=n,this.items=[m,m,m,a,a,a].$freeze()},L.$$arity=3)},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var z,I,B,G,L,v,V,h,N,X=[],R=e.nil,c=e.$$,u=e.module,re=e.klass,o=e.hash2;return e.top.$require("bcdice/dice_table/d66_grid_table"),z=X,I=N=[u(X[0],"BCDice")].concat(z),B=h=[u(N[0],"DiceTable")].concat(I),v=re(h[0],c(h,"D66GridTable"),"D66OneThirdTable"),V=[v].concat(B),e.defs(v,"$from_i18n",G=function(n,m){var p=R;return p=c(V,"I18n").$t(n,o(["locale","raise"],{locale:m,raise:!0})),this.$new(p["$[]"]("name"),p["$[]"]("items_1_2"),p["$[]"]("items_3_4"),p["$[]"]("items_5_6"))},G.$$arity=2),void e.def(v,"$initialize",L=function(n,m,a,p){return this.name=n,this.items=[m,m,a,a,p,p].$freeze()},L.$$arity=4)},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var $,k,G,n,m,a,L,d,B,Z,r=[],c=e.nil,u=e.$$$,re=e.$$,o=e.module,U=e.klass,z=e.hash2,t=e.truthy;return $=r,k=Z=[o(r[0],"BCDice")].concat($),G=B=[o(Z[0],"DiceTable")].concat(k),L=U(B[0],null,"D66Table"),d=[L].concat(G),L.$$prototype.sort_type=L.$$prototype.items=L.$$prototype.name=c,e.defs(L,"$from_i18n",n=function(D,_){var C,b=c;return b=re(d,"I18n").$t(D,z(["locale"],{locale:_})),C=re(d,"D66SortType").$const_get(b["$[]"]("d66_sort_type")),this.$new(b["$[]"]("name"),C,b["$[]"]("items"))},n.$$arity=2),e.def(L,"$initialize",m=function(D,_,f){var b=this;return b.name=D,b.sort_type=_,b.items=f.$freeze()},m.$$arity=3),void e.def(L,"$roll",a=function(D){var b,E,N,_=this,f=c,C=c,Y=c;return f=D.$roll_barabara(2,6),b=_.sort_type,u(re(d,"D66SortType"),"ASC")["$==="](b)?f["$sort!"]():u(re(d,"D66SortType"),"DESC")["$==="](b)&&f["$sort!"]()["$reverse!"](),C=function(N,$){return"number"==typeof N&&"number"==typeof $?N+$:N["$+"]($)}("number"==typeof(N=f["$[]"](0))?10*N:N["$*"](10),f["$[]"](1)),Y=t(E=_.items["$[]"](C))?E:_.items["$[]"](C.$to_s()),t(Y["$respond_to?"]("roll"))&&(Y=Y.$roll(D)),re(d,"RollResult").$new(_.name,C,Y)},a.$$arity=1)},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){function H(I,Z){return"number"==typeof I&&"number"==typeof Z?I+Z:I["$+"](Z)}var Z,d,a,n,B,V,k,c=[],u=e.nil,o=e.$$,U=e.module,z=e.klass,t=e.hash2,N=e.send,$=e.send2;return e.top.$require("bcdice/dice_table/d66_table"),Z=c,B=k=[U(c[0],"BCDice")].concat(Z),d=V=[U(k[0],"DiceTable")].concat(B),[n=z(V[0],o(V,"D66Table"),"D66LeftRangeTable")].concat(d),void e.def(n,"$initialize",a=function(D,_,f){var b,y,E=this;return a.$$p&&(a.$$p=null),y=t([],{}),N(f,"each",[],((b=function(l){function w(g){return l.apply(this,arguments)}return w.toString=function(){return l.toString()},w}(function(l){var g,s,W,w=null==b.$$s?this:b.$$s;return null==l&&(l=u),g=e.to_ary(l),W=null==g[1]?u:g[1],N(null==g[0]?u:g[0],"each",[],((s=function(ue){var be;return null==ue&&(ue=u),N(W,"each_with_index",[],((be=function(qe,ke){var ze,ve,I;return null==qe&&(qe=u),null==ke&&(ke=u),ze=H("number"==typeof(I=ue)?10*I:I["$*"](10),H(ke,1)),N(y,"[]=",e.to_a(ve=[ze,qe])),ve[function(I,Z){return"number"==typeof I?I-1:I["$-"](1)}(ve.length)]}).$$s=null==s.$$s?this:s.$$s,be.$$arity=2,be))}).$$s=w,s.$$arity=1,s))})).$$s=E,b.$$arity=1,b)),$(E,e.find_super_dispatcher(E,"initialize",a,!1,!0),"initialize",[D,_,y],null)},a.$$arity=3)},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var $,k,G,n,m,L,d,B,Z,c=[],u=e.nil,o=e.$$,U=e.module,z=e.klass,t=e.truthy;return $=c,k=Z=[U(c[0],"BCDice")].concat($),G=B=[U(Z[0],"DiceTable")].concat(k),L=z(B[0],null,"D66ParityTable"),d=[L].concat(G),L.$$prototype.odd=L.$$prototype.even=L.$$prototype.name=u,e.def(L,"$initialize",n=function(p,D,_){var f=this;return f.name=p,f.odd=D.$freeze(),f.even=_.$freeze()},n.$$arity=3),void e.def(L,"$roll",m=function(p){var f,C,Y,N,D=this,_=u;return _=p.$roll_once(6),f=p.$roll_once(6),C=(t(_["$odd?"]())?D.odd:D.even)["$[]"]("number"==typeof(N=f)?N-1:N["$-"](1)),Y=function(N,$){return"number"==typeof N&&"number"==typeof $?N+$:N["$+"]($)}(function(N,$){return"number"==typeof N?10*N:N["$*"](10)}(_),f),o(d,"RollResult").$new(D.name,Y,C)},m.$$arity=1)},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var N,h,V,d,n,G,L,K,I,r=[],c=e.nil,re=e.$$,o=e.module,U=e.klass,z=e.send;return N=r,h=I=[o(r[0],"BCDice")].concat(N),V=K=[o(I[0],"DiceTable")].concat(h),G=U(K[0],null,"D66RangeTable"),L=[G].concat(V),G.$$prototype.items=G.$$prototype.name=c,e.def(G,"$initialize",d=function(a,p){return this.name=a,this.items=p.$freeze()},d.$$arity=2),void e.def(G,"$roll",n=function(a){var p,_,f,b,t,D=this,C=c;return _=a.$roll_once(6),f=a.$roll_once(6),b=function(t,N){return"number"==typeof t&&"number"==typeof N?t+N:t["$+"](N)}("number"==typeof(t=_)?10*t:t["$*"](10),f),C=z(D.items,"find",[],((p=function(E){return null==E&&(E=c),E["$[]"](0)["$include?"](b)}).$$s=D,p.$$arity=1,p)),re(L,"RollResult").$new(D.name,b,C["$[]"](1))},n.$$arity=1)},Opal.modules["bcdice/dice_table/range_table"]=function(e){var I,K,L,m,a,p,D,_,f,b,C,Y,d,n,v,h,c=[],u=e.nil,o=e.$$,U=e.module,z=e.klass,t=e.send,N=e.truthy;return I=c,K=h=[U(c[0],"BCDice")].concat(I),L=v=[U(h[0],"DiceTable")].concat(K),d=z(v[0],null,"RangeTable"),n=[d].concat(L),d.$$prototype.name=d.$$prototype.items=d.$$prototype.num_of_dice=d.$$prototype.num_of_sides=d.$$prototype.formatter=u,e.const_set(n[0],"RollResult",t(o(n,"Struct"),"new",["sum","values","content","formatted"],((m=function(){return(null==m.$$s?this:m.$$s).$alias_method("to_s","formatted")}).$$s=d,m.$$arity=0,m))),e.const_set(n[0],"Item",o(n,"Struct").$new("range","content")),e.const_set(n[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),e.const_set(n[0],"DEFAULT_FORMATTER",t(d,"lambda",[],($$2=function(E){function y(l,w){return E.apply(this,arguments)}return y.toString=function(){return E.toString()},y}(function(E,y){return null==$$2.$$s||$$2,null==E&&(E=u),null==y&&(y=u),E.$name()+"("+y.$sum()+") \uff1e "+y.$content()}),$$2.$$s=d,$$2.$$arity=2,$$2))),d.$attr_reader("name"),d.$attr_reader("num_of_dice"),d.$attr_reader("num_of_sides"),e.def(d,"$initialize",a=function(y,l,w){var T,g=a.$$p,P=g||u,s=this,W=u;return g&&(a.$$p=null),g&&(a.$$p=null),s.name=y.$freeze(),s.formatter=N(T=P)?T:o(n,"DEFAULT_FORMATTER"),W=o(n,"DICE_ROLL_METHOD_RE").$match(l),N(W)||s.$raise(o(n,"ArgumentError"),s.name+": invalid dice roll method: "+l),s.num_of_dice=W["$[]"](1).$to_i(),s.num_of_sides=W["$[]"](2).$to_i(),s.$store(w)},a.$$arity=3),e.def(d,"$fetch",p=function(y){var l,g,w=this;return g=t(w.items,"find",[],((l=function(s){return null==s&&(s=u),s.$range()["$include?"](y)}).$$s=w,l.$$arity=1,l)),N(g)||w.$raise(o(n,"RangeError"),w.name+": value is out of range: "+y),g},p.$$arity=1),e.def(d,"$roll",D=function(y){var g,P,s,$,l=this,w=u;return g=(w=y.$roll_barabara(l.num_of_dice,l.num_of_sides)).$sum(),P=o(n,"RollResult").$new(g,w,l.$fetch(g).$content()),s=[l.formatter["$[]"](l,P)],t(P,"formatted=",e.to_a(s)),"number"==typeof($=s.length)||$["$-"](1),P},D.$$arity=1),d.$private(),e.def(d,"$store",_=function(y){var l,w,g,s,T,P=this;return s=t(y,"map",[],((l=function(ae,ue){return null==ae&&(ae=u),null==ue&&(ue=u),[(null==l.$$s?this:l.$$s).$coerce_to_int_range(ae),ue]}).$$s=P,l.$$arity=2,l)),T=t(s,"sort_by",[],((w=function(ae,ue){return null==ae&&(ae=u),null==ue&&(ue=u),ae.$min()}).$$s=P,w.$$arity=2,w)),P.$assert_min_sum_is_covered(T),P.$assert_max_sum_is_covered(T),P.$assert_no_gap_or_overlap_in_ranges(T),P.items=t(T,"map",[],(g=function(ae,ue){return null==ae&&(ae=u),null==ue&&(ue=u),o(n,"Item").$new(ae,ue.$freeze()).$freeze()},g.$$s=P,g.$$arity=2,g)).$freeze(),P},_.$$arity=1),e.def(d,"$coerce_to_int_range",f=function(y){var w,g=u;return w=y,o(n,"Integer")["$==="](w)?o(n,"Range").$new(y,y):o(n,"Range")["$==="](w)&&N(N(g=y.$begin()["$is_a?"](o(n,"Integer")))?y.$end()["$is_a?"](o(n,"Integer")):g)?y:this.$raise(o(n,"TypeError"),this.name+": "+y+" ("+y.$class()+") must be an Integer or a Range with Integers ")},f.$$arity=1),e.def(d,"$assert_min_sum_is_covered",b=function(y){var w,l=this,g=u;return w=l.num_of_dice,g=y.$first()["$[]"](0),N(g["$include?"](w))||l.$raise(o(n,"RangeError"),l.name+": min value ("+w+") is not covered: "+g),l},b.$$arity=1),e.def(d,"$assert_max_sum_is_covered",C=function(y){var w,l=this,g=u;return w=function($,I){return"number"==typeof $&&"number"==typeof I?$*I:$["$*"](I)}(l.num_of_dice,l.num_of_sides),g=y.$last()["$[]"](0),N(g["$include?"](w))||l.$raise(o(n,"RangeError"),l.name+": max value ("+w+") is not covered: "+g),l},C.$$arity=1),void e.def(d,"$assert_no_gap_or_overlap_in_ranges",Y=function(y){var l;return t(y,"each_cons",[2],((l=function(P,s){var ue,ye,$,T=null==l.$$s?this:l.$$s,W=u,ae=u;return null==T.name&&(T.name=u),null==P&&(P=u),null==s&&(s=u),W=P["$[]"](0),ae=s["$[]"](0),ye="number"==typeof($=ue=W.$max())?$+1:$["$+"](1),N(ae["$include?"](ue))&&T.$raise(o(n,"RangeError"),T.name+": Range overlap: "+W+" and "+ae),N(ae["$include?"](ye))?u:T.$raise(o(n,"RangeError"),T.name+": Range gap: "+W+" and "+ae)}).$$s=this,l.$$arity=2,l)),this},Y.$$arity=1)},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var t,Z,v,n,p,D,_,m,a,G,k,$,R=[],r=e.nil,c=e.$$$,u=e.$$,re=e.module,o=e.klass,U=e.send;return t=R,Z=$=[re(R[0],"BCDice")].concat(t),v=k=[re($[0],"DiceTable")].concat(Z),n=G=[o(k[0],null,"SaiFicSkillTable")].concat(v),m=o(G[0],null,"Category"),a=[m].concat(n),m.$$prototype.name=r,e.def(m,"$initialize",p=function(b,C,Y,E){var y,l=this;return l.name=b,l.skills=U(C.$map(),"with_index",[2],((y=function(w){function g(P,s){return w.apply(this,arguments)}return g.toString=function(){return w.toString()},g}(function(w,g){return null==w&&(w=r),null==g&&(g=r),c(u(a,"SaiFicSkillTable"),"Skill").$new(b,w,Y,g,E)})).$$s=l,y.$$arity=2,y)),l.dice=Y},p.$$arity=4),e.def(m,"$roll",D=function(b){return this.$skills()["$[]"]("number"==typeof(z=b.$roll_sum(2,6))?z-2:z["$-"](2));var z},D.$$arity=1),e.def(m,"$to_s",_=function(){return this.name},_.$$arity=0),void m.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var z,I,d,a,p,n,B,V,h,N,X=[],R=e.nil,u=e.module,re=e.klass,o=e.hash2;return z=X,I=N=[u(X[0],"BCDice")].concat(z),B=h=[u(N[0],"DiceTable")].concat(I),d=V=[re(h[0],null,"SaiFicSkillTable")].concat(B),[n=re(V[0],null,"Skill")].concat(d),n.$$prototype.s_format=n.$$prototype.category_dice=n.$$prototype.row_dice=n.$$prototype.category_name=n.$$prototype.name=R,e.def(n,"$initialize",a=function(_,f,b,C,Y){var E=this;return E.category_name=_,E.name=f,E.category_dice=b,E.row_dice=C,E.s_format=Y},a.$$arity=5),e.def(n,"$to_s",p=function(){var _=this;return _.$format(_.s_format,o(["category_dice","row_dice","category_name","skill_name"],{category_dice:_.category_dice,row_dice:_.row_dice,category_name:_.category_name,skill_name:_.name}))},p.$$arity=0),void n.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var Z,B,d,a,p,D,_,f,b,C,n,m,V,k,R=e.top,r=[],c=e.nil,u=e.$$$,re=e.$$,o=e.module,U=e.klass,z=e.hash2,t=e.send,$=e.truthy;return R.$require("bcdice/dice_table/sai_fic_skill_table/category"),R.$require("bcdice/dice_table/sai_fic_skill_table/skill"),Z=r,B=k=[o(r[0],"BCDice")].concat(Z),d=V=[o(k[0],"DiceTable")].concat(B),n=U(V[0],null,"SaiFicSkillTable"),m=[n].concat(d),n.$$prototype.rtt=n.$$prototype.rtt_format=n.$$prototype.rct=n.$$prototype.rct_format=n.$$prototype.rttn=n.$$prototype.rttn_format=n.$$prototype.categories=c,e.defs(n,"$from_i18n",a=function(E,y,l){var w,g,P,s,ue,ae=c;if(null==l)l=z([],{});else if(!l.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return null==(w=l.$$smap.rtt)&&(w=c),null==(g=l.$$smap.rct)&&(g=c),null==(P=l.$$smap.rttn)&&(P=c),ue=(ae=re(m,"I18n").$t("RTT",z(["locale","raise","default"],{locale:y,raise:!1,default:z([],{})})).$merge(re(m,"I18n").$t(E,z(["locale","raise"],{locale:y,raise:!0}))))["$[]"]("items"),ae=t(ae,"select",[],((s=function(ye){function be(pe,qe){return ye.apply(this,arguments)}return be.toString=function(){return ye.toString()},be}(function(ye,be){return null==ye&&(ye=c),null==be&&(be=c),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](ye)})).$$s=this,s.$$arity=2,s)),this.$new(ue,e.to_hash(ae).$merge(z(["rtt","rct","rttn"],{rtt:w,rct:g,rttn:P})))},a.$$arity=-3),e.const_set(m[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),e.const_set(m[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),e.const_set(m[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),e.const_set(m[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),e.def(n,"$initialize",p=function(E,y){var l,w,g,P,s,T,W,ae,ue=this;if(null==y)y=z([],{});else if(!y.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return null==(l=y.$$smap.rtt)&&(l=c),null==(w=y.$$smap.rct)&&(w=c),null==(g=y.$$smap.rttn)&&(g=c),null==(P=y.$$smap.rtt_format)&&(P=re(m,"DEFAULT_RTT")),null==(s=y.$$smap.rct_format)&&(s=re(m,"DEFAULT_RCT")),null==(T=y.$$smap.rttn_format)&&(T=re(m,"DEFAULT_RTTN")),null==(W=y.$$smap.s_format)&&(W=re(m,"DEFAULT_S")),ue.categories=t(E.$map(),"with_index",[1],((ae=function(be,pe){var ke,ze,ve;return null==be&&(be=c),null==pe&&(pe=c),ze=null==(ke=e.to_ary(be))[0]?c:ke[0],ve=null==ke[1]?c:ke[1],u(re(m,"SaiFicSkillTable"),"Category").$new(ze,ve,pe,W)}).$$s=ue,ae.$$arity=2,ae.$$has_top_level_mlhs_arg=!0,ae)),ue.rtt=l,ue.rct=w,ue.rttn=g.$to_a(),ue.rtt_format=P,ue.rct_format=s,ue.rttn_format=T},p.$$arity=-2),e.const_set(m[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),n.$attr_reader("categories"),e.def(n,"$roll_command",D=function(E,y){var w,l=this,g=c,P=c,s=c;return $(["RTT",l.rtt]["$include?"](w=y))?l.$format_skill(l.rtt_format,l.$roll_skill(E)):$(["RCT",l.rct]["$include?"](w))?(g=l.$roll_category(E),l.$format(l.rct_format,z(["category_dice","category_name"],{category_dice:g.$dice(),category_name:g.$name()}))):$($(P=s=re(m,"RTTN").$index(w))?P:s=l.rttn.$index(w))?l.$format_skill(l.rttn_format,l.categories["$[]"](s).$roll(E)):c},D.$$arity=2),e.def(n,"$roll_category",_=function(E){return this.categories["$[]"]("number"==typeof(I=E.$roll_once(6))?I-1:I["$-"](1));var I},_.$$arity=1),e.def(n,"$roll_skill",f=function(E){return this.$roll_category(E).$roll(E)},f.$$arity=1),e.def(n,"$prefixes",b=function(){var E=this;return function(I,Z){return"number"==typeof I&&"number"==typeof Z?I+Z:I["$+"](Z)}(["RTT[1-6]?","RCT",E.rtt,E.rct],E.rttn).$compact()},b.$$arity=0),n.$private(),void e.def(n,"$format_skill",C=function(E,y){return this.$format(E,z(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:y.$category_dice(),row_dice:y.$row_dice(),category_name:y.$category_name(),skill_name:y.$name(),text:y.$to_s()}))},C.$$arity=2)},Opal.modules["bcdice/dice_table/table"]=function(e){var N,h,V,d,n,m,a,G,L,K,I,R=[],r=e.nil,u=e.$$,re=e.module,o=e.klass,U=e.hash2,z=e.truthy;return N=R,h=I=[re(R[0],"BCDice")].concat(N),V=K=[re(I[0],"DiceTable")].concat(h),G=o(K[0],null,"Table"),L=[G].concat(V),G.$$prototype.times=G.$$prototype.sides=G.$$prototype.name=G.$$prototype.items=r,e.defs(G,"$from_i18n",d=function(D,_){var b=r;return b=u(L,"I18n").$t(D,U(["locale"],{locale:_})),this.$new(b["$[]"]("name"),b["$[]"]("type"),b["$[]"]("items"))},d.$$arity=2),e.def(G,"$initialize",n=function(D,_,f){var b=this,C=r;return b.name=D,b.items=f.$freeze(),C=/(\d+)D(\d+)/i.$match(_),z(C)||b.$raise(u(L,"ArgumentError"),"Unexpected table type: "+_),b.times=C["$[]"](1).$to_i(),b.sides=C["$[]"](2).$to_i()},n.$$arity=3),e.def(G,"$roll",m=function(D){var f,_=this;return f=D.$roll_sum(_.times,_.sides),_.$choice(f)},m.$$arity=1),void e.def(G,"$choice",a=function(D){var f,_=this;return f=function(t,N){return"number"==typeof t&&"number"==typeof N?t-N:t["$-"](N)}(D,_.times),u(L,"RollResult").$new(_.name,D,_.items["$[]"](f))},a.$$arity=1)},Opal.modules["bcdice/dice_table"]=function(e){var H=e.top;return H.$require("bcdice/dice_table/roll_result"),H.$require("bcdice/dice_table/chain_table"),H.$require("bcdice/dice_table/d66_grid_table"),H.$require("bcdice/dice_table/d66_half_grid_table"),H.$require("bcdice/dice_table/d66_one_third_table"),H.$require("bcdice/dice_table/d66_left_range_table"),H.$require("bcdice/dice_table/d66_parity_table"),H.$require("bcdice/dice_table/d66_range_table"),H.$require("bcdice/dice_table/d66_table"),H.$require("bcdice/dice_table/range_table"),H.$require("bcdice/dice_table/sai_fic_skill_table"),H.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var o,N,I,z,X=[],u=e.module;return o=X,N=z=[u(X[0],"BCDice")].concat(o),I=[u(z[0],"D66SortType")].concat(N),e.const_set(I[0],"NO_SORT","no_sort"),e.const_set(I[0],"ASC","asc"),e.const_set(I[0],"DESC","desc"),void function(t,N){var I=[u(t,"RoundType")].concat(N);e.const_set(I[0],"CEIL","ceil"),e.const_set(I[0],"FLOOR","floor"),e.const_set(I[0],"ROUND","round")}(z[0],z)},Opal.modules["bcdice/translate"]=function(e){var z,I,k,Z,h,N,X=[],R=e.nil,c=e.$$,u=e.module,re=e.hash2;return z=X,I=N=[u(X[0],"BCDice")].concat(z),Z=u(N[0],"Translate"),h=[Z].concat(I),void e.def(Z,"$translate",k=function(B,v){var V,G=this;if(null==G.locale&&(G.locale=R),null==v)v=re([],{});else if(!v.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return V=e.kwrestargs(v,{}),c(h,"I18n").$translate(B,re(["locale","raise"],{locale:G.locale,raise:!0}).$merge(e.to_hash(V)))},k.$$arity=-2)},Opal.modules["bcdice/result"]=function(e){function H(z,t){return"number"==typeof z&&"number"==typeof t?z-t:z["$-"](t)}var t,m,D,_,f,b,C,h,B,v,V,G,L,d,n,k,K,$,R=[],r=e.nil,o=e.klass,U=e.send;return t=R,h=$=[(0,e.module)(R[0],"BCDice")].concat(t),K=[k=o($[0],null,"Result")].concat(h),k.$$prototype.secret=k.$$prototype.success=k.$$prototype.failure=k.$$prototype.critical=k.$$prototype.fumble=r,[m=e.get_singleton_class(k)].concat(K),e.def(m,"$success",D=function(E){var y;return U(this.$new(),"tap",[],((y=function(w){function g(P){return w.apply(this,arguments)}return g.toString=function(){return w.toString()},g}(function(w){var P=r;return null==w&&(w=r),U(w,"text=",e.to_a(P=[E])),H(P.length,1),U(w,"success=",e.to_a(P=[!0])),P[H(P.length,1)]})).$$s=this,y.$$arity=1,y))},D.$$arity=1),e.def(m,"$failure",_=function(E){var y;return U(this.$new(),"tap",[],((y=function(g){var s=r;return null==g&&(g=r),U(g,"text=",e.to_a(s=[E])),H(s.length,1),U(g,"failure=",e.to_a(s=[!0])),s[H(s.length,1)]}).$$s=this,y.$$arity=1,y))},_.$$arity=1),e.def(m,"$critical",f=function(E){var y;return U(this.$new(),"tap",[],((y=function(g){var s=r;return null==g&&(g=r),U(g,"text=",e.to_a(s=[E])),H(s.length,1),U(g,"critical=",e.to_a(s=[!0])),H(s.length,1),U(g,"success=",e.to_a(s=[!0])),s[H(s.length,1)]}).$$s=this,y.$$arity=1,y))},f.$$arity=1),e.def(m,"$fumble",b=function(E){var y;return U(this.$new(),"tap",[],((y=function(g){var s=r;return null==g&&(g=r),U(g,"text=",e.to_a(s=[E])),H(s.length,1),U(g,"fumble=",e.to_a(s=[!0])),H(s.length,1),U(g,"failure=",e.to_a(s=[!0])),s[H(s.length,1)]}).$$s=this,y.$$arity=1,y))},b.$$arity=1),e.def(m,"$nothing",C=function(){return"nothing"},C.$$arity=0),e.def(k,"$initialize",B=function(a){var p=this;return null==a&&(a=r),p.text=a,p.rands=r,p.detailed_rands=r,p.secret=!1,p.success=!1,p.failure=!1,p.critical=!1,p.fumble=!1},B.$$arity=-1),k.$attr_accessor("text","rands","detailed_rands"),k.$attr_writer("secret","success","failure","critical","fumble"),e.def(k,"$secret?",v=function(){return this.secret},v.$$arity=0),e.def(k,"$success?",V=function(){return this.success},V.$$arity=0),e.def(k,"$failure?",G=function(){return this.failure},G.$$arity=0),e.def(k,"$critical?",L=function(){return this.critical},L.$$arity=0),e.def(k,"$fumble?",d=function(){return this.fumble},d.$$arity=0),void e.def(k,"$condition=",n=function(a){return this.success=a,this.failure=a["$!"]()},n.$$arity=1)},Opal.modules["racc/parser"]=function(e){function H(B,v){return"number"==typeof B&&"number"==typeof v?B<v:B["$<"](v)}function X(B,v){return"number"==typeof B&&"number"==typeof v?B-v:B["$-"](v)}function R(B,v){return"number"==typeof B&&"number"==typeof v?B+v:B["$+"](v)}function r(B,v){return"number"==typeof B&&"number"==typeof v?B>=v:B["$>="](v)}function c(B,v){return"number"==typeof B&&"number"==typeof v?B>v:B["$>"](v)}function u(B,v){return"number"==typeof B&&"number"==typeof v?B<=v:B["$<="](v)}var L,d,n,v,G,z=[],t=e.nil,N=e.$$$,$=e.$$,I=e.module,Z=e.klass,h=e.truthy,k=e.gvars,K=e.send;return v=z,L=(G=[I(z[0],"Racc")].concat(v))[0],d=$(G,"StandardError"),n=G,[Z(L,d,"ParseError")].concat(n),h(N("::","ParseError","skip_raise")?"constant":t)||e.const_set(z[0],"ParseError",N($(z,"Racc"),"ParseError")),function(B,v){var m,D,_,f,b,C,Y,E,y,l,w,g,P,s,T,W,ae,ue,ye,be,pe,qe,ke,Ie,ze,a,p,G=[I(B,"Racc")].concat(v);h($(G,"Racc_No_Extensions","skip_raise")?"constant":t)||e.const_set(G[0],"Racc_No_Extensions",!1),m=G,a=Z(G[0],null,"Parser"),p=[a].concat(m),a.$$prototype.yydebug=a.$$prototype.racc_debug_out=a.$$prototype.racc_error_status=a.$$prototype.racc_t=a.$$prototype.racc_vstack=a.$$prototype.racc_val=a.$$prototype.racc_state=a.$$prototype.racc_tstack=t,e.const_set(p[0],"Racc_Runtime_Version","1.4.6"),e.const_set(p[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),e.const_set(p[0],"Racc_Runtime_Core_Version_R","1.4.6"),e.const_set(p[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),e.const_set(p[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),e.const_set(p[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),e.const_set(p[0],"Racc_Runtime_Core_Version",$(p,"Racc_Runtime_Core_Version_R")),e.const_set(p[0],"Racc_Runtime_Core_Revision",$(p,"Racc_Runtime_Core_Revision_R")),e.const_set(p[0],"Racc_Runtime_Type","ruby"),e.defs($(p,"Parser"),"$racc_runtime_type",D=function(){return $(p,"Racc_Runtime_Type")},D.$$arity=0),e.def(a,"$_racc_setup",_=function(){var J,O,i=this,M=t,A=t,S=t;return null==k.stderr&&(k.stderr=t),h(N(i.$class(),"Racc_debug_parser"))||(i.yydebug=!1),h(null!=(J=i.yydebug)&&J!==t?"instance-variable":t)||(i.yydebug=!1),h(i.yydebug)&&(h(null!=(O=i.racc_debug_out)&&O!==t?"instance-variable":t)||(i.racc_debug_out=k.stderr),i.racc_debug_out=h(M=i.racc_debug_out)?M:k.stderr),A=N(i.$class(),"Racc_arg"),h(H(A.$size(),14))&&(K(A,"[]=",e.to_a(S=[13,!0])),X(S.length,1)),A},_.$$arity=0),e.def(a,"$_racc_init_sysvars",f=function(){var J=this;return J.racc_state=[0],J.racc_tstack=[],J.racc_vstack=[],J.racc_t=t,J.racc_val=t,J.racc_read_next=!0,J.racc_user_yyerror=!1,J.racc_error_status=0},f.$$arity=0),e.def(a,"$do_parse",b=function(){return this.$__send__($(p,"Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)},b.$$arity=0),e.def(a,"$next_token",C=function(){return this.$raise($(p,"NotImplementedError"),this.$class()+"#next_token is not defined")},C.$$arity=0),e.def(a,"$_racc_do_parse_rb",Y=function(J,O){var i,A,S=this,ee=t,te=t,oe=t,xe=t,fe=t,ge=t,we=t,le=t;return i=e.to_ary(J),ee=null==i[0]?t:i[0],te=null==i[1]?t:i[1],oe=null==i[2]?t:i[2],xe=null==i[3]?t:i[3],fe=null==i[10]?t:i[10],S.$_racc_init_sysvars(),ge=we=le=t,K(S,"catch",["racc_end_parse"],((A=function(){var Me,Ue,de=null==A.$$s?this:A.$$s,Ce=t,je=t,Ge=t;for(null==de.racc_state&&(de.racc_state=t),null==de.racc_read_next&&(de.racc_read_next=t),null==de.racc_t&&(de.racc_t=t),null==de.yydebug&&(de.yydebug=t),null==de.racc_val&&(de.racc_val=t);h(!0);)for(h(le=xe["$[]"](de.racc_state["$[]"](-1)))?(h(de.racc_read_next)&&h(de.racc_t["$!="](0))&&(Ue=de.$next_token(),Me=e.to_ary(Ue),ge=null==Me[0]?t:Me[0],de.racc_val=null==Me[1]?t:Me[1],de.racc_t=h(ge)?h(Ce=fe["$[]"](ge))?Ce:1:0,h(de.yydebug)&&de.$racc_read_token(de.racc_t,ge,de.racc_val),de.racc_read_next=!1),le=R(le,de.racc_t),h(h(je=h(Ge=r(le,0))?we=ee["$[]"](le):Ge)?te["$[]"](le)["$=="](de.racc_state["$[]"](-1)):je)||(we=oe["$[]"](de.racc_state["$[]"](-1)))):we=oe["$[]"](de.racc_state["$[]"](-1));h(we=de.$_racc_evalact(we,J)););}).$$s=S,A.$$arity=0,A))},Y.$$arity=2),e.def(a,"$yyparse",E=function(J,O){return this.$__send__($(p,"Racc_YY_Parse_Method"),J,O,this.$_racc_setup(),!0)},E.$$arity=2),e.def(a,"$_racc_yyparse_rb",y=function(J,O,i,M){var A,ee,oe=t,xe=t,ce=t,fe=t,we=t,le=t,Te=t;return A=e.to_ary(i),oe=null==A[0]?t:A[0],xe=null==A[1]?t:A[1],ce=null==A[2]?t:A[2],fe=null==A[3]?t:A[3],we=null==A[10]?t:A[10],this.$_racc_init_sysvars(),le=t,Te=t,K(this,"catch",["racc_end_parse"],((ee=function(){var Ce,Ee=null==ee.$$s?this:ee.$$s;for(null==Ee.racc_state&&(Ee.racc_state=t);!h(Te=fe["$[]"](Ee.racc_state["$[]"](-1)));)for(;h(le=Ee.$_racc_evalact(ce["$[]"](Ee.racc_state["$[]"](-1)),i)););return K(J,"__send__",[O],((Ce=function(Ge,Fe){var Q,F,Be=null==Ce.$$s?this:Ce.$$s,Re=t,me=t,Pe=t,_e=t,$e=t,x=t,ne=t;for(null==Be.racc_t&&(Be.racc_t=t),null==Be.racc_state&&(Be.racc_state=t),null==Be.racc_read_next&&(Be.racc_read_next=t),null==Ge&&(Ge=t),null==Fe&&(Fe=t),Be.racc_t=h(Ge)?h(Re=we["$[]"](Ge))?Re:1:0,Be.racc_val=Fe,Be.racc_read_next=!1,Te=R(Te,Be.racc_t),h(h(Q=h(F=r(Te,0))?le=oe["$[]"](Te):F)?xe["$[]"](Te)["$=="](Be.racc_state["$[]"](-1)):Q)||(le=ce["$[]"](Be.racc_state["$[]"](-1)));h(le=Be.$_racc_evalact(le,i)););for(;h(h(me=h(Pe=(Te=fe["$[]"](Be.racc_state["$[]"](-1)))["$!"]())?Pe:Be.racc_read_next["$!"]())?me:Be.racc_t["$=="](0));)for(h(h(_e=h($e=h(x=h(ne=Te)?Te=R(Te,Be.racc_t):ne)?r(Te,0):x)?le=oe["$[]"](Te):$e)?xe["$[]"](Te)["$=="](Be.racc_state["$[]"](-1)):_e)||(le=ce["$[]"](Be.racc_state["$[]"](-1)));h(le=Be.$_racc_evalact(le,i)););}).$$s=Ee,Ce.$$arity=2,Ce))}).$$s=this,ee.$$arity=0,ee))},y.$$arity=4),e.def(a,"$_racc_evalact",l=function(J,O){var i,A,ce,ge,S=this,ee=t,te=t,xe=t,fe=t,we=t,le=t,Te=t,de=t,Ee=t,Me=t;if(ee=null==(i=e.to_ary(O))[0]?t:i[0],te=null==i[1]?t:i[1],xe=null==i[3]?t:i[3],ce=null==i[11]?t:i[11],fe=null==i[12]?t:i[12],h(h(ge=c(J,0))?H(J,ce):ge))h(c(S.racc_error_status,0))&&(S.racc_t["$=="](1)||(S.racc_error_status=X(S.racc_error_status,1))),S.racc_vstack.$push(S.racc_val),S.racc_state.$push(J),S.racc_read_next=!0,h(S.yydebug)&&(S.racc_tstack.$push(S.racc_t),S.$racc_shift(S.racc_t,S.racc_tstack,S.racc_vstack));else if(h(h(we=H(J,0))?c(J,fe["$-@"]()):we)){if(le=K(S,"catch",["racc_jump"],((A=function(){var Ce=null==A.$$s?this:A.$$s;return null==Ce.racc_state&&(Ce.racc_state=t),Ce.racc_state.$push(Ce.$_racc_do_reduce(O,J)),!1}).$$s=S,A.$$arity=0,A)),h(le)){if(1["$==="](Te=le))return S.racc_user_yyerror=!0,fe["$-@"]();if(2["$==="](Te))return ce;S.$raise("[Racc Bug] unknown jump code")}}else if(J["$=="](ce))h(S.yydebug)&&S.$racc_accept(),S.$throw("racc_end_parse",S.racc_vstack["$[]"](0));else{if(J["$=="](fe["$-@"]())){for((0)["$==="](Te=S.racc_error_status)?h(O["$[]"](21))||S.$on_error(S.racc_t,S.racc_val,S.racc_vstack):3["$==="](Te)&&(S.racc_t["$=="](0)&&S.$throw("racc_end_parse",t),S.racc_read_next=!0),S.racc_user_yyerror=!1,S.racc_error_status=3;h(!0)&&(!h(de=xe["$[]"](S.racc_state["$[]"](-1)))||(de=R(de,1),!h(h(Ee=h(Me=r(de,0))?J=ee["$[]"](de):Me)?te["$[]"](de)["$=="](S.racc_state["$[]"](-1)):Ee)));)h(u(S.racc_state.$size(),1))&&S.$throw("racc_end_parse",t),S.racc_state.$pop(),S.racc_vstack.$pop(),h(S.yydebug)&&(S.racc_tstack.$pop(),S.$racc_e_pop(S.racc_state,S.racc_tstack,S.racc_vstack));return J}S.$raise("[Racc Bug] unknown action "+J.$inspect())}return h(S.yydebug)&&S.$racc_next_state(S.racc_state["$[]"](-1),S.racc_state),t},l.$$arity=2),e.def(a,"$_racc_do_reduce",w=function(J,O){var i,ce,ge,Me,Ue,Ce,Be,A=this,ee=t,te=t,oe=t,xe=t,fe=t,we=t,le=t,Te=t,de=t,Ee=t,je=t,Ge=t,Fe=t,De=t,se=t,Re=t;return ee=null==(i=e.to_ary(J))[4]?t:i[4],te=null==i[5]?t:i[5],oe=null==i[6]?t:i[6],xe=null==i[7]?t:i[7],ce=null==i[8]?t:i[8],fe=null==i[9]?t:i[9],ge=null==i[13]?t:i[13],we=A.racc_state,le=A.racc_vstack,Te=A.racc_tstack,de=function(B,v){return"number"==typeof B?-3*B:B["$*"](-3)}(O),Ee=fe["$[]"](de),Me=fe["$[]"](R(de,1)),Ue=fe["$[]"](R(de,2)),Ce=[],h(A.yydebug)&&(je=Te["$[]"](Ee["$-@"](),Ee)),Ge=le["$[]"](Ee["$-@"](),Ee),h(A.yydebug)&&(Fe=[Ee["$-@"](),Ee,Ce],K(Te,"[]=",e.to_a(Fe)),X(Fe.length,1)),Fe=[Ee["$-@"](),Ee,Ce],K(le,"[]=",e.to_a(Fe)),X(Fe.length,1),Fe=[Ee["$-@"](),Ee,Ce],K(we,"[]=",e.to_a(Fe)),X(Fe.length,1),h(ge)?le.$push(A.$__send__(Ue,Ge,le,Ge["$[]"](0))):le.$push(A.$__send__(Ue,Ge,le)),Te.$push(Me),h(A.yydebug)&&A.$racc_reduce(je,Me,Te,le),Be=X(Me,ce),h(de=xe["$[]"](Be))&&(de=R(de,we["$[]"](-1)),h(h(De=h(se=r(de,0))?Re=ee["$[]"](de):se)?te["$[]"](de)["$=="](Be):De))?Re:oe["$[]"](Be)},w.$$arity=2),e.def(a,"$on_error",g=function(J,O,i){var A,M=this;return M.$raise($(p,"ParseError"),M.$sprintf("\nparse error on value %s (%s)",O.$inspect(),h(A=M.$token_to_str(J))?A:"?"))},g.$$arity=3),e.def(a,"$yyerror",P=function(){return this.$throw("racc_jump",1)},P.$$arity=0),e.def(a,"$yyaccept",s=function(){return this.$throw("racc_jump",2)},s.$$arity=0),e.def(a,"$yyerrok",T=function(){return this.racc_error_status=0},T.$$arity=0),e.def(a,"$racc_read_token",W=function(J,O,i){var M=this;return M.racc_debug_out.$print("read    "),M.racc_debug_out.$print(O.$inspect(),"(",M.$racc_token2str(J),") "),M.racc_debug_out.$puts(i.$inspect()),M.racc_debug_out.$puts()},W.$$arity=3),e.def(a,"$racc_shift",ae=function(J,O,i){var M=this;return M.racc_debug_out.$puts("shift   "+M.$racc_token2str(J)),M.$racc_print_stacks(O,i),M.racc_debug_out.$puts()},ae.$$arity=3),e.def(a,"$racc_reduce",ue=function(J,O,i,M){var A,S=this,ee=t;return(ee=S.racc_debug_out).$print("reduce "),h(J["$empty?"]())?ee.$print(" <none>"):K(J,"each",[],((A=function(oe){return null==oe&&(oe=t),ee.$print(" ",(null==A.$$s?this:A.$$s).$racc_token2str(oe))}).$$s=S,A.$$arity=1,A)),ee.$puts(" --\x3e "+S.$racc_token2str(O)),S.$racc_print_stacks(i,M),S.racc_debug_out.$puts()},ue.$$arity=4),e.def(a,"$racc_accept",ye=function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()},ye.$$arity=0),e.def(a,"$racc_e_pop",be=function(J,O,i){var M=this;return M.racc_debug_out.$puts("error recovering mode: pop token"),M.$racc_print_states(J),M.$racc_print_stacks(O,i),M.racc_debug_out.$puts()},be.$$arity=3),e.def(a,"$racc_next_state",pe=function(J,O){var i=this;return i.racc_debug_out.$puts("goto    "+J),i.$racc_print_states(O),i.racc_debug_out.$puts()},pe.$$arity=2),e.def(a,"$racc_print_stacks",qe=function(J,O){var i,A=t;return(A=this.racc_debug_out).$print("        ["),K(J,"each_index",[],((i=function(ee){return null==ee&&(ee=t),A.$print(" (",(null==i.$$s?this:i.$$s).$racc_token2str(J["$[]"](ee))," ",O["$[]"](ee).$inspect(),")")}).$$s=this,i.$$arity=1,i)),A.$puts(" ]")},qe.$$arity=2),e.def(a,"$racc_print_states",ke=function(J){var O,M=t;return(M=this.racc_debug_out).$print("        ["),K(J,"each",[],((O=function(S){return null==S&&(S=t),M.$print(" ",S)}).$$s=this,O.$$arity=1,O)),M.$puts(" ]")},ke.$$arity=1),e.def(a,"$racc_token2str",Ie=function(J){var i;return h(i=N(this.$class(),"Racc_token_to_s_table")["$[]"](J))?i:this.$raise("[Racc Bug] can't convert token "+J+" to string")},Ie.$$arity=1),e.def(a,"$token_to_str",ze=function(J){return N(this.$class(),"Racc_token_to_s_table")["$[]"](J)},ze.$$arity=1)}(z[0],z)},Opal.modules["bcdice/arithmetic/node"]=function(e){function H(z,t){return"number"==typeof z&&"number"==typeof t?z/t:z["$/"](t)}var t,Z,B,G,L,d,a,p,D,_,f,b,n,m,V,k,$,R=[],r=e.nil,c=e.$$$,u=e.$$,re=e.module,o=e.klass,U=e.send2;return t=R,Z=$=[re(R[0],"BCDice")].concat(t),B=k=[re($[0],"Arithmetic")].concat(Z),function(G,L,d){var a,p,D,_,f,n=o(G,null,"BinaryOp");[n].concat(d),n.$$prototype.lhs=n.$$prototype.rhs=n.$$prototype.op=r,e.def(n,"$initialize",a=function(C,Y,E){var y=this;return y.lhs=C,y.op=Y,y.rhs=E},a.$$arity=3),e.def(n,"$eval",p=function(C){var y,Y=this,E=r;return E=Y.lhs.$eval(C),y=Y.rhs.$eval(C),E.$send(Y.op,y)},p.$$arity=1),e.def(n,"$output",D=function(){var C=this;return""+C.lhs.$output()+C.op+C.rhs.$output()},D.$$arity=0),e.def(n,"$s_exp",_=function(){var C=this;return"("+C.$op_for_s_exp()+" "+C.lhs.$s_exp()+" "+C.rhs.$s_exp()+")"},_.$$arity=0),e.def(n,"$op_for_s_exp",f=function(){return this.op},f.$$arity=0)}((V=[re(k[0],"Node")].concat(B))[0],0,V),G=V[0],L=u(V,"BinaryOp"),d=V,n=o(G,L,"DivideBase"),m=[n].concat(d),n.$$prototype.lhs=n.$$prototype.rhs=n.$$prototype.op=r,e.def(n,"$initialize",a=function(Y,E){return a.$$p&&(a.$$p=null),U(this,e.find_super_dispatcher(this,"initialize",a,!1,!0),"initialize",[Y,"/",E],null)},a.$$arity=2),e.def(n,"$eval",p=function(Y){var y,E=this,l=r;return y=E.lhs.$eval(Y),(l=E.rhs.$eval(Y))["$=="](0)&&E.$raise(u(m,"ZeroDivisionError")),E.$divide_and_round(y,l,Y)},p.$$arity=1),e.def(n,"$output",D=function(){var Y=D.$$p,y=this,l=r,w=r,g=r;for(Y&&(D.$$p=null),w=0,g=arguments.length,l=new Array(g);w<g;w++)l[w]=arguments[w];return""+U(y,e.find_super_dispatcher(y,"output",D,!1,!0),"output",l,Y)+y.$rounding_method()},D.$$arity=0),n.$private(),e.def(n,"$rounding_method",_=function(){return c(this.$class(),"ROUNDING_METHOD")},_.$$arity=0),e.def(n,"$op_for_s_exp",f=function(){return""+this.op+this.$rounding_method()},f.$$arity=0),e.def(n,"$divide_and_round",b=function(Y,E,y){return this.$raise(u(m,"NotImplementedError"))},b.$$arity=3),function(G,L,d){var a,n=o(G,L,"DivideWithGameSystemDefault"),m=[n].concat(d);e.const_set(m[0],"ROUNDING_METHOD",""),n.$private(),e.def(n,"$divide_and_round",a=function(D,_,f){var C;return C=f,c(u(m,"RoundType"),"CEIL")["$==="](C)?H(D.$to_f(),_).$ceil():c(u(m,"RoundType"),"ROUND")["$==="](C)?H(D.$to_f(),_).$round():H(D,_).$to_i()},a.$$arity=3)}(V[0],u(V,"DivideBase"),V),function(G,L,d){var a,n=o(G,L,"DivideWithCeil"),m=[n].concat(d);e.const_set(m[0],"ROUNDING_METHOD","C"),n.$private(),e.def(n,"$divide_and_round",a=function(D,_,f){return H(D.$to_f(),_).$ceil()},a.$$arity=3)}(V[0],u(V,"DivideBase"),V),function(G,L,d){var a,n=o(G,L,"DivideWithRound"),m=[n].concat(d);e.const_set(m[0],"ROUNDING_METHOD","R"),n.$private(),e.def(n,"$divide_and_round",a=function(D,_,f){return H(D.$to_f(),_).$round()},a.$$arity=3)}(V[0],u(V,"DivideBase"),V),function(G,L,d){var a,n=o(G,L,"DivideWithFloor"),m=[n].concat(d);e.const_set(m[0],"ROUNDING_METHOD","F"),n.$private(),e.def(n,"$divide_and_round",a=function(D,_,f){return H(D,_).$to_i()},a.$$arity=3)}(V[0],u(V,"DivideBase"),V),function(G,L,d){var a,p,D,_,n=o(G,null,"Negative");[n].concat(d),n.$$prototype.body=r,e.def(n,"$initialize",a=function(b){return this.body=b},a.$$arity=1),e.def(n,"$eval",p=function(b){return this.body.$eval(b)["$-@"]()},p.$$arity=1),e.def(n,"$output",D=function(){return"-"+this.body.$output()},D.$$arity=0),e.def(n,"$s_exp",_=function(){return"(- "+this.body.$s_exp()+")"},_.$$arity=0)}(V[0],0,V),function(G,L,d){var a,p,D,_,n=o(G,null,"Parenthesis");[n].concat(d),n.$$prototype.expr=r,e.def(n,"$initialize",a=function(b){return this.expr=b},a.$$arity=1),e.def(n,"$eval",p=function(b){return this.expr.$eval(b)},p.$$arity=1),e.def(n,"$output",D=function(){return"("+this.expr.$output()+")"},D.$$arity=0),e.def(n,"$s_exp",_=function(){return"(Parenthesis "+this.expr.$s_exp()+")"},_.$$arity=0)}(V[0],0,V),void function(G,L,d){var a,p,D,n=o(G,null,"Number");[n].concat(d),n.$$prototype.value=r,e.def(n,"$initialize",a=function(f){return this.value=f},a.$$arity=1),e.def(n,"$eval",p=function(f){return this.value},p.$$arity=1),e.def(n,"$output",D=function(){return this.value.$to_s()},D.$$arity=0),e.alias(n,"s_exp","output")}(V[0],0,V)},Opal.modules.strscan=function(e){var N,Z,h,k,K,B,v,V,G,L,d,n,m,a,p,D,_,f,b,C,Y,E,y,l,w,g,$,I,R=[],r=e.nil,u=e.$$,o=e.truthy,U=e.send;return N=R,$=(0,e.klass)(R[0],null,"StringScanner"),I=[$].concat(N),$.$$prototype.pos=$.$$prototype.string=$.$$prototype.working=$.$$prototype.matched=$.$$prototype.prev_pos=$.$$prototype.match=r,$.$attr_reader("pos"),$.$attr_reader("matched"),e.def($,"$initialize",Z=function(s){var T=this;return T.string=s,T.pos=0,T.matched=r,T.working=s,T.match=[]},Z.$$arity=1),$.$attr_reader("string"),e.def($,"$beginning_of_line?",h=function(){var s=this;return 0===s.pos||"\n"===s.string.charAt(s.pos-1)},h.$$arity=0),e.alias($,"bol?","beginning_of_line?"),e.def($,"$scan",k=function(s){var T=this,W=(s=T.$anchor(s)).exec(T.working);return null==W?T.matched=r:"object"==typeof W?(T.prev_pos=T.pos,T.pos+=W[0].length,T.working=T.working.substring(W[0].length),T.matched=W[0],T.match=W,W[0]):"string"==typeof W?(T.pos+=W.length,T.working=T.working.substring(W.length),W):r},k.$$arity=1),e.def($,"$scan_until",K=function(s){var T=this;s=T.$anchor(s);for(var ue,W=T.pos,ae=T.working;;){if(ue=s.exec(ae),W+=1,ae=ae.substr(1),null!=ue)return T.matched=T.string.substr(T.pos,W-T.pos-1+ue[0].length),T.match=ue,T.prev_pos=W-1,T.pos=W,T.working=ae.substr(ue[0].length),T.matched;if(0===ae.length)return T.match=[],T.matched=r}},K.$$arity=1),e.def($,"$[]",B=function(s){var W;if(o(this.match["$empty?"]()))return r;W=s,u(I,"Symbol")["$==="](W)?s=s.$to_s():u(I,"String")["$==="](W)||(s=u(I,"Opal")["$coerce_to!"](s,u(I,"Integer"),"to_int"));var ae=this.match;return s<0&&(s+=ae.length),s<0||s>=ae.length||null==ae[s]?r:ae[s]},B.$$arity=1),e.def($,"$check",v=function(s){var T=this,W=(s=T.$anchor(s)).exec(T.working);return T.matched=null==W?r:W[0]},v.$$arity=1),e.def($,"$check_until",V=function(s){var T=this,W=T.prev_pos,ae=T.pos,ue=T.$scan_until(s);return ue!==r&&(T.matched=ue.substr(-1),T.working=T.string.substr(ae)),T.prev_pos=W,T.pos=ae,ue},V.$$arity=1),e.def($,"$peek",G=function(s){return this.working.substring(0,s)},G.$$arity=1),e.def($,"$eos?",L=function(){return 0===this.working.length},L.$$arity=0),e.def($,"$exist?",d=function(s){var W=s.exec(this.working);return null==W?r:0==W.index?0:W.index+1},d.$$arity=1),e.def($,"$skip",n=function(s){var T=this,W=(s=T.$anchor(s)).exec(T.working);if(null==W)return T.match=[],T.matched=r;var ae=W[0],ue=ae.length;return T.matched=ae,T.match=W,T.prev_pos=T.pos,T.pos+=ue,T.working=T.working.substring(ue),ue},n.$$arity=1),e.def($,"$skip_until",m=function(s){var W=this.$scan_until(s);return W===r?r:(this.matched=W.substr(-1),W.length)},m.$$arity=1),e.def($,"$get_byte",a=function(){var s=this,T=r;return s.pos<s.string.length?(s.prev_pos=s.pos,s.pos+=1,T=s.matched=s.working.substring(0,1),s.working=s.working.substring(1)):s.matched=r,T},a.$$arity=0),e.alias($,"getch","get_byte"),e.def($,"$match?",p=function(s){var T=this,W=(s=T.$anchor(s)).exec(T.working);return null==W?r:(T.prev_pos=T.pos,W[0].length)},p.$$arity=1),e.def($,"$pos=",D=function(s){var T=this;return s<0&&(s+=T.string.$length()),T.pos=s,T.working=T.string.slice(s)},D.$$arity=1),e.def($,"$matched_size",_=function(){return this.matched===r?r:this.matched.length},_.$$arity=0),e.def($,"$post_match",f=function(){var s=this;return s.matched===r?r:s.string.substr(s.pos)},f.$$arity=0),e.def($,"$pre_match",b=function(){var s=this;return s.matched===r?r:s.string.substr(0,s.prev_pos)},b.$$arity=0),e.def($,"$reset",C=function(){var s=this;return s.working=s.string,s.matched=r,s.pos=0},C.$$arity=0),e.def($,"$rest",Y=function(){return this.working},Y.$$arity=0),e.def($,"$rest?",E=function(){return 0!==this.working.length},E.$$arity=0),e.def($,"$rest_size",y=function(){return this.$rest().$size()},y.$$arity=0),e.def($,"$terminate",l=function(){var T,z,s=this;return s.match=r,T=[s.string.$length()],U(s,"pos=",e.to_a(T)),T[(z=T.length,"number"==typeof z?z-1:z["$-"](1))]},l.$$arity=0),e.def($,"$unscan",w=function(){var s=this;return s.pos=s.prev_pos,s.prev_pos=r,s.match=r,s},w.$$arity=0),$.$private(),e.def($,"$anchor",g=function(s){var W=s.toString().match(/\/([^\/]+)$/);return W=W?W[1]:void 0,new RegExp("^(?:"+s.source+")",W)},g.$$arity=1),r&&"anchor"},Opal.modules["bcdice/normalize"]=function(e){var N,Z,h,$,o,z,X=[],R=e.nil,u=e.module;return o=X,N=z=[u(X[0],"BCDice")].concat(o),[$=u(z[0],"Normalize")].concat(N),$.$module_function(),e.def($,"$comparison_operator",Z=function(K){var v;return/<=|=</["$==="](v=K)?"<=":/>=|=>/["$==="](v)?">=":/<>|!=|=!/["$==="](v)?"!=":/</["$==="](v)?"<":/>/["$==="](v)?">":/=/["$==="](v)?"==":R},Z.$$arity=1),void e.def($,"$target_number",h=function(K){return K["$=="]("?")?K:K.$to_i()},h.$$arity=1)},Opal.modules["bcdice/command/lexer"]=function(e){var N,h,V,d,n,m,G,L,K,I,H=e.top,X=[],R=e.nil,c=e.$$,u=e.module,re=e.klass,o=e.hash2,U=e.truthy,z=e.send;return H.$require("strscan"),H.$require("bcdice/normalize"),N=X,h=I=[u(X[0],"BCDice")].concat(N),V=K=[u(I[0],"Command")].concat(h),G=re(K[0],null,"Lexer"),L=[G].concat(V),G.$$prototype.scanner=G.$$prototype.notations=R,e.const_set(L[0],"SYMBOLS",o(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),e.def(G,"$initialize",d=function(p,D){var _,f,b,Y,C=this;return p=U(Y=(f=(_=p)===R||null==_?R:z(_,"split",[" ",2]))===R||null==f?R:z(f,"first",[]))?Y:"",C.scanner=c(L,"StringScanner").$new(p),C.notations=z(D,"map",[],((b=function(E){function y(l){return E.apply(this,arguments)}return y.toString=function(){return E.toString()},y}(function(E){return null==E&&(E=R),U(E["$is_a?"](c(L,"String")))?c(L,"Regexp").$new(E):E})).$$s=C,b.$$arity=1,b))},d.$$arity=2),e.def(G,"$next_token",n=function(){try{var p,D=this,_=R,f=R,C=R,Y=R;return U(D.scanner["$eos?"]())?[!1,"$"]:(z(D.notations,"each",[],((p=function(y){var w,l=null==p.$$s?this:p.$$s;if(null==l.scanner&&(l.scanner=R),null==y&&(y=R),w=l.scanner.$scan(y),!U(w))return R;e.ret(["NOTATION",w])}).$$s=D,p.$$arity=1,p)),U(_=D.scanner.$scan(/\d+/))?["NUMBER",_.$to_i()]:U(f=D.scanner.$scan(/[<>!=]+/))?(f=c(L,"Normalize").$comparison_operator(f),[U(f)?"CMP_OP":"ILLEGAL",f]):(C=D.scanner.$getch().$upcase(),[U(Y=c(L,"SYMBOLS")["$[]"](C))?Y:C.$to_sym(),C]))}catch(E){if(E===e.returner)return E.$v;throw E}},n.$$arity=0),void e.def(G,"$source",m=function(){return this.scanner.$string()},m.$$arity=0)},Opal.modules["bcdice/command/parsed"]=function(e){var z,I,B,G,L,d,v,V,h,N,X=[],R=e.nil,c=e.$$,u=e.module,re=e.klass,o=e.truthy;return z=X,I=N=[u(X[0],"BCDice")].concat(z),B=h=[u(N[0],"Command")].concat(I),v=re(h[0],null,"Parsed"),V=[v].concat(B),v.$$prototype.question_target=v.$$prototype.critical=v.$$prototype.fumble=v.$$prototype.dollar=v.$$prototype.modify_number=v.$$prototype.target_number=v.$$prototype.prefix_number=v.$$prototype.command=v.$$prototype.suffix_number=v.$$prototype.cmp_op=R,v.$attr_accessor("command"),v.$attr_accessor("prefix_number"),v.$attr_accessor("suffix_number"),v.$attr_accessor("critical"),v.$attr_accessor("fumble"),v.$attr_accessor("dollar"),v.$attr_accessor("modify_number"),v.$attr_accessor("cmp_op"),v.$attr_accessor("target_number"),v.$attr_writer("question_target"),e.def(v,"$initialize",G=function(){var m=this;return m.prefix_number=R,m.suffix_number=R,m.critical=R,m.fumble=R,m.dollar=R,m.cmp_op=R,m.target_number=R,m.question_target=!1},G.$$arity=0),e.def(v,"$question_target?",L=function(){return this.question_target},L.$$arity=0),void e.def(v,"$to_s",d=function(m){var C,a=this,p=R,D=R,_=R,f=R,b=R;return null==m&&(m="after_command"),p=o(a.critical)?"@"+a.critical:R,D=o(a.fumble)?"#"+a.fumble:R,_=o(a.dollar)?"$"+a.dollar:R,f=c(V,"Format").$modifier(a.modify_number),b=o(a.question_target)?"?":a.target_number,"after_command"["$==="](C=m)?[a.prefix_number,a.command,a.suffix_number,p,D,_,f,a.cmp_op,b].$join():"after_modify_number"["$==="](C)?[a.prefix_number,a.command,a.suffix_number,f,p,D,_,a.cmp_op,b].$join():"after_target_number"["$==="](C)?[a.prefix_number,a.command,a.suffix_number,f,a.cmp_op,b,p,D,_].$join():R},d.$$arity=-1)},Opal.modules["bcdice/command/parser"]=function(e){function H(I,Z){return"number"==typeof I&&"number"==typeof Z?I-Z:I["$-"](Z)}var Z,B,G,L,d,a,p,D,_,f,b,C,Y,E,y,l,w,g,P,s,T,W,ae,ue,ye,be,pe,qe,ke,Ie,ze,ve,J,O,i,M,A,S,ee,te,oe,xe,ce,fe,ge,we,le,Te,de,Ee,Me,Ue,Ce,je,Ge,Fe,Be,De,se,Re,me,n,m,V,k,X=e.top,R=[],r=e.nil,c=e.$$$,u=e.$$,re=e.klass,o=e.module,U=e.hash2,z=e.send2,t=e.send,N=e.hash,$=e.truthy;return X.$require("racc/parser.rb"),X.$require("bcdice/arithmetic/node"),X.$require("bcdice/command/lexer"),X.$require("bcdice/command/parsed"),function(I,Z,h){[re(I,Z,"Parser")].concat(h)}(c(u(R,"BCDice"),"Command"),c(u(R,"Racc"),"Parser"),R),Z=R,B=k=[o(R[0],"BCDice")].concat(Z),G=(V=[o(k[0],"Command")].concat(B))[0],L=c(u(V,"Racc"),"Parser"),d=V,n=re(G,L,"Parser"),m=[n].concat(d),n.$$prototype.notations=n.$$prototype.lexer=n.$$prototype.modifier=n.$$prototype.prefix_number=n.$$prototype.suffix_number=n.$$prototype.need_suffix_number=n.$$prototype.need_prefix_number=n.$$prototype.critical=n.$$prototype.fumble=n.$$prototype.dollar=n.$$prototype.allowed_cmp_op=n.$$prototype.question_target=r,e.def(n,"$initialize",a=function(x,ne){var q,j,ie,Le,Ne=a.$$p,Se=this;if(Ne&&(a.$$p=null),q=e.slice.call(arguments,0,arguments.length),null==(j=e.extract_kwargs(q)))j=U([],{});else if(!j.$$is_hash)throw e.ArgumentError.$new("expected kwargs");if(ie=q,!e.hasOwnProperty.call(j.$$smap,"round_type"))throw e.ArgumentError.$new("missing keyword: round_type");return Le=j.$$smap.round_type,z(Se,e.find_super_dispatcher(Se,"initialize",a,!1,!0),"initialize",[],null),Se.notations=ie,Se.round_type=Le,Se.prefix_number=!1,Se.suffix_number=!1,Se.need_prefix_number=!1,Se.need_suffix_number=!1,Se.modifier=!0,Se.critical=!1,Se.fumble=!1,Se.dollar=!1,Se.allowed_cmp_op=[r,">=",">","<=","<","==","!="],Se.question_target=!1},a.$$arity=-2),e.def(n,"$disable_modifier",p=function(){return this.modifier=!1,this},p.$$arity=0),e.def(n,"$enable_prefix_number",D=function(){return this.prefix_number=!0,this},D.$$arity=0),e.def(n,"$enable_suffix_number",_=function(){return this.suffix_number=!0,this},_.$$arity=0),e.def(n,"$has_prefix_number",f=function(){var x=this;return x.prefix_number=!0,x.need_prefix_number=!0,x},f.$$arity=0),e.def(n,"$has_suffix_number",b=function(){var x=this;return x.suffix_number=!0,x.need_suffix_number=!0,x},b.$$arity=0),e.def(n,"$enable_critical",C=function(){return this.critical=!0,this},C.$$arity=0),e.def(n,"$enable_fumble",Y=function(){return this.fumble=!0,this},Y.$$arity=0),e.def(n,"$enable_dollar",E=function(){return this.dollar=!0,this},E.$$arity=0),e.def(n,"$restrict_cmp_op_to",y=function(x){var ne,j=this;return ne=e.slice.call(arguments,0,arguments.length),j.allowed_cmp_op=ne,j},y.$$arity=-1),e.def(n,"$enable_question_target",l=function(){return this.question_target=!0,this},l.$$arity=0),e.def(n,"$parse",w=function(x){try{return this.lexer=u(m,"Lexer").$new(x,this.notations),this.$do_parse()}catch(q){if(!e.rescue(q,[u(m,"ParseError"),u(m,"ZeroDivisionError")]))throw q;try{return r}finally{e.pop_exception()}}},w.$$arity=1),n.$private(),e.def(n,"$parsed",g=function(x,ne,q,j){var ie;return t(u(m,"Parsed").$new(),"tap",[],((ie=function(Ae){var We,He,Ke,Ye,Ve,Qe,Se=null==ie.$$s?this:ie.$$s,he=r;return null==Se.round_type&&(Se.round_type=r),null==Ae&&(Ae=r),he=[x["$[]"]("command")],t(Ae,"command=",e.to_a(he)),H(he.length,1),he=[(We=x["$[]"]("prefix"),We===r||null==We?r:t(We,"eval",[Se.round_type]))],t(Ae,"prefix_number=",e.to_a(he)),H(he.length,1),he=[(He=x["$[]"]("suffix"),He===r||null==He?r:t(He,"eval",[Se.round_type]))],t(Ae,"suffix_number=",e.to_a(he)),H(he.length,1),he=[(Ke=ne["$[]"]("critical"),Ke===r||null==Ke?r:t(Ke,"eval",[Se.round_type]))],t(Ae,"critical=",e.to_a(he)),H(he.length,1),he=[(Ye=ne["$[]"]("fumble"),Ye===r||null==Ye?r:t(Ye,"eval",[Se.round_type]))],t(Ae,"fumble=",e.to_a(he)),H(he.length,1),he=[(Ve=ne["$[]"]("dollar"),Ve===r||null==Ve?r:t(Ve,"eval",[Se.round_type]))],t(Ae,"dollar=",e.to_a(he)),H(he.length,1),he=[q.$eval(Se.round_type)],t(Ae,"modify_number=",e.to_a(he)),H(he.length,1),he=[j["$[]"]("cmp_op")],t(Ae,"cmp_op=",e.to_a(he)),H(he.length,1),j["$[]"]("target")["$=="]("?")?(t(Ae,"question_target=",e.to_a(he=[!0])),H(he.length,1),t(Ae,"target_number=",e.to_a(he=[0])),he[H(he.length,1)]):(t(Ae,"question_target=",e.to_a(he=[!1])),H(he.length,1),he=[(Qe=j["$[]"]("target"),Qe===r||null==Qe?r:t(Qe,"eval",[Se.round_type]))],t(Ae,"target_number=",e.to_a(he)),he[H(he.length,1)])}).$$s=this,ie.$$arity=1,ie))},g.$$arity=4),e.def(n,"$next_token",P=function(){return this.lexer.$next_token()},P.$$arity=0),Ue=[6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,33,34,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,r,r,17,18,6,r,5,r,r,17,18,r,r,5,23,24,25,26,56,54,55,57],Ce=[0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,r,17,15,15,18,18,23,r,18,30,30,23,23,24,r,23,31,31,24,24,25,r,24,44,44,25,25,28,r,25,47,47,28,28,29,r,28,48,48,29,29,33,r,29,49,49,33,33,34,r,33,50,50,34,34,36,r,34,r,r,36,36,37,r,36,r,r,37,37,r,r,37,27,27,27,27,52,52,52,52],je=[-2,4,16,-3,-1,11,r,33,13,35,23,30,1,r,28,40,r,37,44,r,r,-2,r,51,58,65,0,106,72,79,47,54,r,86,93,r,100,107,r,r,r,r,r,r,63,r,r,68,75,82,89,r,120,r,r,r,r,r],Ge=[-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29],Fe=[30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,r,r,21,47,48,40,51,52,49,50,44,46,3,r,r,r,13,r,r,r,r,r,r,r,32],Be=[8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,r,r,4,8,8,5,7,7,8,8,9,5,6,r,r,r,6,r,r,r,r,r,r,r,6],De=[r,6,13,3,9,-1,27,-15,-10,-1,-38],se=[r,r,r,r,r,r,19,16,15,r,r],Re=[0,0,"racc_error",4,20,"_reduce_1",4,20,"_reduce_2",3,20,"_reduce_3",3,21,"_reduce_4",2,21,"_reduce_5",2,21,"_reduce_6",1,21,"_reduce_7",0,22,"_reduce_8",3,22,"_reduce_9",3,22,"_reduce_10",3,22,"_reduce_11",2,23,"_reduce_12",2,23,"_reduce_13",3,23,"_reduce_14",3,23,"_reduce_15",0,24,"_reduce_16",2,24,"_reduce_17",2,24,"_reduce_18",3,28,"_reduce_19",3,28,"_reduce_20",1,28,"_reduce_none",3,27,"_reduce_22",4,27,"_reduce_23",1,27,"_reduce_none",0,29,"_reduce_25",1,29,"_reduce_26",1,29,"_reduce_27",1,29,"_reduce_28",1,29,"_reduce_29",2,26,"_reduce_30",2,26,"_reduce_31",1,26,"_reduce_none",3,25,"_reduce_33",1,25,"_reduce_34"],me=N(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),e.const_set(m[0],"Racc_arg",[Ue,Ce,Ge,je,Fe,Be,se,De,19,Re,me,58,35,!0]),e.const_set(m[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),e.const_set(m[0],"Racc_debug_parser",!1),e.def(n,"$_reduce_1",s=function(x,ne,q){var j;return $(this.modifier)||this.$raise(u(m,"ParseError")),j=e.to_ary(x),this.$parsed(null==j[0]?r:j[0],null==j[1]?r:j[1],null==j[2]?r:j[2],null==j[3]?r:j[3])},s.$$arity=3),e.def(n,"$_reduce_2",T=function(x,ne,q){var j;return $(this.modifier)||this.$raise(u(m,"ParseError")),j=e.to_ary(x),this.$parsed(null==j[0]?r:j[0],null==j[2]?r:j[2],null==j[1]?r:j[1],null==j[3]?r:j[3])},T.$$arity=3),e.def(n,"$_reduce_3",W=function(x,ne,q){var j,Se;return Se=null==(j=e.to_ary(x))[2]?r:j[2],this.$parsed(null==j[0]?r:j[0],null==j[1]?r:j[1],c(c(u(m,"Arithmetic"),"Node"),"Number").$new(0),Se)},W.$$arity=3),e.def(n,"$_reduce_4",ae=function(x,ne,q){var ie,j=this;return $($(ie=j.prefix_number)?j.suffix_number:ie)||j.$raise(u(m,"ParseError")),U(["command","prefix","suffix"],{command:x["$[]"](1),prefix:x["$[]"](0),suffix:x["$[]"](2)})},ae.$$arity=3),e.def(n,"$_reduce_5",ue=function(x,ne,q){var j=this;return $(j.prefix_number)||j.$raise(u(m,"ParseError")),$(j.need_suffix_number)&&j.$raise(u(m,"ParseError")),U(["command","prefix"],{command:x["$[]"](1),prefix:x["$[]"](0)})},ue.$$arity=3),e.def(n,"$_reduce_6",ye=function(x,ne,q){var j=this;return $(j.suffix_number)||j.$raise(u(m,"ParseError")),$(j.need_prefix_number)&&j.$raise(u(m,"ParseError")),U(["command","suffix"],{command:x["$[]"](0),suffix:x["$[]"](1)})},ye.$$arity=3),e.def(n,"$_reduce_7",be=function(x,ne,q){var ie,j=this;return $($(ie=j.need_prefix_number)?ie:j.need_suffix_number)&&j.$raise(u(m,"ParseError")),U(["command"],{command:x["$[]"](0)})},be.$$arity=3),e.def(n,"$_reduce_8",pe=function(x,ne,q){return U([],{})},pe.$$arity=3),e.def(n,"$_reduce_9",qe=function(x,ne,q){var j,Se,He,We,Ne=r;return Ne=null==(j=e.to_ary(x))[0]?r:j[0],Se=null==j[2]?r:j[2],$($(We=this.critical)?Ne["$[]"]("critical")["$nil?"]():We)||this.$raise(u(m,"ParseError")),t(Ne,"[]=",e.to_a(He=["critical",Se])),H(He.length,1),Ne},qe.$$arity=3),e.def(n,"$_reduce_10",ke=function(x,ne,q){var j,Se,He,We,Ne=r;return Ne=null==(j=e.to_ary(x))[0]?r:j[0],Se=null==j[2]?r:j[2],$($(We=this.fumble)?Ne["$[]"]("fumble")["$nil?"]():We)||this.$raise(u(m,"ParseError")),t(Ne,"[]=",e.to_a(He=["fumble",Se])),H(He.length,1),Ne},ke.$$arity=3),e.def(n,"$_reduce_11",Ie=function(x,ne,q){var j,Se,He,We,Ne=r;return Ne=null==(j=e.to_ary(x))[0]?r:j[0],Se=null==j[2]?r:j[2],$($(We=this.dollar)?Ne["$[]"]("dollar")["$nil?"]():We)||this.$raise(u(m,"ParseError")),t(Ne,"[]=",e.to_a(He=["dollar",Se])),H(He.length,1),Ne},Ie.$$arity=3),e.def(n,"$_reduce_12",ze=function(x,ne,q){return x["$[]"](1)},ze.$$arity=3),e.def(n,"$_reduce_13",ve=function(x,ne,q){return c(c(u(m,"Arithmetic"),"Node"),"Negative").$new(x["$[]"](1))},ve.$$arity=3),e.def(n,"$_reduce_14",J=function(x,ne,q){return c(c(u(m,"Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"+",x["$[]"](2))},J.$$arity=3),e.def(n,"$_reduce_15",O=function(x,ne,q){return c(c(u(m,"Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"-",x["$[]"](2))},O.$$arity=3),e.def(n,"$_reduce_16",i=function(x,ne,q){return $(this.allowed_cmp_op["$include?"](r))||this.$raise(u(m,"ParseError")),U([],{})},i.$$arity=3),e.def(n,"$_reduce_17",M=function(x,ne,q){var j,Ne,Ae;return Ae=null==(j=e.to_ary(x))[1]?r:j[1],$(this.allowed_cmp_op["$include?"](Ne=null==j[0]?r:j[0]))||this.$raise(u(m,"ParseError")),U(["cmp_op","target"],{cmp_op:Ne,target:Ae})},M.$$arity=3),e.def(n,"$_reduce_18",A=function(x,ne,q){var ie,j=this;return ie=x["$[]"](0),$(j.question_target)||j.$raise(u(m,"ParseError")),$(j.allowed_cmp_op["$include?"](ie))||j.$raise(u(m,"ParseError")),U(["cmp_op","target"],{cmp_op:ie,target:"?"})},A.$$arity=3),e.def(n,"$_reduce_19",S=function(x,ne,q){return c(c(u(m,"Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"+",x["$[]"](2))},S.$$arity=3),e.def(n,"$_reduce_20",ee=function(x,ne,q){return c(c(u(m,"Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"-",x["$[]"](2))},ee.$$arity=3),e.def(n,"$_reduce_22",te=function(x,ne,q){return c(c(u(m,"Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"*",x["$[]"](2))},te.$$arity=3),e.def(n,"$_reduce_23",oe=function(x,ne,q){return x["$[]"](3).$new(x["$[]"](0),x["$[]"](2))},oe.$$arity=3),e.def(n,"$_reduce_25",xe=function(x,ne,q){return c(c(u(m,"Arithmetic"),"Node"),"DivideWithGameSystemDefault")},xe.$$arity=3),e.def(n,"$_reduce_26",ce=function(x,ne,q){return c(c(u(m,"Arithmetic"),"Node"),"DivideWithCeil")},ce.$$arity=3),e.def(n,"$_reduce_27",fe=function(x,ne,q){return c(c(u(m,"Arithmetic"),"Node"),"DivideWithCeil")},fe.$$arity=3),e.def(n,"$_reduce_28",ge=function(x,ne,q){return c(c(u(m,"Arithmetic"),"Node"),"DivideWithRound")},ge.$$arity=3),e.def(n,"$_reduce_29",we=function(x,ne,q){return c(c(u(m,"Arithmetic"),"Node"),"DivideWithFloor")},we.$$arity=3),e.def(n,"$_reduce_30",le=function(x,ne,q){return x["$[]"](1)},le.$$arity=3),e.def(n,"$_reduce_31",Te=function(x,ne,q){return c(c(u(m,"Arithmetic"),"Node"),"Negative").$new(x["$[]"](1))},Te.$$arity=3),e.def(n,"$_reduce_33",de=function(x,ne,q){return x["$[]"](1)},de.$$arity=3),e.def(n,"$_reduce_34",Ee=function(x,ne,q){return c(c(u(m,"Arithmetic"),"Node"),"Number").$new(x["$[]"](0))},Ee.$$arity=3),void e.def(n,"$_reduce_none",Me=function(x,ne,q){return x["$[]"](0)},Me.$$arity=3)},Opal.modules["bcdice/deprecated/checker"]=function(e){var z,I,K,V,G,L,d,n,m,B,v,h,N,X=[],R=e.nil,c=e.$$,u=e.module,re=e.send,o=e.truthy;return z=X,I=N=[u(X[0],"BCDice")].concat(z),K=h=[u(N[0],"Deprecated")].concat(I),B=u(h[0],"Checker"),v=[B].concat(K),B.$private(),e.def(B,"$check_result_legacy",V=function(p,D,_,f){var E,w,b=this,C=R,Y=R,y=R,l=R,g=R;return C=re(D,"map",[],"sides".$to_proc()),E=(Y=re(D,"map",[],"value".$to_proc())).$sum(),y=[100]["$==="](l=C)?b.$check_1D100(p,E,_,f):[20]["$==="](l)?b.$check_1D20(p,E,_,f):[6,6]["$==="](l)?b.$check_2D6(p,E,Y,_,f):R,o(o(w=y["$nil?"]())?w:y["$empty?"]())&&(l=C.$uniq(),y=[10]["$==="](l)?b.$check_nD10(p,E,Y,_,f):[6]["$==="](l)?b.$check_nD6(p,E,Y,_,f):R,o(o(g=y["$nil?"]())?g:y["$empty?"]()))?R:c(v,"Result").$new(y.$delete_prefix(" \uff1e "))},V.$$arity=4),e.def(B,"$check_1D100",G=function(p,D,_,f){return R},G.$$arity=4),e.def(B,"$check_1D20",L=function(p,D,_,f){return R},L.$$arity=4),e.def(B,"$check_nD10",d=function(p,D,_,f,b){return R},d.$$arity=5),e.def(B,"$check_2D6",n=function(p,D,_,f,b){return R},n.$$arity=5),void e.def(B,"$check_nD6",m=function(p,D,_,f,b){return R},m.$$arity=5)},Opal.modules["bcdice/base"]=function(e){function H(k,K){return"number"==typeof k&&"number"==typeof K?k+K:k["$+"](K)}function X(k,K){return"number"==typeof k&&"number"==typeof K?k-K:k["$-"](K)}var K,L,m,a,p,D,_,f,b,C,Y,E,y,l,w,g,P,s,T,W,ae,ue,ye,be,pe,qe,ke,Ie,ze,ve,J,O,A,S,ee,te,oe,M,d,n,v,u=e.top,re=[],o=e.nil,U=e.$$$,z=e.$$,t=e.module,N=e.klass,$=e.truthy,I=e.send,Z=e.range,h=o;return u.$require("i18n"),u.$require("i18n/backend/fallbacks"),u.$require("bcdice/randomizer"),u.$require("bcdice/dice_table"),u.$require("bcdice/enum"),u.$require("bcdice/translate"),u.$require("bcdice/result"),u.$require("bcdice/command/parser"),u.$require("bcdice/deprecated/checker"),K=re,L=v=[t(re[0],"BCDice")].concat(K),d=N(v[0],null,"Base"),n=[d].concat(L),d.$$prototype.sort_add_dice=d.$$prototype.sort_barabara_dice=d.$$prototype.enabled_d9=d.$$prototype.raw_input=d.$$prototype.randomizer=d.$$prototype.enabled_upcase_input=d.$$prototype.debug=o,O=e.get_singleton_class(d),M=[O].concat(n),O.$attr_reader("prefixes"),e.def(O,"$register_prefix",A=function(ce){var ge,we=this,le=o;return null==we.prefixes&&(we.prefixes=o),ge=e.slice.call(arguments,0,arguments.length),we.prefixes=$(le=we.prefixes)?le:[],we.prefixes.$concat(ge.$flatten())},A.$$arity=-1),e.def(O,"$register_prefix_from_super_class",S=function(){return this.$register_prefix(this.$superclass().$prefixes())},S.$$arity=0),e.def(O,"$prefixes_pattern",ee=function(){var fe,ce=this,ge=o;return null==ce.prefixes_pattern&&(ce.prefixes_pattern=o),null==ce.prefixes&&(ce.prefixes=o),ce.prefixes_pattern=$(fe=ce.prefixes_pattern)?fe:o,$(ce.prefixes_pattern)?ce.prefixes_pattern:(ce.prefixes=$(ge=ce.prefixes)?ge:[],ce.prefixes.$freeze(),ce.prefixes_pattern=($(ce.prefixes["$empty?"]())?/(?!)/:e.regexp(["^(S)?(",ce.prefixes.$join("|"),")"],"i")).$freeze())},ee.$$arity=0),e.def(O,"$command_pattern",te=function(){var ce,ge,fe=this,we=o,le=o;return null==fe.command_pattern&&(fe.command_pattern=o),null==fe.prefixes&&(fe.prefixes=o),fe.command_pattern=$(ge=fe.command_pattern)?ge:o,$(fe.command_pattern)?fe.command_pattern:(fe.prefixes=$(we=fe.prefixes)?we:[],fe.prefixes.$freeze(),le=H(I(U(z(M,"CommonCommand"),"COMMANDS"),"map",[],((ce=function(de){return null==de&&(de=o),U(de,"PREFIX_PATTERN").$source()}).$$s=fe,ce.$$arity=1,ce)),fe.prefixes),fe.command_pattern=e.regexp(["^S?(",le.$join("|"),")"],"i").$freeze())},te.$$arity=0),e.def(O,"$eval",oe=function(ce){return this.$new(ce).$eval()},oe.$$arity=1),d.$include(z(n,"Translate")),d.$include(U(z(n,"Deprecated"),"Checker")),e.def(d,"$initialize",m=function(i){var M=this;return M.raw_input=i,M.sort_add_dice=!1,M.sort_barabara_dice=!1,M.d66_sort_type=U(z(n,"D66SortType"),"NO_SORT"),M.enabled_d9=!1,M.round_type=U(z(n,"RoundType"),"FLOOR"),M.sides_implicit_d=6,M.upper_dice_reroll_threshold=o,M.reroll_dice_reroll_threshold=o,M.default_cmp_op=o,M.default_target_number=o,M.enabled_upcase_input=!0,M.locale="ja_jp",M.randomizer=U(z(n,"BCDice"),"Randomizer").$new(),M.debug=!1},m.$$arity=1),d.$attr_accessor("randomizer"),d.$attr_reader("d66_sort_type"),d.$attr_reader("round_type"),d.$attr_reader("sides_implicit_d"),d.$attr_reader("upper_dice_reroll_threshold"),d.$attr_reader("reroll_dice_reroll_threshold"),d.$attr_reader("default_cmp_op"),d.$attr_reader("default_target_number"),e.def(d,"$sort_add_dice?",a=function(){return this.sort_add_dice},a.$$arity=0),e.def(d,"$sort_barabara_dice?",p=function(){return this.sort_barabara_dice},p.$$arity=0),e.def(d,"$enabled_d9?",D=function(){return this.enabled_d9},D.$$arity=0),e.def(d,"$enable_debug",_=function(){return this.debug=!0},_.$$arity=0),e.def(d,"$eval",f=function(){var M,A,S,i=this,ee=o;return M=U(z(n,"BCDice"),"Preprocessor").$process(i.raw_input,i),A=$(S=i.$dice_command(M))?S:i.$eval_common_command(i.raw_input),$(A)?(ee=[i.randomizer.$rand_results()],I(A,"rands=",e.to_a(ee)),X(ee.length,1),ee=[i.randomizer.$detailed_rand_results()],I(A,"detailed_rands=",e.to_a(ee)),X(ee.length,1),A):o},f.$$arity=0),e.def(d,"$change_text",b=function(i){return i},b.$$arity=1),e.def(d,"$check_result",C=function(i,M,A,S){var ee=this,te=o,oe=o,xe=o,ce=o,fe=o;return te=ee.$check_result_legacy(i,M,A,S),$(te)?te:(oe=I(M,"map",[],"sides".$to_proc()),ce=(xe=I(M,"map",[],"value".$to_proc())).$sum(),(te=[100]["$==="](fe=oe)?ee.$result_1d100(i,ce,A,S):[20]["$==="](fe)?ee.$result_1d20(i,ce,A,S):[6,6]["$==="](fe)?ee.$result_2d6(i,ce,xe,A,S):o)["$=="](z(n,"Result").$nothing())?o:$(te)?te:(fe=oe.$uniq(),(te=[10]["$==="](fe)?ee.$result_nd10(i,ce,xe,A,S):[6]["$==="](fe)?ee.$result_nd6(i,ce,xe,A,S):o)["$=="](z(n,"Result").$nothing())?o:$(te)?te:ee.$result_ndx(i,A,S)))},C.$$arity=4),e.def(d,"$grich_text",Y=function(i,M,A){return o},Y.$$arity=3),d.$private(),e.def(d,"$eval_common_command",E=function(i){try{var M;return i=this.$change_text(i),I(U(z(n,"CommonCommand"),"COMMANDS"),"each",[],((M=function(ee){var oe,te=null==M.$$s?this:M.$$s;if(null==te.randomizer&&(te.randomizer=o),null==ee&&(ee=o),oe=ee.$eval(i,te,te.randomizer),!$(oe))return o;e.ret(oe)}).$$s=this,M.$$arity=1,M)),o}catch(S){if(S===e.returner)return S.$v;throw S}},E.$$arity=1),e.def(d,"$dice_command",y=function(i){var M,A=this,S=o,ee=o,te=o,oe=o,xe=o,ce=o,fe=o;return $(A.enabled_upcase_input)&&(i=i.$upcase()),S=A.$class().$prefixes_pattern().$match(i),$(S)?(ee=S["$[]"](1)["$nil?"]()["$!"](),$(ee)&&(i=i["$[]"](Z(1,-1,!1))),te=A.$eval_game_system_specific_command(i),$(te["$is_a?"](z(n,"Result")))?(oe=[$(xe=te["$secret?"]())?xe:ee],I(te,"secret=",e.to_a(oe)),X(oe.length,1),te):$($(ce=$(fe=te["$nil?"]())?fe:te["$empty?"]())?ce:te["$=="]("1"))?o:I(z(n,"Result").$new(),"tap",[],((M=function(we){return null==we&&(we=o),oe=[te.$to_s()],I(we,"text=",e.to_a(oe)),X(oe.length,1),I(we,"secret=",e.to_a(oe=[ee])),oe[X(oe.length,1)]}).$$s=A,M.$$arity=1,M))):o},y.$$arity=1),e.def(d,"$eval_game_system_specific_command",l=function(i){return o},l.$$arity=1),e.def(d,"$result_ndx",w=function(i,M,A){return $(A["$is_a?"](z(n,"String")))?o:$(i.$send(M,A))?z(n,"Result").$success(this.$translate("success")):z(n,"Result").$failure(this.$translate("failure"))},w.$$arity=3),e.def(d,"$result_1d100",g=function(i,M,A,S){return o},g.$$arity=4),e.def(d,"$result_1d20",P=function(i,M,A,S){return o},P.$$arity=4),e.def(d,"$result_nd10",s=function(i,M,A,S,ee){return o},s.$$arity=5),e.def(d,"$result_2d6",T=function(i,M,A,S,ee){return o},T.$$arity=5),e.def(d,"$result_nd6",W=function(i,M,A,S,ee){return o},W.$$arity=5),e.def(d,"$get_table_by_2d6",ae=function(i){return this.$get_table_by_nD6(i,2)},ae.$$arity=1),e.def(d,"$get_table_by_1d6",ue=function(i){return this.$get_table_by_nD6(i,1)},ue.$$arity=1),e.def(d,"$get_table_by_nD6",ye=function(i,M){return this.$get_table_by_nDx(i,M,6)},ye.$$arity=2),e.def(d,"$get_table_by_nDx",be=function(i,M,A){var ee,te=o;return ee=this.randomizer.$roll_sum(M,A),te=this.$get_table_value(i["$[]"](X(ee,M))),$(te["$nil?"]())?["1",0]:[te,ee]},be.$$arity=3),e.def(d,"$get_table_by_1d3",pe=function(i){var S,ee,k,M=this,te=o;return M.$debug("get_table_by_1d3"),S=M.randomizer.$roll_sum(1,6),M.$debug("num",S),ee=(k=X(S,1),"number"==typeof k?k/2:k["$/"](2)).$to_i(),M.$debug("index",ee),te=i["$[]"](ee),$(te["$nil?"]())?["1",0]:[te,S]},pe.$$arity=1),e.def(d,"$get_table_by_d66_swap",qe=function(i){var A;return A=this.randomizer.$roll_d66(U(z(n,"D66SortType"),"ASC")),[this.$get_table_by_number(A,i),A]},qe.$$arity=1),e.def(d,"$get_table_by_d66",ke=function(i){var A,S,ee,oe,k,te=o;return A=this.randomizer.$roll_once(6),S=this.randomizer.$roll_once(6),ee=H("number"==typeof(k=X(A,1))?6*k:k["$*"](6),X(S,1)),te=i["$[]"](ee),oe=""+A+S,$(te["$nil?"]())?["1",oe]:[te,oe]},ke.$$arity=1),e.def(d,"$get_table_by_number",Ie=function(i,M,A){try{var S;return null==A&&(A="1"),I(M,"each",[],((S=function(oe){var ce,xe=null==S.$$s?this:S.$$s;if(null==oe&&(oe=o),ce=oe["$[]"](0),!$(function(k,K){return"number"==typeof k&&"number"==typeof K?k>=K:k["$>="](K)}(ce,i)))return o;e.ret(xe.$get_table_value(oe["$[]"](1)))}).$$s=this,S.$$arity=1,S)),this.$get_table_value(A)}catch(te){if(te===e.returner)return te.$v;throw te}},Ie.$$arity=-3),e.def(d,"$get_table_value",ze=function(i){return $(i["$is_a?"](z(n,"Proc")))?i.$call():i},ze.$$arity=1),e.def(d,"$roll_tables",ve=function(i,M){var S=o;return S=M["$[]"](i),$(S)?S.$roll(this.randomizer).$to_s():o},ve.$$arity=2),e.def(d,"$debug",J=function(i,M){var S,ee,te=this,oe=o,xe=o;return S=e.slice.call(arguments,1,arguments.length),$(te.debug)?(oe=$(i["$is_a?"](z(n,"String")))?i:i.$inspect(),$(S["$empty?"]())?te.$warn(oe):(xe=I(S,"map",[],((ee=function(fe){return null==fe&&(fe=o),$(fe["$is_a?"](z(n,"String")))?'"'+fe+'"':fe.$inspect()}).$$s=te,ee.$$arity=1,ee)),te.$warn(oe+": "+xe.$join(", ")))):o},J.$$arity=-2),U(U(z(re,"I18n"),"Backend"),"Simple").$include(U(U(z(re,"I18n"),"Backend"),"Fallbacks")),z(re,"I18n").$load_path()["$<<"](z(re,"Dir")["$[]"](z(re,"File").$join(u.$__dir__(),"../../i18n/**/*.yml"))),h=["ja_jp"],I(z(re,"I18n"),"default_locale=",e.to_a(h)),X(h.length,1),h=[["ja_jp"]],I(z(re,"I18n").$fallbacks(),"defaults=",e.to_a(h)),h[X(h.length,1)]},Opal.modules["bcdice/game_system/sword_world/rating_lexer"]=function(e){var N,h,V,m,D,_,f,a,p,L,K,I,X=[],R=e.nil,c=e.$$,u=e.module,re=e.klass,o=e.hash2,U=e.truthy,z=e.send;return e.top.$require("strscan"),N=X,h=I=[u(X[0],"BCDice")].concat(N),V=K=[u(I[0],"GameSystem")].concat(h),m=L=[re(K[0],c(K,"Base"),"SwordWorld")].concat(V),a=re(L[0],null,"RatingLexer"),p=[a].concat(m),a.$$prototype.scanner=R,e.const_set(p[0],"SYMBOLS",o(["+","-","*","/","(",")","[","]","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","[":"BRACKETL","]":"BRACKETR","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),e.def(a,"$initialize",D=function(C){var Y,E,l;return C=U(l=(E=(Y=C)===R||null==Y?R:z(Y,"split",[" ",2]))===R||null==E?R:z(E,"first",[]))?l:"",this.scanner=c(p,"StringScanner").$new(C)},D.$$arity=1),e.def(a,"$next_token",_=function(){var C=this,Y=R,E=R,l=R;return U(C.scanner["$eos?"]())?[!1,"$"]:U(Y=C.scanner.$scan(/\d+/))?["NUMBER",Y.$to_i()]:(E=C.scanner.$getch().$upcase(),[U(l=c(p,"SYMBOLS")["$[]"](E))?l:E.$to_sym(),E])},_.$$arity=0),void e.def(a,"$source",f=function(){return this.scanner.$string()},f.$$arity=0)},Opal.modules["bcdice/game_system/sword_world/rating_parsed"]=function(e){function H(t,N){return"number"==typeof t&&"number"==typeof N?t<N:t["$<"](N)}function X(t,N){return"number"==typeof t&&"number"==typeof N?t+N:t["$+"](N)}var N,h,V,m,D,_,f,b,C,Y,E,y,l,a,p,L,K,I,r=[],c=e.nil,re=e.$$,o=e.module,U=e.klass,z=e.truthy;return N=r,h=I=[o(r[0],"BCDice")].concat(N),V=K=[o(I[0],"GameSystem")].concat(h),m=L=[U(K[0],re(K,"Base"),"SwordWorld")].concat(V),a=U(L[0],null,"RatingParsed"),p=[a].concat(m),a.$$prototype.modifier_after_half=a.$$prototype.critical=a.$$prototype.first_modify=a.$$prototype.first_to=a.$$prototype.rateup=a.$$prototype.kept_modify=a.$$prototype.rate=a.$$prototype.greatest_fortune=a.$$prototype.modifier=c,a.$attr_accessor("rate"),a.$attr_writer("critical"),a.$attr_writer("kept_modify"),a.$attr_writer("first_to"),a.$attr_writer("first_modify"),a.$attr_writer("rateup"),a.$attr_accessor("greatest_fortune"),a.$attr_accessor("modifier"),a.$attr_writer("modifier_after_half"),e.def(a,"$initialize",D=function(){var g=this;return g.critical=c,g.kept_modify=c,g.first_to=c,g.first_modify=c,g.greatest_fortune=!1,g.rateup=c},D.$$arity=0),e.def(a,"$half",_=function(){return this.modifier_after_half["$nil?"]()["$!"]()},_.$$arity=0),e.def(a,"$critical",f=function(){var s,P=c;return P=z(s=this.critical)?s:z(this.$half())?13:10,z(H(P,3))&&(P=3),P},f.$$arity=0),e.def(a,"$first_modify",b=function(){var P;return z(P=this.first_modify)?P:0},b.$$arity=0),e.def(a,"$first_to",C=function(){var P;return z(P=this.first_to)?P:0},C.$$arity=0),e.def(a,"$rateup",Y=function(){var P;return z(P=this.rateup)?P:0},Y.$$arity=0),e.def(a,"$kept_modify",E=function(){var P;return z(P=this.kept_modify)?P:0},E.$$arity=0),e.def(a,"$modifier_after_half",y=function(){var P;return z(P=this.modifier_after_half)?P:0},y.$$arity=0),void e.def(a,"$to_s",l=function(){var g=this,P=c;return P="KeyNo."+g.rate,z(H(g.$critical(),13))&&(P=X(P,"c["+g.$critical()+"]")),z(g.$first_modify()["$!="](0))&&(P=X(P,"m["+re(p,"Format").$modifier(g.$first_modify())+"]")),z(g.$first_to()["$!="](0))&&(P=X(P,"m["+g.$first_to()+"]")),z(g.$rateup()["$!="](0))&&(P=X(P,"r["+g.$rateup()+"]")),z(g.greatest_fortune)&&(P=X(P,"gf")),z(g.$kept_modify()["$!="](0))&&(P=X(P,"a["+re(p,"Format").$modifier(g.$kept_modify())+"]")),z(g.modifier["$!="](0))&&(P=X(P,re(p,"Format").$modifier(g.modifier))),P},l.$$arity=0)},Opal.modules["bcdice/game_system/sword_world/rating_parser"]=function(e){function H(I,Z){return"number"==typeof I&&"number"==typeof Z?I-Z:I["$-"](Z)}var Z,B,d,D,b,C,Y,E,y,l,w,g,P,s,T,W,ae,ue,ye,be,pe,qe,ke,Ie,ze,ve,J,O,i,M,A,S,ee,te,oe,xe,ce,fe,ge,we,le,Te,de,Ee,Me,Ue,Ge,_,f,m,V,k,X=e.top,R=[],r=e.nil,c=e.$$$,u=e.$$,re=e.module,o=e.klass,U=e.hash2,z=e.send2,t=e.send,N=e.hash,$=e.truthy;return X.$require("racc/parser.rb"),X.$require("bcdice/arithmetic/node"),X.$require("bcdice/enum"),X.$require("bcdice/game_system/sword_world/rating_lexer"),X.$require("bcdice/game_system/sword_world/rating_parsed"),Z=R,B=k=[re(R[0],"BCDice")].concat(Z),d=V=[re(k[0],"GameSystem")].concat(B),D=m=[o(V[0],u(V,"Base"),"SwordWorld")].concat(d),_=o(m[0],c(u(m,"Racc"),"Parser"),"RatingParser"),f=[_].concat(D),_.$$prototype.lexer=_.$$prototype.version=r,e.def(_,"$initialize",b=function(se){var Re,Q;if(b.$$p&&(b.$$p=null),null==se)se=U([],{});else if(!se.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return null==(Re=se.$$smap.version)&&(Re="v1_0"),null==(Q=se.$$smap.round_type)&&(Q=c(u(f,"RoundType"),"CEIL")),z(this,e.find_super_dispatcher(this,"initialize",b,!1,!0),"initialize",[],null),this.version=Re,this.round_type=Q},b.$$arity=-1),e.def(_,"$set_debug",C=function(){return this.yydebug=!0,this},C.$$arity=0),e.def(_,"$parse",Y=function(se){try{return this.lexer=u(f,"RatingLexer").$new(se),this.$do_parse()}catch(Q){if(!e.rescue(Q,[u(f,"ParseError"),u(f,"ZeroDivisionError")]))throw Q;try{return r}finally{e.pop_exception()}}},Y.$$arity=1),_.$private(),e.def(_,"$parsed",E=function(se,Re,Q){var F;return t(u(f,"RatingParsed").$new(),"tap",[],((F=function(_e){var x,ne,q,j,$e=null==F.$$s?this:F.$$s,ie=r;return null==$e.round_type&&($e.round_type=r),null==_e&&(_e=r),t(_e,"rate=",e.to_a(ie=[se])),H(ie.length,1),ie=[(x=Q["$[]"]("critical"),x===r||null==x?r:t(x,"eval",[$e.round_type]))],t(_e,"critical=",e.to_a(ie)),H(ie.length,1),ie=[(ne=Q["$[]"]("kept_modify"),ne===r||null==ne?r:t(ne,"eval",[$e.round_type]))],t(_e,"kept_modify=",e.to_a(ie)),H(ie.length,1),ie=[Q["$[]"]("first_to")],t(_e,"first_to=",e.to_a(ie)),H(ie.length,1),ie=[Q["$[]"]("first_modify")],t(_e,"first_modify=",e.to_a(ie)),H(ie.length,1),ie=[(q=Q["$[]"]("rateup"),q===r||null==q?r:t(q,"eval",[$e.round_type]))],t(_e,"rateup=",e.to_a(ie)),H(ie.length,1),ie=[Q.$fetch("greatest_fortune",!1)],t(_e,"greatest_fortune=",e.to_a(ie)),H(ie.length,1),ie=[Re.$eval($e.round_type)],t(_e,"modifier=",e.to_a(ie)),H(ie.length,1),ie=[(j=Q["$[]"]("modifier_after_half"),j===r||null==j?r:t(j,"eval",[$e.round_type]))],t(_e,"modifier_after_half=",e.to_a(ie)),ie[H(ie.length,1)]}).$$s=this,F.$$arity=1,F))},E.$$arity=3),e.def(_,"$next_token",y=function(){return this.lexer.$next_token()},y.$$arity=0),fe=[15,14,16,5,18,19,51,52,21,22,11,53,12,17,13,15,14,16,4,18,19,4,8,3,28,11,28,12,17,13,24,25,24,25,27,28,27,28,49,50,9,24,25,24,25,27,28,27,28,49,50,35,24,25,24,25,27,28,27,28,49,50,42,24,25,24,25,27,28,27,28,49,50,47,24,25,24,25,27,28,27,28,49,50,48,24,25,24,25,27,28,27,28,49,50,r,24,25,24,25,27,28,27,28,49,50,r,24,25,24,25,27,30,27,r,r,r,r,31,32],ge=[6,6,6,1,6,6,45,45,10,10,6,45,6,6,6,20,20,20,3,20,20,0,4,0,11,20,12,20,20,20,11,11,12,12,11,14,12,15,37,37,5,14,14,15,15,14,17,15,18,39,39,16,17,17,18,18,17,19,18,21,40,40,23,19,19,21,21,19,22,21,24,41,41,31,22,22,24,24,22,25,24,27,46,46,32,25,25,27,27,25,49,27,50,56,56,r,49,49,50,50,49,51,50,52,57,57,r,51,51,52,52,51,13,52,r,r,r,r,13,13],we=[18,3,r,15,20,40,-4,r,r,r,0,22,24,110,33,35,44,44,46,55,11,57,66,47,68,77,r,79,r,r,r,71,82,r,r,r,r,28,r,39,50,61,r,r,r,-2,72,r,r,88,90,99,101,r,r,r,83,94],le=[-31,-31,-4,-31,-31,-31,-1,-4,-3,58,-5,-31,-31,-31,-11,-31,-31,-31,-31,-31,-2,-31,-31,-31,-31,-31,-28,-31,-30,-7,-8,-31,-31,-12,-13,-14,-15,-16,-25,-17,-18,-19,-6,-26,-27,-31,-22,-9,-10,-31,-31,-31,-31,-29,-23,-24,-20,-21],Te=[23,29,2,33,34,7,36,37,39,1,40,41,6,43,44,45,46,20,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,54,55,56,57],de=[5,5,2,5,5,2,5,6,6,1,6,6,3,5,5,7,6,3,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,5,5,6,6],Ee=[r,9,2,10,r,-11,-11,-12,r],Me=[r,r,r,r,10,38,r,r,26],Ue=[0,0,"racc_error",2,20,"_reduce_1",3,20,"_reduce_2",2,21,"_reduce_3",0,22,"_reduce_4",2,22,"_reduce_5",4,22,"_reduce_6",3,22,"_reduce_7",3,22,"_reduce_8",4,22,"_reduce_9",4,22,"_reduce_10",2,22,"_reduce_11",3,22,"_reduce_12",3,22,"_reduce_13",3,22,"_reduce_14",3,22,"_reduce_15",2,23,"_reduce_16",2,23,"_reduce_17",3,23,"_reduce_18",3,23,"_reduce_19",3,26,"_reduce_20",3,26,"_reduce_21",1,26,"_reduce_none",3,25,"_reduce_23",3,25,"_reduce_24",1,25,"_reduce_none",2,24,"_reduce_26",2,24,"_reduce_27",1,24,"_reduce_none",3,27,"_reduce_29",1,27,"_reduce_30"],Ge=N(!1,0,"error",1,"NUMBER",2,"K",3,"R",4,"H",5,"G",6,"F",7,"PLUS",8,"MINUS",9,"ASTERISK",10,"SLASH",11,"PARENL",12,"PARENR",13,"BRACKETL",14,"BRACKETR",15,"AT",16,"SHARP",17,"DOLLAR",18),e.const_set(f[0],"Racc_arg",[fe,ge,le,we,Te,de,Me,Ee,19,Ue,Ge,58,31,!0]),e.const_set(f[0],"Racc_token_to_s_table",["$end","error","NUMBER","K","R","H","G","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","BRACKETL","BRACKETR","AT","SHARP","DOLLAR","$start","expr","rate","option","modifier","unary","mul","add","term"]),e.const_set(f[0],"Racc_debug_parser",!1),e.def(_,"$_reduce_1",l=function(se,Re,Q){var F,_e,x,ne,$e=r;return _e=null==(F=e.to_ary(se))[0]?r:F[0],x=$(ne=($e=null==F[1]?r:F[1])["$[]"]("modifier"))?ne:c(c(u(f,"Arithmetic"),"Node"),"Number").$new(0),this.$parsed(_e,x,$e)},l.$$arity=3),e.def(_,"$_reduce_2",w=function(se,Re,Q){var F,$e,j,ie,x=r,q=r;return $e=null==(F=e.to_ary(se))[1]?r:F[1],$((x=null==F[2]?r:F[2])["$[]"]("modifier_after_half"))||(q=["modifier_after_half",c(c(u(f,"Arithmetic"),"Node"),"Number").$new(0)],t(x,"[]=",e.to_a(q)),H(q.length,1)),j=$(ie=x["$[]"]("modifier"))?ie:c(c(u(f,"Arithmetic"),"Node"),"Number").$new(0),this.$parsed($e,j,x)},w.$$arity=3),e.def(_,"$_reduce_3",g=function(se,Re,Q){return se["$[]"](1).$to_i()},g.$$arity=3),e.def(_,"$_reduce_4",P=function(se,Re,Q){return U([],{})},P.$$arity=3),e.def(_,"$_reduce_5",s=function(se,Re,Q){var F,$e,x,_e=r;return $e=null==(F=e.to_ary(se))[1]?r:F[1],$((_e=null==F[0]?r:F[0])["$[]"]("modifier")["$nil?"]())||this.$raise(u(f,"ParseError")),t(_e,"[]=",e.to_a(x=["modifier",$e])),H(x.length,1),_e},s.$$arity=3),e.def(_,"$_reduce_6",T=function(se,Re,Q){var F,x,ne,_e=r;return x=null==(F=e.to_ary(se))[2]?r:F[2],$((_e=null==F[0]?r:F[0])["$[]"]("critical")["$nil?"]())||this.$raise(u(f,"ParseError")),t(_e,"[]=",e.to_a(ne=["critical",x])),H(ne.length,1),_e},T.$$arity=3),e.def(_,"$_reduce_7",W=function(se,Re,Q){var F,x,ne,_e=r;return x=null==(F=e.to_ary(se))[2]?r:F[2],$((_e=null==F[0]?r:F[0])["$[]"]("critical")["$nil?"]())||this.$raise(u(f,"ParseError")),t(_e,"[]=",e.to_a(ne=["critical",x])),H(ne.length,1),_e},W.$$arity=3),e.def(_,"$_reduce_8",ae=function(se,Re,Q){var F,q,ne,_e=r,x=r;return x=null==(F=e.to_ary(se))[2]?r:F[2],$($(ne=(_e=null==F[0]?r:F[0])["$[]"]("first_to")["$nil?"]())?_e["$[]"]("first_modify")["$nil?"]():ne)||this.$raise(u(f,"ParseError")),q=["first_to",x.$to_i()],t(_e,"[]=",e.to_a(q)),H(q.length,1),_e},ae.$$arity=3),e.def(_,"$_reduce_9",ue=function(se,Re,Q){var F,q,ne,_e=r,x=r;return x=null==(F=e.to_ary(se))[3]?r:F[3],$($(ne=(_e=null==F[0]?r:F[0])["$[]"]("first_to")["$nil?"]())?_e["$[]"]("first_modify")["$nil?"]():ne)||this.$raise(u(f,"ParseError")),q=["first_modify",x.$to_i()],t(_e,"[]=",e.to_a(q)),H(q.length,1),_e},ue.$$arity=3),e.def(_,"$_reduce_10",ye=function(se,Re,Q){var F,q,ne,_e=r,x=r;return x=null==(F=e.to_ary(se))[3]?r:F[3],$($(ne=(_e=null==F[0]?r:F[0])["$[]"]("first_to")["$nil?"]())?_e["$[]"]("first_modify")["$nil?"]():ne)||this.$raise(u(f,"ParseError")),q=["first_modify",x.$to_i()["$-@"]()],t(_e,"[]=",e.to_a(q)),H(q.length,1),_e},ye.$$arity=3),e.def(_,"$_reduce_11",be=function(se,Re,Q){var F,x,_e=r;return F=e.to_ary(se),$((_e=null==F[0]?r:F[0])["$[]"]("modifier_after_half")["$nil?"]())||this.$raise(u(f,"ParseError")),x=["modifier_after_half",c(c(u(f,"Arithmetic"),"Node"),"Number").$new(0)],t(_e,"[]=",e.to_a(x)),H(x.length,1),_e},be.$$arity=3),e.def(_,"$_reduce_12",pe=function(se,Re,Q){var F,x,ne,_e=r;return x=null==(F=e.to_ary(se))[2]?r:F[2],$((_e=null==F[0]?r:F[0])["$[]"]("modifier_after_half")["$nil?"]())||this.$raise(u(f,"ParseError")),t(_e,"[]=",e.to_a(ne=["modifier_after_half",x])),H(ne.length,1),_e},pe.$$arity=3),e.def(_,"$_reduce_13",qe=function(se,Re,Q){var F,x,q,ne,_e=r;return _e=null==(F=e.to_ary(se))[0]?r:F[0],x=null==F[2]?r:F[2],$($(ne=["v2_5","v2_0"]["$include?"](this.version))?_e["$[]"]("rateup")["$nil?"]():ne)||this.$raise(u(f,"ParseError")),t(_e,"[]=",e.to_a(q=["rateup",x])),H(q.length,1),_e},qe.$$arity=3),e.def(_,"$_reduce_14",ke=function(se,Re,Q){var F,ne,x,_e=r;return _e=null==(F=e.to_ary(se))[0]?r:F[0],$($(x=["v2_5","v2_0"]["$include?"](this.version))?_e["$[]"]("greatest_fortune")["$nil?"]():x)||this.$raise(u(f,"ParseError")),t(_e,"[]=",e.to_a(ne=["greatest_fortune",!0])),H(ne.length,1),_e},ke.$$arity=3),e.def(_,"$_reduce_15",Ie=function(se,Re,Q){var F,x,q,ne,_e=r;return _e=null==(F=e.to_ary(se))[0]?r:F[0],x=null==F[2]?r:F[2],$($(ne=this.version["$=="]("v2_5"))?_e["$[]"]("kept_modify")["$nil?"]():ne)||this.$raise(u(f,"ParseError")),t(_e,"[]=",e.to_a(q=["kept_modify",x])),H(q.length,1),_e},Ie.$$arity=3),e.def(_,"$_reduce_16",ze=function(se,Re,Q){return se["$[]"](1)},ze.$$arity=3),e.def(_,"$_reduce_17",ve=function(se,Re,Q){return c(c(u(f,"Arithmetic"),"Node"),"Negative").$new(se["$[]"](1))},ve.$$arity=3),e.def(_,"$_reduce_18",J=function(se,Re,Q){return c(c(u(f,"Arithmetic"),"Node"),"BinaryOp").$new(se["$[]"](0),"+",se["$[]"](2))},J.$$arity=3),e.def(_,"$_reduce_19",O=function(se,Re,Q){return c(c(u(f,"Arithmetic"),"Node"),"BinaryOp").$new(se["$[]"](0),"-",se["$[]"](2))},O.$$arity=3),e.def(_,"$_reduce_20",i=function(se,Re,Q){return c(c(u(f,"Arithmetic"),"Node"),"BinaryOp").$new(se["$[]"](0),"+",se["$[]"](2))},i.$$arity=3),e.def(_,"$_reduce_21",M=function(se,Re,Q){return c(c(u(f,"Arithmetic"),"Node"),"BinaryOp").$new(se["$[]"](0),"-",se["$[]"](2))},M.$$arity=3),e.def(_,"$_reduce_23",A=function(se,Re,Q){return c(c(u(f,"Arithmetic"),"Node"),"BinaryOp").$new(se["$[]"](0),"*",se["$[]"](2))},A.$$arity=3),e.def(_,"$_reduce_24",S=function(se,Re,Q){return c(c(u(f,"Arithmetic"),"Node"),"DivideWithGameSystemDefault").$new(se["$[]"](0),se["$[]"](2))},S.$$arity=3),e.def(_,"$_reduce_26",ee=function(se,Re,Q){return se["$[]"](1)},ee.$$arity=3),e.def(_,"$_reduce_27",te=function(se,Re,Q){return c(c(u(f,"Arithmetic"),"Node"),"Negative").$new(se["$[]"](1))},te.$$arity=3),e.def(_,"$_reduce_29",oe=function(se,Re,Q){return se["$[]"](1)},oe.$$arity=3),e.def(_,"$_reduce_30",xe=function(se,Re,Q){return c(c(u(f,"Arithmetic"),"Node"),"Number").$new(se["$[]"](0))},xe.$$arity=3),void e.def(_,"$_reduce_none",ce=function(se,Re,Q){return se["$[]"](0)},ce.$$arity=3)},function(e){function H(B,v){return"number"==typeof B&&"number"==typeof v?B>=v:B["$>="](v)}function X(B,v){return"number"==typeof B&&"number"==typeof v?B<=v:B["$<="](v)}function R(B,v){return"number"==typeof B&&"number"==typeof v?B-v:B["$-"](v)}function r(B,v){return"number"==typeof B&&"number"==typeof v?B>v:B["$>"](v)}function c(B,v){return"number"==typeof B&&"number"==typeof v?B+v:B["$+"](v)}function re(B,v){return"number"==typeof B&&"number"==typeof v?B*v:B["$*"](v)}var v,d,D,b,C,Y,E,y,l,w,g,P,_,f,m,G,U=e.top,z=[],t=e.nil,$=e.$$,I=e.module,Z=e.klass,h=e.send2,k=e.truthy,K=e.send;U.$require("bcdice/base"),U.$require("bcdice/game_system/sword_world/rating_parser"),v=z,d=G=[I(z[0],"BCDice")].concat(v),D=m=[I(G[0],"GameSystem")].concat(d),_=Z(m[0],$(m,"Base"),"SwordWorld"),f=[_].concat(D),_.$$prototype.rating_table=_.$$prototype.randomizer=t,e.const_set(f[0],"ID","SwordWorld"),e.const_set(f[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c9RPG"),e.const_set(f[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u3068"),e.const_set(f[0],"HELP_MESSAGE","\u30fbSW\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx[c]+m$f) (x:\u30ad\u30fc, c:\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024, m:\u30dc\u30fc\u30ca\u30b9, f:\u51fa\u76ee\u4fee\u6b63)\n"),_.$register_prefix("H?K"),e.def(_,"$initialize",b=function(T){return b.$$p&&(b.$$p=null),h(this,e.find_super_dispatcher(this,"initialize",b,!1,!0),"initialize",[T],null),this.rating_table=0},b.$$arity=1),e.def(_,"$result_2d6",C=function(T,W,ae,ue,ye){var pe=t;return k(H(W,12))?$(f,"Result").$critical("\u81ea\u52d5\u7684\u6210\u529f"):k(X(W,2))?$(f,"Result").$fumble("\u81ea\u52d5\u7684\u5931\u6557"):k(k(pe=ue["$!="](">="))?pe:ye["$=="]("?"))?t:k(H(T,ye))?$(f,"Result").$success("\u6210\u529f"):$(f,"Result").$failure("\u5931\u6557")},C.$$arity=5),e.def(_,"$eval_game_system_specific_command",Y=function(T){return this.$rating(T)},Y.$$arity=1),_.$private(),e.def(_,"$rating_parser",E=function(){return $(f,"RatingParser").$new()},E.$$arity=0),e.def(_,"$rating",y=function(T){var W,ae,ue,ye,be=this,pe=t,qe=t,ke=t,Ie=t,ze=t,ve=t,J=t,O=t,i=t,M=t,A=t,S=t,ee=t,te=t,xe=t,ce=t;return be.$debug("rating string",T),pe=be.$rating_parser().$parse(T),k(pe)?(qe=be.$getSW2_0_RatingTable(),ke=R(qe.$length(),1),be.$debug("keyMax",ke),k(r(pe.$rate(),ke))?"\u30ad\u30fc\u30ca\u30f3\u30d0\u30fc\u306f"+ke+"\u307e\u3067\u3067\u3059":(Ie=be.$getNewRates(qe),ze=pe+" \uff1e ",ve=[],J=[],O=[],i=0,M=0,A=0,S=0,ee=pe.$first_to(),te=pe.$first_modify(),function(){var fe=e.new_brk();try{K(be,"loop",[],((W=function(){var le,Te,Ue,Ce,Me,B,we=null==W.$$s?this:W.$$s,de=t,Ee=t;if(Te=we.$rollDice(pe),Ee=null==(le=e.to_ary(Te))[1]?t:le[1],i=de=null==le[0]?t:le[0],k(ee["$!="](0))?(i=de=ee,ee=0):k(te["$!="](0))&&(i=c(i,te),te=0),k(X(de,2))&&(ve["$<<"](de.$to_s()),J["$<<"](Ee.$to_s()),O["$<<"]("**"),S=c(S,1),e.brk(t,fe)),k(k(Me=pe.$kept_modify()["$!="](0))?i["$!="](2):Me)&&(i=c(i,pe.$kept_modify())),k("number"==typeof(B=i)?B<2:B["$<"](2))&&(i=2),k(r(i,12))&&(i=12),Ue=[c(pe.$rate(),re(S,pe.$rateup())),ke].$min(),we.$debug("currentKey",Ue),Ce=Ie["$[]"](i)["$[]"](Ue),we.$debug("rateValue",Ce),A=c(A,Ce),M=c(M,i),ve["$<<"](i.$to_s()),J["$<<"](Ee.$to_s()),O["$<<"](k(r(i,2))?Ce:"**"),S=c(S,1),k(H(i,pe.$critical())))return t;e.brk(t,fe)}).$$s=be,W.$$brk=fe,W.$$arity=0,W))}catch(ge){if(ge===fe)return ge.$v;throw ge}}(),ue=be.$getResultText(A,pe,J,ve,O,M,S),ae=e.to_ary(ue),xe=null==ae[1]?t:ae[1],ce=null==ae[2]?t:ae[2],ze=c(ze,null==ae[0]?t:ae[0]),K($(f,"Result").$new(),"tap",[],((ye=function(ge){var le=t;return null==ge&&(ge=t),K(ge,"text=",e.to_a(le=[ze])),R(le.length,1),K(ge,"critical=",e.to_a(le=[xe])),R(le.length,1),K(ge,"fumble=",e.to_a(le=[ce])),le[R(le.length,1)]}).$$s=be,ye.$$arity=1,ye)))):(be.$debug("not matched"),"1")},y.$$arity=1),e.def(_,"$getSW2_0_RatingTable",l=function(){return["*,0,0,0,1,2,2,3,3,4,4","*,0,0,0,1,2,3,3,3,4,4","*,0,0,0,1,2,3,4,4,4,4","*,0,0,1,1,2,3,4,4,4,5","*,0,0,1,2,2,3,4,4,5,5","*,0,1,1,2,2,3,4,5,5,5","*,0,1,1,2,3,3,4,5,5,5","*,0,1,1,2,3,4,4,5,5,6","*,0,1,2,2,3,4,4,5,6,6","*,0,1,2,3,3,4,4,5,6,7","*,1,1,2,3,3,4,5,5,6,7","*,1,2,2,3,3,4,5,6,6,7","*,1,2,2,3,4,4,5,6,6,7","*,1,2,3,3,4,4,5,6,7,7","*,1,2,3,4,4,4,5,6,7,8","*,1,2,3,4,4,5,5,6,7,8","*,1,2,3,4,4,5,6,7,7,8","*,1,2,3,4,5,5,6,7,7,8","*,1,2,3,4,5,6,6,7,7,8","*,1,2,3,4,5,6,7,7,8,9","*,1,2,3,4,5,6,7,8,9,10","*,1,2,3,4,6,6,7,8,9,10","*,1,2,3,5,6,6,7,8,9,10","*,2,2,3,5,6,7,7,8,9,10","*,2,3,4,5,6,7,7,8,9,10","*,2,3,4,5,6,7,8,8,9,10","*,2,3,4,5,6,8,8,9,9,10","*,2,3,4,6,6,8,8,9,9,10","*,2,3,4,6,6,8,9,9,10,10","*,2,3,4,6,7,8,9,9,10,10","*,2,4,4,6,7,8,9,10,10,10","*,2,4,5,6,7,8,9,10,10,11","*,3,4,5,6,7,8,10,10,10,11","*,3,4,5,6,8,8,10,10,10,11","*,3,4,5,6,8,9,10,10,11,11","*,3,4,5,7,8,9,10,10,11,12","*,3,5,5,7,8,9,10,11,11,12","*,3,5,6,7,8,9,10,11,12,12","*,3,5,6,7,8,10,10,11,12,13","*,4,5,6,7,8,10,11,11,12,13","*,4,5,6,7,9,10,11,11,12,13","*,4,6,6,7,9,10,11,12,12,13","*,4,6,7,7,9,10,11,12,13,13","*,4,6,7,8,9,10,11,12,13,14","*,4,6,7,8,10,10,11,12,13,14","*,4,6,7,9,10,10,11,12,13,14","*,4,6,7,9,10,10,12,13,13,14","*,4,6,7,9,10,11,12,13,13,15","*,4,6,7,9,10,12,12,13,13,15","*,4,6,7,10,10,12,12,13,14,15","*,4,6,8,10,10,12,12,13,15,15","*,5,7,8,10,10,12,12,13,15,15","*,5,7,8,10,11,12,12,13,15,15","*,5,7,9,10,11,12,12,14,15,15","*,5,7,9,10,11,12,13,14,15,16","*,5,7,10,10,11,12,13,14,16,16","*,5,8,10,10,11,12,13,15,16,16","*,5,8,10,11,11,12,13,15,16,17","*,5,8,10,11,12,12,13,15,16,17","*,5,9,10,11,12,12,14,15,16,17","*,5,9,10,11,12,13,14,15,16,18","*,5,9,10,11,12,13,14,16,17,18","*,5,9,10,11,13,13,14,16,17,18","*,5,9,10,11,13,13,15,17,17,18","*,5,9,10,11,13,14,15,17,17,18","*,5,9,10,12,13,14,15,17,18,18","*,5,9,10,12,13,15,15,17,18,19","*,5,9,10,12,13,15,16,17,19,19","*,5,9,10,12,14,15,16,17,19,19","*,5,9,10,12,14,16,16,17,19,19","*,5,9,10,12,14,16,17,18,19,19","*,5,9,10,13,14,16,17,18,19,20","*,5,9,10,13,15,16,17,18,19,20","*,5,9,10,13,15,16,17,19,20,21","*,6,9,10,13,15,16,18,19,20,21","*,6,9,10,13,16,16,18,19,20,21","*,6,9,10,13,16,17,18,19,20,21","*,6,9,10,13,16,17,18,20,21,22","*,6,9,10,13,16,17,19,20,22,23","*,6,9,10,13,16,18,19,20,22,23","*,6,9,10,13,16,18,20,21,22,23","*,6,9,10,13,17,18,20,21,22,23","*,6,9,10,14,17,18,20,21,22,24","*,6,9,11,14,17,18,20,21,23,24","*,6,9,11,14,17,19,20,21,23,24","*,6,9,11,14,17,19,21,22,23,24","*,7,10,11,14,17,19,21,22,23,25","*,7,10,12,14,17,19,21,22,24,25","*,7,10,12,14,18,19,21,22,24,25","*,7,10,12,15,18,19,21,22,24,26","*,7,10,12,15,18,19,21,23,25,26","*,7,11,13,15,18,19,21,23,25,26","*,7,11,13,15,18,20,21,23,25,27","*,8,11,13,15,18,20,22,23,25,27","*,8,11,13,16,18,20,22,23,25,28","*,8,11,14,16,18,20,22,23,26,28","*,8,11,14,16,19,20,22,23,26,28","*,8,12,14,16,19,20,22,24,26,28","*,8,12,15,16,19,20,22,24,27,28","*,8,12,15,17,19,20,22,24,27,29","*,8,12,15,18,19,20,22,24,27,30"]},l.$$arity=0),e.def(_,"$getNewRates",w=function(T){var W,ue=t,ye=t,be=t,pe=t,qe=t,ke=t,Ie=t,ze=t,ve=t,J=t,O=t,i=t;return ue=[],ye=[],be=[],pe=[],qe=[],ke=[],Ie=[],ze=[],ve=[],J=[],O=[],K(T,"each",[],((W=function(S){var te=t;return null==S&&(S=t),te=S.$split(/,/),O.$push(0),ue.$push(te["$[]"](1).$to_i()),ye.$push(te["$[]"](2).$to_i()),be.$push(te["$[]"](3).$to_i()),pe.$push(te["$[]"](4).$to_i()),qe.$push(te["$[]"](5).$to_i()),ke.$push(te["$[]"](6).$to_i()),Ie.$push(te["$[]"](7).$to_i()),ze.$push(te["$[]"](8).$to_i()),ve.$push(te["$[]"](9).$to_i()),J.$push(te["$[]"](10).$to_i())}).$$s=this,W.$$arity=1,W)),this.rating_table["$=="](1)&&(i=[31,(i=[32,(i=[33,10],K(J,"[]=",e.to_a(i)),i[R(i.length,1)])],K(J,"[]=",e.to_a(i)),i[R(i.length,1)])],K(J,"[]=",e.to_a(i)),R(i.length,1)),[O,O,O,ue,ye,be,pe,qe,ke,Ie,ze,ve,J]},w.$$arity=1),e.def(_,"$rollDice",g=function(T){var ae=t;return[(ae=this.randomizer.$roll_barabara(2,6)).$sum(),ae.$join(",")]},g.$$arity=1),e.def(_,"$getResultText",P=function(T,W,ae,ue,ye,be,pe){var B,ke=t,Ie=t,ze=t,ve=t,J=t,O=t;return(ke=[]).$push("2D:["+ae.$join(" ")+"]="+ue.$join(",")),k(X(be,2))?(ke.$push(ye.$join(",")),ke.$push("\u81ea\u52d5\u7684\u5931\u6557"),[ke.$join(" \uff1e "),!1,!0]):(k(k(Ie=r(ye.$size(),1))?Ie:W.$modifier()["$!="](0))?(ze=c(ye.$join(","),$(f,"Format").$modifier(W.$modifier())),k(W.$half())&&(ze="("+ze+")/2",k(W.$modifier_after_half()["$!="](0))&&(ze=c(ze,$(f,"Format").$modifier(W.$modifier_after_half())))),ke.$push(ze)):k(W.$half())&&(ze=ye.$first()+"/2",k(W.$modifier_after_half()["$!="](0))&&(ze=c(ze,$(f,"Format").$modifier(W.$modifier_after_half()))),ke.$push(ze)),k(r(pe,1))&&(ve=R(pe,1)+"\u56de\u8ee2",ke.$push(ve)),J=c(T,W.$modifier()),k(W.$half())&&(J=(B=J,"number"==typeof B?B/2:B["$/"](2)).$ceil(),k(W.$modifier_after_half()["$!="](0))&&(J=c(J,W.$modifier_after_half()))),O=J.$to_s(),ke.$push(O),[ke.$join(" \uff1e "),r(pe,1),!1])},P.$$arity=7)}(Opal)}}]);