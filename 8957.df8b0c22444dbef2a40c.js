(self.webpackChunkudonarium_lily_gk=self.webpackChunkudonarium_lily_gk||[]).push([[8957],{8957:function(Xe,Je,Ve){Ve(4656),Opal.modules["i18n/backend/fallbacks"]=function(e){function W(E,i){return"number"==typeof E&&"number"==typeof i?E-i:E["$-"](i)}var i,l,G,D,H,q,F,T=[],r=e.nil,R=e.$$$,_=e.$$,X=e.module,$=e.truthy,L=e.send,P=e.send2,t=e.hash2;return i=T,F=[q=X(T[0],"I18n")].concat(i),e.class_variable_set(F[0],"@@fallbacks",r),l=e.get_singleton_class(q),H=[l].concat(F),e.def(l,"$fallbacks",G=function(){var A,n,d;return e.class_variable_set(H[1],"@@fallbacks",$(d=null==(A=H[1].$$cvars["@@fallbacks"])?r:A)?d:R(R(_(H,"I18n"),"Locale"),"Fallbacks").$new()),$(n=_(H,"Thread").$current()["$[]"]("i18n_fallbacks"))?n:null==(A=H[1].$$cvars["@@fallbacks"])?r:A},G.$$arity=0),e.def(l,"$fallbacks=",D=function(A){var C,n;return e.class_variable_set(H[1],"@@fallbacks",$(A["$is_a?"](_(H,"Array")))?R(R(_(H,"I18n"),"Locale"),"Fallbacks").$new(A):A),n=["i18n_fallbacks",null==(C=H[1].$$cvars["@@fallbacks"])?r:C],L(_(H,"Thread").$current(),"[]=",e.to_a(n)),n[W(n.length,1)]},D.$$arity=1),void function(l,B){var G=[X(l,"Backend")].concat(B);!function(D,Z){var d,n,f,u,A=X(D,"Fallbacks"),C=[A].concat(Z);e.def(A,"$translate",d=function(h,g,p){try{var v,I=d.$$p,S=this,c=r,o=r,m=r,y=r,z=r,a=r;for(I&&(d.$$p=null),z=0,a=arguments.length,y=new Array(a);z<a;z++)y[z]=arguments[z];return null==p&&(p=_(C,"EMPTY_HASH")),!$(p.$fetch("fallback",!0))||$(p["$[]"]("fallback_in_progress"))?P(S,e.find_super_dispatcher(S,"translate",d,!1,!0),"translate",y,I):($(p["$[]"]("default"))&&(c=S["$extract_non_symbol_default!"](p)),o=p.$merge(t(["fallback_in_progress"],{fallback_in_progress:!0})),L(_(C,"I18n").$fallbacks()["$[]"](h),"each",[],((v=function(Y){var re,te=null==v.$$s?this:v.$$s;null==Y&&(Y=r);try{return L(te,"catch",["exception"],((re=function(){var ye=null==re.$$s?this:re.$$s,De=r;if(De=P(ye,e.find_iter_super_dispatcher(ye,"translate",re.$$def||v.$$def||d,!1,!1),"translate",[Y,g,o],null),$(De["$nil?"]()))return r;$(h.$to_s()["$!="](Y.$to_s()))&&ye.$on_fallback(h,Y,g,p),e.ret(De)}).$$s=te,re.$$arity=0,re))}catch(me){if(!e.rescue(me,[R(_(C,"I18n"),"InvalidLocale")]))throw me;try{return r}finally{e.pop_exception()}}}).$$s=S,v.$$arity=1,v)),$($(m=p["$key?"]("default"))?p["$[]"]("default")["$nil?"]():m)?r:$(c)?P(S,e.find_super_dispatcher(S,"translate",d,!1,!0),"translate",[h,r,p.$merge(t(["default"],{default:c}))],null):S.$throw("exception",R(_(C,"I18n"),"MissingTranslation").$new(h,g,p)))}catch(k){if(k===e.returner)return k.$v;throw k}},d.$$arity=-3),e.def(A,"$extract_non_symbol_default!",n=function(h){var g,I,v=r,K=r;return v=[h["$[]"]("default")].$flatten(),I=L(v,"detect",[],((g=function(c){return null==c&&(c=r),c["$is_a?"](_(C,"Symbol"))["$!"]()}).$$s=this,g.$$arity=1,g)),$(I)&&(K=["default",v["$[]"](0,v.$index(I))],L(h,"[]=",e.to_a(K)),W(K.length,1)),I},n.$$arity=1),e.def(A,"$exists?",f=function(h,g,p){try{var v,I=f.$$p,S=this,c=r,o=r,m=r;for(I&&(f.$$p=null),o=0,m=arguments.length,c=new Array(m);o<m;o++)c[o]=arguments[o];return null==p&&(p=_(C,"EMPTY_HASH")),$(p.$fetch("fallback",!0))?(L(_(C,"I18n").$fallbacks()["$[]"](h),"each",[],((v=function(z){var a=null==v.$$s?this:v.$$s;null==z&&(z=r);try{if(!$(P(a,e.find_iter_super_dispatcher(a,"exists?",v.$$def||f,!1,!1),"exists?",[z,g],null)))return r;e.ret(!0)}catch(k){if(!e.rescue(k,[R(_(C,"I18n"),"InvalidLocale")]))throw k;try{return r}finally{e.pop_exception()}}}).$$s=S,v.$$arity=1,v)),!1):P(S,e.find_super_dispatcher(S,"exists?",f,!1,!0),"exists?",c,I)}catch(y){if(y===e.returner)return y.$v;throw y}},f.$$arity=-3),A.$private(),e.def(A,"$on_fallback",u=function(h,g,p,v){return r},u.$$arity=4)}(G[0],G)}(F[0],F)},Opal.modules["bcdice/randomizer"]=function(e){function W(l,B){return"number"==typeof l&&"number"==typeof B?l>B:l["$>"](B)}function V(l,B){return"number"==typeof l&&"number"==typeof B?l+B:l["$+"](B)}function T(l,B){return"number"==typeof l&&"number"==typeof B?l<=B:l["$<="](B)}function r(l,B){return"number"==typeof l&&"number"==typeof B?l-B:l["$-"](B)}function R(l,B){return"number"==typeof l&&"number"==typeof B?l*B:l["$*"](B)}var B,A,n,f,u,b,h,g,p,v,I,K,S,C,d,G,$=[],L=e.nil,P=e.$$$,t=e.$$,i=e.klass,q=e.truthy,F=e.send;return B=$,A=G=[(0,e.module)($[0],"BCDice")].concat(B),C=i(G[0],null,"Randomizer"),d=[C].concat(A),C.$$prototype.rand_results=C.$$prototype.detailed_rand_results=L,e.const_set(d[0],"UPPER_LIMIT_DICE_TIMES",200),e.const_set(d[0],"UPPER_LIMIT_DICE_SIDES",1e3),e.const_set(d[0],"UPPER_LIMIT_RANDS",1e4),e.def(C,"$initialize",n=function(){return this.rand_results=[],this.detailed_rand_results=[]},n.$$arity=0),C.$attr_reader("rand_results"),C.$attr_reader("detailed_rand_results"),e.const_set(d[0],"DetailedRandResult",t(d,"Struct").$new("kind","sides","value")),e.def(C,"$roll_barabara",f=function(o,m){var y,a,z=this;return q(W(V(z.rand_results.$size(),o),t(d,"UPPER_LIMIT_RANDS")))&&z.$raise(t(d,"TooManyRandsError")),q(q(a=T(o,0))?a:W(o,t(d,"UPPER_LIMIT_DICE_TIMES")))?[]:F(t(d,"Array"),"new",[o],((y=function(){return(null==y.$$s?this:y.$$s).$roll_once(m)}).$$s=z,y.$$arity=0,y))},f.$$arity=2),e.def(C,"$roll_sum",u=function(o,m){return this.$roll_barabara(o,m).$sum()},u.$$arity=2),e.def(C,"$roll_once",b=function(o){var y,z=L;return q(q(y=T(o,0))?y:W(o,t(d,"UPPER_LIMIT_DICE_SIDES")))?0:(z=this.$rand_inner(o),this.$push_to_detail("normal",o,z),z)},b.$$arity=1),e.def(C,"$roll_index",h=function(o){return r(this.$roll_once(o),1)},h.$$arity=1),e.def(C,"$roll_tens_d10",g=function(){var y,m=L;return(m=this.$rand_inner(10))["$=="](10)&&(m=0),y=R(m,10),this.$push_to_detail("tens_d10",10,y),y},g.$$arity=0),e.def(C,"$roll_d9",p=function(){var m;return m=r(this.$rand_inner(10),1),this.$push_to_detail("d9",10,m),m},p.$$arity=0),e.def(C,"$roll_d66",v=function(o){var m,a,z=L;return z=F(t(d,"Array"),"new",[2],((m=function(){return(null==m.$$s?this:m.$$s).$roll_once(6)}).$$s=this,m.$$arity=0,m)),a=o,P(t(d,"D66SortType"),"ASC")["$==="](a)?z["$sort!"]():P(t(d,"D66SortType"),"DESC")["$==="](a)&&z["$sort!"]()["$reverse!"](),V(R(z["$[]"](0),10),z["$[]"](1))},v.$$arity=1),C.$private(),e.def(C,"$rand_inner",I=function(o){var y,m=this;return q(function(l,B){return"number"==typeof l&&"number"==typeof B?l>=B:l["$>="](B)}(m.rand_results.$size(),t(d,"UPPER_LIMIT_RANDS")))&&m.$raise(t(d,"TooManyRandsError")),y=m.$random(o),m.rand_results["$<<"]([y,o]),y},I.$$arity=1),e.def(C,"$random",K=function(o){return V(t(d,"Kernel").$rand(o),1)},K.$$arity=1),e.def(C,"$push_to_detail",S=function(o,m,y){var a;return a=t(d,"DetailedRandResult").$new(o,m,y),this.detailed_rand_results.$push(a)},S.$$arity=3),void function(D,Z,A){[i(D,Z,"TooManyRandsError")].concat(A)}(G[0],t(G,"StandardError"),G)},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var P,q,G,A,C,d,n,D,Z,l,E,V=[],T=e.nil,R=e.$$,_=e.module,X=e.klass,$=e.truthy;return P=V,q=E=[_(V[0],"BCDice")].concat(P),G=l=[_(E[0],"DiceTable")].concat(q),D=X(l[0],null,"RollResult"),Z=[D].concat(G),D.$$prototype.table_name=D.$$prototype.value=D.$$prototype.body=T,e.def(D,"$initialize",A=function(u,b,h){var g=this;return g.table_name=u,g.value=b,g.body=h},A.$$arity=3),D.$attr_reader("table_name"),D.$attr_reader("value"),D.$attr_reader("body"),e.def(D,"$to_s",C=function(){var u=this;return u.table_name+"("+u.value+") \uff1e "+u.body},C.$$arity=0),e.def(D,"$last_body",d=function(){var u=this;return $(u.body["$is_a?"](R(Z,"RollResult")))?u.body.$last_body():u.body},d.$$arity=0),void e.def(D,"$empty?",n=function(){return!1},n.$$arity=0)},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var t,F,D,C,d,Z,A,B,i,T=[],r=e.nil,_=e.$$,X=e.module,$=e.klass,L=e.truthy;return t=T,F=i=[X(T[0],"BCDice")].concat(t),D=B=[X(i[0],"DiceTable")].concat(F),Z=$(B[0],null,"ChainTable"),A=[Z].concat(D),Z.$$prototype.times=Z.$$prototype.sides=Z.$$prototype.items=Z.$$prototype.name=r,e.def(Z,"$initialize",C=function(f,u,b){var h=this,g=r;return h.name=f,h.items=b.$freeze(),g=/(\d+)D(\d+)/i.$match(u),L(g)||h.$raise(_(A,"ArgumentError"),"Unexpected table type: "+u),h.times=g["$[]"](1).$to_i(),h.sides=g["$[]"](2).$to_i()},C.$$arity=3),void e.def(Z,"$roll",d=function(f){var b,h,u=this,g=r;return h=function(P,t){return"number"==typeof P&&"number"==typeof t?P-t:P["$-"](t)}(b=f.$roll_sum(u.times,u.sides),u.times),g=u.items["$[]"](h),L(g["$respond_to?"]("roll"))&&(g=g.$roll(f)),_(A,"RollResult").$new(u.name,b,g)},d.$$arity=1)},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){function T(E,i){return"number"==typeof E&&"number"==typeof i?E-i:E["$-"](i)}var i,B,A,n,f,u,C,d,G,F,R=[],_=e.nil,$=e.$$,L=e.module,P=e.klass,t=e.hash2;return i=R,B=F=[L(R[0],"BCDice")].concat(i),A=G=[L(F[0],"DiceTable")].concat(B),C=P(G[0],null,"D66GridTable"),d=[C].concat(A),C.$$prototype.name=C.$$prototype.items=_,e.defs(C,"$from_i18n",n=function(h,g){var v=_;return v=$(d,"I18n").$t(h,t(["locale","raise"],{locale:g,raise:!0})),this.$new(v["$[]"]("name"),v["$[]"]("items"))},n.$$arity=2),e.def(C,"$initialize",f=function(h,g){return this.name=h,this.items=g.$freeze()},f.$$arity=2),void e.def(C,"$roll",u=function(h){var p,v,I,K,S,E;return p=h.$roll_once(6),v=h.$roll_once(6),I=function(E,i){return"number"==typeof E&&"number"==typeof i?E+i:E["$+"](i)}("number"==typeof(E=p)?10*E:E["$*"](10),v),K=T(p,1),S=T(v,1),$(d,"RollResult").$new(this.name,I,this.items["$[]"](K)["$[]"](S))},u.$$arity=1)},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var P,q,G,A,C,D,Z,l,E,V=[],T=e.nil,R=e.$$,_=e.module,X=e.klass,$=e.hash2;return e.top.$require("bcdice/dice_table/d66_grid_table"),P=V,q=E=[_(V[0],"BCDice")].concat(P),G=l=[_(E[0],"DiceTable")].concat(q),D=X(l[0],R(l,"D66GridTable"),"D66HalfGridTable"),Z=[D].concat(G),e.defs(D,"$from_i18n",A=function(n,f){var b=T;return b=R(Z,"I18n").$t(n,$(["locale","raise"],{locale:f,raise:!0})),this.$new(b["$[]"]("name"),b["$[]"]("items_1_2_3"),b["$[]"]("items_4_5_6"))},A.$$arity=2),void e.def(D,"$initialize",C=function(n,f,u){return this.name=n,this.items=[f,f,f,u,u,u].$freeze()},C.$$arity=3)},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var P,q,G,A,C,D,Z,l,E,V=[],T=e.nil,R=e.$$,_=e.module,X=e.klass,$=e.hash2;return e.top.$require("bcdice/dice_table/d66_grid_table"),P=V,q=E=[_(V[0],"BCDice")].concat(P),G=l=[_(E[0],"DiceTable")].concat(q),D=X(l[0],R(l,"D66GridTable"),"D66OneThirdTable"),Z=[D].concat(G),e.defs(D,"$from_i18n",A=function(n,f){var b=T;return b=R(Z,"I18n").$t(n,$(["locale","raise"],{locale:f,raise:!0})),this.$new(b["$[]"]("name"),b["$[]"]("items_1_2"),b["$[]"]("items_3_4"),b["$[]"]("items_5_6"))},A.$$arity=2),void e.def(D,"$initialize",C=function(n,f,u,b){return this.name=n,this.items=[f,f,u,u,b,b].$freeze()},C.$$arity=4)},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var i,B,A,n,f,u,C,d,G,F,r=[],R=e.nil,_=e.$$$,X=e.$$,$=e.module,L=e.klass,P=e.hash2,t=e.truthy;return i=r,B=F=[$(r[0],"BCDice")].concat(i),A=G=[$(F[0],"DiceTable")].concat(B),C=L(G[0],null,"D66Table"),d=[C].concat(A),C.$$prototype.sort_type=C.$$prototype.items=C.$$prototype.name=R,e.defs(C,"$from_i18n",n=function(h,g){var I,v=R;return v=X(d,"I18n").$t(h,P(["locale"],{locale:g})),I=X(d,"D66SortType").$const_get(v["$[]"]("d66_sort_type")),this.$new(v["$[]"]("name"),I,v["$[]"]("items"))},n.$$arity=2),e.def(C,"$initialize",f=function(h,g,p){var v=this;return v.name=h,v.sort_type=g,v.items=p.$freeze()},f.$$arity=3),void e.def(C,"$roll",u=function(h){var v,S,E,g=this,p=R,I=R,K=R;return p=h.$roll_barabara(2,6),v=g.sort_type,_(X(d,"D66SortType"),"ASC")["$==="](v)?p["$sort!"]():_(X(d,"D66SortType"),"DESC")["$==="](v)&&p["$sort!"]()["$reverse!"](),I=function(E,i){return"number"==typeof E&&"number"==typeof i?E+i:E["$+"](i)}("number"==typeof(E=p["$[]"](0))?10*E:E["$*"](10),p["$[]"](1)),K=t(S=g.items["$[]"](I))?S:g.items["$[]"](I.$to_s()),t(K["$respond_to?"]("roll"))&&(K=K.$roll(h)),X(d,"RollResult").$new(g.name,I,K)},u.$$arity=1)},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){function W(q,F){return"number"==typeof q&&"number"==typeof F?q+F:q["$+"](F)}var F,d,u,n,G,Z,B,R=[],_=e.nil,$=e.$$,L=e.module,P=e.klass,t=e.hash2,E=e.send,i=e.send2;return e.top.$require("bcdice/dice_table/d66_table"),F=R,G=B=[L(R[0],"BCDice")].concat(F),d=Z=[L(B[0],"DiceTable")].concat(G),[n=P(Z[0],$(Z,"D66Table"),"D66LeftRangeTable")].concat(d),void e.def(n,"$initialize",u=function(h,g,p){var v,c,S=this;return u.$$p&&(u.$$p=null),c=t([],{}),E(p,"each",[],((v=function(o){function m(y){return o.apply(this,arguments)}return m.toString=function(){return o.toString()},m}(function(o){var y,a,Y,m=null==v.$$s?this:v.$$s;return null==o&&(o=_),y=e.to_ary(o),Y=null==y[1]?_:y[1],E(null==y[0]?_:y[0],"each",[],((a=function(re){var ye;return null==re&&(re=_),E(Y,"each_with_index",[],((ye=function(Be,Te){var Ce,oe,q;return null==Be&&(Be=_),null==Te&&(Te=_),Ce=W("number"==typeof(q=re)?10*q:q["$*"](10),W(Te,1)),E(c,"[]=",e.to_a(oe=[Ce,Be])),oe[function(q,F){return"number"==typeof q?q-1:q["$-"](1)}(oe.length)]}).$$s=null==a.$$s?this:a.$$s,ye.$$arity=2,ye))}).$$s=m,a.$$arity=1,a))})).$$s=S,v.$$arity=1,v)),i(S,e.find_super_dispatcher(S,"initialize",u,!1,!0),"initialize",[h,g,c],null)},u.$$arity=3)},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var i,B,A,n,f,C,d,G,F,R=[],_=e.nil,$=e.$$,L=e.module,P=e.klass,t=e.truthy;return i=R,B=F=[L(R[0],"BCDice")].concat(i),A=G=[L(F[0],"DiceTable")].concat(B),C=P(G[0],null,"D66ParityTable"),d=[C].concat(A),C.$$prototype.odd=C.$$prototype.even=C.$$prototype.name=_,e.def(C,"$initialize",n=function(b,h,g){var p=this;return p.name=b,p.odd=h.$freeze(),p.even=g.$freeze()},n.$$arity=3),void e.def(C,"$roll",f=function(b){var p,I,K,E,h=this,g=_;return g=b.$roll_once(6),p=b.$roll_once(6),I=(t(g["$odd?"]())?h.odd:h.even)["$[]"]("number"==typeof(E=p)?E-1:E["$-"](1)),K=function(E,i){return"number"==typeof E&&"number"==typeof i?E+i:E["$+"](i)}(function(E,i){return"number"==typeof E?10*E:E["$*"](10)}(g),p),$(d,"RollResult").$new(h.name,K,I)},f.$$arity=1)},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var E,l,Z,d,n,A,C,H,q,r=[],R=e.nil,X=e.$$,$=e.module,L=e.klass,P=e.send;return E=r,l=q=[$(r[0],"BCDice")].concat(E),Z=H=[$(q[0],"DiceTable")].concat(l),A=L(H[0],null,"D66RangeTable"),C=[A].concat(Z),A.$$prototype.items=A.$$prototype.name=R,e.def(A,"$initialize",d=function(u,b){return this.name=u,this.items=b.$freeze()},d.$$arity=2),void e.def(A,"$roll",n=function(u){var b,g,p,v,t,h=this,I=R;return g=u.$roll_once(6),p=u.$roll_once(6),v=function(t,E){return"number"==typeof t&&"number"==typeof E?t+E:t["$+"](E)}("number"==typeof(t=g)?10*t:t["$*"](10),p),I=P(h.items,"find",[],((b=function(S){return null==S&&(S=R),S["$[]"](0)["$include?"](v)}).$$s=h,b.$$arity=1,b)),X(C,"RollResult").$new(h.name,v,I["$[]"](1))},n.$$arity=1)},Opal.modules["bcdice/dice_table/range_table"]=function(e){var q,H,C,f,u,b,h,g,p,v,I,K,d,n,D,l,R=[],_=e.nil,$=e.$$,L=e.module,P=e.klass,t=e.send,E=e.truthy;return q=R,H=l=[L(R[0],"BCDice")].concat(q),C=D=[L(l[0],"DiceTable")].concat(H),d=P(D[0],null,"RangeTable"),n=[d].concat(C),d.$$prototype.name=d.$$prototype.items=d.$$prototype.num_of_dice=d.$$prototype.num_of_sides=d.$$prototype.formatter=_,e.const_set(n[0],"RollResult",t($(n,"Struct"),"new",["sum","values","content","formatted"],((f=function(){return(null==f.$$s?this:f.$$s).$alias_method("to_s","formatted")}).$$s=d,f.$$arity=0,f))),e.const_set(n[0],"Item",$(n,"Struct").$new("range","content")),e.const_set(n[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),e.const_set(n[0],"DEFAULT_FORMATTER",t(d,"lambda",[],($$2=function(S){function c(o,m){return S.apply(this,arguments)}return c.toString=function(){return S.toString()},c}(function(S,c){return null==$$2.$$s||$$2,null==S&&(S=_),null==c&&(c=_),S.$name()+"("+c.$sum()+") \uff1e "+c.$content()}),$$2.$$s=d,$$2.$$arity=2,$$2))),d.$attr_reader("name"),d.$attr_reader("num_of_dice"),d.$attr_reader("num_of_sides"),e.def(d,"$initialize",u=function(c,o,m){var k,y=u.$$p,z=y||_,a=this,Y=_;return y&&(u.$$p=null),y&&(u.$$p=null),a.name=c.$freeze(),a.formatter=E(k=z)?k:$(n,"DEFAULT_FORMATTER"),Y=$(n,"DICE_ROLL_METHOD_RE").$match(o),E(Y)||a.$raise($(n,"ArgumentError"),a.name+": invalid dice roll method: "+o),a.num_of_dice=Y["$[]"](1).$to_i(),a.num_of_sides=Y["$[]"](2).$to_i(),a.$store(m)},u.$$arity=3),e.def(d,"$fetch",b=function(c){var o,y,m=this;return y=t(m.items,"find",[],((o=function(a){return null==a&&(a=_),a.$range()["$include?"](c)}).$$s=m,o.$$arity=1,o)),E(y)||m.$raise($(n,"RangeError"),m.name+": value is out of range: "+c),y},b.$$arity=1),e.def(d,"$roll",h=function(c){var y,z,a,i,o=this,m=_;return y=(m=c.$roll_barabara(o.num_of_dice,o.num_of_sides)).$sum(),z=$(n,"RollResult").$new(y,m,o.$fetch(y).$content()),a=[o.formatter["$[]"](o,z)],t(z,"formatted=",e.to_a(a)),"number"==typeof(i=a.length)||i["$-"](1),z},h.$$arity=1),d.$private(),e.def(d,"$store",g=function(c){var o,m,y,a,k,z=this;return a=t(c,"map",[],((o=function(te,re){return null==te&&(te=_),null==re&&(re=_),[(null==o.$$s?this:o.$$s).$coerce_to_int_range(te),re]}).$$s=z,o.$$arity=2,o)),k=t(a,"sort_by",[],((m=function(te,re){return null==te&&(te=_),null==re&&(re=_),te.$min()}).$$s=z,m.$$arity=2,m)),z.$assert_min_sum_is_covered(k),z.$assert_max_sum_is_covered(k),z.$assert_no_gap_or_overlap_in_ranges(k),z.items=t(k,"map",[],(y=function(te,re){return null==te&&(te=_),null==re&&(re=_),$(n,"Item").$new(te,re.$freeze()).$freeze()},y.$$s=z,y.$$arity=2,y)).$freeze(),z},g.$$arity=1),e.def(d,"$coerce_to_int_range",p=function(c){var m,y=_;return m=c,$(n,"Integer")["$==="](m)?$(n,"Range").$new(c,c):$(n,"Range")["$==="](m)&&E(E(y=c.$begin()["$is_a?"]($(n,"Integer")))?c.$end()["$is_a?"]($(n,"Integer")):y)?c:this.$raise($(n,"TypeError"),this.name+": "+c+" ("+c.$class()+") must be an Integer or a Range with Integers ")},p.$$arity=1),e.def(d,"$assert_min_sum_is_covered",v=function(c){var m,o=this,y=_;return m=o.num_of_dice,y=c.$first()["$[]"](0),E(y["$include?"](m))||o.$raise($(n,"RangeError"),o.name+": min value ("+m+") is not covered: "+y),o},v.$$arity=1),e.def(d,"$assert_max_sum_is_covered",I=function(c){var m,o=this,y=_;return m=function(i,q){return"number"==typeof i&&"number"==typeof q?i*q:i["$*"](q)}(o.num_of_dice,o.num_of_sides),y=c.$last()["$[]"](0),E(y["$include?"](m))||o.$raise($(n,"RangeError"),o.name+": max value ("+m+") is not covered: "+y),o},I.$$arity=1),void e.def(d,"$assert_no_gap_or_overlap_in_ranges",K=function(c){var o;return t(c,"each_cons",[2],((o=function(z,a){var re,me,i,k=null==o.$$s?this:o.$$s,Y=_,te=_;return null==k.name&&(k.name=_),null==z&&(z=_),null==a&&(a=_),Y=z["$[]"](0),te=a["$[]"](0),me="number"==typeof(i=re=Y.$max())?i+1:i["$+"](1),E(te["$include?"](re))&&k.$raise($(n,"RangeError"),k.name+": Range overlap: "+Y+" and "+te),E(te["$include?"](me))?_:k.$raise($(n,"RangeError"),k.name+": Range gap: "+Y+" and "+te)}).$$s=this,o.$$arity=2,o)),this},K.$$arity=1)},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var t,F,D,n,b,h,g,f,u,A,B,i,T=[],r=e.nil,R=e.$$$,_=e.$$,X=e.module,$=e.klass,L=e.send;return t=T,F=i=[X(T[0],"BCDice")].concat(t),D=B=[X(i[0],"DiceTable")].concat(F),n=A=[$(B[0],null,"SaiFicSkillTable")].concat(D),f=$(A[0],null,"Category"),u=[f].concat(n),f.$$prototype.name=r,e.def(f,"$initialize",b=function(v,I,K,S){var c,o=this;return o.name=v,o.skills=L(I.$map(),"with_index",[2],((c=function(m){function y(z,a){return m.apply(this,arguments)}return y.toString=function(){return m.toString()},y}(function(m,y){return null==m&&(m=r),null==y&&(y=r),R(_(u,"SaiFicSkillTable"),"Skill").$new(v,m,K,y,S)})).$$s=o,c.$$arity=2,c)),o.dice=K},b.$$arity=4),e.def(f,"$roll",h=function(v){return this.$skills()["$[]"]("number"==typeof(P=v.$roll_sum(2,6))?P-2:P["$-"](2));var P},h.$$arity=1),e.def(f,"$to_s",g=function(){return this.name},g.$$arity=0),void f.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var P,q,d,u,b,n,G,Z,l,E,V=[],T=e.nil,_=e.module,X=e.klass,$=e.hash2;return P=V,q=E=[_(V[0],"BCDice")].concat(P),G=l=[_(E[0],"DiceTable")].concat(q),d=Z=[X(l[0],null,"SaiFicSkillTable")].concat(G),[n=X(Z[0],null,"Skill")].concat(d),n.$$prototype.s_format=n.$$prototype.category_dice=n.$$prototype.row_dice=n.$$prototype.category_name=n.$$prototype.name=T,e.def(n,"$initialize",u=function(g,p,v,I,K){var S=this;return S.category_name=g,S.name=p,S.category_dice=v,S.row_dice=I,S.s_format=K},u.$$arity=5),e.def(n,"$to_s",b=function(){var g=this;return g.$format(g.s_format,$(["category_dice","row_dice","category_name","skill_name"],{category_dice:g.category_dice,row_dice:g.row_dice,category_name:g.category_name,skill_name:g.name}))},b.$$arity=0),void n.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var F,G,d,u,b,h,g,p,v,I,n,f,Z,B,T=e.top,r=[],R=e.nil,_=e.$$$,X=e.$$,$=e.module,L=e.klass,P=e.hash2,t=e.send,i=e.truthy;return T.$require("bcdice/dice_table/sai_fic_skill_table/category"),T.$require("bcdice/dice_table/sai_fic_skill_table/skill"),F=r,G=B=[$(r[0],"BCDice")].concat(F),d=Z=[$(B[0],"DiceTable")].concat(G),n=L(Z[0],null,"SaiFicSkillTable"),f=[n].concat(d),n.$$prototype.rtt=n.$$prototype.rtt_format=n.$$prototype.rct=n.$$prototype.rct_format=n.$$prototype.rttn=n.$$prototype.rttn_format=n.$$prototype.categories=R,e.defs(n,"$from_i18n",u=function(S,c,o){var m,y,z,a,re,te=R;if(null==o)o=P([],{});else if(!o.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return null==(m=o.$$smap.rtt)&&(m=R),null==(y=o.$$smap.rct)&&(y=R),null==(z=o.$$smap.rttn)&&(z=R),re=(te=X(f,"I18n").$t("RTT",P(["locale","raise","default"],{locale:c,raise:!1,default:P([],{})})).$merge(X(f,"I18n").$t(S,P(["locale","raise"],{locale:c,raise:!0}))))["$[]"]("items"),te=t(te,"select",[],((a=function(me){function ye(De,Be){return me.apply(this,arguments)}return ye.toString=function(){return me.toString()},ye}(function(me,ye){return null==me&&(me=R),null==ye&&(ye=R),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](me)})).$$s=this,a.$$arity=2,a)),this.$new(re,e.to_hash(te).$merge(P(["rtt","rct","rttn"],{rtt:m,rct:y,rttn:z})))},u.$$arity=-3),e.const_set(f[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),e.const_set(f[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),e.const_set(f[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),e.const_set(f[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),e.def(n,"$initialize",b=function(S,c){var o,m,y,z,a,k,Y,te,re=this;if(null==c)c=P([],{});else if(!c.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return null==(o=c.$$smap.rtt)&&(o=R),null==(m=c.$$smap.rct)&&(m=R),null==(y=c.$$smap.rttn)&&(y=R),null==(z=c.$$smap.rtt_format)&&(z=X(f,"DEFAULT_RTT")),null==(a=c.$$smap.rct_format)&&(a=X(f,"DEFAULT_RCT")),null==(k=c.$$smap.rttn_format)&&(k=X(f,"DEFAULT_RTTN")),null==(Y=c.$$smap.s_format)&&(Y=X(f,"DEFAULT_S")),re.categories=t(S.$map(),"with_index",[1],((te=function(ye,De){var Te,Ce,oe;return null==ye&&(ye=R),null==De&&(De=R),Ce=null==(Te=e.to_ary(ye))[0]?R:Te[0],oe=null==Te[1]?R:Te[1],_(X(f,"SaiFicSkillTable"),"Category").$new(Ce,oe,De,Y)}).$$s=re,te.$$arity=2,te.$$has_top_level_mlhs_arg=!0,te)),re.rtt=o,re.rct=m,re.rttn=y.$to_a(),re.rtt_format=z,re.rct_format=a,re.rttn_format=k},b.$$arity=-2),e.const_set(f[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),n.$attr_reader("categories"),e.def(n,"$roll_command",h=function(S,c){var m,o=this,y=R,z=R,a=R;return i(["RTT",o.rtt]["$include?"](m=c))?o.$format_skill(o.rtt_format,o.$roll_skill(S)):i(["RCT",o.rct]["$include?"](m))?(y=o.$roll_category(S),o.$format(o.rct_format,P(["category_dice","category_name"],{category_dice:y.$dice(),category_name:y.$name()}))):i(i(z=a=X(f,"RTTN").$index(m))?z:a=o.rttn.$index(m))?o.$format_skill(o.rttn_format,o.categories["$[]"](a).$roll(S)):R},h.$$arity=2),e.def(n,"$roll_category",g=function(S){return this.categories["$[]"]("number"==typeof(q=S.$roll_once(6))?q-1:q["$-"](1));var q},g.$$arity=1),e.def(n,"$roll_skill",p=function(S){return this.$roll_category(S).$roll(S)},p.$$arity=1),e.def(n,"$prefixes",v=function(){var S=this;return function(q,F){return"number"==typeof q&&"number"==typeof F?q+F:q["$+"](F)}(["RTT[1-6]?","RCT",S.rtt,S.rct],S.rttn).$compact()},v.$$arity=0),n.$private(),void e.def(n,"$format_skill",I=function(S,c){return this.$format(S,P(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:c.$category_dice(),row_dice:c.$row_dice(),category_name:c.$category_name(),skill_name:c.$name(),text:c.$to_s()}))},I.$$arity=2)},Opal.modules["bcdice/dice_table/table"]=function(e){var E,l,Z,d,n,f,u,A,C,H,q,T=[],r=e.nil,_=e.$$,X=e.module,$=e.klass,L=e.hash2,P=e.truthy;return E=T,l=q=[X(T[0],"BCDice")].concat(E),Z=H=[X(q[0],"DiceTable")].concat(l),A=$(H[0],null,"Table"),C=[A].concat(Z),A.$$prototype.times=A.$$prototype.sides=A.$$prototype.name=A.$$prototype.items=r,e.defs(A,"$from_i18n",d=function(h,g){var v=r;return v=_(C,"I18n").$t(h,L(["locale"],{locale:g})),this.$new(v["$[]"]("name"),v["$[]"]("type"),v["$[]"]("items"))},d.$$arity=2),e.def(A,"$initialize",n=function(h,g,p){var v=this,I=r;return v.name=h,v.items=p.$freeze(),I=/(\d+)D(\d+)/i.$match(g),P(I)||v.$raise(_(C,"ArgumentError"),"Unexpected table type: "+g),v.times=I["$[]"](1).$to_i(),v.sides=I["$[]"](2).$to_i()},n.$$arity=3),e.def(A,"$roll",f=function(h){var p,g=this;return p=h.$roll_sum(g.times,g.sides),g.$choice(p)},f.$$arity=1),void e.def(A,"$choice",u=function(h){var p,g=this;return p=function(t,E){return"number"==typeof t&&"number"==typeof E?t-E:t["$-"](E)}(h,g.times),_(C,"RollResult").$new(g.name,h,g.items["$[]"](p))},u.$$arity=1)},Opal.modules["bcdice/dice_table"]=function(e){var W=e.top;return W.$require("bcdice/dice_table/roll_result"),W.$require("bcdice/dice_table/chain_table"),W.$require("bcdice/dice_table/d66_grid_table"),W.$require("bcdice/dice_table/d66_half_grid_table"),W.$require("bcdice/dice_table/d66_one_third_table"),W.$require("bcdice/dice_table/d66_left_range_table"),W.$require("bcdice/dice_table/d66_parity_table"),W.$require("bcdice/dice_table/d66_range_table"),W.$require("bcdice/dice_table/d66_table"),W.$require("bcdice/dice_table/range_table"),W.$require("bcdice/dice_table/sai_fic_skill_table"),W.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var $,E,q,P,V=[],_=e.module;return $=V,E=P=[_(V[0],"BCDice")].concat($),q=[_(P[0],"D66SortType")].concat(E),e.const_set(q[0],"NO_SORT","no_sort"),e.const_set(q[0],"ASC","asc"),e.const_set(q[0],"DESC","desc"),void function(t,E){var q=[_(t,"RoundType")].concat(E);e.const_set(q[0],"CEIL","ceil"),e.const_set(q[0],"FLOOR","floor"),e.const_set(q[0],"ROUND","round")}(P[0],P)},Opal.modules["bcdice/translate"]=function(e){var P,q,B,F,l,E,V=[],T=e.nil,R=e.$$,_=e.module,X=e.hash2;return P=V,q=E=[_(V[0],"BCDice")].concat(P),F=_(E[0],"Translate"),l=[F].concat(q),void e.def(F,"$translate",B=function(G,D){var Z,A=this;if(null==A.locale&&(A.locale=T),null==D)D=X([],{});else if(!D.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return Z=e.kwrestargs(D,{}),R(l,"I18n").$translate(G,X(["locale","raise"],{locale:A.locale,raise:!0}).$merge(e.to_hash(Z)))},B.$$arity=-2)},Opal.modules["bcdice/result"]=function(e){function W(P,t){return"number"==typeof P&&"number"==typeof t?P-t:P["$-"](t)}var t,f,h,g,p,v,I,l,G,D,Z,A,C,d,n,B,H,i,T=[],r=e.nil,$=e.klass,L=e.send;return t=T,l=i=[(0,e.module)(T[0],"BCDice")].concat(t),H=[B=$(i[0],null,"Result")].concat(l),B.$$prototype.secret=B.$$prototype.success=B.$$prototype.failure=B.$$prototype.critical=B.$$prototype.fumble=r,[f=e.get_singleton_class(B)].concat(H),e.def(f,"$success",h=function(S){var c;return L(this.$new(),"tap",[],((c=function(m){function y(z){return m.apply(this,arguments)}return y.toString=function(){return m.toString()},y}(function(m){var z=r;return null==m&&(m=r),L(m,"text=",e.to_a(z=[S])),W(z.length,1),L(m,"success=",e.to_a(z=[!0])),z[W(z.length,1)]})).$$s=this,c.$$arity=1,c))},h.$$arity=1),e.def(f,"$failure",g=function(S){var c;return L(this.$new(),"tap",[],((c=function(y){var a=r;return null==y&&(y=r),L(y,"text=",e.to_a(a=[S])),W(a.length,1),L(y,"failure=",e.to_a(a=[!0])),a[W(a.length,1)]}).$$s=this,c.$$arity=1,c))},g.$$arity=1),e.def(f,"$critical",p=function(S){var c;return L(this.$new(),"tap",[],((c=function(y){var a=r;return null==y&&(y=r),L(y,"text=",e.to_a(a=[S])),W(a.length,1),L(y,"critical=",e.to_a(a=[!0])),W(a.length,1),L(y,"success=",e.to_a(a=[!0])),a[W(a.length,1)]}).$$s=this,c.$$arity=1,c))},p.$$arity=1),e.def(f,"$fumble",v=function(S){var c;return L(this.$new(),"tap",[],((c=function(y){var a=r;return null==y&&(y=r),L(y,"text=",e.to_a(a=[S])),W(a.length,1),L(y,"fumble=",e.to_a(a=[!0])),W(a.length,1),L(y,"failure=",e.to_a(a=[!0])),a[W(a.length,1)]}).$$s=this,c.$$arity=1,c))},v.$$arity=1),e.def(f,"$nothing",I=function(){return"nothing"},I.$$arity=0),e.def(B,"$initialize",G=function(u){var b=this;return null==u&&(u=r),b.text=u,b.rands=r,b.detailed_rands=r,b.secret=!1,b.success=!1,b.failure=!1,b.critical=!1,b.fumble=!1},G.$$arity=-1),B.$attr_accessor("text","rands","detailed_rands"),B.$attr_writer("secret","success","failure","critical","fumble"),e.def(B,"$secret?",D=function(){return this.secret},D.$$arity=0),e.def(B,"$success?",Z=function(){return this.success},Z.$$arity=0),e.def(B,"$failure?",A=function(){return this.failure},A.$$arity=0),e.def(B,"$critical?",C=function(){return this.critical},C.$$arity=0),e.def(B,"$fumble?",d=function(){return this.fumble},d.$$arity=0),void e.def(B,"$condition=",n=function(u){return this.success=u,this.failure=u["$!"]()},n.$$arity=1)},Opal.modules["racc/parser"]=function(e){function W(G,D){return"number"==typeof G&&"number"==typeof D?G<D:G["$<"](D)}function V(G,D){return"number"==typeof G&&"number"==typeof D?G-D:G["$-"](D)}function T(G,D){return"number"==typeof G&&"number"==typeof D?G+D:G["$+"](D)}function r(G,D){return"number"==typeof G&&"number"==typeof D?G>=D:G["$>="](D)}function R(G,D){return"number"==typeof G&&"number"==typeof D?G>D:G["$>"](D)}function _(G,D){return"number"==typeof G&&"number"==typeof D?G<=D:G["$<="](D)}var C,d,n,D,A,P=[],t=e.nil,E=e.$$$,i=e.$$,q=e.module,F=e.klass,l=e.truthy,B=e.gvars,H=e.send;return D=P,C=(A=[q(P[0],"Racc")].concat(D))[0],d=i(A,"StandardError"),n=A,[F(C,d,"ParseError")].concat(n),l(E("::","ParseError","skip_raise")?"constant":t)||e.const_set(P[0],"ParseError",E(i(P,"Racc"),"ParseError")),function(G,D){var f,h,g,p,v,I,K,S,c,o,m,y,z,a,k,Y,te,re,me,ye,De,Be,Te,Ee,Ce,u,b,A=[q(G,"Racc")].concat(D);l(i(A,"Racc_No_Extensions","skip_raise")?"constant":t)||e.const_set(A[0],"Racc_No_Extensions",!1),f=A,u=F(A[0],null,"Parser"),b=[u].concat(f),u.$$prototype.yydebug=u.$$prototype.racc_debug_out=u.$$prototype.racc_error_status=u.$$prototype.racc_t=u.$$prototype.racc_vstack=u.$$prototype.racc_val=u.$$prototype.racc_state=u.$$prototype.racc_tstack=t,e.const_set(b[0],"Racc_Runtime_Version","1.4.6"),e.const_set(b[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),e.const_set(b[0],"Racc_Runtime_Core_Version_R","1.4.6"),e.const_set(b[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),e.const_set(b[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),e.const_set(b[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),e.const_set(b[0],"Racc_Runtime_Core_Version",i(b,"Racc_Runtime_Core_Version_R")),e.const_set(b[0],"Racc_Runtime_Core_Revision",i(b,"Racc_Runtime_Core_Revision_R")),e.const_set(b[0],"Racc_Runtime_Type","ruby"),e.defs(i(b,"Parser"),"$racc_runtime_type",h=function(){return i(b,"Racc_Runtime_Type")},h.$$arity=0),e.def(u,"$_racc_setup",g=function(){var O,J,s=this,N=t,w=t,x=t;return null==B.stderr&&(B.stderr=t),l(E(s.$class(),"Racc_debug_parser"))||(s.yydebug=!1),l(null!=(O=s.yydebug)&&O!==t?"instance-variable":t)||(s.yydebug=!1),l(s.yydebug)&&(l(null!=(J=s.racc_debug_out)&&J!==t?"instance-variable":t)||(s.racc_debug_out=B.stderr),s.racc_debug_out=l(N=s.racc_debug_out)?N:B.stderr),w=E(s.$class(),"Racc_arg"),l(W(w.$size(),14))&&(H(w,"[]=",e.to_a(x=[13,!0])),V(x.length,1)),w},g.$$arity=0),e.def(u,"$_racc_init_sysvars",p=function(){var O=this;return O.racc_state=[0],O.racc_tstack=[],O.racc_vstack=[],O.racc_t=t,O.racc_val=t,O.racc_read_next=!0,O.racc_user_yyerror=!1,O.racc_error_status=0},p.$$arity=0),e.def(u,"$do_parse",v=function(){return this.$__send__(i(b,"Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)},v.$$arity=0),e.def(u,"$next_token",I=function(){return this.$raise(i(b,"NotImplementedError"),this.$class()+"#next_token is not defined")},I.$$arity=0),e.def(u,"$_racc_do_parse_rb",K=function(O,J){var s,w,x=this,Q=t,ee=t,$e=t,de=t,ie=t,ve=t,be=t,fe=t;return s=e.to_ary(O),Q=null==s[0]?t:s[0],ee=null==s[1]?t:s[1],$e=null==s[2]?t:s[2],de=null==s[3]?t:s[3],ie=null==s[10]?t:s[10],x.$_racc_init_sysvars(),ve=be=fe=t,H(x,"catch",["racc_end_parse"],((w=function(){var qe,Ne,ae=null==w.$$s?this:w.$$s,Se=t,Ae=t,Ie=t;for(null==ae.racc_state&&(ae.racc_state=t),null==ae.racc_read_next&&(ae.racc_read_next=t),null==ae.racc_t&&(ae.racc_t=t),null==ae.yydebug&&(ae.yydebug=t),null==ae.racc_val&&(ae.racc_val=t);l(!0);)for(l(fe=de["$[]"](ae.racc_state["$[]"](-1)))?(l(ae.racc_read_next)&&l(ae.racc_t["$!="](0))&&(Ne=ae.$next_token(),qe=e.to_ary(Ne),ve=null==qe[0]?t:qe[0],ae.racc_val=null==qe[1]?t:qe[1],ae.racc_t=l(ve)?l(Se=ie["$[]"](ve))?Se:1:0,l(ae.yydebug)&&ae.$racc_read_token(ae.racc_t,ve,ae.racc_val),ae.racc_read_next=!1),fe=T(fe,ae.racc_t),l(l(Ae=l(Ie=r(fe,0))?be=Q["$[]"](fe):Ie)?ee["$[]"](fe)["$=="](ae.racc_state["$[]"](-1)):Ae)||(be=$e["$[]"](ae.racc_state["$[]"](-1)))):be=$e["$[]"](ae.racc_state["$[]"](-1));l(be=ae.$_racc_evalact(be,O)););}).$$s=x,w.$$arity=0,w))},K.$$arity=2),e.def(u,"$yyparse",S=function(O,J){return this.$__send__(i(b,"Racc_YY_Parse_Method"),O,J,this.$_racc_setup(),!0)},S.$$arity=2),e.def(u,"$_racc_yyparse_rb",c=function(O,J,s,N){var w,Q,$e=t,de=t,ne=t,ie=t,be=t,fe=t,he=t;return w=e.to_ary(s),$e=null==w[0]?t:w[0],de=null==w[1]?t:w[1],ne=null==w[2]?t:w[2],ie=null==w[3]?t:w[3],be=null==w[10]?t:w[10],this.$_racc_init_sysvars(),fe=t,he=t,H(this,"catch",["racc_end_parse"],((Q=function(){var Se,xe=null==Q.$$s?this:Q.$$s;for(null==xe.racc_state&&(xe.racc_state=t);!l(he=ie["$[]"](xe.racc_state["$[]"](-1)));)for(;l(fe=xe.$_racc_evalact(ne["$[]"](xe.racc_state["$[]"](-1)),s)););return H(O,"__send__",[J],((Se=function(Ie,Pe){var Ue,He,ke=null==Se.$$s?this:Se.$$s,Le=t,Ge=t,je=t,We=t,ue=t,U=t,_e=t;for(null==ke.racc_t&&(ke.racc_t=t),null==ke.racc_state&&(ke.racc_state=t),null==ke.racc_read_next&&(ke.racc_read_next=t),null==Ie&&(Ie=t),null==Pe&&(Pe=t),ke.racc_t=l(Ie)?l(Le=be["$[]"](Ie))?Le:1:0,ke.racc_val=Pe,ke.racc_read_next=!1,he=T(he,ke.racc_t),l(l(Ue=l(He=r(he,0))?fe=$e["$[]"](he):He)?de["$[]"](he)["$=="](ke.racc_state["$[]"](-1)):Ue)||(fe=ne["$[]"](ke.racc_state["$[]"](-1)));l(fe=ke.$_racc_evalact(fe,s)););for(;l(l(Ge=l(je=(he=ie["$[]"](ke.racc_state["$[]"](-1)))["$!"]())?je:ke.racc_read_next["$!"]())?Ge:ke.racc_t["$=="](0));)for(l(l(We=l(ue=l(U=l(_e=he)?he=T(he,ke.racc_t):_e)?r(he,0):U)?fe=$e["$[]"](he):ue)?de["$[]"](he)["$=="](ke.racc_state["$[]"](-1)):We)||(fe=ne["$[]"](ke.racc_state["$[]"](-1)));l(fe=ke.$_racc_evalact(fe,s)););}).$$s=xe,Se.$$arity=2,Se))}).$$s=this,Q.$$arity=0,Q))},c.$$arity=4),e.def(u,"$_racc_evalact",o=function(O,J){var s,w,ne,ve,x=this,Q=t,ee=t,de=t,ie=t,be=t,fe=t,he=t,ae=t,xe=t,qe=t;if(Q=null==(s=e.to_ary(J))[0]?t:s[0],ee=null==s[1]?t:s[1],de=null==s[3]?t:s[3],ne=null==s[11]?t:s[11],ie=null==s[12]?t:s[12],l(l(ve=R(O,0))?W(O,ne):ve))l(R(x.racc_error_status,0))&&(x.racc_t["$=="](1)||(x.racc_error_status=V(x.racc_error_status,1))),x.racc_vstack.$push(x.racc_val),x.racc_state.$push(O),x.racc_read_next=!0,l(x.yydebug)&&(x.racc_tstack.$push(x.racc_t),x.$racc_shift(x.racc_t,x.racc_tstack,x.racc_vstack));else if(l(l(be=W(O,0))?R(O,ie["$-@"]()):be)){if(fe=H(x,"catch",["racc_jump"],((w=function(){var Se=null==w.$$s?this:w.$$s;return null==Se.racc_state&&(Se.racc_state=t),Se.racc_state.$push(Se.$_racc_do_reduce(J,O)),!1}).$$s=x,w.$$arity=0,w)),l(fe)){if(1["$==="](he=fe))return x.racc_user_yyerror=!0,ie["$-@"]();if(2["$==="](he))return ne;x.$raise("[Racc Bug] unknown jump code")}}else if(O["$=="](ne))l(x.yydebug)&&x.$racc_accept(),x.$throw("racc_end_parse",x.racc_vstack["$[]"](0));else{if(O["$=="](ie["$-@"]())){for((0)["$==="](he=x.racc_error_status)?l(J["$[]"](21))||x.$on_error(x.racc_t,x.racc_val,x.racc_vstack):3["$==="](he)&&(x.racc_t["$=="](0)&&x.$throw("racc_end_parse",t),x.racc_read_next=!0),x.racc_user_yyerror=!1,x.racc_error_status=3;l(!0)&&(!l(ae=de["$[]"](x.racc_state["$[]"](-1)))||(ae=T(ae,1),!l(l(xe=l(qe=r(ae,0))?O=Q["$[]"](ae):qe)?ee["$[]"](ae)["$=="](x.racc_state["$[]"](-1)):xe)));)l(_(x.racc_state.$size(),1))&&x.$throw("racc_end_parse",t),x.racc_state.$pop(),x.racc_vstack.$pop(),l(x.yydebug)&&(x.racc_tstack.$pop(),x.$racc_e_pop(x.racc_state,x.racc_tstack,x.racc_vstack));return O}x.$raise("[Racc Bug] unknown action "+O.$inspect())}return l(x.yydebug)&&x.$racc_next_state(x.racc_state["$[]"](-1),x.racc_state),t},o.$$arity=2),e.def(u,"$_racc_do_reduce",m=function(O,J){var s,ne,ve,qe,Ne,Se,ke,w=this,Q=t,ee=t,$e=t,de=t,ie=t,be=t,fe=t,he=t,ae=t,xe=t,Ae=t,Ie=t,Pe=t,Me=t,Fe=t,Le=t;return Q=null==(s=e.to_ary(O))[4]?t:s[4],ee=null==s[5]?t:s[5],$e=null==s[6]?t:s[6],de=null==s[7]?t:s[7],ne=null==s[8]?t:s[8],ie=null==s[9]?t:s[9],ve=null==s[13]?t:s[13],be=w.racc_state,fe=w.racc_vstack,he=w.racc_tstack,ae=function(G,D){return"number"==typeof G?-3*G:G["$*"](-3)}(J),xe=ie["$[]"](ae),qe=ie["$[]"](T(ae,1)),Ne=ie["$[]"](T(ae,2)),Se=[],l(w.yydebug)&&(Ae=he["$[]"](xe["$-@"](),xe)),Ie=fe["$[]"](xe["$-@"](),xe),l(w.yydebug)&&(Pe=[xe["$-@"](),xe,Se],H(he,"[]=",e.to_a(Pe)),V(Pe.length,1)),Pe=[xe["$-@"](),xe,Se],H(fe,"[]=",e.to_a(Pe)),V(Pe.length,1),Pe=[xe["$-@"](),xe,Se],H(be,"[]=",e.to_a(Pe)),V(Pe.length,1),l(ve)?fe.$push(w.$__send__(Ne,Ie,fe,Ie["$[]"](0))):fe.$push(w.$__send__(Ne,Ie,fe)),he.$push(qe),l(w.yydebug)&&w.$racc_reduce(Ae,qe,he,fe),ke=V(qe,ne),l(ae=de["$[]"](ke))&&(ae=T(ae,be["$[]"](-1)),l(l(Me=l(Fe=r(ae,0))?Le=Q["$[]"](ae):Fe)?ee["$[]"](ae)["$=="](ke):Me))?Le:$e["$[]"](ke)},m.$$arity=2),e.def(u,"$on_error",y=function(O,J,s){var w,N=this;return N.$raise(i(b,"ParseError"),N.$sprintf("\nparse error on value %s (%s)",J.$inspect(),l(w=N.$token_to_str(O))?w:"?"))},y.$$arity=3),e.def(u,"$yyerror",z=function(){return this.$throw("racc_jump",1)},z.$$arity=0),e.def(u,"$yyaccept",a=function(){return this.$throw("racc_jump",2)},a.$$arity=0),e.def(u,"$yyerrok",k=function(){return this.racc_error_status=0},k.$$arity=0),e.def(u,"$racc_read_token",Y=function(O,J,s){var N=this;return N.racc_debug_out.$print("read    "),N.racc_debug_out.$print(J.$inspect(),"(",N.$racc_token2str(O),") "),N.racc_debug_out.$puts(s.$inspect()),N.racc_debug_out.$puts()},Y.$$arity=3),e.def(u,"$racc_shift",te=function(O,J,s){var N=this;return N.racc_debug_out.$puts("shift   "+N.$racc_token2str(O)),N.$racc_print_stacks(J,s),N.racc_debug_out.$puts()},te.$$arity=3),e.def(u,"$racc_reduce",re=function(O,J,s,N){var w,x=this,Q=t;return(Q=x.racc_debug_out).$print("reduce "),l(O["$empty?"]())?Q.$print(" <none>"):H(O,"each",[],((w=function($e){return null==$e&&($e=t),Q.$print(" ",(null==w.$$s?this:w.$$s).$racc_token2str($e))}).$$s=x,w.$$arity=1,w)),Q.$puts(" --\x3e "+x.$racc_token2str(J)),x.$racc_print_stacks(s,N),x.racc_debug_out.$puts()},re.$$arity=4),e.def(u,"$racc_accept",me=function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()},me.$$arity=0),e.def(u,"$racc_e_pop",ye=function(O,J,s){var N=this;return N.racc_debug_out.$puts("error recovering mode: pop token"),N.$racc_print_states(O),N.$racc_print_stacks(J,s),N.racc_debug_out.$puts()},ye.$$arity=3),e.def(u,"$racc_next_state",De=function(O,J){var s=this;return s.racc_debug_out.$puts("goto    "+O),s.$racc_print_states(J),s.racc_debug_out.$puts()},De.$$arity=2),e.def(u,"$racc_print_stacks",Be=function(O,J){var s,w=t;return(w=this.racc_debug_out).$print("        ["),H(O,"each_index",[],((s=function(Q){return null==Q&&(Q=t),w.$print(" (",(null==s.$$s?this:s.$$s).$racc_token2str(O["$[]"](Q))," ",J["$[]"](Q).$inspect(),")")}).$$s=this,s.$$arity=1,s)),w.$puts(" ]")},Be.$$arity=2),e.def(u,"$racc_print_states",Te=function(O){var J,N=t;return(N=this.racc_debug_out).$print("        ["),H(O,"each",[],((J=function(x){return null==x&&(x=t),N.$print(" ",x)}).$$s=this,J.$$arity=1,J)),N.$puts(" ]")},Te.$$arity=1),e.def(u,"$racc_token2str",Ee=function(O){var s;return l(s=E(this.$class(),"Racc_token_to_s_table")["$[]"](O))?s:this.$raise("[Racc Bug] can't convert token "+O+" to string")},Ee.$$arity=1),e.def(u,"$token_to_str",Ce=function(O){return E(this.$class(),"Racc_token_to_s_table")["$[]"](O)},Ce.$$arity=1)}(P[0],P)},Opal.modules["bcdice/arithmetic/node"]=function(e){function W(P,t){return"number"==typeof P&&"number"==typeof t?P/t:P["$/"](t)}var t,F,G,A,C,d,u,b,h,g,p,v,n,f,Z,B,i,T=[],r=e.nil,R=e.$$$,_=e.$$,X=e.module,$=e.klass,L=e.send2;return t=T,F=i=[X(T[0],"BCDice")].concat(t),G=B=[X(i[0],"Arithmetic")].concat(F),function(A,C,d){var u,b,h,g,p,n=$(A,null,"BinaryOp");[n].concat(d),n.$$prototype.lhs=n.$$prototype.rhs=n.$$prototype.op=r,e.def(n,"$initialize",u=function(I,K,S){var c=this;return c.lhs=I,c.op=K,c.rhs=S},u.$$arity=3),e.def(n,"$eval",b=function(I){var c,K=this,S=r;return S=K.lhs.$eval(I),c=K.rhs.$eval(I),S.$send(K.op,c)},b.$$arity=1),e.def(n,"$output",h=function(){var I=this;return""+I.lhs.$output()+I.op+I.rhs.$output()},h.$$arity=0),e.def(n,"$s_exp",g=function(){var I=this;return"("+I.$op_for_s_exp()+" "+I.lhs.$s_exp()+" "+I.rhs.$s_exp()+")"},g.$$arity=0),e.def(n,"$op_for_s_exp",p=function(){return this.op},p.$$arity=0)}((Z=[X(B[0],"Node")].concat(G))[0],0,Z),A=Z[0],C=_(Z,"BinaryOp"),d=Z,n=$(A,C,"DivideBase"),f=[n].concat(d),n.$$prototype.lhs=n.$$prototype.rhs=n.$$prototype.op=r,e.def(n,"$initialize",u=function(K,S){return u.$$p&&(u.$$p=null),L(this,e.find_super_dispatcher(this,"initialize",u,!1,!0),"initialize",[K,"/",S],null)},u.$$arity=2),e.def(n,"$eval",b=function(K){var c,S=this,o=r;return c=S.lhs.$eval(K),(o=S.rhs.$eval(K))["$=="](0)&&S.$raise(_(f,"ZeroDivisionError")),S.$divide_and_round(c,o,K)},b.$$arity=1),e.def(n,"$output",h=function(){var K=h.$$p,c=this,o=r,m=r,y=r;for(K&&(h.$$p=null),m=0,y=arguments.length,o=new Array(y);m<y;m++)o[m]=arguments[m];return""+L(c,e.find_super_dispatcher(c,"output",h,!1,!0),"output",o,K)+c.$rounding_method()},h.$$arity=0),n.$private(),e.def(n,"$rounding_method",g=function(){return R(this.$class(),"ROUNDING_METHOD")},g.$$arity=0),e.def(n,"$op_for_s_exp",p=function(){return""+this.op+this.$rounding_method()},p.$$arity=0),e.def(n,"$divide_and_round",v=function(K,S,c){return this.$raise(_(f,"NotImplementedError"))},v.$$arity=3),function(A,C,d){var u,n=$(A,C,"DivideWithGameSystemDefault"),f=[n].concat(d);e.const_set(f[0],"ROUNDING_METHOD",""),n.$private(),e.def(n,"$divide_and_round",u=function(h,g,p){var I;return I=p,R(_(f,"RoundType"),"CEIL")["$==="](I)?W(h.$to_f(),g).$ceil():R(_(f,"RoundType"),"ROUND")["$==="](I)?W(h.$to_f(),g).$round():W(h,g).$to_i()},u.$$arity=3)}(Z[0],_(Z,"DivideBase"),Z),function(A,C,d){var u,n=$(A,C,"DivideWithCeil"),f=[n].concat(d);e.const_set(f[0],"ROUNDING_METHOD","C"),n.$private(),e.def(n,"$divide_and_round",u=function(h,g,p){return W(h.$to_f(),g).$ceil()},u.$$arity=3)}(Z[0],_(Z,"DivideBase"),Z),function(A,C,d){var u,n=$(A,C,"DivideWithRound"),f=[n].concat(d);e.const_set(f[0],"ROUNDING_METHOD","R"),n.$private(),e.def(n,"$divide_and_round",u=function(h,g,p){return W(h.$to_f(),g).$round()},u.$$arity=3)}(Z[0],_(Z,"DivideBase"),Z),function(A,C,d){var u,n=$(A,C,"DivideWithFloor"),f=[n].concat(d);e.const_set(f[0],"ROUNDING_METHOD","F"),n.$private(),e.def(n,"$divide_and_round",u=function(h,g,p){return W(h,g).$to_i()},u.$$arity=3)}(Z[0],_(Z,"DivideBase"),Z),function(A,C,d){var u,b,h,g,n=$(A,null,"Negative");[n].concat(d),n.$$prototype.body=r,e.def(n,"$initialize",u=function(v){return this.body=v},u.$$arity=1),e.def(n,"$eval",b=function(v){return this.body.$eval(v)["$-@"]()},b.$$arity=1),e.def(n,"$output",h=function(){return"-"+this.body.$output()},h.$$arity=0),e.def(n,"$s_exp",g=function(){return"(- "+this.body.$s_exp()+")"},g.$$arity=0)}(Z[0],0,Z),function(A,C,d){var u,b,h,g,n=$(A,null,"Parenthesis");[n].concat(d),n.$$prototype.expr=r,e.def(n,"$initialize",u=function(v){return this.expr=v},u.$$arity=1),e.def(n,"$eval",b=function(v){return this.expr.$eval(v)},b.$$arity=1),e.def(n,"$output",h=function(){return"("+this.expr.$output()+")"},h.$$arity=0),e.def(n,"$s_exp",g=function(){return"(Parenthesis "+this.expr.$s_exp()+")"},g.$$arity=0)}(Z[0],0,Z),void function(A,C,d){var u,b,h,n=$(A,null,"Number");[n].concat(d),n.$$prototype.value=r,e.def(n,"$initialize",u=function(p){return this.value=p},u.$$arity=1),e.def(n,"$eval",b=function(p){return this.value},b.$$arity=1),e.def(n,"$output",h=function(){return this.value.$to_s()},h.$$arity=0),e.alias(n,"s_exp","output")}(Z[0],0,Z)},Opal.modules.strscan=function(e){var E,F,l,B,H,G,D,Z,A,C,d,n,f,u,b,h,g,p,v,I,K,S,c,o,m,y,i,q,T=[],r=e.nil,_=e.$$,$=e.truthy,L=e.send;return E=T,i=(0,e.klass)(T[0],null,"StringScanner"),q=[i].concat(E),i.$$prototype.pos=i.$$prototype.string=i.$$prototype.working=i.$$prototype.matched=i.$$prototype.prev_pos=i.$$prototype.match=r,i.$attr_reader("pos"),i.$attr_reader("matched"),e.def(i,"$initialize",F=function(a){var k=this;return k.string=a,k.pos=0,k.matched=r,k.working=a,k.match=[]},F.$$arity=1),i.$attr_reader("string"),e.def(i,"$beginning_of_line?",l=function(){var a=this;return 0===a.pos||"\n"===a.string.charAt(a.pos-1)},l.$$arity=0),e.alias(i,"bol?","beginning_of_line?"),e.def(i,"$scan",B=function(a){var k=this,Y=(a=k.$anchor(a)).exec(k.working);return null==Y?k.matched=r:"object"==typeof Y?(k.prev_pos=k.pos,k.pos+=Y[0].length,k.working=k.working.substring(Y[0].length),k.matched=Y[0],k.match=Y,Y[0]):"string"==typeof Y?(k.pos+=Y.length,k.working=k.working.substring(Y.length),Y):r},B.$$arity=1),e.def(i,"$scan_until",H=function(a){var k=this;a=k.$anchor(a);for(var re,Y=k.pos,te=k.working;;){if(re=a.exec(te),Y+=1,te=te.substr(1),null!=re)return k.matched=k.string.substr(k.pos,Y-k.pos-1+re[0].length),k.match=re,k.prev_pos=Y-1,k.pos=Y,k.working=te.substr(re[0].length),k.matched;if(0===te.length)return k.match=[],k.matched=r}},H.$$arity=1),e.def(i,"$[]",G=function(a){var Y;if($(this.match["$empty?"]()))return r;Y=a,_(q,"Symbol")["$==="](Y)?a=a.$to_s():_(q,"String")["$==="](Y)||(a=_(q,"Opal")["$coerce_to!"](a,_(q,"Integer"),"to_int"));var te=this.match;return a<0&&(a+=te.length),a<0||a>=te.length||null==te[a]?r:te[a]},G.$$arity=1),e.def(i,"$check",D=function(a){var k=this,Y=(a=k.$anchor(a)).exec(k.working);return k.matched=null==Y?r:Y[0]},D.$$arity=1),e.def(i,"$check_until",Z=function(a){var k=this,Y=k.prev_pos,te=k.pos,re=k.$scan_until(a);return re!==r&&(k.matched=re.substr(-1),k.working=k.string.substr(te)),k.prev_pos=Y,k.pos=te,re},Z.$$arity=1),e.def(i,"$peek",A=function(a){return this.working.substring(0,a)},A.$$arity=1),e.def(i,"$eos?",C=function(){return 0===this.working.length},C.$$arity=0),e.def(i,"$exist?",d=function(a){var Y=a.exec(this.working);return null==Y?r:0==Y.index?0:Y.index+1},d.$$arity=1),e.def(i,"$skip",n=function(a){var k=this,Y=(a=k.$anchor(a)).exec(k.working);if(null==Y)return k.match=[],k.matched=r;var te=Y[0],re=te.length;return k.matched=te,k.match=Y,k.prev_pos=k.pos,k.pos+=re,k.working=k.working.substring(re),re},n.$$arity=1),e.def(i,"$skip_until",f=function(a){var Y=this.$scan_until(a);return Y===r?r:(this.matched=Y.substr(-1),Y.length)},f.$$arity=1),e.def(i,"$get_byte",u=function(){var a=this,k=r;return a.pos<a.string.length?(a.prev_pos=a.pos,a.pos+=1,k=a.matched=a.working.substring(0,1),a.working=a.working.substring(1)):a.matched=r,k},u.$$arity=0),e.alias(i,"getch","get_byte"),e.def(i,"$match?",b=function(a){var k=this,Y=(a=k.$anchor(a)).exec(k.working);return null==Y?r:(k.prev_pos=k.pos,Y[0].length)},b.$$arity=1),e.def(i,"$pos=",h=function(a){var k=this;return a<0&&(a+=k.string.$length()),k.pos=a,k.working=k.string.slice(a)},h.$$arity=1),e.def(i,"$matched_size",g=function(){return this.matched===r?r:this.matched.length},g.$$arity=0),e.def(i,"$post_match",p=function(){var a=this;return a.matched===r?r:a.string.substr(a.pos)},p.$$arity=0),e.def(i,"$pre_match",v=function(){var a=this;return a.matched===r?r:a.string.substr(0,a.prev_pos)},v.$$arity=0),e.def(i,"$reset",I=function(){var a=this;return a.working=a.string,a.matched=r,a.pos=0},I.$$arity=0),e.def(i,"$rest",K=function(){return this.working},K.$$arity=0),e.def(i,"$rest?",S=function(){return 0!==this.working.length},S.$$arity=0),e.def(i,"$rest_size",c=function(){return this.$rest().$size()},c.$$arity=0),e.def(i,"$terminate",o=function(){var k,P,a=this;return a.match=r,k=[a.string.$length()],L(a,"pos=",e.to_a(k)),k[(P=k.length,"number"==typeof P?P-1:P["$-"](1))]},o.$$arity=0),e.def(i,"$unscan",m=function(){var a=this;return a.pos=a.prev_pos,a.prev_pos=r,a.match=r,a},m.$$arity=0),i.$private(),e.def(i,"$anchor",y=function(a){var Y=a.toString().match(/\/([^\/]+)$/);return Y=Y?Y[1]:void 0,new RegExp("^(?:"+a.source+")",Y)},y.$$arity=1),r&&"anchor"},Opal.modules["bcdice/normalize"]=function(e){var E,F,l,i,$,P,V=[],T=e.nil,_=e.module;return $=V,E=P=[_(V[0],"BCDice")].concat($),[i=_(P[0],"Normalize")].concat(E),i.$module_function(),e.def(i,"$comparison_operator",F=function(H){var D;return/<=|=</["$==="](D=H)?"<=":/>=|=>/["$==="](D)?">=":/<>|!=|=!/["$==="](D)?"!=":/</["$==="](D)?"<":/>/["$==="](D)?">":/=/["$==="](D)?"==":T},F.$$arity=1),void e.def(i,"$target_number",l=function(H){return H["$=="]("?")?H:H.$to_i()},l.$$arity=1)},Opal.modules["bcdice/command/lexer"]=function(e){var E,l,Z,d,n,f,A,C,H,q,W=e.top,V=[],T=e.nil,R=e.$$,_=e.module,X=e.klass,$=e.hash2,L=e.truthy,P=e.send;return W.$require("strscan"),W.$require("bcdice/normalize"),E=V,l=q=[_(V[0],"BCDice")].concat(E),Z=H=[_(q[0],"Command")].concat(l),A=X(H[0],null,"Lexer"),C=[A].concat(Z),A.$$prototype.scanner=A.$$prototype.notations=T,e.const_set(C[0],"SYMBOLS",$(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),e.def(A,"$initialize",d=function(b,h){var g,p,v,K,I=this;return b=L(K=(p=(g=b)===T||null==g?T:P(g,"split",[" ",2]))===T||null==p?T:P(p,"first",[]))?K:"",I.scanner=R(C,"StringScanner").$new(b),I.notations=P(h,"map",[],((v=function(S){function c(o){return S.apply(this,arguments)}return c.toString=function(){return S.toString()},c}(function(S){return null==S&&(S=T),L(S["$is_a?"](R(C,"String")))?R(C,"Regexp").$new(S):S})).$$s=I,v.$$arity=1,v))},d.$$arity=2),e.def(A,"$next_token",n=function(){try{var b,h=this,g=T,p=T,I=T,K=T;return L(h.scanner["$eos?"]())?[!1,"$"]:(P(h.notations,"each",[],((b=function(c){var m,o=null==b.$$s?this:b.$$s;if(null==o.scanner&&(o.scanner=T),null==c&&(c=T),m=o.scanner.$scan(c),!L(m))return T;e.ret(["NOTATION",m])}).$$s=h,b.$$arity=1,b)),L(g=h.scanner.$scan(/\d+/))?["NUMBER",g.$to_i()]:L(p=h.scanner.$scan(/[<>!=]+/))?(p=R(C,"Normalize").$comparison_operator(p),[L(p)?"CMP_OP":"ILLEGAL",p]):(I=h.scanner.$getch().$upcase(),[L(K=R(C,"SYMBOLS")["$[]"](I))?K:I.$to_sym(),I]))}catch(S){if(S===e.returner)return S.$v;throw S}},n.$$arity=0),void e.def(A,"$source",f=function(){return this.scanner.$string()},f.$$arity=0)},Opal.modules["bcdice/command/parsed"]=function(e){var P,q,G,A,C,d,D,Z,l,E,V=[],T=e.nil,R=e.$$,_=e.module,X=e.klass,$=e.truthy;return P=V,q=E=[_(V[0],"BCDice")].concat(P),G=l=[_(E[0],"Command")].concat(q),D=X(l[0],null,"Parsed"),Z=[D].concat(G),D.$$prototype.question_target=D.$$prototype.critical=D.$$prototype.fumble=D.$$prototype.dollar=D.$$prototype.modify_number=D.$$prototype.target_number=D.$$prototype.prefix_number=D.$$prototype.command=D.$$prototype.suffix_number=D.$$prototype.cmp_op=T,D.$attr_accessor("command"),D.$attr_accessor("prefix_number"),D.$attr_accessor("suffix_number"),D.$attr_accessor("critical"),D.$attr_accessor("fumble"),D.$attr_accessor("dollar"),D.$attr_accessor("modify_number"),D.$attr_accessor("cmp_op"),D.$attr_accessor("target_number"),D.$attr_writer("question_target"),e.def(D,"$initialize",A=function(){var f=this;return f.prefix_number=T,f.suffix_number=T,f.critical=T,f.fumble=T,f.dollar=T,f.cmp_op=T,f.target_number=T,f.question_target=!1},A.$$arity=0),e.def(D,"$question_target?",C=function(){return this.question_target},C.$$arity=0),void e.def(D,"$to_s",d=function(f){var I,u=this,b=T,h=T,g=T,p=T,v=T;return null==f&&(f="after_command"),b=$(u.critical)?"@"+u.critical:T,h=$(u.fumble)?"#"+u.fumble:T,g=$(u.dollar)?"$"+u.dollar:T,p=R(Z,"Format").$modifier(u.modify_number),v=$(u.question_target)?"?":u.target_number,"after_command"["$==="](I=f)?[u.prefix_number,u.command,u.suffix_number,b,h,g,p,u.cmp_op,v].$join():"after_modify_number"["$==="](I)?[u.prefix_number,u.command,u.suffix_number,p,b,h,g,u.cmp_op,v].$join():"after_target_number"["$==="](I)?[u.prefix_number,u.command,u.suffix_number,p,u.cmp_op,v,b,h,g].$join():T},d.$$arity=-1)},Opal.modules["bcdice/command/parser"]=function(e){function W(q,F){return"number"==typeof q&&"number"==typeof F?q-F:q["$-"](F)}var F,G,A,C,d,u,b,h,g,p,v,I,K,S,c,o,m,y,z,a,k,Y,te,re,me,ye,De,Be,Te,Ee,Ce,oe,O,J,s,N,w,x,Q,ee,$e,de,ne,ie,ve,be,fe,he,ae,xe,qe,Ne,Se,Ae,Ie,Pe,ke,Me,Fe,Le,Ge,n,f,Z,B,V=e.top,T=[],r=e.nil,R=e.$$$,_=e.$$,X=e.klass,$=e.module,L=e.hash2,P=e.send2,t=e.send,E=e.hash,i=e.truthy;return V.$require("racc/parser.rb"),V.$require("bcdice/arithmetic/node"),V.$require("bcdice/command/lexer"),V.$require("bcdice/command/parsed"),function(q,F,l){[X(q,F,"Parser")].concat(l)}(R(_(T,"BCDice"),"Command"),R(_(T,"Racc"),"Parser"),T),F=T,G=B=[$(T[0],"BCDice")].concat(F),A=(Z=[$(B[0],"Command")].concat(G))[0],C=R(_(Z,"Racc"),"Parser"),d=Z,n=X(A,C,"Parser"),f=[n].concat(d),n.$$prototype.notations=n.$$prototype.lexer=n.$$prototype.modifier=n.$$prototype.prefix_number=n.$$prototype.suffix_number=n.$$prototype.need_suffix_number=n.$$prototype.need_prefix_number=n.$$prototype.critical=n.$$prototype.fumble=n.$$prototype.dollar=n.$$prototype.allowed_cmp_op=n.$$prototype.question_target=r,e.def(n,"$initialize",u=function(U,_e){var j,M,se,Re,pe=u.$$p,le=this;if(pe&&(u.$$p=null),j=e.slice.call(arguments,0,arguments.length),null==(M=e.extract_kwargs(j)))M=L([],{});else if(!M.$$is_hash)throw e.ArgumentError.$new("expected kwargs");if(se=j,!e.hasOwnProperty.call(M.$$smap,"round_type"))throw e.ArgumentError.$new("missing keyword: round_type");return Re=M.$$smap.round_type,P(le,e.find_super_dispatcher(le,"initialize",u,!1,!0),"initialize",[],null),le.notations=se,le.round_type=Re,le.prefix_number=!1,le.suffix_number=!1,le.need_prefix_number=!1,le.need_suffix_number=!1,le.modifier=!0,le.critical=!1,le.fumble=!1,le.dollar=!1,le.allowed_cmp_op=[r,">=",">","<=","<","==","!="],le.question_target=!1},u.$$arity=-2),e.def(n,"$disable_modifier",b=function(){return this.modifier=!1,this},b.$$arity=0),e.def(n,"$enable_prefix_number",h=function(){return this.prefix_number=!0,this},h.$$arity=0),e.def(n,"$enable_suffix_number",g=function(){return this.suffix_number=!0,this},g.$$arity=0),e.def(n,"$has_prefix_number",p=function(){var U=this;return U.prefix_number=!0,U.need_prefix_number=!0,U},p.$$arity=0),e.def(n,"$has_suffix_number",v=function(){var U=this;return U.suffix_number=!0,U.need_suffix_number=!0,U},v.$$arity=0),e.def(n,"$enable_critical",I=function(){return this.critical=!0,this},I.$$arity=0),e.def(n,"$enable_fumble",K=function(){return this.fumble=!0,this},K.$$arity=0),e.def(n,"$enable_dollar",S=function(){return this.dollar=!0,this},S.$$arity=0),e.def(n,"$restrict_cmp_op_to",c=function(U){var _e,M=this;return _e=e.slice.call(arguments,0,arguments.length),M.allowed_cmp_op=_e,M},c.$$arity=-1),e.def(n,"$enable_question_target",o=function(){return this.question_target=!0,this},o.$$arity=0),e.def(n,"$parse",m=function(U){try{return this.lexer=_(f,"Lexer").$new(U,this.notations),this.$do_parse()}catch(j){if(!e.rescue(j,[_(f,"ParseError"),_(f,"ZeroDivisionError")]))throw j;try{return r}finally{e.pop_exception()}}},m.$$arity=1),n.$private(),e.def(n,"$parsed",y=function(U,_e,j,M){var se;return t(_(f,"Parsed").$new(),"tap",[],((se=function(ge){var we,ze,Ze,Ye,Ke,Qe,le=null==se.$$s?this:se.$$s,ce=r;return null==le.round_type&&(le.round_type=r),null==ge&&(ge=r),ce=[U["$[]"]("command")],t(ge,"command=",e.to_a(ce)),W(ce.length,1),ce=[(we=U["$[]"]("prefix"),we===r||null==we?r:t(we,"eval",[le.round_type]))],t(ge,"prefix_number=",e.to_a(ce)),W(ce.length,1),ce=[(ze=U["$[]"]("suffix"),ze===r||null==ze?r:t(ze,"eval",[le.round_type]))],t(ge,"suffix_number=",e.to_a(ce)),W(ce.length,1),ce=[(Ze=_e["$[]"]("critical"),Ze===r||null==Ze?r:t(Ze,"eval",[le.round_type]))],t(ge,"critical=",e.to_a(ce)),W(ce.length,1),ce=[(Ye=_e["$[]"]("fumble"),Ye===r||null==Ye?r:t(Ye,"eval",[le.round_type]))],t(ge,"fumble=",e.to_a(ce)),W(ce.length,1),ce=[(Ke=_e["$[]"]("dollar"),Ke===r||null==Ke?r:t(Ke,"eval",[le.round_type]))],t(ge,"dollar=",e.to_a(ce)),W(ce.length,1),ce=[j.$eval(le.round_type)],t(ge,"modify_number=",e.to_a(ce)),W(ce.length,1),ce=[M["$[]"]("cmp_op")],t(ge,"cmp_op=",e.to_a(ce)),W(ce.length,1),M["$[]"]("target")["$=="]("?")?(t(ge,"question_target=",e.to_a(ce=[!0])),W(ce.length,1),t(ge,"target_number=",e.to_a(ce=[0])),ce[W(ce.length,1)]):(t(ge,"question_target=",e.to_a(ce=[!1])),W(ce.length,1),ce=[(Qe=M["$[]"]("target"),Qe===r||null==Qe?r:t(Qe,"eval",[le.round_type]))],t(ge,"target_number=",e.to_a(ce)),ce[W(ce.length,1)])}).$$s=this,se.$$arity=1,se))},y.$$arity=4),e.def(n,"$next_token",z=function(){return this.lexer.$next_token()},z.$$arity=0),Ne=[6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,33,34,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,r,r,17,18,6,r,5,r,r,17,18,r,r,5,23,24,25,26,56,54,55,57],Se=[0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,r,17,15,15,18,18,23,r,18,30,30,23,23,24,r,23,31,31,24,24,25,r,24,44,44,25,25,28,r,25,47,47,28,28,29,r,28,48,48,29,29,33,r,29,49,49,33,33,34,r,33,50,50,34,34,36,r,34,r,r,36,36,37,r,36,r,r,37,37,r,r,37,27,27,27,27,52,52,52,52],Ae=[-2,4,16,-3,-1,11,r,33,13,35,23,30,1,r,28,40,r,37,44,r,r,-2,r,51,58,65,0,106,72,79,47,54,r,86,93,r,100,107,r,r,r,r,r,r,63,r,r,68,75,82,89,r,120,r,r,r,r,r],Ie=[-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29],Pe=[30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,r,r,21,47,48,40,51,52,49,50,44,46,3,r,r,r,13,r,r,r,r,r,r,r,32],ke=[8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,r,r,4,8,8,5,7,7,8,8,9,5,6,r,r,r,6,r,r,r,r,r,r,r,6],Me=[r,6,13,3,9,-1,27,-15,-10,-1,-38],Fe=[r,r,r,r,r,r,19,16,15,r,r],Le=[0,0,"racc_error",4,20,"_reduce_1",4,20,"_reduce_2",3,20,"_reduce_3",3,21,"_reduce_4",2,21,"_reduce_5",2,21,"_reduce_6",1,21,"_reduce_7",0,22,"_reduce_8",3,22,"_reduce_9",3,22,"_reduce_10",3,22,"_reduce_11",2,23,"_reduce_12",2,23,"_reduce_13",3,23,"_reduce_14",3,23,"_reduce_15",0,24,"_reduce_16",2,24,"_reduce_17",2,24,"_reduce_18",3,28,"_reduce_19",3,28,"_reduce_20",1,28,"_reduce_none",3,27,"_reduce_22",4,27,"_reduce_23",1,27,"_reduce_none",0,29,"_reduce_25",1,29,"_reduce_26",1,29,"_reduce_27",1,29,"_reduce_28",1,29,"_reduce_29",2,26,"_reduce_30",2,26,"_reduce_31",1,26,"_reduce_none",3,25,"_reduce_33",1,25,"_reduce_34"],Ge=E(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),e.const_set(f[0],"Racc_arg",[Ne,Se,Ie,Ae,Pe,ke,Fe,Me,19,Le,Ge,58,35,!0]),e.const_set(f[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),e.const_set(f[0],"Racc_debug_parser",!1),e.def(n,"$_reduce_1",a=function(U,_e,j){var M;return i(this.modifier)||this.$raise(_(f,"ParseError")),M=e.to_ary(U),this.$parsed(null==M[0]?r:M[0],null==M[1]?r:M[1],null==M[2]?r:M[2],null==M[3]?r:M[3])},a.$$arity=3),e.def(n,"$_reduce_2",k=function(U,_e,j){var M;return i(this.modifier)||this.$raise(_(f,"ParseError")),M=e.to_ary(U),this.$parsed(null==M[0]?r:M[0],null==M[2]?r:M[2],null==M[1]?r:M[1],null==M[3]?r:M[3])},k.$$arity=3),e.def(n,"$_reduce_3",Y=function(U,_e,j){var M,le;return le=null==(M=e.to_ary(U))[2]?r:M[2],this.$parsed(null==M[0]?r:M[0],null==M[1]?r:M[1],R(R(_(f,"Arithmetic"),"Node"),"Number").$new(0),le)},Y.$$arity=3),e.def(n,"$_reduce_4",te=function(U,_e,j){var se,M=this;return i(i(se=M.prefix_number)?M.suffix_number:se)||M.$raise(_(f,"ParseError")),L(["command","prefix","suffix"],{command:U["$[]"](1),prefix:U["$[]"](0),suffix:U["$[]"](2)})},te.$$arity=3),e.def(n,"$_reduce_5",re=function(U,_e,j){var M=this;return i(M.prefix_number)||M.$raise(_(f,"ParseError")),i(M.need_suffix_number)&&M.$raise(_(f,"ParseError")),L(["command","prefix"],{command:U["$[]"](1),prefix:U["$[]"](0)})},re.$$arity=3),e.def(n,"$_reduce_6",me=function(U,_e,j){var M=this;return i(M.suffix_number)||M.$raise(_(f,"ParseError")),i(M.need_prefix_number)&&M.$raise(_(f,"ParseError")),L(["command","suffix"],{command:U["$[]"](0),suffix:U["$[]"](1)})},me.$$arity=3),e.def(n,"$_reduce_7",ye=function(U,_e,j){var se,M=this;return i(i(se=M.need_prefix_number)?se:M.need_suffix_number)&&M.$raise(_(f,"ParseError")),L(["command"],{command:U["$[]"](0)})},ye.$$arity=3),e.def(n,"$_reduce_8",De=function(U,_e,j){return L([],{})},De.$$arity=3),e.def(n,"$_reduce_9",Be=function(U,_e,j){var M,le,ze,we,pe=r;return pe=null==(M=e.to_ary(U))[0]?r:M[0],le=null==M[2]?r:M[2],i(i(we=this.critical)?pe["$[]"]("critical")["$nil?"]():we)||this.$raise(_(f,"ParseError")),t(pe,"[]=",e.to_a(ze=["critical",le])),W(ze.length,1),pe},Be.$$arity=3),e.def(n,"$_reduce_10",Te=function(U,_e,j){var M,le,ze,we,pe=r;return pe=null==(M=e.to_ary(U))[0]?r:M[0],le=null==M[2]?r:M[2],i(i(we=this.fumble)?pe["$[]"]("fumble")["$nil?"]():we)||this.$raise(_(f,"ParseError")),t(pe,"[]=",e.to_a(ze=["fumble",le])),W(ze.length,1),pe},Te.$$arity=3),e.def(n,"$_reduce_11",Ee=function(U,_e,j){var M,le,ze,we,pe=r;return pe=null==(M=e.to_ary(U))[0]?r:M[0],le=null==M[2]?r:M[2],i(i(we=this.dollar)?pe["$[]"]("dollar")["$nil?"]():we)||this.$raise(_(f,"ParseError")),t(pe,"[]=",e.to_a(ze=["dollar",le])),W(ze.length,1),pe},Ee.$$arity=3),e.def(n,"$_reduce_12",Ce=function(U,_e,j){return U["$[]"](1)},Ce.$$arity=3),e.def(n,"$_reduce_13",oe=function(U,_e,j){return R(R(_(f,"Arithmetic"),"Node"),"Negative").$new(U["$[]"](1))},oe.$$arity=3),e.def(n,"$_reduce_14",O=function(U,_e,j){return R(R(_(f,"Arithmetic"),"Node"),"BinaryOp").$new(U["$[]"](0),"+",U["$[]"](2))},O.$$arity=3),e.def(n,"$_reduce_15",J=function(U,_e,j){return R(R(_(f,"Arithmetic"),"Node"),"BinaryOp").$new(U["$[]"](0),"-",U["$[]"](2))},J.$$arity=3),e.def(n,"$_reduce_16",s=function(U,_e,j){return i(this.allowed_cmp_op["$include?"](r))||this.$raise(_(f,"ParseError")),L([],{})},s.$$arity=3),e.def(n,"$_reduce_17",N=function(U,_e,j){var M,pe,ge;return ge=null==(M=e.to_ary(U))[1]?r:M[1],i(this.allowed_cmp_op["$include?"](pe=null==M[0]?r:M[0]))||this.$raise(_(f,"ParseError")),L(["cmp_op","target"],{cmp_op:pe,target:ge})},N.$$arity=3),e.def(n,"$_reduce_18",w=function(U,_e,j){var se,M=this;return se=U["$[]"](0),i(M.question_target)||M.$raise(_(f,"ParseError")),i(M.allowed_cmp_op["$include?"](se))||M.$raise(_(f,"ParseError")),L(["cmp_op","target"],{cmp_op:se,target:"?"})},w.$$arity=3),e.def(n,"$_reduce_19",x=function(U,_e,j){return R(R(_(f,"Arithmetic"),"Node"),"BinaryOp").$new(U["$[]"](0),"+",U["$[]"](2))},x.$$arity=3),e.def(n,"$_reduce_20",Q=function(U,_e,j){return R(R(_(f,"Arithmetic"),"Node"),"BinaryOp").$new(U["$[]"](0),"-",U["$[]"](2))},Q.$$arity=3),e.def(n,"$_reduce_22",ee=function(U,_e,j){return R(R(_(f,"Arithmetic"),"Node"),"BinaryOp").$new(U["$[]"](0),"*",U["$[]"](2))},ee.$$arity=3),e.def(n,"$_reduce_23",$e=function(U,_e,j){return U["$[]"](3).$new(U["$[]"](0),U["$[]"](2))},$e.$$arity=3),e.def(n,"$_reduce_25",de=function(U,_e,j){return R(R(_(f,"Arithmetic"),"Node"),"DivideWithGameSystemDefault")},de.$$arity=3),e.def(n,"$_reduce_26",ne=function(U,_e,j){return R(R(_(f,"Arithmetic"),"Node"),"DivideWithCeil")},ne.$$arity=3),e.def(n,"$_reduce_27",ie=function(U,_e,j){return R(R(_(f,"Arithmetic"),"Node"),"DivideWithCeil")},ie.$$arity=3),e.def(n,"$_reduce_28",ve=function(U,_e,j){return R(R(_(f,"Arithmetic"),"Node"),"DivideWithRound")},ve.$$arity=3),e.def(n,"$_reduce_29",be=function(U,_e,j){return R(R(_(f,"Arithmetic"),"Node"),"DivideWithFloor")},be.$$arity=3),e.def(n,"$_reduce_30",fe=function(U,_e,j){return U["$[]"](1)},fe.$$arity=3),e.def(n,"$_reduce_31",he=function(U,_e,j){return R(R(_(f,"Arithmetic"),"Node"),"Negative").$new(U["$[]"](1))},he.$$arity=3),e.def(n,"$_reduce_33",ae=function(U,_e,j){return U["$[]"](1)},ae.$$arity=3),e.def(n,"$_reduce_34",xe=function(U,_e,j){return R(R(_(f,"Arithmetic"),"Node"),"Number").$new(U["$[]"](0))},xe.$$arity=3),void e.def(n,"$_reduce_none",qe=function(U,_e,j){return U["$[]"](0)},qe.$$arity=3)},Opal.modules["bcdice/deprecated/checker"]=function(e){var P,q,H,Z,A,C,d,n,f,G,D,l,E,V=[],T=e.nil,R=e.$$,_=e.module,X=e.send,$=e.truthy;return P=V,q=E=[_(V[0],"BCDice")].concat(P),H=l=[_(E[0],"Deprecated")].concat(q),G=_(l[0],"Checker"),D=[G].concat(H),G.$private(),e.def(G,"$check_result_legacy",Z=function(b,h,g,p){var S,m,v=this,I=T,K=T,c=T,o=T,y=T;return I=X(h,"map",[],"sides".$to_proc()),S=(K=X(h,"map",[],"value".$to_proc())).$sum(),c=[100]["$==="](o=I)?v.$check_1D100(b,S,g,p):[20]["$==="](o)?v.$check_1D20(b,S,g,p):[6,6]["$==="](o)?v.$check_2D6(b,S,K,g,p):T,$($(m=c["$nil?"]())?m:c["$empty?"]())&&(o=I.$uniq(),c=[10]["$==="](o)?v.$check_nD10(b,S,K,g,p):[6]["$==="](o)?v.$check_nD6(b,S,K,g,p):T,$($(y=c["$nil?"]())?y:c["$empty?"]()))?T:R(D,"Result").$new(c.$delete_prefix(" \uff1e "))},Z.$$arity=4),e.def(G,"$check_1D100",A=function(b,h,g,p){return T},A.$$arity=4),e.def(G,"$check_1D20",C=function(b,h,g,p){return T},C.$$arity=4),e.def(G,"$check_nD10",d=function(b,h,g,p,v){return T},d.$$arity=5),e.def(G,"$check_2D6",n=function(b,h,g,p,v){return T},n.$$arity=5),void e.def(G,"$check_nD6",f=function(b,h,g,p,v){return T},f.$$arity=5)},Opal.modules["bcdice/base"]=function(e){function W(B,H){return"number"==typeof B&&"number"==typeof H?B+H:B["$+"](H)}function V(B,H){return"number"==typeof B&&"number"==typeof H?B-H:B["$-"](H)}var H,C,f,u,b,h,g,p,v,I,K,S,c,o,m,y,z,a,k,Y,te,re,me,ye,De,Be,Te,Ee,Ce,oe,O,J,w,x,Q,ee,$e,N,d,n,D,_=e.top,X=[],$=e.nil,L=e.$$$,P=e.$$,t=e.module,E=e.klass,i=e.truthy,q=e.send,F=e.range,l=$;return _.$require("i18n"),_.$require("i18n/backend/fallbacks"),_.$require("bcdice/randomizer"),_.$require("bcdice/dice_table"),_.$require("bcdice/enum"),_.$require("bcdice/translate"),_.$require("bcdice/result"),_.$require("bcdice/command/parser"),_.$require("bcdice/deprecated/checker"),H=X,C=D=[t(X[0],"BCDice")].concat(H),d=E(D[0],null,"Base"),n=[d].concat(C),d.$$prototype.sort_add_dice=d.$$prototype.sort_barabara_dice=d.$$prototype.enabled_d9=d.$$prototype.raw_input=d.$$prototype.randomizer=d.$$prototype.enabled_upcase_input=d.$$prototype.debug=$,J=e.get_singleton_class(d),N=[J].concat(n),J.$attr_reader("prefixes"),e.def(J,"$register_prefix",w=function(ne){var ve,be=this,fe=$;return null==be.prefixes&&(be.prefixes=$),ve=e.slice.call(arguments,0,arguments.length),be.prefixes=i(fe=be.prefixes)?fe:[],be.prefixes.$concat(ve.$flatten())},w.$$arity=-1),e.def(J,"$register_prefix_from_super_class",x=function(){return this.$register_prefix(this.$superclass().$prefixes())},x.$$arity=0),e.def(J,"$prefixes_pattern",Q=function(){var ie,ne=this,ve=$;return null==ne.prefixes_pattern&&(ne.prefixes_pattern=$),null==ne.prefixes&&(ne.prefixes=$),ne.prefixes_pattern=i(ie=ne.prefixes_pattern)?ie:$,i(ne.prefixes_pattern)?ne.prefixes_pattern:(ne.prefixes=i(ve=ne.prefixes)?ve:[],ne.prefixes.$freeze(),ne.prefixes_pattern=(i(ne.prefixes["$empty?"]())?/(?!)/:e.regexp(["^(S)?(",ne.prefixes.$join("|"),")"],"i")).$freeze())},Q.$$arity=0),e.def(J,"$command_pattern",ee=function(){var ne,ve,ie=this,be=$,fe=$;return null==ie.command_pattern&&(ie.command_pattern=$),null==ie.prefixes&&(ie.prefixes=$),ie.command_pattern=i(ve=ie.command_pattern)?ve:$,i(ie.command_pattern)?ie.command_pattern:(ie.prefixes=i(be=ie.prefixes)?be:[],ie.prefixes.$freeze(),fe=W(q(L(P(N,"CommonCommand"),"COMMANDS"),"map",[],((ne=function(ae){return null==ae&&(ae=$),L(ae,"PREFIX_PATTERN").$source()}).$$s=ie,ne.$$arity=1,ne)),ie.prefixes),ie.command_pattern=e.regexp(["^S?(",fe.$join("|"),")"],"i").$freeze())},ee.$$arity=0),e.def(J,"$eval",$e=function(ne){return this.$new(ne).$eval()},$e.$$arity=1),d.$include(P(n,"Translate")),d.$include(L(P(n,"Deprecated"),"Checker")),e.def(d,"$initialize",f=function(s){var N=this;return N.raw_input=s,N.sort_add_dice=!1,N.sort_barabara_dice=!1,N.d66_sort_type=L(P(n,"D66SortType"),"NO_SORT"),N.enabled_d9=!1,N.round_type=L(P(n,"RoundType"),"FLOOR"),N.sides_implicit_d=6,N.upper_dice_reroll_threshold=$,N.reroll_dice_reroll_threshold=$,N.default_cmp_op=$,N.default_target_number=$,N.enabled_upcase_input=!0,N.locale="ja_jp",N.randomizer=L(P(n,"BCDice"),"Randomizer").$new(),N.debug=!1},f.$$arity=1),d.$attr_accessor("randomizer"),d.$attr_reader("d66_sort_type"),d.$attr_reader("round_type"),d.$attr_reader("sides_implicit_d"),d.$attr_reader("upper_dice_reroll_threshold"),d.$attr_reader("reroll_dice_reroll_threshold"),d.$attr_reader("default_cmp_op"),d.$attr_reader("default_target_number"),e.def(d,"$sort_add_dice?",u=function(){return this.sort_add_dice},u.$$arity=0),e.def(d,"$sort_barabara_dice?",b=function(){return this.sort_barabara_dice},b.$$arity=0),e.def(d,"$enabled_d9?",h=function(){return this.enabled_d9},h.$$arity=0),e.def(d,"$enable_debug",g=function(){return this.debug=!0},g.$$arity=0),e.def(d,"$eval",p=function(){var N,w,x,s=this,Q=$;return N=L(P(n,"BCDice"),"Preprocessor").$process(s.raw_input,s),w=i(x=s.$dice_command(N))?x:s.$eval_common_command(s.raw_input),i(w)?(Q=[s.randomizer.$rand_results()],q(w,"rands=",e.to_a(Q)),V(Q.length,1),Q=[s.randomizer.$detailed_rand_results()],q(w,"detailed_rands=",e.to_a(Q)),V(Q.length,1),w):$},p.$$arity=0),e.def(d,"$change_text",v=function(s){return s},v.$$arity=1),e.def(d,"$check_result",I=function(s,N,w,x){var Q=this,ee=$,$e=$,de=$,ne=$,ie=$;return ee=Q.$check_result_legacy(s,N,w,x),i(ee)?ee:($e=q(N,"map",[],"sides".$to_proc()),ne=(de=q(N,"map",[],"value".$to_proc())).$sum(),(ee=[100]["$==="](ie=$e)?Q.$result_1d100(s,ne,w,x):[20]["$==="](ie)?Q.$result_1d20(s,ne,w,x):[6,6]["$==="](ie)?Q.$result_2d6(s,ne,de,w,x):$)["$=="](P(n,"Result").$nothing())?$:i(ee)?ee:(ie=$e.$uniq(),(ee=[10]["$==="](ie)?Q.$result_nd10(s,ne,de,w,x):[6]["$==="](ie)?Q.$result_nd6(s,ne,de,w,x):$)["$=="](P(n,"Result").$nothing())?$:i(ee)?ee:Q.$result_ndx(s,w,x)))},I.$$arity=4),e.def(d,"$grich_text",K=function(s,N,w){return $},K.$$arity=3),d.$private(),e.def(d,"$eval_common_command",S=function(s){try{var N;return s=this.$change_text(s),q(L(P(n,"CommonCommand"),"COMMANDS"),"each",[],((N=function(Q){var $e,ee=null==N.$$s?this:N.$$s;if(null==ee.randomizer&&(ee.randomizer=$),null==Q&&(Q=$),$e=Q.$eval(s,ee,ee.randomizer),!i($e))return $;e.ret($e)}).$$s=this,N.$$arity=1,N)),$}catch(x){if(x===e.returner)return x.$v;throw x}},S.$$arity=1),e.def(d,"$dice_command",c=function(s){var N,w=this,x=$,Q=$,ee=$,$e=$,de=$,ne=$,ie=$;return i(w.enabled_upcase_input)&&(s=s.$upcase()),x=w.$class().$prefixes_pattern().$match(s),i(x)?(Q=x["$[]"](1)["$nil?"]()["$!"](),i(Q)&&(s=s["$[]"](F(1,-1,!1))),ee=w.$eval_game_system_specific_command(s),i(ee["$is_a?"](P(n,"Result")))?($e=[i(de=ee["$secret?"]())?de:Q],q(ee,"secret=",e.to_a($e)),V($e.length,1),ee):i(i(ne=i(ie=ee["$nil?"]())?ie:ee["$empty?"]())?ne:ee["$=="]("1"))?$:q(P(n,"Result").$new(),"tap",[],((N=function(be){return null==be&&(be=$),$e=[ee.$to_s()],q(be,"text=",e.to_a($e)),V($e.length,1),q(be,"secret=",e.to_a($e=[Q])),$e[V($e.length,1)]}).$$s=w,N.$$arity=1,N))):$},c.$$arity=1),e.def(d,"$eval_game_system_specific_command",o=function(s){return $},o.$$arity=1),e.def(d,"$result_ndx",m=function(s,N,w){return i(w["$is_a?"](P(n,"String")))?$:i(s.$send(N,w))?P(n,"Result").$success(this.$translate("success")):P(n,"Result").$failure(this.$translate("failure"))},m.$$arity=3),e.def(d,"$result_1d100",y=function(s,N,w,x){return $},y.$$arity=4),e.def(d,"$result_1d20",z=function(s,N,w,x){return $},z.$$arity=4),e.def(d,"$result_nd10",a=function(s,N,w,x,Q){return $},a.$$arity=5),e.def(d,"$result_2d6",k=function(s,N,w,x,Q){return $},k.$$arity=5),e.def(d,"$result_nd6",Y=function(s,N,w,x,Q){return $},Y.$$arity=5),e.def(d,"$get_table_by_2d6",te=function(s){return this.$get_table_by_nD6(s,2)},te.$$arity=1),e.def(d,"$get_table_by_1d6",re=function(s){return this.$get_table_by_nD6(s,1)},re.$$arity=1),e.def(d,"$get_table_by_nD6",me=function(s,N){return this.$get_table_by_nDx(s,N,6)},me.$$arity=2),e.def(d,"$get_table_by_nDx",ye=function(s,N,w){var Q,ee=$;return Q=this.randomizer.$roll_sum(N,w),ee=this.$get_table_value(s["$[]"](V(Q,N))),i(ee["$nil?"]())?["1",0]:[ee,Q]},ye.$$arity=3),e.def(d,"$get_table_by_1d3",De=function(s){var x,Q,B,N=this,ee=$;return N.$debug("get_table_by_1d3"),x=N.randomizer.$roll_sum(1,6),N.$debug("num",x),Q=(B=V(x,1),"number"==typeof B?B/2:B["$/"](2)).$to_i(),N.$debug("index",Q),ee=s["$[]"](Q),i(ee["$nil?"]())?["1",0]:[ee,x]},De.$$arity=1),e.def(d,"$get_table_by_d66_swap",Be=function(s){var w;return w=this.randomizer.$roll_d66(L(P(n,"D66SortType"),"ASC")),[this.$get_table_by_number(w,s),w]},Be.$$arity=1),e.def(d,"$get_table_by_d66",Te=function(s){var w,x,Q,$e,B,ee=$;return w=this.randomizer.$roll_once(6),x=this.randomizer.$roll_once(6),Q=W("number"==typeof(B=V(w,1))?6*B:B["$*"](6),V(x,1)),ee=s["$[]"](Q),$e=""+w+x,i(ee["$nil?"]())?["1",$e]:[ee,$e]},Te.$$arity=1),e.def(d,"$get_table_by_number",Ee=function(s,N,w){try{var x;return null==w&&(w="1"),q(N,"each",[],((x=function($e){var ne,de=null==x.$$s?this:x.$$s;if(null==$e&&($e=$),ne=$e["$[]"](0),!i(function(B,H){return"number"==typeof B&&"number"==typeof H?B>=H:B["$>="](H)}(ne,s)))return $;e.ret(de.$get_table_value($e["$[]"](1)))}).$$s=this,x.$$arity=1,x)),this.$get_table_value(w)}catch(ee){if(ee===e.returner)return ee.$v;throw ee}},Ee.$$arity=-3),e.def(d,"$get_table_value",Ce=function(s){return i(s["$is_a?"](P(n,"Proc")))?s.$call():s},Ce.$$arity=1),e.def(d,"$roll_tables",oe=function(s,N){var x=$;return x=N["$[]"](s),i(x)?x.$roll(this.randomizer).$to_s():$},oe.$$arity=2),e.def(d,"$debug",O=function(s,N){var x,Q,ee=this,$e=$,de=$;return x=e.slice.call(arguments,1,arguments.length),i(ee.debug)?($e=i(s["$is_a?"](P(n,"String")))?s:s.$inspect(),i(x["$empty?"]())?ee.$warn($e):(de=q(x,"map",[],((Q=function(ie){return null==ie&&(ie=$),i(ie["$is_a?"](P(n,"String")))?'"'+ie+'"':ie.$inspect()}).$$s=ee,Q.$$arity=1,Q)),ee.$warn($e+": "+de.$join(", ")))):$},O.$$arity=-2),L(L(P(X,"I18n"),"Backend"),"Simple").$include(L(L(P(X,"I18n"),"Backend"),"Fallbacks")),P(X,"I18n").$load_path()["$<<"](P(X,"Dir")["$[]"](P(X,"File").$join(_.$__dir__(),"../../i18n/**/*.yml"))),l=["ja_jp"],q(P(X,"I18n"),"default_locale=",e.to_a(l)),V(l.length,1),l=[["ja_jp"]],q(P(X,"I18n").$fallbacks(),"defaults=",e.to_a(l)),l[V(l.length,1)]},function(e){function W(F,l){return"number"==typeof F&&"number"==typeof l?F+l:F["$+"](l)}function V(F,l){return"number"==typeof F&&"number"==typeof l?F-l:F["$-"](l)}function T(F,l){return"number"==typeof F&&"number"==typeof l?F>l:F["$>"](l)}var l,D,n,b,h,g,p,v,I,K,f,u,A,H,X=[],$=e.nil,P=e.$$,t=e.module,E=e.klass,i=e.truthy,q=e.send;e.top.$require("bcdice/base"),l=X,D=H=[t(X[0],"BCDice")].concat(l),n=A=[t(H[0],"GameSystem")].concat(D),f=E(A[0],P(A,"Base"),"ZettaiReido"),u=[f].concat(n),f.$$prototype.randomizer=$,e.const_set(u[0],"ID","ZettaiReido"),e.const_set(u[0],"NAME","\u7d76\u5bfe\u96b7\u5974"),e.const_set(u[0],"SORT_KEY","\u305b\u3064\u305f\u3044\u308c\u3044\u3068"),e.const_set(u[0],"HELP_MESSAGE","\u30fb\u5224\u5b9a\nm-2DR+n>=x\nm(\u57fa\u672c\u80fd\u529b),n(\u4fee\u6b63\u5024),x(\u76ee\u6a19\u5024)\nDP\u306e\u53d6\u5f97\u306e\u6709\u7121\u3082\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n"),f.$register_prefix("\\d+\\-2DR"),e.def(f,"$eval_game_system_specific_command",b=function(c){var m=$,y=$,z=$;return i(c["$=~"](/^(\d+)-2DR([+\-\d]*)(>=(\d+))?$/i))?(m=P(u,"Regexp").$last_match(1).$to_i(),y=P(u,"Regexp").$last_match(2),z=P(u,"Regexp").$last_match(4),this.$roll2DR(m,y,z)):$},b.$$arity=1),e.def(f,"$roll2DR",h=function(c,o,m){var y,z,k,Y,te,re,me,oe,a=this,De=$,Be=$,Te=$,Ee=$,Ce=$;return z=a.$roll2DarkDice(),k=null==(y=e.to_ary(z))[0]?$:y[0],Y=null==y[1]?$:y[1],te=null==y[2]?$:y[2],z=a.$getModInfo(o),re=null==(y=e.to_ary(z))[0]?$:y[0],o=null==y[1]?$:y[1],z=a.$getDiffInfo(m),me=null==(y=e.to_ary(z))[0]?$:y[0],De="("+c+"-2DR"+o+(null==y[1]?$:y[1])+")",Be=c+"-"+k+"["+Y+"]"+o,Te=W(V(c,k),re),Ee=a.$getResult(k,Te,me),i(T(te,0))&&(Ce=te+"DP"),oe=[[De,Be,Te.$to_i(),Ee.$text(),Ce].$compact().$join(" \uff1e ")],q(Ee,"text=",e.to_a(oe)),V(oe.length,1),Ee},h.$$arity=3),e.def(f,"$roll2DarkDice",g=function(){var c,o,y,z,a,k,Y,m=this,re=$;return y=m.randomizer.$roll_once(6),z=m.randomizer.$roll_once(6),o=m.$changeDiceToDarkDice(y),a=null==(c=e.to_ary(o))[0]?$:c[0],k=null==c[1]?$:c[1],o=m.$changeDiceToDarkDice(z),Y=null==(c=e.to_ary(o))[0]?$:c[0],(re=W(k,null==c[1]?$:c[1]))["$=="](2)&&(re=4),[W(a,Y),a+","+Y,re]},g.$$arity=0),e.def(f,"$changeDiceToDarkDice",p=function(c){var m=$,y=$;return m=0,y=c,c["$=="](6)&&(y=0,m=1),[y,m]},p.$$arity=1),e.def(f,"$getModInfo",v=function(c){var F,m=$,y=$;return m=P(u,"ArithmeticEvaluator").$eval(c),y="",i("number"==typeof(F=m)?F<0:F["$<"](0))?y=m.$to_s():i(T(m,0))&&(y=W("+",m.$to_s())),[m,y]},v.$$arity=1),e.def(f,"$getDiffInfo",I=function(c){var m=$;return m="",i(c["$nil?"]())||(m=">="+(c=c.$to_i()).$to_i()),[c,m]},I.$$arity=1),e.def(f,"$getResult",K=function(c,o,m){var F,z=$;return c["$=="](0)?P(u,"Result").$critical("\u30af\u30ea\u30c6\u30a3\u30ab\u30eb"):c["$=="](10)?P(u,"Result").$fumble("\u30d5\u30a1\u30f3\u30d6\u30eb"):(i(m["$nil?"]())&&(m=0),z=V(o,m),i("number"==typeof(F=z)?F>=0:F["$>="](0))?P(u,"Result").$success(z+" \u6210\u529f"):P(u,"Result").$failure("\u5931\u6557"))},K.$$arity=3)}(Opal)}}]);