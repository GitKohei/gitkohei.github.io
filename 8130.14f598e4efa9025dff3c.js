(self.webpackChunkudonarium_lily_gk=self.webpackChunkudonarium_lily_gk||[]).push([[8130],{8130:function(Xe,Je,Ze){Ze(4656),Opal.modules["i18n/backend/fallbacks"]=function(e){function K(C,a){return"number"==typeof C&&"number"==typeof a?C-a:C["$-"](a)}var a,o,H,T,j,P,Y,w=[],r=e.nil,D=e.$$$,c=e.$$,Z=e.module,$=e.truthy,I=e.send,z=e.send2,t=e.hash2;return a=w,Y=[P=Z(w[0],"I18n")].concat(a),e.class_variable_set(Y[0],"@@fallbacks",r),o=e.get_singleton_class(P),j=[o].concat(Y),e.def(o,"$fallbacks",H=function(){var L,n,f;return e.class_variable_set(j[1],"@@fallbacks",$(f=null==(L=j[1].$$cvars["@@fallbacks"])?r:L)?f:D(D(c(j,"I18n"),"Locale"),"Fallbacks").$new()),$(n=c(j,"Thread").$current()["$[]"]("i18n_fallbacks"))?n:null==(L=j[1].$$cvars["@@fallbacks"])?r:L},H.$$arity=0),e.def(o,"$fallbacks=",T=function(L){var E,n;return e.class_variable_set(j[1],"@@fallbacks",$(L["$is_a?"](c(j,"Array")))?D(D(c(j,"I18n"),"Locale"),"Fallbacks").$new(L):L),n=["i18n_fallbacks",null==(E=j[1].$$cvars["@@fallbacks"])?r:E],I(c(j,"Thread").$current(),"[]=",e.to_a(n)),n[K(n.length,1)]},T.$$arity=1),void function(o,h){var H=[Z(o,"Backend")].concat(h);!function(T,V){var f,n,d,u,L=Z(T,"Fallbacks"),E=[L].concat(V);e.def(L,"$translate",f=function(p,v,k){try{var y,q=f.$$p,g=this,l=r,_=r,b=r,x=r,A=r,i=r;for(q&&(f.$$p=null),A=0,i=arguments.length,x=new Array(i);A<i;A++)x[A]=arguments[A];return null==k&&(k=c(E,"EMPTY_HASH")),!$(k.$fetch("fallback",!0))||$(k["$[]"]("fallback_in_progress"))?z(g,e.find_super_dispatcher(g,"translate",f,!1,!0),"translate",x,q):($(k["$[]"]("default"))&&(l=g["$extract_non_symbol_default!"](k)),_=k.$merge(t(["fallback_in_progress"],{fallback_in_progress:!0})),I(c(E,"I18n").$fallbacks()["$[]"](p),"each",[],((y=function(M){var $e,re=null==y.$$s?this:y.$$s;null==M&&(M=r);try{return I(re,"catch",["exception"],(($e=function(){var ge=null==$e.$$s?this:$e.$$s,Se=r;if(Se=z(ge,e.find_iter_super_dispatcher(ge,"translate",$e.$$def||y.$$def||f,!1,!1),"translate",[M,v,_],null),$(Se["$nil?"]()))return r;$(p.$to_s()["$!="](M.$to_s()))&&ge.$on_fallback(p,M,v,k),e.ret(Se)}).$$s=re,$e.$$arity=0,$e))}catch(be){if(!e.rescue(be,[D(c(E,"I18n"),"InvalidLocale")]))throw be;try{return r}finally{e.pop_exception()}}}).$$s=g,y.$$arity=1,y)),$($(b=k["$key?"]("default"))?k["$[]"]("default")["$nil?"]():b)?r:$(l)?z(g,e.find_super_dispatcher(g,"translate",f,!1,!0),"translate",[p,r,k.$merge(t(["default"],{default:l}))],null):g.$throw("exception",D(c(E,"I18n"),"MissingTranslation").$new(p,v,k)))}catch(S){if(S===e.returner)return S.$v;throw S}},f.$$arity=-3),e.def(L,"$extract_non_symbol_default!",n=function(p){var v,q,y=r,W=r;return y=[p["$[]"]("default")].$flatten(),q=I(y,"detect",[],((v=function(l){return null==l&&(l=r),l["$is_a?"](c(E,"Symbol"))["$!"]()}).$$s=this,v.$$arity=1,v)),$(q)&&(W=["default",y["$[]"](0,y.$index(q))],I(p,"[]=",e.to_a(W)),K(W.length,1)),q},n.$$arity=1),e.def(L,"$exists?",d=function(p,v,k){try{var y,q=d.$$p,g=this,l=r,_=r,b=r;for(q&&(d.$$p=null),_=0,b=arguments.length,l=new Array(b);_<b;_++)l[_]=arguments[_];return null==k&&(k=c(E,"EMPTY_HASH")),$(k.$fetch("fallback",!0))?(I(c(E,"I18n").$fallbacks()["$[]"](p),"each",[],((y=function(A){var i=null==y.$$s?this:y.$$s;null==A&&(A=r);try{if(!$(z(i,e.find_iter_super_dispatcher(i,"exists?",y.$$def||d,!1,!1),"exists?",[A,v],null)))return r;e.ret(!0)}catch(S){if(!e.rescue(S,[D(c(E,"I18n"),"InvalidLocale")]))throw S;try{return r}finally{e.pop_exception()}}}).$$s=g,y.$$arity=1,y)),!1):z(g,e.find_super_dispatcher(g,"exists?",d,!1,!0),"exists?",l,q)}catch(x){if(x===e.returner)return x.$v;throw x}},d.$$arity=-3),L.$private(),e.def(L,"$on_fallback",u=function(p,v,k,y){return r},u.$$arity=4)}(H[0],H)}(Y[0],Y)},Opal.modules["bcdice/randomizer"]=function(e){function K(o,h){return"number"==typeof o&&"number"==typeof h?o>h:o["$>"](h)}function X(o,h){return"number"==typeof o&&"number"==typeof h?o+h:o["$+"](h)}function w(o,h){return"number"==typeof o&&"number"==typeof h?o<=h:o["$<="](h)}function r(o,h){return"number"==typeof o&&"number"==typeof h?o-h:o["$-"](h)}function D(o,h){return"number"==typeof o&&"number"==typeof h?o*h:o["$*"](h)}var h,L,n,d,u,m,p,v,k,y,q,W,g,E,f,H,$=[],I=e.nil,z=e.$$$,t=e.$$,a=e.klass,P=e.truthy,Y=e.send;return h=$,L=H=[(0,e.module)($[0],"BCDice")].concat(h),E=a(H[0],null,"Randomizer"),f=[E].concat(L),E.$$prototype.rand_results=E.$$prototype.detailed_rand_results=I,e.const_set(f[0],"UPPER_LIMIT_DICE_TIMES",200),e.const_set(f[0],"UPPER_LIMIT_DICE_SIDES",1e3),e.const_set(f[0],"UPPER_LIMIT_RANDS",1e4),e.def(E,"$initialize",n=function(){return this.rand_results=[],this.detailed_rand_results=[]},n.$$arity=0),E.$attr_reader("rand_results"),E.$attr_reader("detailed_rand_results"),e.const_set(f[0],"DetailedRandResult",t(f,"Struct").$new("kind","sides","value")),e.def(E,"$roll_barabara",d=function(_,b){var x,i,A=this;return P(K(X(A.rand_results.$size(),_),t(f,"UPPER_LIMIT_RANDS")))&&A.$raise(t(f,"TooManyRandsError")),P(P(i=w(_,0))?i:K(_,t(f,"UPPER_LIMIT_DICE_TIMES")))?[]:Y(t(f,"Array"),"new",[_],((x=function(){return(null==x.$$s?this:x.$$s).$roll_once(b)}).$$s=A,x.$$arity=0,x))},d.$$arity=2),e.def(E,"$roll_sum",u=function(_,b){return this.$roll_barabara(_,b).$sum()},u.$$arity=2),e.def(E,"$roll_once",m=function(_){var x,A=I;return P(P(x=w(_,0))?x:K(_,t(f,"UPPER_LIMIT_DICE_SIDES")))?0:(A=this.$rand_inner(_),this.$push_to_detail("normal",_,A),A)},m.$$arity=1),e.def(E,"$roll_index",p=function(_){return r(this.$roll_once(_),1)},p.$$arity=1),e.def(E,"$roll_tens_d10",v=function(){var x,b=I;return(b=this.$rand_inner(10))["$=="](10)&&(b=0),x=D(b,10),this.$push_to_detail("tens_d10",10,x),x},v.$$arity=0),e.def(E,"$roll_d9",k=function(){var b;return b=r(this.$rand_inner(10),1),this.$push_to_detail("d9",10,b),b},k.$$arity=0),e.def(E,"$roll_d66",y=function(_){var b,i,A=I;return A=Y(t(f,"Array"),"new",[2],((b=function(){return(null==b.$$s?this:b.$$s).$roll_once(6)}).$$s=this,b.$$arity=0,b)),i=_,z(t(f,"D66SortType"),"ASC")["$==="](i)?A["$sort!"]():z(t(f,"D66SortType"),"DESC")["$==="](i)&&A["$sort!"]()["$reverse!"](),X(D(A["$[]"](0),10),A["$[]"](1))},y.$$arity=1),E.$private(),e.def(E,"$rand_inner",q=function(_){var x,b=this;return P(function(o,h){return"number"==typeof o&&"number"==typeof h?o>=h:o["$>="](h)}(b.rand_results.$size(),t(f,"UPPER_LIMIT_RANDS")))&&b.$raise(t(f,"TooManyRandsError")),x=b.$random(_),b.rand_results["$<<"]([x,_]),x},q.$$arity=1),e.def(E,"$random",W=function(_){return X(t(f,"Kernel").$rand(_),1)},W.$$arity=1),e.def(E,"$push_to_detail",g=function(_,b,x){var i;return i=t(f,"DetailedRandResult").$new(_,b,x),this.detailed_rand_results.$push(i)},g.$$arity=3),void function(T,V,L){[a(T,V,"TooManyRandsError")].concat(L)}(H[0],t(H,"StandardError"),H)},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var z,P,H,L,E,f,n,T,V,o,C,X=[],w=e.nil,D=e.$$,c=e.module,Z=e.klass,$=e.truthy;return z=X,P=C=[c(X[0],"BCDice")].concat(z),H=o=[c(C[0],"DiceTable")].concat(P),T=Z(o[0],null,"RollResult"),V=[T].concat(H),T.$$prototype.table_name=T.$$prototype.value=T.$$prototype.body=w,e.def(T,"$initialize",L=function(u,m,p){var v=this;return v.table_name=u,v.value=m,v.body=p},L.$$arity=3),T.$attr_reader("table_name"),T.$attr_reader("value"),T.$attr_reader("body"),e.def(T,"$to_s",E=function(){var u=this;return u.table_name+"("+u.value+") \uff1e "+u.body},E.$$arity=0),e.def(T,"$last_body",f=function(){var u=this;return $(u.body["$is_a?"](D(V,"RollResult")))?u.body.$last_body():u.body},f.$$arity=0),void e.def(T,"$empty?",n=function(){return!1},n.$$arity=0)},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var t,Y,T,E,f,V,L,h,a,w=[],r=e.nil,c=e.$$,Z=e.module,$=e.klass,I=e.truthy;return t=w,Y=a=[Z(w[0],"BCDice")].concat(t),T=h=[Z(a[0],"DiceTable")].concat(Y),V=$(h[0],null,"ChainTable"),L=[V].concat(T),V.$$prototype.times=V.$$prototype.sides=V.$$prototype.items=V.$$prototype.name=r,e.def(V,"$initialize",E=function(d,u,m){var p=this,v=r;return p.name=d,p.items=m.$freeze(),v=/(\d+)D(\d+)/i.$match(u),I(v)||p.$raise(c(L,"ArgumentError"),"Unexpected table type: "+u),p.times=v["$[]"](1).$to_i(),p.sides=v["$[]"](2).$to_i()},E.$$arity=3),void e.def(V,"$roll",f=function(d){var m,p,u=this,v=r;return p=function(z,t){return"number"==typeof z&&"number"==typeof t?z-t:z["$-"](t)}(m=d.$roll_sum(u.times,u.sides),u.times),v=u.items["$[]"](p),I(v["$respond_to?"]("roll"))&&(v=v.$roll(d)),c(L,"RollResult").$new(u.name,m,v)},f.$$arity=1)},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){function w(C,a){return"number"==typeof C&&"number"==typeof a?C-a:C["$-"](a)}var a,h,L,n,d,u,E,f,H,Y,D=[],c=e.nil,$=e.$$,I=e.module,z=e.klass,t=e.hash2;return a=D,h=Y=[I(D[0],"BCDice")].concat(a),L=H=[I(Y[0],"DiceTable")].concat(h),E=z(H[0],null,"D66GridTable"),f=[E].concat(L),E.$$prototype.name=E.$$prototype.items=c,e.defs(E,"$from_i18n",n=function(p,v){var y=c;return y=$(f,"I18n").$t(p,t(["locale","raise"],{locale:v,raise:!0})),this.$new(y["$[]"]("name"),y["$[]"]("items"))},n.$$arity=2),e.def(E,"$initialize",d=function(p,v){return this.name=p,this.items=v.$freeze()},d.$$arity=2),void e.def(E,"$roll",u=function(p){var k,y,q,W,g,C;return k=p.$roll_once(6),y=p.$roll_once(6),q=function(C,a){return"number"==typeof C&&"number"==typeof a?C+a:C["$+"](a)}("number"==typeof(C=k)?10*C:C["$*"](10),y),W=w(k,1),g=w(y,1),$(f,"RollResult").$new(this.name,q,this.items["$[]"](W)["$[]"](g))},u.$$arity=1)},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var z,P,H,L,E,T,V,o,C,X=[],w=e.nil,D=e.$$,c=e.module,Z=e.klass,$=e.hash2;return e.top.$require("bcdice/dice_table/d66_grid_table"),z=X,P=C=[c(X[0],"BCDice")].concat(z),H=o=[c(C[0],"DiceTable")].concat(P),T=Z(o[0],D(o,"D66GridTable"),"D66HalfGridTable"),V=[T].concat(H),e.defs(T,"$from_i18n",L=function(n,d){var m=w;return m=D(V,"I18n").$t(n,$(["locale","raise"],{locale:d,raise:!0})),this.$new(m["$[]"]("name"),m["$[]"]("items_1_2_3"),m["$[]"]("items_4_5_6"))},L.$$arity=2),void e.def(T,"$initialize",E=function(n,d,u){return this.name=n,this.items=[d,d,d,u,u,u].$freeze()},E.$$arity=3)},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var z,P,H,L,E,T,V,o,C,X=[],w=e.nil,D=e.$$,c=e.module,Z=e.klass,$=e.hash2;return e.top.$require("bcdice/dice_table/d66_grid_table"),z=X,P=C=[c(X[0],"BCDice")].concat(z),H=o=[c(C[0],"DiceTable")].concat(P),T=Z(o[0],D(o,"D66GridTable"),"D66OneThirdTable"),V=[T].concat(H),e.defs(T,"$from_i18n",L=function(n,d){var m=w;return m=D(V,"I18n").$t(n,$(["locale","raise"],{locale:d,raise:!0})),this.$new(m["$[]"]("name"),m["$[]"]("items_1_2"),m["$[]"]("items_3_4"),m["$[]"]("items_5_6"))},L.$$arity=2),void e.def(T,"$initialize",E=function(n,d,u,m){return this.name=n,this.items=[d,d,u,u,m,m].$freeze()},E.$$arity=4)},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var a,h,L,n,d,u,E,f,H,Y,r=[],D=e.nil,c=e.$$$,Z=e.$$,$=e.module,I=e.klass,z=e.hash2,t=e.truthy;return a=r,h=Y=[$(r[0],"BCDice")].concat(a),L=H=[$(Y[0],"DiceTable")].concat(h),E=I(H[0],null,"D66Table"),f=[E].concat(L),E.$$prototype.sort_type=E.$$prototype.items=E.$$prototype.name=D,e.defs(E,"$from_i18n",n=function(p,v){var q,y=D;return y=Z(f,"I18n").$t(p,z(["locale"],{locale:v})),q=Z(f,"D66SortType").$const_get(y["$[]"]("d66_sort_type")),this.$new(y["$[]"]("name"),q,y["$[]"]("items"))},n.$$arity=2),e.def(E,"$initialize",d=function(p,v,k){var y=this;return y.name=p,y.sort_type=v,y.items=k.$freeze()},d.$$arity=3),void e.def(E,"$roll",u=function(p){var y,g,C,v=this,k=D,q=D,W=D;return k=p.$roll_barabara(2,6),y=v.sort_type,c(Z(f,"D66SortType"),"ASC")["$==="](y)?k["$sort!"]():c(Z(f,"D66SortType"),"DESC")["$==="](y)&&k["$sort!"]()["$reverse!"](),q=function(C,a){return"number"==typeof C&&"number"==typeof a?C+a:C["$+"](a)}("number"==typeof(C=k["$[]"](0))?10*C:C["$*"](10),k["$[]"](1)),W=t(g=v.items["$[]"](q))?g:v.items["$[]"](q.$to_s()),t(W["$respond_to?"]("roll"))&&(W=W.$roll(p)),Z(f,"RollResult").$new(v.name,q,W)},u.$$arity=1)},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){function K(P,Y){return"number"==typeof P&&"number"==typeof Y?P+Y:P["$+"](Y)}var Y,f,u,n,H,V,h,D=[],c=e.nil,$=e.$$,I=e.module,z=e.klass,t=e.hash2,C=e.send,a=e.send2;return e.top.$require("bcdice/dice_table/d66_table"),Y=D,H=h=[I(D[0],"BCDice")].concat(Y),f=V=[I(h[0],"DiceTable")].concat(H),[n=z(V[0],$(V,"D66Table"),"D66LeftRangeTable")].concat(f),void e.def(n,"$initialize",u=function(p,v,k){var y,l,g=this;return u.$$p&&(u.$$p=null),l=t([],{}),C(k,"each",[],((y=function(_){function b(x){return _.apply(this,arguments)}return b.toString=function(){return _.toString()},b}(function(_){var x,i,M,b=null==y.$$s?this:y.$$s;return null==_&&(_=c),x=e.to_ary(_),M=null==x[1]?c:x[1],C(null==x[0]?c:x[0],"each",[],((i=function($e){var ge;return null==$e&&($e=c),C(M,"each_with_index",[],((ge=function(De,Te){var Ne,fe,P;return null==De&&(De=c),null==Te&&(Te=c),Ne=K("number"==typeof(P=$e)?10*P:P["$*"](10),K(Te,1)),C(l,"[]=",e.to_a(fe=[Ne,De])),fe[function(P,Y){return"number"==typeof P?P-1:P["$-"](1)}(fe.length)]}).$$s=null==i.$$s?this:i.$$s,ge.$$arity=2,ge))}).$$s=b,i.$$arity=1,i))})).$$s=g,y.$$arity=1,y)),a(g,e.find_super_dispatcher(g,"initialize",u,!1,!0),"initialize",[p,v,l],null)},u.$$arity=3)},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var a,h,L,n,d,E,f,H,Y,D=[],c=e.nil,$=e.$$,I=e.module,z=e.klass,t=e.truthy;return a=D,h=Y=[I(D[0],"BCDice")].concat(a),L=H=[I(Y[0],"DiceTable")].concat(h),E=z(H[0],null,"D66ParityTable"),f=[E].concat(L),E.$$prototype.odd=E.$$prototype.even=E.$$prototype.name=c,e.def(E,"$initialize",n=function(m,p,v){var k=this;return k.name=m,k.odd=p.$freeze(),k.even=v.$freeze()},n.$$arity=3),void e.def(E,"$roll",d=function(m){var k,q,W,C,p=this,v=c;return v=m.$roll_once(6),k=m.$roll_once(6),q=(t(v["$odd?"]())?p.odd:p.even)["$[]"]("number"==typeof(C=k)?C-1:C["$-"](1)),W=function(C,a){return"number"==typeof C&&"number"==typeof a?C+a:C["$+"](a)}(function(C,a){return"number"==typeof C?10*C:C["$*"](10)}(v),k),$(f,"RollResult").$new(p.name,W,q)},d.$$arity=1)},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var C,o,V,f,n,L,E,j,P,r=[],D=e.nil,Z=e.$$,$=e.module,I=e.klass,z=e.send;return C=r,o=P=[$(r[0],"BCDice")].concat(C),V=j=[$(P[0],"DiceTable")].concat(o),L=I(j[0],null,"D66RangeTable"),E=[L].concat(V),L.$$prototype.items=L.$$prototype.name=D,e.def(L,"$initialize",f=function(u,m){return this.name=u,this.items=m.$freeze()},f.$$arity=2),void e.def(L,"$roll",n=function(u){var m,v,k,y,t,p=this,q=D;return v=u.$roll_once(6),k=u.$roll_once(6),y=function(t,C){return"number"==typeof t&&"number"==typeof C?t+C:t["$+"](C)}("number"==typeof(t=v)?10*t:t["$*"](10),k),q=z(p.items,"find",[],((m=function(g){return null==g&&(g=D),g["$[]"](0)["$include?"](y)}).$$s=p,m.$$arity=1,m)),Z(E,"RollResult").$new(p.name,y,q["$[]"](1))},n.$$arity=1)},Opal.modules["bcdice/dice_table/range_table"]=function(e){var P,j,E,d,u,m,p,v,k,y,q,W,f,n,T,o,D=[],c=e.nil,$=e.$$,I=e.module,z=e.klass,t=e.send,C=e.truthy;return P=D,j=o=[I(D[0],"BCDice")].concat(P),E=T=[I(o[0],"DiceTable")].concat(j),f=z(T[0],null,"RangeTable"),n=[f].concat(E),f.$$prototype.name=f.$$prototype.items=f.$$prototype.num_of_dice=f.$$prototype.num_of_sides=f.$$prototype.formatter=c,e.const_set(n[0],"RollResult",t($(n,"Struct"),"new",["sum","values","content","formatted"],((d=function(){return(null==d.$$s?this:d.$$s).$alias_method("to_s","formatted")}).$$s=f,d.$$arity=0,d))),e.const_set(n[0],"Item",$(n,"Struct").$new("range","content")),e.const_set(n[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),e.const_set(n[0],"DEFAULT_FORMATTER",t(f,"lambda",[],($$2=function(g){function l(_,b){return g.apply(this,arguments)}return l.toString=function(){return g.toString()},l}(function(g,l){return null==$$2.$$s||$$2,null==g&&(g=c),null==l&&(l=c),g.$name()+"("+l.$sum()+") \uff1e "+l.$content()}),$$2.$$s=f,$$2.$$arity=2,$$2))),f.$attr_reader("name"),f.$attr_reader("num_of_dice"),f.$attr_reader("num_of_sides"),e.def(f,"$initialize",u=function(l,_,b){var S,x=u.$$p,A=x||c,i=this,M=c;return x&&(u.$$p=null),x&&(u.$$p=null),i.name=l.$freeze(),i.formatter=C(S=A)?S:$(n,"DEFAULT_FORMATTER"),M=$(n,"DICE_ROLL_METHOD_RE").$match(_),C(M)||i.$raise($(n,"ArgumentError"),i.name+": invalid dice roll method: "+_),i.num_of_dice=M["$[]"](1).$to_i(),i.num_of_sides=M["$[]"](2).$to_i(),i.$store(b)},u.$$arity=3),e.def(f,"$fetch",m=function(l){var _,x,b=this;return x=t(b.items,"find",[],((_=function(i){return null==i&&(i=c),i.$range()["$include?"](l)}).$$s=b,_.$$arity=1,_)),C(x)||b.$raise($(n,"RangeError"),b.name+": value is out of range: "+l),x},m.$$arity=1),e.def(f,"$roll",p=function(l){var x,A,i,a,_=this,b=c;return x=(b=l.$roll_barabara(_.num_of_dice,_.num_of_sides)).$sum(),A=$(n,"RollResult").$new(x,b,_.$fetch(x).$content()),i=[_.formatter["$[]"](_,A)],t(A,"formatted=",e.to_a(i)),"number"==typeof(a=i.length)||a["$-"](1),A},p.$$arity=1),f.$private(),e.def(f,"$store",v=function(l){var _,b,x,i,S,A=this;return i=t(l,"map",[],((_=function(re,$e){return null==re&&(re=c),null==$e&&($e=c),[(null==_.$$s?this:_.$$s).$coerce_to_int_range(re),$e]}).$$s=A,_.$$arity=2,_)),S=t(i,"sort_by",[],((b=function(re,$e){return null==re&&(re=c),null==$e&&($e=c),re.$min()}).$$s=A,b.$$arity=2,b)),A.$assert_min_sum_is_covered(S),A.$assert_max_sum_is_covered(S),A.$assert_no_gap_or_overlap_in_ranges(S),A.items=t(S,"map",[],(x=function(re,$e){return null==re&&(re=c),null==$e&&($e=c),$(n,"Item").$new(re,$e.$freeze()).$freeze()},x.$$s=A,x.$$arity=2,x)).$freeze(),A},v.$$arity=1),e.def(f,"$coerce_to_int_range",k=function(l){var b,x=c;return b=l,$(n,"Integer")["$==="](b)?$(n,"Range").$new(l,l):$(n,"Range")["$==="](b)&&C(C(x=l.$begin()["$is_a?"]($(n,"Integer")))?l.$end()["$is_a?"]($(n,"Integer")):x)?l:this.$raise($(n,"TypeError"),this.name+": "+l+" ("+l.$class()+") must be an Integer or a Range with Integers ")},k.$$arity=1),e.def(f,"$assert_min_sum_is_covered",y=function(l){var b,_=this,x=c;return b=_.num_of_dice,x=l.$first()["$[]"](0),C(x["$include?"](b))||_.$raise($(n,"RangeError"),_.name+": min value ("+b+") is not covered: "+x),_},y.$$arity=1),e.def(f,"$assert_max_sum_is_covered",q=function(l){var b,_=this,x=c;return b=function(a,P){return"number"==typeof a&&"number"==typeof P?a*P:a["$*"](P)}(_.num_of_dice,_.num_of_sides),x=l.$last()["$[]"](0),C(x["$include?"](b))||_.$raise($(n,"RangeError"),_.name+": max value ("+b+") is not covered: "+x),_},q.$$arity=1),void e.def(f,"$assert_no_gap_or_overlap_in_ranges",W=function(l){var _;return t(l,"each_cons",[2],((_=function(A,i){var $e,be,a,S=null==_.$$s?this:_.$$s,M=c,re=c;return null==S.name&&(S.name=c),null==A&&(A=c),null==i&&(i=c),M=A["$[]"](0),re=i["$[]"](0),be="number"==typeof(a=$e=M.$max())?a+1:a["$+"](1),C(re["$include?"]($e))&&S.$raise($(n,"RangeError"),S.name+": Range overlap: "+M+" and "+re),C(re["$include?"](be))?c:S.$raise($(n,"RangeError"),S.name+": Range gap: "+M+" and "+re)}).$$s=this,_.$$arity=2,_)),this},W.$$arity=1)},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var t,Y,T,n,m,p,v,d,u,L,h,a,w=[],r=e.nil,D=e.$$$,c=e.$$,Z=e.module,$=e.klass,I=e.send;return t=w,Y=a=[Z(w[0],"BCDice")].concat(t),T=h=[Z(a[0],"DiceTable")].concat(Y),n=L=[$(h[0],null,"SaiFicSkillTable")].concat(T),d=$(L[0],null,"Category"),u=[d].concat(n),d.$$prototype.name=r,e.def(d,"$initialize",m=function(y,q,W,g){var l,_=this;return _.name=y,_.skills=I(q.$map(),"with_index",[2],((l=function(b){function x(A,i){return b.apply(this,arguments)}return x.toString=function(){return b.toString()},x}(function(b,x){return null==b&&(b=r),null==x&&(x=r),D(c(u,"SaiFicSkillTable"),"Skill").$new(y,b,W,x,g)})).$$s=_,l.$$arity=2,l)),_.dice=W},m.$$arity=4),e.def(d,"$roll",p=function(y){return this.$skills()["$[]"]("number"==typeof(z=y.$roll_sum(2,6))?z-2:z["$-"](2));var z},p.$$arity=1),e.def(d,"$to_s",v=function(){return this.name},v.$$arity=0),void d.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var z,P,f,u,m,n,H,V,o,C,X=[],w=e.nil,c=e.module,Z=e.klass,$=e.hash2;return z=X,P=C=[c(X[0],"BCDice")].concat(z),H=o=[c(C[0],"DiceTable")].concat(P),f=V=[Z(o[0],null,"SaiFicSkillTable")].concat(H),[n=Z(V[0],null,"Skill")].concat(f),n.$$prototype.s_format=n.$$prototype.category_dice=n.$$prototype.row_dice=n.$$prototype.category_name=n.$$prototype.name=w,e.def(n,"$initialize",u=function(v,k,y,q,W){var g=this;return g.category_name=v,g.name=k,g.category_dice=y,g.row_dice=q,g.s_format=W},u.$$arity=5),e.def(n,"$to_s",m=function(){var v=this;return v.$format(v.s_format,$(["category_dice","row_dice","category_name","skill_name"],{category_dice:v.category_dice,row_dice:v.row_dice,category_name:v.category_name,skill_name:v.name}))},m.$$arity=0),void n.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var Y,H,f,u,m,p,v,k,y,q,n,d,V,h,w=e.top,r=[],D=e.nil,c=e.$$$,Z=e.$$,$=e.module,I=e.klass,z=e.hash2,t=e.send,a=e.truthy;return w.$require("bcdice/dice_table/sai_fic_skill_table/category"),w.$require("bcdice/dice_table/sai_fic_skill_table/skill"),Y=r,H=h=[$(r[0],"BCDice")].concat(Y),f=V=[$(h[0],"DiceTable")].concat(H),n=I(V[0],null,"SaiFicSkillTable"),d=[n].concat(f),n.$$prototype.rtt=n.$$prototype.rtt_format=n.$$prototype.rct=n.$$prototype.rct_format=n.$$prototype.rttn=n.$$prototype.rttn_format=n.$$prototype.categories=D,e.defs(n,"$from_i18n",u=function(g,l,_){var b,x,A,i,$e,re=D;if(null==_)_=z([],{});else if(!_.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return null==(b=_.$$smap.rtt)&&(b=D),null==(x=_.$$smap.rct)&&(x=D),null==(A=_.$$smap.rttn)&&(A=D),$e=(re=Z(d,"I18n").$t("RTT",z(["locale","raise","default"],{locale:l,raise:!1,default:z([],{})})).$merge(Z(d,"I18n").$t(g,z(["locale","raise"],{locale:l,raise:!0}))))["$[]"]("items"),re=t(re,"select",[],((i=function(be){function ge(Se,De){return be.apply(this,arguments)}return ge.toString=function(){return be.toString()},ge}(function(be,ge){return null==be&&(be=D),null==ge&&(ge=D),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](be)})).$$s=this,i.$$arity=2,i)),this.$new($e,e.to_hash(re).$merge(z(["rtt","rct","rttn"],{rtt:b,rct:x,rttn:A})))},u.$$arity=-3),e.const_set(d[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),e.const_set(d[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),e.const_set(d[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),e.const_set(d[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),e.def(n,"$initialize",m=function(g,l){var _,b,x,A,i,S,M,re,$e=this;if(null==l)l=z([],{});else if(!l.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return null==(_=l.$$smap.rtt)&&(_=D),null==(b=l.$$smap.rct)&&(b=D),null==(x=l.$$smap.rttn)&&(x=D),null==(A=l.$$smap.rtt_format)&&(A=Z(d,"DEFAULT_RTT")),null==(i=l.$$smap.rct_format)&&(i=Z(d,"DEFAULT_RCT")),null==(S=l.$$smap.rttn_format)&&(S=Z(d,"DEFAULT_RTTN")),null==(M=l.$$smap.s_format)&&(M=Z(d,"DEFAULT_S")),$e.categories=t(g.$map(),"with_index",[1],((re=function(ge,Se){var Te,Ne,fe;return null==ge&&(ge=D),null==Se&&(Se=D),Ne=null==(Te=e.to_ary(ge))[0]?D:Te[0],fe=null==Te[1]?D:Te[1],c(Z(d,"SaiFicSkillTable"),"Category").$new(Ne,fe,Se,M)}).$$s=$e,re.$$arity=2,re.$$has_top_level_mlhs_arg=!0,re)),$e.rtt=_,$e.rct=b,$e.rttn=x.$to_a(),$e.rtt_format=A,$e.rct_format=i,$e.rttn_format=S},m.$$arity=-2),e.const_set(d[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),n.$attr_reader("categories"),e.def(n,"$roll_command",p=function(g,l){var b,_=this,x=D,A=D,i=D;return a(["RTT",_.rtt]["$include?"](b=l))?_.$format_skill(_.rtt_format,_.$roll_skill(g)):a(["RCT",_.rct]["$include?"](b))?(x=_.$roll_category(g),_.$format(_.rct_format,z(["category_dice","category_name"],{category_dice:x.$dice(),category_name:x.$name()}))):a(a(A=i=Z(d,"RTTN").$index(b))?A:i=_.rttn.$index(b))?_.$format_skill(_.rttn_format,_.categories["$[]"](i).$roll(g)):D},p.$$arity=2),e.def(n,"$roll_category",v=function(g){return this.categories["$[]"]("number"==typeof(P=g.$roll_once(6))?P-1:P["$-"](1));var P},v.$$arity=1),e.def(n,"$roll_skill",k=function(g){return this.$roll_category(g).$roll(g)},k.$$arity=1),e.def(n,"$prefixes",y=function(){var g=this;return function(P,Y){return"number"==typeof P&&"number"==typeof Y?P+Y:P["$+"](Y)}(["RTT[1-6]?","RCT",g.rtt,g.rct],g.rttn).$compact()},y.$$arity=0),n.$private(),void e.def(n,"$format_skill",q=function(g,l){return this.$format(g,z(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:l.$category_dice(),row_dice:l.$row_dice(),category_name:l.$category_name(),skill_name:l.$name(),text:l.$to_s()}))},q.$$arity=2)},Opal.modules["bcdice/dice_table/table"]=function(e){var C,o,V,f,n,d,u,L,E,j,P,w=[],r=e.nil,c=e.$$,Z=e.module,$=e.klass,I=e.hash2,z=e.truthy;return C=w,o=P=[Z(w[0],"BCDice")].concat(C),V=j=[Z(P[0],"DiceTable")].concat(o),L=$(j[0],null,"Table"),E=[L].concat(V),L.$$prototype.times=L.$$prototype.sides=L.$$prototype.name=L.$$prototype.items=r,e.defs(L,"$from_i18n",f=function(p,v){var y=r;return y=c(E,"I18n").$t(p,I(["locale"],{locale:v})),this.$new(y["$[]"]("name"),y["$[]"]("type"),y["$[]"]("items"))},f.$$arity=2),e.def(L,"$initialize",n=function(p,v,k){var y=this,q=r;return y.name=p,y.items=k.$freeze(),q=/(\d+)D(\d+)/i.$match(v),z(q)||y.$raise(c(E,"ArgumentError"),"Unexpected table type: "+v),y.times=q["$[]"](1).$to_i(),y.sides=q["$[]"](2).$to_i()},n.$$arity=3),e.def(L,"$roll",d=function(p){var k,v=this;return k=p.$roll_sum(v.times,v.sides),v.$choice(k)},d.$$arity=1),void e.def(L,"$choice",u=function(p){var k,v=this;return k=function(t,C){return"number"==typeof t&&"number"==typeof C?t-C:t["$-"](C)}(p,v.times),c(E,"RollResult").$new(v.name,p,v.items["$[]"](k))},u.$$arity=1)},Opal.modules["bcdice/dice_table"]=function(e){var K=e.top;return K.$require("bcdice/dice_table/roll_result"),K.$require("bcdice/dice_table/chain_table"),K.$require("bcdice/dice_table/d66_grid_table"),K.$require("bcdice/dice_table/d66_half_grid_table"),K.$require("bcdice/dice_table/d66_one_third_table"),K.$require("bcdice/dice_table/d66_left_range_table"),K.$require("bcdice/dice_table/d66_parity_table"),K.$require("bcdice/dice_table/d66_range_table"),K.$require("bcdice/dice_table/d66_table"),K.$require("bcdice/dice_table/range_table"),K.$require("bcdice/dice_table/sai_fic_skill_table"),K.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var $,C,P,z,X=[],c=e.module;return $=X,C=z=[c(X[0],"BCDice")].concat($),P=[c(z[0],"D66SortType")].concat(C),e.const_set(P[0],"NO_SORT","no_sort"),e.const_set(P[0],"ASC","asc"),e.const_set(P[0],"DESC","desc"),void function(t,C){var P=[c(t,"RoundType")].concat(C);e.const_set(P[0],"CEIL","ceil"),e.const_set(P[0],"FLOOR","floor"),e.const_set(P[0],"ROUND","round")}(z[0],z)},Opal.modules["bcdice/translate"]=function(e){var z,P,h,Y,o,C,X=[],w=e.nil,D=e.$$,c=e.module,Z=e.hash2;return z=X,P=C=[c(X[0],"BCDice")].concat(z),Y=c(C[0],"Translate"),o=[Y].concat(P),void e.def(Y,"$translate",h=function(H,T){var V,L=this;if(null==L.locale&&(L.locale=w),null==T)T=Z([],{});else if(!T.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return V=e.kwrestargs(T,{}),D(o,"I18n").$translate(H,Z(["locale","raise"],{locale:L.locale,raise:!0}).$merge(e.to_hash(V)))},h.$$arity=-2)},Opal.modules["bcdice/result"]=function(e){function K(z,t){return"number"==typeof z&&"number"==typeof t?z-t:z["$-"](t)}var t,d,p,v,k,y,q,o,H,T,V,L,E,f,n,h,j,a,w=[],r=e.nil,$=e.klass,I=e.send;return t=w,o=a=[(0,e.module)(w[0],"BCDice")].concat(t),j=[h=$(a[0],null,"Result")].concat(o),h.$$prototype.secret=h.$$prototype.success=h.$$prototype.failure=h.$$prototype.critical=h.$$prototype.fumble=r,[d=e.get_singleton_class(h)].concat(j),e.def(d,"$success",p=function(g){var l;return I(this.$new(),"tap",[],((l=function(b){function x(A){return b.apply(this,arguments)}return x.toString=function(){return b.toString()},x}(function(b){var A=r;return null==b&&(b=r),I(b,"text=",e.to_a(A=[g])),K(A.length,1),I(b,"success=",e.to_a(A=[!0])),A[K(A.length,1)]})).$$s=this,l.$$arity=1,l))},p.$$arity=1),e.def(d,"$failure",v=function(g){var l;return I(this.$new(),"tap",[],((l=function(x){var i=r;return null==x&&(x=r),I(x,"text=",e.to_a(i=[g])),K(i.length,1),I(x,"failure=",e.to_a(i=[!0])),i[K(i.length,1)]}).$$s=this,l.$$arity=1,l))},v.$$arity=1),e.def(d,"$critical",k=function(g){var l;return I(this.$new(),"tap",[],((l=function(x){var i=r;return null==x&&(x=r),I(x,"text=",e.to_a(i=[g])),K(i.length,1),I(x,"critical=",e.to_a(i=[!0])),K(i.length,1),I(x,"success=",e.to_a(i=[!0])),i[K(i.length,1)]}).$$s=this,l.$$arity=1,l))},k.$$arity=1),e.def(d,"$fumble",y=function(g){var l;return I(this.$new(),"tap",[],((l=function(x){var i=r;return null==x&&(x=r),I(x,"text=",e.to_a(i=[g])),K(i.length,1),I(x,"fumble=",e.to_a(i=[!0])),K(i.length,1),I(x,"failure=",e.to_a(i=[!0])),i[K(i.length,1)]}).$$s=this,l.$$arity=1,l))},y.$$arity=1),e.def(d,"$nothing",q=function(){return"nothing"},q.$$arity=0),e.def(h,"$initialize",H=function(u){var m=this;return null==u&&(u=r),m.text=u,m.rands=r,m.detailed_rands=r,m.secret=!1,m.success=!1,m.failure=!1,m.critical=!1,m.fumble=!1},H.$$arity=-1),h.$attr_accessor("text","rands","detailed_rands"),h.$attr_writer("secret","success","failure","critical","fumble"),e.def(h,"$secret?",T=function(){return this.secret},T.$$arity=0),e.def(h,"$success?",V=function(){return this.success},V.$$arity=0),e.def(h,"$failure?",L=function(){return this.failure},L.$$arity=0),e.def(h,"$critical?",E=function(){return this.critical},E.$$arity=0),e.def(h,"$fumble?",f=function(){return this.fumble},f.$$arity=0),void e.def(h,"$condition=",n=function(u){return this.success=u,this.failure=u["$!"]()},n.$$arity=1)},Opal.modules["racc/parser"]=function(e){function K(H,T){return"number"==typeof H&&"number"==typeof T?H<T:H["$<"](T)}function X(H,T){return"number"==typeof H&&"number"==typeof T?H-T:H["$-"](T)}function w(H,T){return"number"==typeof H&&"number"==typeof T?H+T:H["$+"](T)}function r(H,T){return"number"==typeof H&&"number"==typeof T?H>=T:H["$>="](T)}function D(H,T){return"number"==typeof H&&"number"==typeof T?H>T:H["$>"](T)}function c(H,T){return"number"==typeof H&&"number"==typeof T?H<=T:H["$<="](T)}var E,f,n,T,L,z=[],t=e.nil,C=e.$$$,a=e.$$,P=e.module,Y=e.klass,o=e.truthy,h=e.gvars,j=e.send;return T=z,E=(L=[P(z[0],"Racc")].concat(T))[0],f=a(L,"StandardError"),n=L,[Y(E,f,"ParseError")].concat(n),o(C("::","ParseError","skip_raise")?"constant":t)||e.const_set(z[0],"ParseError",C(a(z,"Racc"),"ParseError")),function(H,T){var d,p,v,k,y,q,W,g,l,_,b,x,A,i,S,M,re,$e,be,ge,Se,De,Te,qe,Ne,u,m,L=[P(H,"Racc")].concat(T);o(a(L,"Racc_No_Extensions","skip_raise")?"constant":t)||e.const_set(L[0],"Racc_No_Extensions",!1),d=L,u=Y(L[0],null,"Parser"),m=[u].concat(d),u.$$prototype.yydebug=u.$$prototype.racc_debug_out=u.$$prototype.racc_error_status=u.$$prototype.racc_t=u.$$prototype.racc_vstack=u.$$prototype.racc_val=u.$$prototype.racc_state=u.$$prototype.racc_tstack=t,e.const_set(m[0],"Racc_Runtime_Version","1.4.6"),e.const_set(m[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),e.const_set(m[0],"Racc_Runtime_Core_Version_R","1.4.6"),e.const_set(m[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),e.const_set(m[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),e.const_set(m[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),e.const_set(m[0],"Racc_Runtime_Core_Version",a(m,"Racc_Runtime_Core_Version_R")),e.const_set(m[0],"Racc_Runtime_Core_Revision",a(m,"Racc_Runtime_Core_Revision_R")),e.const_set(m[0],"Racc_Runtime_Type","ruby"),e.defs(a(m,"Parser"),"$racc_runtime_type",p=function(){return a(m,"Racc_Runtime_Type")},p.$$arity=0),e.def(u,"$_racc_setup",v=function(){var O,J,s=this,N=t,B=t,R=t;return null==h.stderr&&(h.stderr=t),o(C(s.$class(),"Racc_debug_parser"))||(s.yydebug=!1),o(null!=(O=s.yydebug)&&O!==t?"instance-variable":t)||(s.yydebug=!1),o(s.yydebug)&&(o(null!=(J=s.racc_debug_out)&&J!==t?"instance-variable":t)||(s.racc_debug_out=h.stderr),s.racc_debug_out=o(N=s.racc_debug_out)?N:h.stderr),B=C(s.$class(),"Racc_arg"),o(K(B.$size(),14))&&(j(B,"[]=",e.to_a(R=[13,!0])),X(R.length,1)),B},v.$$arity=0),e.def(u,"$_racc_init_sysvars",k=function(){var O=this;return O.racc_state=[0],O.racc_tstack=[],O.racc_vstack=[],O.racc_t=t,O.racc_val=t,O.racc_read_next=!0,O.racc_user_yyerror=!1,O.racc_error_status=0},k.$$arity=0),e.def(u,"$do_parse",y=function(){return this.$__send__(a(m,"Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)},y.$$arity=0),e.def(u,"$next_token",q=function(){return this.$raise(a(m,"NotImplementedError"),this.$class()+"#next_token is not defined")},q.$$arity=0),e.def(u,"$_racc_do_parse_rb",W=function(O,J){var s,B,R=this,Q=t,ee=t,ne=t,de=t,ie=t,me=t,ye=t,le=t;return s=e.to_ary(O),Q=null==s[0]?t:s[0],ee=null==s[1]?t:s[1],ne=null==s[2]?t:s[2],de=null==s[3]?t:s[3],ie=null==s[10]?t:s[10],R.$_racc_init_sysvars(),me=ye=le=t,j(R,"catch",["racc_end_parse"],((B=function(){var Ee,Ae,ae=null==B.$$s?this:B.$$s,we=t,Ie=t,Ce=t;for(null==ae.racc_state&&(ae.racc_state=t),null==ae.racc_read_next&&(ae.racc_read_next=t),null==ae.racc_t&&(ae.racc_t=t),null==ae.yydebug&&(ae.yydebug=t),null==ae.racc_val&&(ae.racc_val=t);o(!0);)for(o(le=de["$[]"](ae.racc_state["$[]"](-1)))?(o(ae.racc_read_next)&&o(ae.racc_t["$!="](0))&&(Ae=ae.$next_token(),Ee=e.to_ary(Ae),me=null==Ee[0]?t:Ee[0],ae.racc_val=null==Ee[1]?t:Ee[1],ae.racc_t=o(me)?o(we=ie["$[]"](me))?we:1:0,o(ae.yydebug)&&ae.$racc_read_token(ae.racc_t,me,ae.racc_val),ae.racc_read_next=!1),le=w(le,ae.racc_t),o(o(Ie=o(Ce=r(le,0))?ye=Q["$[]"](le):Ce)?ee["$[]"](le)["$=="](ae.racc_state["$[]"](-1)):Ie)||(ye=ne["$[]"](ae.racc_state["$[]"](-1)))):ye=ne["$[]"](ae.racc_state["$[]"](-1));o(ye=ae.$_racc_evalact(ye,O)););}).$$s=R,B.$$arity=0,B))},W.$$arity=2),e.def(u,"$yyparse",g=function(O,J){return this.$__send__(a(m,"Racc_YY_Parse_Method"),O,J,this.$_racc_setup(),!0)},g.$$arity=2),e.def(u,"$_racc_yyparse_rb",l=function(O,J,s,N){var B,Q,ne=t,de=t,te=t,ie=t,ye=t,le=t,he=t;return B=e.to_ary(s),ne=null==B[0]?t:B[0],de=null==B[1]?t:B[1],te=null==B[2]?t:B[2],ie=null==B[3]?t:B[3],ye=null==B[10]?t:B[10],this.$_racc_init_sysvars(),le=t,he=t,j(this,"catch",["racc_end_parse"],((Q=function(){var we,xe=null==Q.$$s?this:Q.$$s;for(null==xe.racc_state&&(xe.racc_state=t);!o(he=ie["$[]"](xe.racc_state["$[]"](-1)));)for(;o(le=xe.$_racc_evalact(te["$[]"](xe.racc_state["$[]"](-1)),s)););return j(O,"__send__",[J],((we=function(Ce,Pe){var Ue,He,ke=null==we.$$s?this:we.$$s,Le=t,Ge=t,je=t,We=t,ue=t,U=t,_e=t;for(null==ke.racc_t&&(ke.racc_t=t),null==ke.racc_state&&(ke.racc_state=t),null==ke.racc_read_next&&(ke.racc_read_next=t),null==Ce&&(Ce=t),null==Pe&&(Pe=t),ke.racc_t=o(Ce)?o(Le=ye["$[]"](Ce))?Le:1:0,ke.racc_val=Pe,ke.racc_read_next=!1,he=w(he,ke.racc_t),o(o(Ue=o(He=r(he,0))?le=ne["$[]"](he):He)?de["$[]"](he)["$=="](ke.racc_state["$[]"](-1)):Ue)||(le=te["$[]"](ke.racc_state["$[]"](-1)));o(le=ke.$_racc_evalact(le,s)););for(;o(o(Ge=o(je=(he=ie["$[]"](ke.racc_state["$[]"](-1)))["$!"]())?je:ke.racc_read_next["$!"]())?Ge:ke.racc_t["$=="](0));)for(o(o(We=o(ue=o(U=o(_e=he)?he=w(he,ke.racc_t):_e)?r(he,0):U)?le=ne["$[]"](he):ue)?de["$[]"](he)["$=="](ke.racc_state["$[]"](-1)):We)||(le=te["$[]"](ke.racc_state["$[]"](-1)));o(le=ke.$_racc_evalact(le,s)););}).$$s=xe,we.$$arity=2,we))}).$$s=this,Q.$$arity=0,Q))},l.$$arity=4),e.def(u,"$_racc_evalact",_=function(O,J){var s,B,te,me,R=this,Q=t,ee=t,de=t,ie=t,ye=t,le=t,he=t,ae=t,xe=t,Ee=t;if(Q=null==(s=e.to_ary(J))[0]?t:s[0],ee=null==s[1]?t:s[1],de=null==s[3]?t:s[3],te=null==s[11]?t:s[11],ie=null==s[12]?t:s[12],o(o(me=D(O,0))?K(O,te):me))o(D(R.racc_error_status,0))&&(R.racc_t["$=="](1)||(R.racc_error_status=X(R.racc_error_status,1))),R.racc_vstack.$push(R.racc_val),R.racc_state.$push(O),R.racc_read_next=!0,o(R.yydebug)&&(R.racc_tstack.$push(R.racc_t),R.$racc_shift(R.racc_t,R.racc_tstack,R.racc_vstack));else if(o(o(ye=K(O,0))?D(O,ie["$-@"]()):ye)){if(le=j(R,"catch",["racc_jump"],((B=function(){var we=null==B.$$s?this:B.$$s;return null==we.racc_state&&(we.racc_state=t),we.racc_state.$push(we.$_racc_do_reduce(J,O)),!1}).$$s=R,B.$$arity=0,B)),o(le)){if(1["$==="](he=le))return R.racc_user_yyerror=!0,ie["$-@"]();if(2["$==="](he))return te;R.$raise("[Racc Bug] unknown jump code")}}else if(O["$=="](te))o(R.yydebug)&&R.$racc_accept(),R.$throw("racc_end_parse",R.racc_vstack["$[]"](0));else{if(O["$=="](ie["$-@"]())){for((0)["$==="](he=R.racc_error_status)?o(J["$[]"](21))||R.$on_error(R.racc_t,R.racc_val,R.racc_vstack):3["$==="](he)&&(R.racc_t["$=="](0)&&R.$throw("racc_end_parse",t),R.racc_read_next=!0),R.racc_user_yyerror=!1,R.racc_error_status=3;o(!0)&&(!o(ae=de["$[]"](R.racc_state["$[]"](-1)))||(ae=w(ae,1),!o(o(xe=o(Ee=r(ae,0))?O=Q["$[]"](ae):Ee)?ee["$[]"](ae)["$=="](R.racc_state["$[]"](-1)):xe)));)o(c(R.racc_state.$size(),1))&&R.$throw("racc_end_parse",t),R.racc_state.$pop(),R.racc_vstack.$pop(),o(R.yydebug)&&(R.racc_tstack.$pop(),R.$racc_e_pop(R.racc_state,R.racc_tstack,R.racc_vstack));return O}R.$raise("[Racc Bug] unknown action "+O.$inspect())}return o(R.yydebug)&&R.$racc_next_state(R.racc_state["$[]"](-1),R.racc_state),t},_.$$arity=2),e.def(u,"$_racc_do_reduce",b=function(O,J){var s,te,me,Ee,Ae,we,ke,B=this,Q=t,ee=t,ne=t,de=t,ie=t,ye=t,le=t,he=t,ae=t,xe=t,Ie=t,Ce=t,Pe=t,Fe=t,Me=t,Le=t;return Q=null==(s=e.to_ary(O))[4]?t:s[4],ee=null==s[5]?t:s[5],ne=null==s[6]?t:s[6],de=null==s[7]?t:s[7],te=null==s[8]?t:s[8],ie=null==s[9]?t:s[9],me=null==s[13]?t:s[13],ye=B.racc_state,le=B.racc_vstack,he=B.racc_tstack,ae=function(H,T){return"number"==typeof H?-3*H:H["$*"](-3)}(J),xe=ie["$[]"](ae),Ee=ie["$[]"](w(ae,1)),Ae=ie["$[]"](w(ae,2)),we=[],o(B.yydebug)&&(Ie=he["$[]"](xe["$-@"](),xe)),Ce=le["$[]"](xe["$-@"](),xe),o(B.yydebug)&&(Pe=[xe["$-@"](),xe,we],j(he,"[]=",e.to_a(Pe)),X(Pe.length,1)),Pe=[xe["$-@"](),xe,we],j(le,"[]=",e.to_a(Pe)),X(Pe.length,1),Pe=[xe["$-@"](),xe,we],j(ye,"[]=",e.to_a(Pe)),X(Pe.length,1),o(me)?le.$push(B.$__send__(Ae,Ce,le,Ce["$[]"](0))):le.$push(B.$__send__(Ae,Ce,le)),he.$push(Ee),o(B.yydebug)&&B.$racc_reduce(Ie,Ee,he,le),ke=X(Ee,te),o(ae=de["$[]"](ke))&&(ae=w(ae,ye["$[]"](-1)),o(o(Fe=o(Me=r(ae,0))?Le=Q["$[]"](ae):Me)?ee["$[]"](ae)["$=="](ke):Fe))?Le:ne["$[]"](ke)},b.$$arity=2),e.def(u,"$on_error",x=function(O,J,s){var B,N=this;return N.$raise(a(m,"ParseError"),N.$sprintf("\nparse error on value %s (%s)",J.$inspect(),o(B=N.$token_to_str(O))?B:"?"))},x.$$arity=3),e.def(u,"$yyerror",A=function(){return this.$throw("racc_jump",1)},A.$$arity=0),e.def(u,"$yyaccept",i=function(){return this.$throw("racc_jump",2)},i.$$arity=0),e.def(u,"$yyerrok",S=function(){return this.racc_error_status=0},S.$$arity=0),e.def(u,"$racc_read_token",M=function(O,J,s){var N=this;return N.racc_debug_out.$print("read    "),N.racc_debug_out.$print(J.$inspect(),"(",N.$racc_token2str(O),") "),N.racc_debug_out.$puts(s.$inspect()),N.racc_debug_out.$puts()},M.$$arity=3),e.def(u,"$racc_shift",re=function(O,J,s){var N=this;return N.racc_debug_out.$puts("shift   "+N.$racc_token2str(O)),N.$racc_print_stacks(J,s),N.racc_debug_out.$puts()},re.$$arity=3),e.def(u,"$racc_reduce",$e=function(O,J,s,N){var B,R=this,Q=t;return(Q=R.racc_debug_out).$print("reduce "),o(O["$empty?"]())?Q.$print(" <none>"):j(O,"each",[],((B=function(ne){return null==ne&&(ne=t),Q.$print(" ",(null==B.$$s?this:B.$$s).$racc_token2str(ne))}).$$s=R,B.$$arity=1,B)),Q.$puts(" --\x3e "+R.$racc_token2str(J)),R.$racc_print_stacks(s,N),R.racc_debug_out.$puts()},$e.$$arity=4),e.def(u,"$racc_accept",be=function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()},be.$$arity=0),e.def(u,"$racc_e_pop",ge=function(O,J,s){var N=this;return N.racc_debug_out.$puts("error recovering mode: pop token"),N.$racc_print_states(O),N.$racc_print_stacks(J,s),N.racc_debug_out.$puts()},ge.$$arity=3),e.def(u,"$racc_next_state",Se=function(O,J){var s=this;return s.racc_debug_out.$puts("goto    "+O),s.$racc_print_states(J),s.racc_debug_out.$puts()},Se.$$arity=2),e.def(u,"$racc_print_stacks",De=function(O,J){var s,B=t;return(B=this.racc_debug_out).$print("        ["),j(O,"each_index",[],((s=function(Q){return null==Q&&(Q=t),B.$print(" (",(null==s.$$s?this:s.$$s).$racc_token2str(O["$[]"](Q))," ",J["$[]"](Q).$inspect(),")")}).$$s=this,s.$$arity=1,s)),B.$puts(" ]")},De.$$arity=2),e.def(u,"$racc_print_states",Te=function(O){var J,N=t;return(N=this.racc_debug_out).$print("        ["),j(O,"each",[],((J=function(R){return null==R&&(R=t),N.$print(" ",R)}).$$s=this,J.$$arity=1,J)),N.$puts(" ]")},Te.$$arity=1),e.def(u,"$racc_token2str",qe=function(O){var s;return o(s=C(this.$class(),"Racc_token_to_s_table")["$[]"](O))?s:this.$raise("[Racc Bug] can't convert token "+O+" to string")},qe.$$arity=1),e.def(u,"$token_to_str",Ne=function(O){return C(this.$class(),"Racc_token_to_s_table")["$[]"](O)},Ne.$$arity=1)}(z[0],z)},Opal.modules["bcdice/arithmetic/node"]=function(e){function K(z,t){return"number"==typeof z&&"number"==typeof t?z/t:z["$/"](t)}var t,Y,H,L,E,f,u,m,p,v,k,y,n,d,V,h,a,w=[],r=e.nil,D=e.$$$,c=e.$$,Z=e.module,$=e.klass,I=e.send2;return t=w,Y=a=[Z(w[0],"BCDice")].concat(t),H=h=[Z(a[0],"Arithmetic")].concat(Y),function(L,E,f){var u,m,p,v,k,n=$(L,null,"BinaryOp");[n].concat(f),n.$$prototype.lhs=n.$$prototype.rhs=n.$$prototype.op=r,e.def(n,"$initialize",u=function(q,W,g){var l=this;return l.lhs=q,l.op=W,l.rhs=g},u.$$arity=3),e.def(n,"$eval",m=function(q){var l,W=this,g=r;return g=W.lhs.$eval(q),l=W.rhs.$eval(q),g.$send(W.op,l)},m.$$arity=1),e.def(n,"$output",p=function(){var q=this;return""+q.lhs.$output()+q.op+q.rhs.$output()},p.$$arity=0),e.def(n,"$s_exp",v=function(){var q=this;return"("+q.$op_for_s_exp()+" "+q.lhs.$s_exp()+" "+q.rhs.$s_exp()+")"},v.$$arity=0),e.def(n,"$op_for_s_exp",k=function(){return this.op},k.$$arity=0)}((V=[Z(h[0],"Node")].concat(H))[0],0,V),L=V[0],E=c(V,"BinaryOp"),f=V,n=$(L,E,"DivideBase"),d=[n].concat(f),n.$$prototype.lhs=n.$$prototype.rhs=n.$$prototype.op=r,e.def(n,"$initialize",u=function(W,g){return u.$$p&&(u.$$p=null),I(this,e.find_super_dispatcher(this,"initialize",u,!1,!0),"initialize",[W,"/",g],null)},u.$$arity=2),e.def(n,"$eval",m=function(W){var l,g=this,_=r;return l=g.lhs.$eval(W),(_=g.rhs.$eval(W))["$=="](0)&&g.$raise(c(d,"ZeroDivisionError")),g.$divide_and_round(l,_,W)},m.$$arity=1),e.def(n,"$output",p=function(){var W=p.$$p,l=this,_=r,b=r,x=r;for(W&&(p.$$p=null),b=0,x=arguments.length,_=new Array(x);b<x;b++)_[b]=arguments[b];return""+I(l,e.find_super_dispatcher(l,"output",p,!1,!0),"output",_,W)+l.$rounding_method()},p.$$arity=0),n.$private(),e.def(n,"$rounding_method",v=function(){return D(this.$class(),"ROUNDING_METHOD")},v.$$arity=0),e.def(n,"$op_for_s_exp",k=function(){return""+this.op+this.$rounding_method()},k.$$arity=0),e.def(n,"$divide_and_round",y=function(W,g,l){return this.$raise(c(d,"NotImplementedError"))},y.$$arity=3),function(L,E,f){var u,n=$(L,E,"DivideWithGameSystemDefault"),d=[n].concat(f);e.const_set(d[0],"ROUNDING_METHOD",""),n.$private(),e.def(n,"$divide_and_round",u=function(p,v,k){var q;return q=k,D(c(d,"RoundType"),"CEIL")["$==="](q)?K(p.$to_f(),v).$ceil():D(c(d,"RoundType"),"ROUND")["$==="](q)?K(p.$to_f(),v).$round():K(p,v).$to_i()},u.$$arity=3)}(V[0],c(V,"DivideBase"),V),function(L,E,f){var u,n=$(L,E,"DivideWithCeil"),d=[n].concat(f);e.const_set(d[0],"ROUNDING_METHOD","C"),n.$private(),e.def(n,"$divide_and_round",u=function(p,v,k){return K(p.$to_f(),v).$ceil()},u.$$arity=3)}(V[0],c(V,"DivideBase"),V),function(L,E,f){var u,n=$(L,E,"DivideWithRound"),d=[n].concat(f);e.const_set(d[0],"ROUNDING_METHOD","R"),n.$private(),e.def(n,"$divide_and_round",u=function(p,v,k){return K(p.$to_f(),v).$round()},u.$$arity=3)}(V[0],c(V,"DivideBase"),V),function(L,E,f){var u,n=$(L,E,"DivideWithFloor"),d=[n].concat(f);e.const_set(d[0],"ROUNDING_METHOD","F"),n.$private(),e.def(n,"$divide_and_round",u=function(p,v,k){return K(p,v).$to_i()},u.$$arity=3)}(V[0],c(V,"DivideBase"),V),function(L,E,f){var u,m,p,v,n=$(L,null,"Negative");[n].concat(f),n.$$prototype.body=r,e.def(n,"$initialize",u=function(y){return this.body=y},u.$$arity=1),e.def(n,"$eval",m=function(y){return this.body.$eval(y)["$-@"]()},m.$$arity=1),e.def(n,"$output",p=function(){return"-"+this.body.$output()},p.$$arity=0),e.def(n,"$s_exp",v=function(){return"(- "+this.body.$s_exp()+")"},v.$$arity=0)}(V[0],0,V),function(L,E,f){var u,m,p,v,n=$(L,null,"Parenthesis");[n].concat(f),n.$$prototype.expr=r,e.def(n,"$initialize",u=function(y){return this.expr=y},u.$$arity=1),e.def(n,"$eval",m=function(y){return this.expr.$eval(y)},m.$$arity=1),e.def(n,"$output",p=function(){return"("+this.expr.$output()+")"},p.$$arity=0),e.def(n,"$s_exp",v=function(){return"(Parenthesis "+this.expr.$s_exp()+")"},v.$$arity=0)}(V[0],0,V),void function(L,E,f){var u,m,p,n=$(L,null,"Number");[n].concat(f),n.$$prototype.value=r,e.def(n,"$initialize",u=function(k){return this.value=k},u.$$arity=1),e.def(n,"$eval",m=function(k){return this.value},m.$$arity=1),e.def(n,"$output",p=function(){return this.value.$to_s()},p.$$arity=0),e.alias(n,"s_exp","output")}(V[0],0,V)},Opal.modules.strscan=function(e){var C,Y,o,h,j,H,T,V,L,E,f,n,d,u,m,p,v,k,y,q,W,g,l,_,b,x,a,P,w=[],r=e.nil,c=e.$$,$=e.truthy,I=e.send;return C=w,a=(0,e.klass)(w[0],null,"StringScanner"),P=[a].concat(C),a.$$prototype.pos=a.$$prototype.string=a.$$prototype.working=a.$$prototype.matched=a.$$prototype.prev_pos=a.$$prototype.match=r,a.$attr_reader("pos"),a.$attr_reader("matched"),e.def(a,"$initialize",Y=function(i){var S=this;return S.string=i,S.pos=0,S.matched=r,S.working=i,S.match=[]},Y.$$arity=1),a.$attr_reader("string"),e.def(a,"$beginning_of_line?",o=function(){var i=this;return 0===i.pos||"\n"===i.string.charAt(i.pos-1)},o.$$arity=0),e.alias(a,"bol?","beginning_of_line?"),e.def(a,"$scan",h=function(i){var S=this,M=(i=S.$anchor(i)).exec(S.working);return null==M?S.matched=r:"object"==typeof M?(S.prev_pos=S.pos,S.pos+=M[0].length,S.working=S.working.substring(M[0].length),S.matched=M[0],S.match=M,M[0]):"string"==typeof M?(S.pos+=M.length,S.working=S.working.substring(M.length),M):r},h.$$arity=1),e.def(a,"$scan_until",j=function(i){var S=this;i=S.$anchor(i);for(var $e,M=S.pos,re=S.working;;){if($e=i.exec(re),M+=1,re=re.substr(1),null!=$e)return S.matched=S.string.substr(S.pos,M-S.pos-1+$e[0].length),S.match=$e,S.prev_pos=M-1,S.pos=M,S.working=re.substr($e[0].length),S.matched;if(0===re.length)return S.match=[],S.matched=r}},j.$$arity=1),e.def(a,"$[]",H=function(i){var M;if($(this.match["$empty?"]()))return r;M=i,c(P,"Symbol")["$==="](M)?i=i.$to_s():c(P,"String")["$==="](M)||(i=c(P,"Opal")["$coerce_to!"](i,c(P,"Integer"),"to_int"));var re=this.match;return i<0&&(i+=re.length),i<0||i>=re.length||null==re[i]?r:re[i]},H.$$arity=1),e.def(a,"$check",T=function(i){var S=this,M=(i=S.$anchor(i)).exec(S.working);return S.matched=null==M?r:M[0]},T.$$arity=1),e.def(a,"$check_until",V=function(i){var S=this,M=S.prev_pos,re=S.pos,$e=S.$scan_until(i);return $e!==r&&(S.matched=$e.substr(-1),S.working=S.string.substr(re)),S.prev_pos=M,S.pos=re,$e},V.$$arity=1),e.def(a,"$peek",L=function(i){return this.working.substring(0,i)},L.$$arity=1),e.def(a,"$eos?",E=function(){return 0===this.working.length},E.$$arity=0),e.def(a,"$exist?",f=function(i){var M=i.exec(this.working);return null==M?r:0==M.index?0:M.index+1},f.$$arity=1),e.def(a,"$skip",n=function(i){var S=this,M=(i=S.$anchor(i)).exec(S.working);if(null==M)return S.match=[],S.matched=r;var re=M[0],$e=re.length;return S.matched=re,S.match=M,S.prev_pos=S.pos,S.pos+=$e,S.working=S.working.substring($e),$e},n.$$arity=1),e.def(a,"$skip_until",d=function(i){var M=this.$scan_until(i);return M===r?r:(this.matched=M.substr(-1),M.length)},d.$$arity=1),e.def(a,"$get_byte",u=function(){var i=this,S=r;return i.pos<i.string.length?(i.prev_pos=i.pos,i.pos+=1,S=i.matched=i.working.substring(0,1),i.working=i.working.substring(1)):i.matched=r,S},u.$$arity=0),e.alias(a,"getch","get_byte"),e.def(a,"$match?",m=function(i){var S=this,M=(i=S.$anchor(i)).exec(S.working);return null==M?r:(S.prev_pos=S.pos,M[0].length)},m.$$arity=1),e.def(a,"$pos=",p=function(i){var S=this;return i<0&&(i+=S.string.$length()),S.pos=i,S.working=S.string.slice(i)},p.$$arity=1),e.def(a,"$matched_size",v=function(){return this.matched===r?r:this.matched.length},v.$$arity=0),e.def(a,"$post_match",k=function(){var i=this;return i.matched===r?r:i.string.substr(i.pos)},k.$$arity=0),e.def(a,"$pre_match",y=function(){var i=this;return i.matched===r?r:i.string.substr(0,i.prev_pos)},y.$$arity=0),e.def(a,"$reset",q=function(){var i=this;return i.working=i.string,i.matched=r,i.pos=0},q.$$arity=0),e.def(a,"$rest",W=function(){return this.working},W.$$arity=0),e.def(a,"$rest?",g=function(){return 0!==this.working.length},g.$$arity=0),e.def(a,"$rest_size",l=function(){return this.$rest().$size()},l.$$arity=0),e.def(a,"$terminate",_=function(){var S,z,i=this;return i.match=r,S=[i.string.$length()],I(i,"pos=",e.to_a(S)),S[(z=S.length,"number"==typeof z?z-1:z["$-"](1))]},_.$$arity=0),e.def(a,"$unscan",b=function(){var i=this;return i.pos=i.prev_pos,i.prev_pos=r,i.match=r,i},b.$$arity=0),a.$private(),e.def(a,"$anchor",x=function(i){var M=i.toString().match(/\/([^\/]+)$/);return M=M?M[1]:void 0,new RegExp("^(?:"+i.source+")",M)},x.$$arity=1),r&&"anchor"},Opal.modules["bcdice/normalize"]=function(e){var C,Y,o,a,$,z,X=[],w=e.nil,c=e.module;return $=X,C=z=[c(X[0],"BCDice")].concat($),[a=c(z[0],"Normalize")].concat(C),a.$module_function(),e.def(a,"$comparison_operator",Y=function(j){var T;return/<=|=</["$==="](T=j)?"<=":/>=|=>/["$==="](T)?">=":/<>|!=|=!/["$==="](T)?"!=":/</["$==="](T)?"<":/>/["$==="](T)?">":/=/["$==="](T)?"==":w},Y.$$arity=1),void e.def(a,"$target_number",o=function(j){return j["$=="]("?")?j:j.$to_i()},o.$$arity=1)},Opal.modules["bcdice/command/lexer"]=function(e){var C,o,V,f,n,d,L,E,j,P,K=e.top,X=[],w=e.nil,D=e.$$,c=e.module,Z=e.klass,$=e.hash2,I=e.truthy,z=e.send;return K.$require("strscan"),K.$require("bcdice/normalize"),C=X,o=P=[c(X[0],"BCDice")].concat(C),V=j=[c(P[0],"Command")].concat(o),L=Z(j[0],null,"Lexer"),E=[L].concat(V),L.$$prototype.scanner=L.$$prototype.notations=w,e.const_set(E[0],"SYMBOLS",$(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),e.def(L,"$initialize",f=function(m,p){var v,k,y,W,q=this;return m=I(W=(k=(v=m)===w||null==v?w:z(v,"split",[" ",2]))===w||null==k?w:z(k,"first",[]))?W:"",q.scanner=D(E,"StringScanner").$new(m),q.notations=z(p,"map",[],((y=function(g){function l(_){return g.apply(this,arguments)}return l.toString=function(){return g.toString()},l}(function(g){return null==g&&(g=w),I(g["$is_a?"](D(E,"String")))?D(E,"Regexp").$new(g):g})).$$s=q,y.$$arity=1,y))},f.$$arity=2),e.def(L,"$next_token",n=function(){try{var m,p=this,v=w,k=w,q=w,W=w;return I(p.scanner["$eos?"]())?[!1,"$"]:(z(p.notations,"each",[],((m=function(l){var b,_=null==m.$$s?this:m.$$s;if(null==_.scanner&&(_.scanner=w),null==l&&(l=w),b=_.scanner.$scan(l),!I(b))return w;e.ret(["NOTATION",b])}).$$s=p,m.$$arity=1,m)),I(v=p.scanner.$scan(/\d+/))?["NUMBER",v.$to_i()]:I(k=p.scanner.$scan(/[<>!=]+/))?(k=D(E,"Normalize").$comparison_operator(k),[I(k)?"CMP_OP":"ILLEGAL",k]):(q=p.scanner.$getch().$upcase(),[I(W=D(E,"SYMBOLS")["$[]"](q))?W:q.$to_sym(),q]))}catch(g){if(g===e.returner)return g.$v;throw g}},n.$$arity=0),void e.def(L,"$source",d=function(){return this.scanner.$string()},d.$$arity=0)},Opal.modules["bcdice/command/parsed"]=function(e){var z,P,H,L,E,f,T,V,o,C,X=[],w=e.nil,D=e.$$,c=e.module,Z=e.klass,$=e.truthy;return z=X,P=C=[c(X[0],"BCDice")].concat(z),H=o=[c(C[0],"Command")].concat(P),T=Z(o[0],null,"Parsed"),V=[T].concat(H),T.$$prototype.question_target=T.$$prototype.critical=T.$$prototype.fumble=T.$$prototype.dollar=T.$$prototype.modify_number=T.$$prototype.target_number=T.$$prototype.prefix_number=T.$$prototype.command=T.$$prototype.suffix_number=T.$$prototype.cmp_op=w,T.$attr_accessor("command"),T.$attr_accessor("prefix_number"),T.$attr_accessor("suffix_number"),T.$attr_accessor("critical"),T.$attr_accessor("fumble"),T.$attr_accessor("dollar"),T.$attr_accessor("modify_number"),T.$attr_accessor("cmp_op"),T.$attr_accessor("target_number"),T.$attr_writer("question_target"),e.def(T,"$initialize",L=function(){var d=this;return d.prefix_number=w,d.suffix_number=w,d.critical=w,d.fumble=w,d.dollar=w,d.cmp_op=w,d.target_number=w,d.question_target=!1},L.$$arity=0),e.def(T,"$question_target?",E=function(){return this.question_target},E.$$arity=0),void e.def(T,"$to_s",f=function(d){var q,u=this,m=w,p=w,v=w,k=w,y=w;return null==d&&(d="after_command"),m=$(u.critical)?"@"+u.critical:w,p=$(u.fumble)?"#"+u.fumble:w,v=$(u.dollar)?"$"+u.dollar:w,k=D(V,"Format").$modifier(u.modify_number),y=$(u.question_target)?"?":u.target_number,"after_command"["$==="](q=d)?[u.prefix_number,u.command,u.suffix_number,m,p,v,k,u.cmp_op,y].$join():"after_modify_number"["$==="](q)?[u.prefix_number,u.command,u.suffix_number,k,m,p,v,u.cmp_op,y].$join():"after_target_number"["$==="](q)?[u.prefix_number,u.command,u.suffix_number,k,u.cmp_op,y,m,p,v].$join():w},f.$$arity=-1)},Opal.modules["bcdice/command/parser"]=function(e){function K(P,Y){return"number"==typeof P&&"number"==typeof Y?P-Y:P["$-"](Y)}var Y,H,L,E,f,u,m,p,v,k,y,q,W,g,l,_,b,x,A,i,S,M,re,$e,be,ge,Se,De,Te,qe,Ne,fe,O,J,s,N,B,R,Q,ee,ne,de,te,ie,me,ye,le,he,ae,xe,Ee,Ae,we,Ie,Ce,Pe,ke,Fe,Me,Le,Ge,n,d,V,h,X=e.top,w=[],r=e.nil,D=e.$$$,c=e.$$,Z=e.klass,$=e.module,I=e.hash2,z=e.send2,t=e.send,C=e.hash,a=e.truthy;return X.$require("racc/parser.rb"),X.$require("bcdice/arithmetic/node"),X.$require("bcdice/command/lexer"),X.$require("bcdice/command/parsed"),function(P,Y,o){[Z(P,Y,"Parser")].concat(o)}(D(c(w,"BCDice"),"Command"),D(c(w,"Racc"),"Parser"),w),Y=w,H=h=[$(w[0],"BCDice")].concat(Y),L=(V=[$(h[0],"Command")].concat(H))[0],E=D(c(V,"Racc"),"Parser"),f=V,n=Z(L,E,"Parser"),d=[n].concat(f),n.$$prototype.notations=n.$$prototype.lexer=n.$$prototype.modifier=n.$$prototype.prefix_number=n.$$prototype.suffix_number=n.$$prototype.need_suffix_number=n.$$prototype.need_prefix_number=n.$$prototype.critical=n.$$prototype.fumble=n.$$prototype.dollar=n.$$prototype.allowed_cmp_op=n.$$prototype.question_target=r,e.def(n,"$initialize",u=function(U,_e){var G,F,se,Re,pe=u.$$p,oe=this;if(pe&&(u.$$p=null),G=e.slice.call(arguments,0,arguments.length),null==(F=e.extract_kwargs(G)))F=I([],{});else if(!F.$$is_hash)throw e.ArgumentError.$new("expected kwargs");if(se=G,!e.hasOwnProperty.call(F.$$smap,"round_type"))throw e.ArgumentError.$new("missing keyword: round_type");return Re=F.$$smap.round_type,z(oe,e.find_super_dispatcher(oe,"initialize",u,!1,!0),"initialize",[],null),oe.notations=se,oe.round_type=Re,oe.prefix_number=!1,oe.suffix_number=!1,oe.need_prefix_number=!1,oe.need_suffix_number=!1,oe.modifier=!0,oe.critical=!1,oe.fumble=!1,oe.dollar=!1,oe.allowed_cmp_op=[r,">=",">","<=","<","==","!="],oe.question_target=!1},u.$$arity=-2),e.def(n,"$disable_modifier",m=function(){return this.modifier=!1,this},m.$$arity=0),e.def(n,"$enable_prefix_number",p=function(){return this.prefix_number=!0,this},p.$$arity=0),e.def(n,"$enable_suffix_number",v=function(){return this.suffix_number=!0,this},v.$$arity=0),e.def(n,"$has_prefix_number",k=function(){var U=this;return U.prefix_number=!0,U.need_prefix_number=!0,U},k.$$arity=0),e.def(n,"$has_suffix_number",y=function(){var U=this;return U.suffix_number=!0,U.need_suffix_number=!0,U},y.$$arity=0),e.def(n,"$enable_critical",q=function(){return this.critical=!0,this},q.$$arity=0),e.def(n,"$enable_fumble",W=function(){return this.fumble=!0,this},W.$$arity=0),e.def(n,"$enable_dollar",g=function(){return this.dollar=!0,this},g.$$arity=0),e.def(n,"$restrict_cmp_op_to",l=function(U){var _e,F=this;return _e=e.slice.call(arguments,0,arguments.length),F.allowed_cmp_op=_e,F},l.$$arity=-1),e.def(n,"$enable_question_target",_=function(){return this.question_target=!0,this},_.$$arity=0),e.def(n,"$parse",b=function(U){try{return this.lexer=c(d,"Lexer").$new(U,this.notations),this.$do_parse()}catch(G){if(!e.rescue(G,[c(d,"ParseError"),c(d,"ZeroDivisionError")]))throw G;try{return r}finally{e.pop_exception()}}},b.$$arity=1),n.$private(),e.def(n,"$parsed",x=function(U,_e,G,F){var se;return t(c(d,"Parsed").$new(),"tap",[],((se=function(ve){var ze,Be,Ye,Ke,Ve,Qe,oe=null==se.$$s?this:se.$$s,ce=r;return null==oe.round_type&&(oe.round_type=r),null==ve&&(ve=r),ce=[U["$[]"]("command")],t(ve,"command=",e.to_a(ce)),K(ce.length,1),ce=[(ze=U["$[]"]("prefix"),ze===r||null==ze?r:t(ze,"eval",[oe.round_type]))],t(ve,"prefix_number=",e.to_a(ce)),K(ce.length,1),ce=[(Be=U["$[]"]("suffix"),Be===r||null==Be?r:t(Be,"eval",[oe.round_type]))],t(ve,"suffix_number=",e.to_a(ce)),K(ce.length,1),ce=[(Ye=_e["$[]"]("critical"),Ye===r||null==Ye?r:t(Ye,"eval",[oe.round_type]))],t(ve,"critical=",e.to_a(ce)),K(ce.length,1),ce=[(Ke=_e["$[]"]("fumble"),Ke===r||null==Ke?r:t(Ke,"eval",[oe.round_type]))],t(ve,"fumble=",e.to_a(ce)),K(ce.length,1),ce=[(Ve=_e["$[]"]("dollar"),Ve===r||null==Ve?r:t(Ve,"eval",[oe.round_type]))],t(ve,"dollar=",e.to_a(ce)),K(ce.length,1),ce=[G.$eval(oe.round_type)],t(ve,"modify_number=",e.to_a(ce)),K(ce.length,1),ce=[F["$[]"]("cmp_op")],t(ve,"cmp_op=",e.to_a(ce)),K(ce.length,1),F["$[]"]("target")["$=="]("?")?(t(ve,"question_target=",e.to_a(ce=[!0])),K(ce.length,1),t(ve,"target_number=",e.to_a(ce=[0])),ce[K(ce.length,1)]):(t(ve,"question_target=",e.to_a(ce=[!1])),K(ce.length,1),ce=[(Qe=F["$[]"]("target"),Qe===r||null==Qe?r:t(Qe,"eval",[oe.round_type]))],t(ve,"target_number=",e.to_a(ce)),ce[K(ce.length,1)])}).$$s=this,se.$$arity=1,se))},x.$$arity=4),e.def(n,"$next_token",A=function(){return this.lexer.$next_token()},A.$$arity=0),Ae=[6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,33,34,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,r,r,17,18,6,r,5,r,r,17,18,r,r,5,23,24,25,26,56,54,55,57],we=[0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,r,17,15,15,18,18,23,r,18,30,30,23,23,24,r,23,31,31,24,24,25,r,24,44,44,25,25,28,r,25,47,47,28,28,29,r,28,48,48,29,29,33,r,29,49,49,33,33,34,r,33,50,50,34,34,36,r,34,r,r,36,36,37,r,36,r,r,37,37,r,r,37,27,27,27,27,52,52,52,52],Ie=[-2,4,16,-3,-1,11,r,33,13,35,23,30,1,r,28,40,r,37,44,r,r,-2,r,51,58,65,0,106,72,79,47,54,r,86,93,r,100,107,r,r,r,r,r,r,63,r,r,68,75,82,89,r,120,r,r,r,r,r],Ce=[-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29],Pe=[30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,r,r,21,47,48,40,51,52,49,50,44,46,3,r,r,r,13,r,r,r,r,r,r,r,32],ke=[8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,r,r,4,8,8,5,7,7,8,8,9,5,6,r,r,r,6,r,r,r,r,r,r,r,6],Fe=[r,6,13,3,9,-1,27,-15,-10,-1,-38],Me=[r,r,r,r,r,r,19,16,15,r,r],Le=[0,0,"racc_error",4,20,"_reduce_1",4,20,"_reduce_2",3,20,"_reduce_3",3,21,"_reduce_4",2,21,"_reduce_5",2,21,"_reduce_6",1,21,"_reduce_7",0,22,"_reduce_8",3,22,"_reduce_9",3,22,"_reduce_10",3,22,"_reduce_11",2,23,"_reduce_12",2,23,"_reduce_13",3,23,"_reduce_14",3,23,"_reduce_15",0,24,"_reduce_16",2,24,"_reduce_17",2,24,"_reduce_18",3,28,"_reduce_19",3,28,"_reduce_20",1,28,"_reduce_none",3,27,"_reduce_22",4,27,"_reduce_23",1,27,"_reduce_none",0,29,"_reduce_25",1,29,"_reduce_26",1,29,"_reduce_27",1,29,"_reduce_28",1,29,"_reduce_29",2,26,"_reduce_30",2,26,"_reduce_31",1,26,"_reduce_none",3,25,"_reduce_33",1,25,"_reduce_34"],Ge=C(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),e.const_set(d[0],"Racc_arg",[Ae,we,Ce,Ie,Pe,ke,Me,Fe,19,Le,Ge,58,35,!0]),e.const_set(d[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),e.const_set(d[0],"Racc_debug_parser",!1),e.def(n,"$_reduce_1",i=function(U,_e,G){var F;return a(this.modifier)||this.$raise(c(d,"ParseError")),F=e.to_ary(U),this.$parsed(null==F[0]?r:F[0],null==F[1]?r:F[1],null==F[2]?r:F[2],null==F[3]?r:F[3])},i.$$arity=3),e.def(n,"$_reduce_2",S=function(U,_e,G){var F;return a(this.modifier)||this.$raise(c(d,"ParseError")),F=e.to_ary(U),this.$parsed(null==F[0]?r:F[0],null==F[2]?r:F[2],null==F[1]?r:F[1],null==F[3]?r:F[3])},S.$$arity=3),e.def(n,"$_reduce_3",M=function(U,_e,G){var F,oe;return oe=null==(F=e.to_ary(U))[2]?r:F[2],this.$parsed(null==F[0]?r:F[0],null==F[1]?r:F[1],D(D(c(d,"Arithmetic"),"Node"),"Number").$new(0),oe)},M.$$arity=3),e.def(n,"$_reduce_4",re=function(U,_e,G){var se,F=this;return a(a(se=F.prefix_number)?F.suffix_number:se)||F.$raise(c(d,"ParseError")),I(["command","prefix","suffix"],{command:U["$[]"](1),prefix:U["$[]"](0),suffix:U["$[]"](2)})},re.$$arity=3),e.def(n,"$_reduce_5",$e=function(U,_e,G){var F=this;return a(F.prefix_number)||F.$raise(c(d,"ParseError")),a(F.need_suffix_number)&&F.$raise(c(d,"ParseError")),I(["command","prefix"],{command:U["$[]"](1),prefix:U["$[]"](0)})},$e.$$arity=3),e.def(n,"$_reduce_6",be=function(U,_e,G){var F=this;return a(F.suffix_number)||F.$raise(c(d,"ParseError")),a(F.need_prefix_number)&&F.$raise(c(d,"ParseError")),I(["command","suffix"],{command:U["$[]"](0),suffix:U["$[]"](1)})},be.$$arity=3),e.def(n,"$_reduce_7",ge=function(U,_e,G){var se,F=this;return a(a(se=F.need_prefix_number)?se:F.need_suffix_number)&&F.$raise(c(d,"ParseError")),I(["command"],{command:U["$[]"](0)})},ge.$$arity=3),e.def(n,"$_reduce_8",Se=function(U,_e,G){return I([],{})},Se.$$arity=3),e.def(n,"$_reduce_9",De=function(U,_e,G){var F,oe,Be,ze,pe=r;return pe=null==(F=e.to_ary(U))[0]?r:F[0],oe=null==F[2]?r:F[2],a(a(ze=this.critical)?pe["$[]"]("critical")["$nil?"]():ze)||this.$raise(c(d,"ParseError")),t(pe,"[]=",e.to_a(Be=["critical",oe])),K(Be.length,1),pe},De.$$arity=3),e.def(n,"$_reduce_10",Te=function(U,_e,G){var F,oe,Be,ze,pe=r;return pe=null==(F=e.to_ary(U))[0]?r:F[0],oe=null==F[2]?r:F[2],a(a(ze=this.fumble)?pe["$[]"]("fumble")["$nil?"]():ze)||this.$raise(c(d,"ParseError")),t(pe,"[]=",e.to_a(Be=["fumble",oe])),K(Be.length,1),pe},Te.$$arity=3),e.def(n,"$_reduce_11",qe=function(U,_e,G){var F,oe,Be,ze,pe=r;return pe=null==(F=e.to_ary(U))[0]?r:F[0],oe=null==F[2]?r:F[2],a(a(ze=this.dollar)?pe["$[]"]("dollar")["$nil?"]():ze)||this.$raise(c(d,"ParseError")),t(pe,"[]=",e.to_a(Be=["dollar",oe])),K(Be.length,1),pe},qe.$$arity=3),e.def(n,"$_reduce_12",Ne=function(U,_e,G){return U["$[]"](1)},Ne.$$arity=3),e.def(n,"$_reduce_13",fe=function(U,_e,G){return D(D(c(d,"Arithmetic"),"Node"),"Negative").$new(U["$[]"](1))},fe.$$arity=3),e.def(n,"$_reduce_14",O=function(U,_e,G){return D(D(c(d,"Arithmetic"),"Node"),"BinaryOp").$new(U["$[]"](0),"+",U["$[]"](2))},O.$$arity=3),e.def(n,"$_reduce_15",J=function(U,_e,G){return D(D(c(d,"Arithmetic"),"Node"),"BinaryOp").$new(U["$[]"](0),"-",U["$[]"](2))},J.$$arity=3),e.def(n,"$_reduce_16",s=function(U,_e,G){return a(this.allowed_cmp_op["$include?"](r))||this.$raise(c(d,"ParseError")),I([],{})},s.$$arity=3),e.def(n,"$_reduce_17",N=function(U,_e,G){var F,pe,ve;return ve=null==(F=e.to_ary(U))[1]?r:F[1],a(this.allowed_cmp_op["$include?"](pe=null==F[0]?r:F[0]))||this.$raise(c(d,"ParseError")),I(["cmp_op","target"],{cmp_op:pe,target:ve})},N.$$arity=3),e.def(n,"$_reduce_18",B=function(U,_e,G){var se,F=this;return se=U["$[]"](0),a(F.question_target)||F.$raise(c(d,"ParseError")),a(F.allowed_cmp_op["$include?"](se))||F.$raise(c(d,"ParseError")),I(["cmp_op","target"],{cmp_op:se,target:"?"})},B.$$arity=3),e.def(n,"$_reduce_19",R=function(U,_e,G){return D(D(c(d,"Arithmetic"),"Node"),"BinaryOp").$new(U["$[]"](0),"+",U["$[]"](2))},R.$$arity=3),e.def(n,"$_reduce_20",Q=function(U,_e,G){return D(D(c(d,"Arithmetic"),"Node"),"BinaryOp").$new(U["$[]"](0),"-",U["$[]"](2))},Q.$$arity=3),e.def(n,"$_reduce_22",ee=function(U,_e,G){return D(D(c(d,"Arithmetic"),"Node"),"BinaryOp").$new(U["$[]"](0),"*",U["$[]"](2))},ee.$$arity=3),e.def(n,"$_reduce_23",ne=function(U,_e,G){return U["$[]"](3).$new(U["$[]"](0),U["$[]"](2))},ne.$$arity=3),e.def(n,"$_reduce_25",de=function(U,_e,G){return D(D(c(d,"Arithmetic"),"Node"),"DivideWithGameSystemDefault")},de.$$arity=3),e.def(n,"$_reduce_26",te=function(U,_e,G){return D(D(c(d,"Arithmetic"),"Node"),"DivideWithCeil")},te.$$arity=3),e.def(n,"$_reduce_27",ie=function(U,_e,G){return D(D(c(d,"Arithmetic"),"Node"),"DivideWithCeil")},ie.$$arity=3),e.def(n,"$_reduce_28",me=function(U,_e,G){return D(D(c(d,"Arithmetic"),"Node"),"DivideWithRound")},me.$$arity=3),e.def(n,"$_reduce_29",ye=function(U,_e,G){return D(D(c(d,"Arithmetic"),"Node"),"DivideWithFloor")},ye.$$arity=3),e.def(n,"$_reduce_30",le=function(U,_e,G){return U["$[]"](1)},le.$$arity=3),e.def(n,"$_reduce_31",he=function(U,_e,G){return D(D(c(d,"Arithmetic"),"Node"),"Negative").$new(U["$[]"](1))},he.$$arity=3),e.def(n,"$_reduce_33",ae=function(U,_e,G){return U["$[]"](1)},ae.$$arity=3),e.def(n,"$_reduce_34",xe=function(U,_e,G){return D(D(c(d,"Arithmetic"),"Node"),"Number").$new(U["$[]"](0))},xe.$$arity=3),void e.def(n,"$_reduce_none",Ee=function(U,_e,G){return U["$[]"](0)},Ee.$$arity=3)},Opal.modules["bcdice/deprecated/checker"]=function(e){var z,P,j,V,L,E,f,n,d,H,T,o,C,X=[],w=e.nil,D=e.$$,c=e.module,Z=e.send,$=e.truthy;return z=X,P=C=[c(X[0],"BCDice")].concat(z),j=o=[c(C[0],"Deprecated")].concat(P),H=c(o[0],"Checker"),T=[H].concat(j),H.$private(),e.def(H,"$check_result_legacy",V=function(m,p,v,k){var g,b,y=this,q=w,W=w,l=w,_=w,x=w;return q=Z(p,"map",[],"sides".$to_proc()),g=(W=Z(p,"map",[],"value".$to_proc())).$sum(),l=[100]["$==="](_=q)?y.$check_1D100(m,g,v,k):[20]["$==="](_)?y.$check_1D20(m,g,v,k):[6,6]["$==="](_)?y.$check_2D6(m,g,W,v,k):w,$($(b=l["$nil?"]())?b:l["$empty?"]())&&(_=q.$uniq(),l=[10]["$==="](_)?y.$check_nD10(m,g,W,v,k):[6]["$==="](_)?y.$check_nD6(m,g,W,v,k):w,$($(x=l["$nil?"]())?x:l["$empty?"]()))?w:D(T,"Result").$new(l.$delete_prefix(" \uff1e "))},V.$$arity=4),e.def(H,"$check_1D100",L=function(m,p,v,k){return w},L.$$arity=4),e.def(H,"$check_1D20",E=function(m,p,v,k){return w},E.$$arity=4),e.def(H,"$check_nD10",f=function(m,p,v,k,y){return w},f.$$arity=5),e.def(H,"$check_2D6",n=function(m,p,v,k,y){return w},n.$$arity=5),void e.def(H,"$check_nD6",d=function(m,p,v,k,y){return w},d.$$arity=5)},Opal.modules["bcdice/base"]=function(e){function K(h,j){return"number"==typeof h&&"number"==typeof j?h+j:h["$+"](j)}function X(h,j){return"number"==typeof h&&"number"==typeof j?h-j:h["$-"](j)}var j,E,d,u,m,p,v,k,y,q,W,g,l,_,b,x,A,i,S,M,re,$e,be,ge,Se,De,Te,qe,Ne,fe,O,J,B,R,Q,ee,ne,N,f,n,T,c=e.top,Z=[],$=e.nil,I=e.$$$,z=e.$$,t=e.module,C=e.klass,a=e.truthy,P=e.send,Y=e.range,o=$;return c.$require("i18n"),c.$require("i18n/backend/fallbacks"),c.$require("bcdice/randomizer"),c.$require("bcdice/dice_table"),c.$require("bcdice/enum"),c.$require("bcdice/translate"),c.$require("bcdice/result"),c.$require("bcdice/command/parser"),c.$require("bcdice/deprecated/checker"),j=Z,E=T=[t(Z[0],"BCDice")].concat(j),f=C(T[0],null,"Base"),n=[f].concat(E),f.$$prototype.sort_add_dice=f.$$prototype.sort_barabara_dice=f.$$prototype.enabled_d9=f.$$prototype.raw_input=f.$$prototype.randomizer=f.$$prototype.enabled_upcase_input=f.$$prototype.debug=$,J=e.get_singleton_class(f),N=[J].concat(n),J.$attr_reader("prefixes"),e.def(J,"$register_prefix",B=function(te){var me,ye=this,le=$;return null==ye.prefixes&&(ye.prefixes=$),me=e.slice.call(arguments,0,arguments.length),ye.prefixes=a(le=ye.prefixes)?le:[],ye.prefixes.$concat(me.$flatten())},B.$$arity=-1),e.def(J,"$register_prefix_from_super_class",R=function(){return this.$register_prefix(this.$superclass().$prefixes())},R.$$arity=0),e.def(J,"$prefixes_pattern",Q=function(){var ie,te=this,me=$;return null==te.prefixes_pattern&&(te.prefixes_pattern=$),null==te.prefixes&&(te.prefixes=$),te.prefixes_pattern=a(ie=te.prefixes_pattern)?ie:$,a(te.prefixes_pattern)?te.prefixes_pattern:(te.prefixes=a(me=te.prefixes)?me:[],te.prefixes.$freeze(),te.prefixes_pattern=(a(te.prefixes["$empty?"]())?/(?!)/:e.regexp(["^(S)?(",te.prefixes.$join("|"),")"],"i")).$freeze())},Q.$$arity=0),e.def(J,"$command_pattern",ee=function(){var te,me,ie=this,ye=$,le=$;return null==ie.command_pattern&&(ie.command_pattern=$),null==ie.prefixes&&(ie.prefixes=$),ie.command_pattern=a(me=ie.command_pattern)?me:$,a(ie.command_pattern)?ie.command_pattern:(ie.prefixes=a(ye=ie.prefixes)?ye:[],ie.prefixes.$freeze(),le=K(P(I(z(N,"CommonCommand"),"COMMANDS"),"map",[],((te=function(ae){return null==ae&&(ae=$),I(ae,"PREFIX_PATTERN").$source()}).$$s=ie,te.$$arity=1,te)),ie.prefixes),ie.command_pattern=e.regexp(["^S?(",le.$join("|"),")"],"i").$freeze())},ee.$$arity=0),e.def(J,"$eval",ne=function(te){return this.$new(te).$eval()},ne.$$arity=1),f.$include(z(n,"Translate")),f.$include(I(z(n,"Deprecated"),"Checker")),e.def(f,"$initialize",d=function(s){var N=this;return N.raw_input=s,N.sort_add_dice=!1,N.sort_barabara_dice=!1,N.d66_sort_type=I(z(n,"D66SortType"),"NO_SORT"),N.enabled_d9=!1,N.round_type=I(z(n,"RoundType"),"FLOOR"),N.sides_implicit_d=6,N.upper_dice_reroll_threshold=$,N.reroll_dice_reroll_threshold=$,N.default_cmp_op=$,N.default_target_number=$,N.enabled_upcase_input=!0,N.locale="ja_jp",N.randomizer=I(z(n,"BCDice"),"Randomizer").$new(),N.debug=!1},d.$$arity=1),f.$attr_accessor("randomizer"),f.$attr_reader("d66_sort_type"),f.$attr_reader("round_type"),f.$attr_reader("sides_implicit_d"),f.$attr_reader("upper_dice_reroll_threshold"),f.$attr_reader("reroll_dice_reroll_threshold"),f.$attr_reader("default_cmp_op"),f.$attr_reader("default_target_number"),e.def(f,"$sort_add_dice?",u=function(){return this.sort_add_dice},u.$$arity=0),e.def(f,"$sort_barabara_dice?",m=function(){return this.sort_barabara_dice},m.$$arity=0),e.def(f,"$enabled_d9?",p=function(){return this.enabled_d9},p.$$arity=0),e.def(f,"$enable_debug",v=function(){return this.debug=!0},v.$$arity=0),e.def(f,"$eval",k=function(){var N,B,R,s=this,Q=$;return N=I(z(n,"BCDice"),"Preprocessor").$process(s.raw_input,s),B=a(R=s.$dice_command(N))?R:s.$eval_common_command(s.raw_input),a(B)?(Q=[s.randomizer.$rand_results()],P(B,"rands=",e.to_a(Q)),X(Q.length,1),Q=[s.randomizer.$detailed_rand_results()],P(B,"detailed_rands=",e.to_a(Q)),X(Q.length,1),B):$},k.$$arity=0),e.def(f,"$change_text",y=function(s){return s},y.$$arity=1),e.def(f,"$check_result",q=function(s,N,B,R){var Q=this,ee=$,ne=$,de=$,te=$,ie=$;return ee=Q.$check_result_legacy(s,N,B,R),a(ee)?ee:(ne=P(N,"map",[],"sides".$to_proc()),te=(de=P(N,"map",[],"value".$to_proc())).$sum(),(ee=[100]["$==="](ie=ne)?Q.$result_1d100(s,te,B,R):[20]["$==="](ie)?Q.$result_1d20(s,te,B,R):[6,6]["$==="](ie)?Q.$result_2d6(s,te,de,B,R):$)["$=="](z(n,"Result").$nothing())?$:a(ee)?ee:(ie=ne.$uniq(),(ee=[10]["$==="](ie)?Q.$result_nd10(s,te,de,B,R):[6]["$==="](ie)?Q.$result_nd6(s,te,de,B,R):$)["$=="](z(n,"Result").$nothing())?$:a(ee)?ee:Q.$result_ndx(s,B,R)))},q.$$arity=4),e.def(f,"$grich_text",W=function(s,N,B){return $},W.$$arity=3),f.$private(),e.def(f,"$eval_common_command",g=function(s){try{var N;return s=this.$change_text(s),P(I(z(n,"CommonCommand"),"COMMANDS"),"each",[],((N=function(Q){var ne,ee=null==N.$$s?this:N.$$s;if(null==ee.randomizer&&(ee.randomizer=$),null==Q&&(Q=$),ne=Q.$eval(s,ee,ee.randomizer),!a(ne))return $;e.ret(ne)}).$$s=this,N.$$arity=1,N)),$}catch(R){if(R===e.returner)return R.$v;throw R}},g.$$arity=1),e.def(f,"$dice_command",l=function(s){var N,B=this,R=$,Q=$,ee=$,ne=$,de=$,te=$,ie=$;return a(B.enabled_upcase_input)&&(s=s.$upcase()),R=B.$class().$prefixes_pattern().$match(s),a(R)?(Q=R["$[]"](1)["$nil?"]()["$!"](),a(Q)&&(s=s["$[]"](Y(1,-1,!1))),ee=B.$eval_game_system_specific_command(s),a(ee["$is_a?"](z(n,"Result")))?(ne=[a(de=ee["$secret?"]())?de:Q],P(ee,"secret=",e.to_a(ne)),X(ne.length,1),ee):a(a(te=a(ie=ee["$nil?"]())?ie:ee["$empty?"]())?te:ee["$=="]("1"))?$:P(z(n,"Result").$new(),"tap",[],((N=function(ye){return null==ye&&(ye=$),ne=[ee.$to_s()],P(ye,"text=",e.to_a(ne)),X(ne.length,1),P(ye,"secret=",e.to_a(ne=[Q])),ne[X(ne.length,1)]}).$$s=B,N.$$arity=1,N))):$},l.$$arity=1),e.def(f,"$eval_game_system_specific_command",_=function(s){return $},_.$$arity=1),e.def(f,"$result_ndx",b=function(s,N,B){return a(B["$is_a?"](z(n,"String")))?$:a(s.$send(N,B))?z(n,"Result").$success(this.$translate("success")):z(n,"Result").$failure(this.$translate("failure"))},b.$$arity=3),e.def(f,"$result_1d100",x=function(s,N,B,R){return $},x.$$arity=4),e.def(f,"$result_1d20",A=function(s,N,B,R){return $},A.$$arity=4),e.def(f,"$result_nd10",i=function(s,N,B,R,Q){return $},i.$$arity=5),e.def(f,"$result_2d6",S=function(s,N,B,R,Q){return $},S.$$arity=5),e.def(f,"$result_nd6",M=function(s,N,B,R,Q){return $},M.$$arity=5),e.def(f,"$get_table_by_2d6",re=function(s){return this.$get_table_by_nD6(s,2)},re.$$arity=1),e.def(f,"$get_table_by_1d6",$e=function(s){return this.$get_table_by_nD6(s,1)},$e.$$arity=1),e.def(f,"$get_table_by_nD6",be=function(s,N){return this.$get_table_by_nDx(s,N,6)},be.$$arity=2),e.def(f,"$get_table_by_nDx",ge=function(s,N,B){var Q,ee=$;return Q=this.randomizer.$roll_sum(N,B),ee=this.$get_table_value(s["$[]"](X(Q,N))),a(ee["$nil?"]())?["1",0]:[ee,Q]},ge.$$arity=3),e.def(f,"$get_table_by_1d3",Se=function(s){var R,Q,h,N=this,ee=$;return N.$debug("get_table_by_1d3"),R=N.randomizer.$roll_sum(1,6),N.$debug("num",R),Q=(h=X(R,1),"number"==typeof h?h/2:h["$/"](2)).$to_i(),N.$debug("index",Q),ee=s["$[]"](Q),a(ee["$nil?"]())?["1",0]:[ee,R]},Se.$$arity=1),e.def(f,"$get_table_by_d66_swap",De=function(s){var B;return B=this.randomizer.$roll_d66(I(z(n,"D66SortType"),"ASC")),[this.$get_table_by_number(B,s),B]},De.$$arity=1),e.def(f,"$get_table_by_d66",Te=function(s){var B,R,Q,ne,h,ee=$;return B=this.randomizer.$roll_once(6),R=this.randomizer.$roll_once(6),Q=K("number"==typeof(h=X(B,1))?6*h:h["$*"](6),X(R,1)),ee=s["$[]"](Q),ne=""+B+R,a(ee["$nil?"]())?["1",ne]:[ee,ne]},Te.$$arity=1),e.def(f,"$get_table_by_number",qe=function(s,N,B){try{var R;return null==B&&(B="1"),P(N,"each",[],((R=function(ne){var te,de=null==R.$$s?this:R.$$s;if(null==ne&&(ne=$),te=ne["$[]"](0),!a(function(h,j){return"number"==typeof h&&"number"==typeof j?h>=j:h["$>="](j)}(te,s)))return $;e.ret(de.$get_table_value(ne["$[]"](1)))}).$$s=this,R.$$arity=1,R)),this.$get_table_value(B)}catch(ee){if(ee===e.returner)return ee.$v;throw ee}},qe.$$arity=-3),e.def(f,"$get_table_value",Ne=function(s){return a(s["$is_a?"](z(n,"Proc")))?s.$call():s},Ne.$$arity=1),e.def(f,"$roll_tables",fe=function(s,N){var R=$;return R=N["$[]"](s),a(R)?R.$roll(this.randomizer).$to_s():$},fe.$$arity=2),e.def(f,"$debug",O=function(s,N){var R,Q,ee=this,ne=$,de=$;return R=e.slice.call(arguments,1,arguments.length),a(ee.debug)?(ne=a(s["$is_a?"](z(n,"String")))?s:s.$inspect(),a(R["$empty?"]())?ee.$warn(ne):(de=P(R,"map",[],((Q=function(ie){return null==ie&&(ie=$),a(ie["$is_a?"](z(n,"String")))?'"'+ie+'"':ie.$inspect()}).$$s=ee,Q.$$arity=1,Q)),ee.$warn(ne+": "+de.$join(", ")))):$},O.$$arity=-2),I(I(z(Z,"I18n"),"Backend"),"Simple").$include(I(I(z(Z,"I18n"),"Backend"),"Fallbacks")),z(Z,"I18n").$load_path()["$<<"](z(Z,"Dir")["$[]"](z(Z,"File").$join(c.$__dir__(),"../../i18n/**/*.yml"))),o=["ja_jp"],P(z(Z,"I18n"),"default_locale=",e.to_a(o)),X(o.length,1),o=[["ja_jp"]],P(z(Z,"I18n").$fallbacks(),"defaults=",e.to_a(o)),o[X(o.length,1)]},function(e){function w(o,h){return"number"==typeof o&&"number"==typeof h?o-h:o["$-"](h)}var h,V,d,p,v,k,y,u,m,E,H,Z=[],$=e.nil,I=e.$$$,z=e.$$,t=e.module,C=e.klass,a=e.hash2,P=e.truthy,Y=e.send;e.top.$require("bcdice/base"),h=Z,V=H=[t(Z[0],"BCDice")].concat(h),d=E=[t(H[0],"GameSystem")].concat(V),u=C(E[0],z(E,"Base"),"SamsaraBallad"),m=[u].concat(d),u.$$prototype.randomizer=$,e.const_set(m[0],"ID","SamsaraBallad"),e.const_set(m[0],"NAME","\u30b5\u30f3\u30b5\u30fc\u30e9\u30fb\u30d0\u30e9\u30c3\u30c9"),e.const_set(m[0],"SORT_KEY","\u3055\u3093\u3055\u3042\u3089\u306f\u3089\u3064\u3068"),e.const_set(m[0],"HELP_MESSAGE","SB\t \u901a\u5e38\u306eD100\u30ed\u30fc\u30eb\u3092\u884c\u3046\nSBS\t \u30b9\u30ef\u30c3\u30d7\u30ed\u30fc\u30eb\u3067D100\u30ed\u30fc\u30eb\u3092\u884c\u3046\nSB#x@y\t F\u5024\u3092x\u3001C\u5024\u3092y\u3068\u3057\u3066\u901a\u5e38\u306eD100\u30ed\u30fc\u30eb\u3092\u884c\u3046\nSBS#x@y\t F\u5024\u3092x\u3001C\u5024\u3092y\u3068\u3057\u3066\u30b9\u30ef\u30c3\u30d7\u30ed\u30fc\u30eb\u3067D100\u30ed\u30fc\u30eb\u3092\u884c\u3046\n\n\u4f8b\uff1a\nSB<=85 \u901a\u5e38\u306e\u6280\u80fd\u3067\u6210\u529f\u738785%\u306e\u5224\u5b9a\nSBS<=70 \u7fd2\u719f\u3092\u5f97\u305f\u6280\u80fd\u3067\u6210\u529f\u738770%\u306e\u5224\u5b9a\nSBS#3@7<=80 \u7fd2\u719f\u3092\u5f97\u305f\u6280\u80fd\u3067\u3001F\u50243\u3001C\u50247\u3067\u6210\u529f\u738780%\u306e\u653b\u6483\u5224\u5b9a\nSB<57 \u901a\u5e38\u306e\u6280\u80fd\u3067\u3001\u80fd\u52d5\u5074\u306e\u9054\u6210\u5024\u304c57\u306e\u53d7\u52d5\u5224\u5b9a\nSBS<70 \u7fd2\u719f\u3092\u5f97\u305f\u6280\u80fd\u3067\u3001\u80fd\u52d5\u5074\u306e\u9054\u6210\u5024\u304c70\u306e\u53d7\u52d5\u5224\u5b9a\n"),u.$register_prefix("SBS?"),e.def(u,"$eval_game_system_specific_command",p=function(W){var g,o,l=this,b=$,x=$,A=$,i=$,S=$,M=$,re=$,$e=$,be=$,Se=$;return l.$debug("eval_game_system_specific_command Begin"),b=I(z(m,"Command"),"Parser").$new("SBS","SB",a(["round_type"],{round_type:l.$round_type()})).$enable_critical().$enable_fumble().$restrict_cmp_op_to($,"<=","<").$parse(W),P(b)?(b.$command()["$=="]("SB")?(x=$,A=l.randomizer.$roll_once(100)):(x=(i=l.randomizer.$roll_once(10))+","+(S=l.randomizer.$roll_once(10)),(A=function(o,h){return"number"==typeof o&&"number"==typeof h?o+h:o["$+"](h)}((o=(M=Y([i,S],"map",[],(g=function(De){function Te(qe){return De.apply(this,arguments)}return Te.toString=function(){return De.toString()},Te}(function(De){return null==De&&(De=$),De["$=="](10)?0:De}),g.$$s=l,g.$$arity=1,g)).$sort())["$[]"](0),"number"==typeof o?10*o:o["$*"](10)),M["$[]"](1)))["$=="](0)&&(A=100)),re=l.$compare(A,b),$e=P(re["$failure?"]())?"\u5931\u6557":P(re["$success?"]())?"\u6210\u529f":$,be=P(re["$fumble?"]())?"\u30d5\u30a1\u30f3\u30d6\u30eb":P(re["$critical?"]())?"\u30af\u30ea\u30c6\u30a3\u30ab\u30eb":$,Se=[["(D100"+b.$cmp_op()+b.$target_number()+")",x,A.$to_s(),$e,be].$compact().$join(" \uff1e ")],Y(re,"text=",e.to_a(Se)),w(Se.length,1),re):$},p.$$arity=1),u.$private(),e.def(u,"$compare",v=function(W,g){var l,_,b,x=this;return P(["<=","<"]["$include?"](g.$cmp_op()))?P(W.$send(g.$cmp_op(),g.$target_number())["$!"]())?z(m,"Result").$failure($):P(x["$fumble_?"](W,g.$fumble()))?Y(z(m,"Result").$new(),"tap",[],((l=function(i){var M=$;return null==i&&(i=$),Y(i,"success=",e.to_a(M=[!0])),w(M.length,1),Y(i,"fumble=",e.to_a(M=[!0])),M[w(M.length,1)]}).$$s=x,l.$$arity=1,l)):P(x["$critical_?"](W,g.$critical()))?z(m,"Result").$critical($):z(m,"Result").$success($):P(x["$fumble_?"](W,g.$fumble()))?Y(z(m,"Result").$new(),"tap",[],((_=function(i){var M;return null==i&&(i=$),Y(i,"fumble=",e.to_a(M=[!0])),M[w(M.length,1)]}).$$s=x,_.$$arity=1,_)):P(x["$critical_?"](W,g.$critical()))?Y(z(m,"Result").$new(),"tap",[],((b=function(i){var M;return null==i&&(i=$),Y(i,"critical=",e.to_a(M=[!0])),M[w(M.length,1)]}).$$s=x,b.$$arity=1,b)):z(m,"Result").$new()},v.$$arity=2),e.def(u,"$fumble_?",k=function(W,g){var _;return P(_=g)?function(o,h){return"number"==typeof o&&"number"==typeof h?o<=h:o["$<="](h)}(W["$%"](10),g):_},k.$$arity=2),e.def(u,"$critical_?",y=function(W,g){var _;return P(_=g)?function(o,h){return"number"==typeof o&&"number"==typeof h?o>=h:o["$>="](h)}(W["$%"](10),g):_},y.$$arity=2)}(Opal)}}]);