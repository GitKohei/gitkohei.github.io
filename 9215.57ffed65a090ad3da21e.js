(self.webpackChunkudonarium_lily_gk=self.webpackChunkudonarium_lily_gk||[]).push([[9215],{9215:function(Xe,Je,Ze){Ze(4656),Opal.modules["bcdice/arithmetic_evaluator"]=function(e){var z,P,S,R,C,G,b,N,X=[],w=e.nil,r=e.$$$,_=e.$$,s=e.module,V=e.hash2,f=e.truthy;return z=X,P=N=[s(X[0],"BCDice")].concat(z),b=[G=s(N[0],"ArithmeticEvaluator")].concat(P),S=e.get_singleton_class(G),C=[S].concat(b),void e.def(S,"$eval",R=function(U,I){var g,m=w;if(null==I)I=V([],{});else if(!I.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return null==(g=I.$$smap.round_type)&&(g=r(_(C,"RoundType"),"FLOOR")),f(U)&&f(m=_(C,"Arithmetic").$eval(U,g))?m:0},R.$$arity=-2)},Opal.modules["i18n/backend/fallbacks"]=function(e){function H(N,i){return"number"==typeof N&&"number"==typeof i?N-i:N["$-"](i)}var i,b,C,R,j,P,G,w=[],r=e.nil,_=e.$$$,s=e.$$,V=e.module,f=e.truthy,F=e.send,z=e.send2,t=e.hash2;return i=w,G=[P=V(w[0],"I18n")].concat(i),e.class_variable_set(G[0],"@@fallbacks",r),b=e.get_singleton_class(P),j=[b].concat(G),e.def(b,"$fallbacks",C=function(){var U,n,g;return e.class_variable_set(j[1],"@@fallbacks",f(g=null==(U=j[1].$$cvars["@@fallbacks"])?r:U)?g:_(_(s(j,"I18n"),"Locale"),"Fallbacks").$new()),f(n=s(j,"Thread").$current()["$[]"]("i18n_fallbacks"))?n:null==(U=j[1].$$cvars["@@fallbacks"])?r:U},C.$$arity=0),e.def(b,"$fallbacks=",R=function(U){var I,n;return e.class_variable_set(j[1],"@@fallbacks",f(U["$is_a?"](s(j,"Array")))?_(_(s(j,"I18n"),"Locale"),"Fallbacks").$new(U):U),n=["i18n_fallbacks",null==(I=j[1].$$cvars["@@fallbacks"])?r:I],F(s(j,"Thread").$current(),"[]=",e.to_a(n)),n[H(n.length,1)]},R.$$arity=1),void function(b,S){var C=[V(b,"Backend")].concat(S);!function(R,Q){var g,n,m,u,U=V(R,"Fallbacks"),I=[U].concat(Q);e.def(U,"$translate",g=function(E,c,l){try{var p,q=g.$$p,B=this,y=r,o=r,h=r,v=r,d=r,a=r;for(q&&(g.$$p=null),d=0,a=arguments.length,v=new Array(a);d<a;d++)v[d]=arguments[d];return null==l&&(l=s(I,"EMPTY_HASH")),!f(l.$fetch("fallback",!0))||f(l["$[]"]("fallback_in_progress"))?z(B,e.find_super_dispatcher(B,"translate",g,!1,!0),"translate",v,q):(f(l["$[]"]("default"))&&(y=B["$extract_non_symbol_default!"](l)),o=l.$merge(t(["fallback_in_progress"],{fallback_in_progress:!0})),F(s(I,"I18n").$fallbacks()["$[]"](E),"each",[],((p=function(A){var te,O=null==p.$$s?this:p.$$s;null==A&&(A=r);try{return F(O,"catch",["exception"],((te=function(){var ve=null==te.$$s?this:te.$$s,ge=r;if(ge=z(ve,e.find_iter_super_dispatcher(ve,"translate",te.$$def||p.$$def||g,!1,!1),"translate",[A,c,o],null),f(ge["$nil?"]()))return r;f(E.$to_s()["$!="](A.$to_s()))&&ve.$on_fallback(E,A,c,l),e.ret(ge)}).$$s=O,te.$$arity=0,te))}catch(de){if(!e.rescue(de,[_(s(I,"I18n"),"InvalidLocale")]))throw de;try{return r}finally{e.pop_exception()}}}).$$s=B,p.$$arity=1,p)),f(f(h=l["$key?"]("default"))?l["$[]"]("default")["$nil?"]():h)?r:f(y)?z(B,e.find_super_dispatcher(B,"translate",g,!1,!0),"translate",[E,r,l.$merge(t(["default"],{default:y}))],null):B.$throw("exception",_(s(I,"I18n"),"MissingTranslation").$new(E,c,l)))}catch(k){if(k===e.returner)return k.$v;throw k}},g.$$arity=-3),e.def(U,"$extract_non_symbol_default!",n=function(E){var c,q,p=r,Z=r;return p=[E["$[]"]("default")].$flatten(),q=F(p,"detect",[],((c=function(y){return null==y&&(y=r),y["$is_a?"](s(I,"Symbol"))["$!"]()}).$$s=this,c.$$arity=1,c)),f(q)&&(Z=["default",p["$[]"](0,p.$index(q))],F(E,"[]=",e.to_a(Z)),H(Z.length,1)),q},n.$$arity=1),e.def(U,"$exists?",m=function(E,c,l){try{var p,q=m.$$p,B=this,y=r,o=r,h=r;for(q&&(m.$$p=null),o=0,h=arguments.length,y=new Array(h);o<h;o++)y[o]=arguments[o];return null==l&&(l=s(I,"EMPTY_HASH")),f(l.$fetch("fallback",!0))?(F(s(I,"I18n").$fallbacks()["$[]"](E),"each",[],((p=function(d){var a=null==p.$$s?this:p.$$s;null==d&&(d=r);try{if(!f(z(a,e.find_iter_super_dispatcher(a,"exists?",p.$$def||m,!1,!1),"exists?",[d,c],null)))return r;e.ret(!0)}catch(k){if(!e.rescue(k,[_(s(I,"I18n"),"InvalidLocale")]))throw k;try{return r}finally{e.pop_exception()}}}).$$s=B,p.$$arity=1,p)),!1):z(B,e.find_super_dispatcher(B,"exists?",m,!1,!0),"exists?",y,q)}catch(v){if(v===e.returner)return v.$v;throw v}},m.$$arity=-3),U.$private(),e.def(U,"$on_fallback",u=function(E,c,l,p){return r},u.$$arity=4)}(C[0],C)}(G[0],G)},Opal.modules["bcdice/randomizer"]=function(e){function H(b,S){return"number"==typeof b&&"number"==typeof S?b>S:b["$>"](S)}function X(b,S){return"number"==typeof b&&"number"==typeof S?b+S:b["$+"](S)}function w(b,S){return"number"==typeof b&&"number"==typeof S?b<=S:b["$<="](S)}function r(b,S){return"number"==typeof b&&"number"==typeof S?b-S:b["$-"](S)}function _(b,S){return"number"==typeof b&&"number"==typeof S?b*S:b["$*"](S)}var S,U,n,m,u,x,E,c,l,p,q,Z,B,I,g,C,f=[],F=e.nil,z=e.$$$,t=e.$$,i=e.klass,P=e.truthy,G=e.send;return S=f,U=C=[(0,e.module)(f[0],"BCDice")].concat(S),I=i(C[0],null,"Randomizer"),g=[I].concat(U),I.$$prototype.rand_results=I.$$prototype.detailed_rand_results=F,e.const_set(g[0],"UPPER_LIMIT_DICE_TIMES",200),e.const_set(g[0],"UPPER_LIMIT_DICE_SIDES",1e3),e.const_set(g[0],"UPPER_LIMIT_RANDS",1e4),e.def(I,"$initialize",n=function(){return this.rand_results=[],this.detailed_rand_results=[]},n.$$arity=0),I.$attr_reader("rand_results"),I.$attr_reader("detailed_rand_results"),e.const_set(g[0],"DetailedRandResult",t(g,"Struct").$new("kind","sides","value")),e.def(I,"$roll_barabara",m=function(o,h){var v,a,d=this;return P(H(X(d.rand_results.$size(),o),t(g,"UPPER_LIMIT_RANDS")))&&d.$raise(t(g,"TooManyRandsError")),P(P(a=w(o,0))?a:H(o,t(g,"UPPER_LIMIT_DICE_TIMES")))?[]:G(t(g,"Array"),"new",[o],((v=function(){return(null==v.$$s?this:v.$$s).$roll_once(h)}).$$s=d,v.$$arity=0,v))},m.$$arity=2),e.def(I,"$roll_sum",u=function(o,h){return this.$roll_barabara(o,h).$sum()},u.$$arity=2),e.def(I,"$roll_once",x=function(o){var v,d=F;return P(P(v=w(o,0))?v:H(o,t(g,"UPPER_LIMIT_DICE_SIDES")))?0:(d=this.$rand_inner(o),this.$push_to_detail("normal",o,d),d)},x.$$arity=1),e.def(I,"$roll_index",E=function(o){return r(this.$roll_once(o),1)},E.$$arity=1),e.def(I,"$roll_tens_d10",c=function(){var v,h=F;return(h=this.$rand_inner(10))["$=="](10)&&(h=0),v=_(h,10),this.$push_to_detail("tens_d10",10,v),v},c.$$arity=0),e.def(I,"$roll_d9",l=function(){var h;return h=r(this.$rand_inner(10),1),this.$push_to_detail("d9",10,h),h},l.$$arity=0),e.def(I,"$roll_d66",p=function(o){var h,a,d=F;return d=G(t(g,"Array"),"new",[2],((h=function(){return(null==h.$$s?this:h.$$s).$roll_once(6)}).$$s=this,h.$$arity=0,h)),a=o,z(t(g,"D66SortType"),"ASC")["$==="](a)?d["$sort!"]():z(t(g,"D66SortType"),"DESC")["$==="](a)&&d["$sort!"]()["$reverse!"](),X(_(d["$[]"](0),10),d["$[]"](1))},p.$$arity=1),I.$private(),e.def(I,"$rand_inner",q=function(o){var v,h=this;return P(function(b,S){return"number"==typeof b&&"number"==typeof S?b>=S:b["$>="](S)}(h.rand_results.$size(),t(g,"UPPER_LIMIT_RANDS")))&&h.$raise(t(g,"TooManyRandsError")),v=h.$random(o),h.rand_results["$<<"]([v,o]),v},q.$$arity=1),e.def(I,"$random",Z=function(o){return X(t(g,"Kernel").$rand(o),1)},Z.$$arity=1),e.def(I,"$push_to_detail",B=function(o,h,v){var a;return a=t(g,"DetailedRandResult").$new(o,h,v),this.detailed_rand_results.$push(a)},B.$$arity=3),void function(R,Q,U){[i(R,Q,"TooManyRandsError")].concat(U)}(C[0],t(C,"StandardError"),C)},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var z,P,C,U,I,g,n,R,Q,b,N,X=[],w=e.nil,_=e.$$,s=e.module,V=e.klass,f=e.truthy;return z=X,P=N=[s(X[0],"BCDice")].concat(z),C=b=[s(N[0],"DiceTable")].concat(P),R=V(b[0],null,"RollResult"),Q=[R].concat(C),R.$$prototype.table_name=R.$$prototype.value=R.$$prototype.body=w,e.def(R,"$initialize",U=function(u,x,E){var c=this;return c.table_name=u,c.value=x,c.body=E},U.$$arity=3),R.$attr_reader("table_name"),R.$attr_reader("value"),R.$attr_reader("body"),e.def(R,"$to_s",I=function(){var u=this;return u.table_name+"("+u.value+") \uff1e "+u.body},I.$$arity=0),e.def(R,"$last_body",g=function(){var u=this;return f(u.body["$is_a?"](_(Q,"RollResult")))?u.body.$last_body():u.body},g.$$arity=0),void e.def(R,"$empty?",n=function(){return!1},n.$$arity=0)},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var t,G,R,I,g,Q,U,S,i,w=[],r=e.nil,s=e.$$,V=e.module,f=e.klass,F=e.truthy;return t=w,G=i=[V(w[0],"BCDice")].concat(t),R=S=[V(i[0],"DiceTable")].concat(G),Q=f(S[0],null,"ChainTable"),U=[Q].concat(R),Q.$$prototype.times=Q.$$prototype.sides=Q.$$prototype.items=Q.$$prototype.name=r,e.def(Q,"$initialize",I=function(m,u,x){var E=this,c=r;return E.name=m,E.items=x.$freeze(),c=/(\d+)D(\d+)/i.$match(u),F(c)||E.$raise(s(U,"ArgumentError"),"Unexpected table type: "+u),E.times=c["$[]"](1).$to_i(),E.sides=c["$[]"](2).$to_i()},I.$$arity=3),void e.def(Q,"$roll",g=function(m){var x,E,u=this,c=r;return E=function(z,t){return"number"==typeof z&&"number"==typeof t?z-t:z["$-"](t)}(x=m.$roll_sum(u.times,u.sides),u.times),c=u.items["$[]"](E),F(c["$respond_to?"]("roll"))&&(c=c.$roll(m)),s(U,"RollResult").$new(u.name,x,c)},g.$$arity=1)},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){function w(N,i){return"number"==typeof N&&"number"==typeof i?N-i:N["$-"](i)}var i,S,U,n,m,u,I,g,C,G,_=[],s=e.nil,f=e.$$,F=e.module,z=e.klass,t=e.hash2;return i=_,S=G=[F(_[0],"BCDice")].concat(i),U=C=[F(G[0],"DiceTable")].concat(S),I=z(C[0],null,"D66GridTable"),g=[I].concat(U),I.$$prototype.name=I.$$prototype.items=s,e.defs(I,"$from_i18n",n=function(E,c){var p=s;return p=f(g,"I18n").$t(E,t(["locale","raise"],{locale:c,raise:!0})),this.$new(p["$[]"]("name"),p["$[]"]("items"))},n.$$arity=2),e.def(I,"$initialize",m=function(E,c){return this.name=E,this.items=c.$freeze()},m.$$arity=2),void e.def(I,"$roll",u=function(E){var l,p,q,Z,B,N;return l=E.$roll_once(6),p=E.$roll_once(6),q=function(N,i){return"number"==typeof N&&"number"==typeof i?N+i:N["$+"](i)}("number"==typeof(N=l)?10*N:N["$*"](10),p),Z=w(l,1),B=w(p,1),f(g,"RollResult").$new(this.name,q,this.items["$[]"](Z)["$[]"](B))},u.$$arity=1)},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var z,P,C,U,I,R,Q,b,N,X=[],w=e.nil,_=e.$$,s=e.module,V=e.klass,f=e.hash2;return e.top.$require("bcdice/dice_table/d66_grid_table"),z=X,P=N=[s(X[0],"BCDice")].concat(z),C=b=[s(N[0],"DiceTable")].concat(P),R=V(b[0],_(b,"D66GridTable"),"D66HalfGridTable"),Q=[R].concat(C),e.defs(R,"$from_i18n",U=function(n,m){var x=w;return x=_(Q,"I18n").$t(n,f(["locale","raise"],{locale:m,raise:!0})),this.$new(x["$[]"]("name"),x["$[]"]("items_1_2_3"),x["$[]"]("items_4_5_6"))},U.$$arity=2),void e.def(R,"$initialize",I=function(n,m,u){return this.name=n,this.items=[m,m,m,u,u,u].$freeze()},I.$$arity=3)},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var z,P,C,U,I,R,Q,b,N,X=[],w=e.nil,_=e.$$,s=e.module,V=e.klass,f=e.hash2;return e.top.$require("bcdice/dice_table/d66_grid_table"),z=X,P=N=[s(X[0],"BCDice")].concat(z),C=b=[s(N[0],"DiceTable")].concat(P),R=V(b[0],_(b,"D66GridTable"),"D66OneThirdTable"),Q=[R].concat(C),e.defs(R,"$from_i18n",U=function(n,m){var x=w;return x=_(Q,"I18n").$t(n,f(["locale","raise"],{locale:m,raise:!0})),this.$new(x["$[]"]("name"),x["$[]"]("items_1_2"),x["$[]"]("items_3_4"),x["$[]"]("items_5_6"))},U.$$arity=2),void e.def(R,"$initialize",I=function(n,m,u,x){return this.name=n,this.items=[m,m,u,u,x,x].$freeze()},I.$$arity=4)},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var i,S,U,n,m,u,I,g,C,G,r=[],_=e.nil,s=e.$$$,V=e.$$,f=e.module,F=e.klass,z=e.hash2,t=e.truthy;return i=r,S=G=[f(r[0],"BCDice")].concat(i),U=C=[f(G[0],"DiceTable")].concat(S),I=F(C[0],null,"D66Table"),g=[I].concat(U),I.$$prototype.sort_type=I.$$prototype.items=I.$$prototype.name=_,e.defs(I,"$from_i18n",n=function(E,c){var q,p=_;return p=V(g,"I18n").$t(E,z(["locale"],{locale:c})),q=V(g,"D66SortType").$const_get(p["$[]"]("d66_sort_type")),this.$new(p["$[]"]("name"),q,p["$[]"]("items"))},n.$$arity=2),e.def(I,"$initialize",m=function(E,c,l){var p=this;return p.name=E,p.sort_type=c,p.items=l.$freeze()},m.$$arity=3),void e.def(I,"$roll",u=function(E){var p,B,N,c=this,l=_,q=_,Z=_;return l=E.$roll_barabara(2,6),p=c.sort_type,s(V(g,"D66SortType"),"ASC")["$==="](p)?l["$sort!"]():s(V(g,"D66SortType"),"DESC")["$==="](p)&&l["$sort!"]()["$reverse!"](),q=function(N,i){return"number"==typeof N&&"number"==typeof i?N+i:N["$+"](i)}("number"==typeof(N=l["$[]"](0))?10*N:N["$*"](10),l["$[]"](1)),Z=t(B=c.items["$[]"](q))?B:c.items["$[]"](q.$to_s()),t(Z["$respond_to?"]("roll"))&&(Z=Z.$roll(E)),V(g,"RollResult").$new(c.name,q,Z)},u.$$arity=1)},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){function H(P,G){return"number"==typeof P&&"number"==typeof G?P+G:P["$+"](G)}var G,g,u,n,C,Q,S,_=[],s=e.nil,f=e.$$,F=e.module,z=e.klass,t=e.hash2,N=e.send,i=e.send2;return e.top.$require("bcdice/dice_table/d66_table"),G=_,C=S=[F(_[0],"BCDice")].concat(G),g=Q=[F(S[0],"DiceTable")].concat(C),[n=z(Q[0],f(Q,"D66Table"),"D66LeftRangeTable")].concat(g),void e.def(n,"$initialize",u=function(E,c,l){var p,y,B=this;return u.$$p&&(u.$$p=null),y=t([],{}),N(l,"each",[],((p=function(o){function h(v){return o.apply(this,arguments)}return h.toString=function(){return o.toString()},h}(function(o){var v,a,A,h=null==p.$$s?this:p.$$s;return null==o&&(o=s),v=e.to_ary(o),A=null==v[1]?s:v[1],N(null==v[0]?s:v[0],"each",[],((a=function(te){var ve;return null==te&&(te=s),N(A,"each_with_index",[],((ve=function(qe,Re){var Te,be,P;return null==qe&&(qe=s),null==Re&&(Re=s),Te=H("number"==typeof(P=te)?10*P:P["$*"](10),H(Re,1)),N(y,"[]=",e.to_a(be=[Te,qe])),be[function(P,G){return"number"==typeof P?P-1:P["$-"](1)}(be.length)]}).$$s=null==a.$$s?this:a.$$s,ve.$$arity=2,ve))}).$$s=h,a.$$arity=1,a))})).$$s=B,p.$$arity=1,p)),i(B,e.find_super_dispatcher(B,"initialize",u,!1,!0),"initialize",[E,c,y],null)},u.$$arity=3)},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var i,S,U,n,m,I,g,C,G,_=[],s=e.nil,f=e.$$,F=e.module,z=e.klass,t=e.truthy;return i=_,S=G=[F(_[0],"BCDice")].concat(i),U=C=[F(G[0],"DiceTable")].concat(S),I=z(C[0],null,"D66ParityTable"),g=[I].concat(U),I.$$prototype.odd=I.$$prototype.even=I.$$prototype.name=s,e.def(I,"$initialize",n=function(x,E,c){var l=this;return l.name=x,l.odd=E.$freeze(),l.even=c.$freeze()},n.$$arity=3),void e.def(I,"$roll",m=function(x){var l,q,Z,N,E=this,c=s;return c=x.$roll_once(6),l=x.$roll_once(6),q=(t(c["$odd?"]())?E.odd:E.even)["$[]"]("number"==typeof(N=l)?N-1:N["$-"](1)),Z=function(N,i){return"number"==typeof N&&"number"==typeof i?N+i:N["$+"](i)}(function(N,i){return"number"==typeof N?10*N:N["$*"](10)}(c),l),f(g,"RollResult").$new(E.name,Z,q)},m.$$arity=1)},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var N,b,Q,g,n,U,I,j,P,r=[],_=e.nil,V=e.$$,f=e.module,F=e.klass,z=e.send;return N=r,b=P=[f(r[0],"BCDice")].concat(N),Q=j=[f(P[0],"DiceTable")].concat(b),U=F(j[0],null,"D66RangeTable"),I=[U].concat(Q),U.$$prototype.items=U.$$prototype.name=_,e.def(U,"$initialize",g=function(u,x){return this.name=u,this.items=x.$freeze()},g.$$arity=2),void e.def(U,"$roll",n=function(u){var x,c,l,p,t,E=this,q=_;return c=u.$roll_once(6),l=u.$roll_once(6),p=function(t,N){return"number"==typeof t&&"number"==typeof N?t+N:t["$+"](N)}("number"==typeof(t=c)?10*t:t["$*"](10),l),q=z(E.items,"find",[],((x=function(B){return null==B&&(B=_),B["$[]"](0)["$include?"](p)}).$$s=E,x.$$arity=1,x)),V(I,"RollResult").$new(E.name,p,q["$[]"](1))},n.$$arity=1)},Opal.modules["bcdice/dice_table/range_table"]=function(e){var P,j,I,m,u,x,E,c,l,p,q,Z,g,n,R,b,_=[],s=e.nil,f=e.$$,F=e.module,z=e.klass,t=e.send,N=e.truthy;return P=_,j=b=[F(_[0],"BCDice")].concat(P),I=R=[F(b[0],"DiceTable")].concat(j),g=z(R[0],null,"RangeTable"),n=[g].concat(I),g.$$prototype.name=g.$$prototype.items=g.$$prototype.num_of_dice=g.$$prototype.num_of_sides=g.$$prototype.formatter=s,e.const_set(n[0],"RollResult",t(f(n,"Struct"),"new",["sum","values","content","formatted"],((m=function(){return(null==m.$$s?this:m.$$s).$alias_method("to_s","formatted")}).$$s=g,m.$$arity=0,m))),e.const_set(n[0],"Item",f(n,"Struct").$new("range","content")),e.const_set(n[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),e.const_set(n[0],"DEFAULT_FORMATTER",t(g,"lambda",[],($$2=function(B){function y(o,h){return B.apply(this,arguments)}return y.toString=function(){return B.toString()},y}(function(B,y){return null==$$2.$$s||$$2,null==B&&(B=s),null==y&&(y=s),B.$name()+"("+y.$sum()+") \uff1e "+y.$content()}),$$2.$$s=g,$$2.$$arity=2,$$2))),g.$attr_reader("name"),g.$attr_reader("num_of_dice"),g.$attr_reader("num_of_sides"),e.def(g,"$initialize",u=function(y,o,h){var k,v=u.$$p,d=v||s,a=this,A=s;return v&&(u.$$p=null),v&&(u.$$p=null),a.name=y.$freeze(),a.formatter=N(k=d)?k:f(n,"DEFAULT_FORMATTER"),A=f(n,"DICE_ROLL_METHOD_RE").$match(o),N(A)||a.$raise(f(n,"ArgumentError"),a.name+": invalid dice roll method: "+o),a.num_of_dice=A["$[]"](1).$to_i(),a.num_of_sides=A["$[]"](2).$to_i(),a.$store(h)},u.$$arity=3),e.def(g,"$fetch",x=function(y){var o,v,h=this;return v=t(h.items,"find",[],((o=function(a){return null==a&&(a=s),a.$range()["$include?"](y)}).$$s=h,o.$$arity=1,o)),N(v)||h.$raise(f(n,"RangeError"),h.name+": value is out of range: "+y),v},x.$$arity=1),e.def(g,"$roll",E=function(y){var v,d,a,i,o=this,h=s;return v=(h=y.$roll_barabara(o.num_of_dice,o.num_of_sides)).$sum(),d=f(n,"RollResult").$new(v,h,o.$fetch(v).$content()),a=[o.formatter["$[]"](o,d)],t(d,"formatted=",e.to_a(a)),"number"==typeof(i=a.length)||i["$-"](1),d},E.$$arity=1),g.$private(),e.def(g,"$store",c=function(y){var o,h,v,a,k,d=this;return a=t(y,"map",[],((o=function(O,te){return null==O&&(O=s),null==te&&(te=s),[(null==o.$$s?this:o.$$s).$coerce_to_int_range(O),te]}).$$s=d,o.$$arity=2,o)),k=t(a,"sort_by",[],((h=function(O,te){return null==O&&(O=s),null==te&&(te=s),O.$min()}).$$s=d,h.$$arity=2,h)),d.$assert_min_sum_is_covered(k),d.$assert_max_sum_is_covered(k),d.$assert_no_gap_or_overlap_in_ranges(k),d.items=t(k,"map",[],(v=function(O,te){return null==O&&(O=s),null==te&&(te=s),f(n,"Item").$new(O,te.$freeze()).$freeze()},v.$$s=d,v.$$arity=2,v)).$freeze(),d},c.$$arity=1),e.def(g,"$coerce_to_int_range",l=function(y){var h,v=s;return h=y,f(n,"Integer")["$==="](h)?f(n,"Range").$new(y,y):f(n,"Range")["$==="](h)&&N(N(v=y.$begin()["$is_a?"](f(n,"Integer")))?y.$end()["$is_a?"](f(n,"Integer")):v)?y:this.$raise(f(n,"TypeError"),this.name+": "+y+" ("+y.$class()+") must be an Integer or a Range with Integers ")},l.$$arity=1),e.def(g,"$assert_min_sum_is_covered",p=function(y){var h,o=this,v=s;return h=o.num_of_dice,v=y.$first()["$[]"](0),N(v["$include?"](h))||o.$raise(f(n,"RangeError"),o.name+": min value ("+h+") is not covered: "+v),o},p.$$arity=1),e.def(g,"$assert_max_sum_is_covered",q=function(y){var h,o=this,v=s;return h=function(i,P){return"number"==typeof i&&"number"==typeof P?i*P:i["$*"](P)}(o.num_of_dice,o.num_of_sides),v=y.$last()["$[]"](0),N(v["$include?"](h))||o.$raise(f(n,"RangeError"),o.name+": max value ("+h+") is not covered: "+v),o},q.$$arity=1),void e.def(g,"$assert_no_gap_or_overlap_in_ranges",Z=function(y){var o;return t(y,"each_cons",[2],((o=function(d,a){var te,de,i,k=null==o.$$s?this:o.$$s,A=s,O=s;return null==k.name&&(k.name=s),null==d&&(d=s),null==a&&(a=s),A=d["$[]"](0),O=a["$[]"](0),de="number"==typeof(i=te=A.$max())?i+1:i["$+"](1),N(O["$include?"](te))&&k.$raise(f(n,"RangeError"),k.name+": Range overlap: "+A+" and "+O),N(O["$include?"](de))?s:k.$raise(f(n,"RangeError"),k.name+": Range gap: "+A+" and "+O)}).$$s=this,o.$$arity=2,o)),this},Z.$$arity=1)},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var t,G,R,n,x,E,c,m,u,U,S,i,w=[],r=e.nil,_=e.$$$,s=e.$$,V=e.module,f=e.klass,F=e.send;return t=w,G=i=[V(w[0],"BCDice")].concat(t),R=S=[V(i[0],"DiceTable")].concat(G),n=U=[f(S[0],null,"SaiFicSkillTable")].concat(R),m=f(U[0],null,"Category"),u=[m].concat(n),m.$$prototype.name=r,e.def(m,"$initialize",x=function(p,q,Z,B){var y,o=this;return o.name=p,o.skills=F(q.$map(),"with_index",[2],((y=function(h){function v(d,a){return h.apply(this,arguments)}return v.toString=function(){return h.toString()},v}(function(h,v){return null==h&&(h=r),null==v&&(v=r),_(s(u,"SaiFicSkillTable"),"Skill").$new(p,h,Z,v,B)})).$$s=o,y.$$arity=2,y)),o.dice=Z},x.$$arity=4),e.def(m,"$roll",E=function(p){return this.$skills()["$[]"]("number"==typeof(z=p.$roll_sum(2,6))?z-2:z["$-"](2));var z},E.$$arity=1),e.def(m,"$to_s",c=function(){return this.name},c.$$arity=0),void m.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var z,P,g,u,x,n,C,Q,b,N,X=[],w=e.nil,s=e.module,V=e.klass,f=e.hash2;return z=X,P=N=[s(X[0],"BCDice")].concat(z),C=b=[s(N[0],"DiceTable")].concat(P),g=Q=[V(b[0],null,"SaiFicSkillTable")].concat(C),[n=V(Q[0],null,"Skill")].concat(g),n.$$prototype.s_format=n.$$prototype.category_dice=n.$$prototype.row_dice=n.$$prototype.category_name=n.$$prototype.name=w,e.def(n,"$initialize",u=function(c,l,p,q,Z){var B=this;return B.category_name=c,B.name=l,B.category_dice=p,B.row_dice=q,B.s_format=Z},u.$$arity=5),e.def(n,"$to_s",x=function(){var c=this;return c.$format(c.s_format,f(["category_dice","row_dice","category_name","skill_name"],{category_dice:c.category_dice,row_dice:c.row_dice,category_name:c.category_name,skill_name:c.name}))},x.$$arity=0),void n.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var G,C,g,u,x,E,c,l,p,q,n,m,Q,S,w=e.top,r=[],_=e.nil,s=e.$$$,V=e.$$,f=e.module,F=e.klass,z=e.hash2,t=e.send,i=e.truthy;return w.$require("bcdice/dice_table/sai_fic_skill_table/category"),w.$require("bcdice/dice_table/sai_fic_skill_table/skill"),G=r,C=S=[f(r[0],"BCDice")].concat(G),g=Q=[f(S[0],"DiceTable")].concat(C),n=F(Q[0],null,"SaiFicSkillTable"),m=[n].concat(g),n.$$prototype.rtt=n.$$prototype.rtt_format=n.$$prototype.rct=n.$$prototype.rct_format=n.$$prototype.rttn=n.$$prototype.rttn_format=n.$$prototype.categories=_,e.defs(n,"$from_i18n",u=function(B,y,o){var h,v,d,a,te,O=_;if(null==o)o=z([],{});else if(!o.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return null==(h=o.$$smap.rtt)&&(h=_),null==(v=o.$$smap.rct)&&(v=_),null==(d=o.$$smap.rttn)&&(d=_),te=(O=V(m,"I18n").$t("RTT",z(["locale","raise","default"],{locale:y,raise:!1,default:z([],{})})).$merge(V(m,"I18n").$t(B,z(["locale","raise"],{locale:y,raise:!0}))))["$[]"]("items"),O=t(O,"select",[],((a=function(de){function ve(ge,qe){return de.apply(this,arguments)}return ve.toString=function(){return de.toString()},ve}(function(de,ve){return null==de&&(de=_),null==ve&&(ve=_),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](de)})).$$s=this,a.$$arity=2,a)),this.$new(te,e.to_hash(O).$merge(z(["rtt","rct","rttn"],{rtt:h,rct:v,rttn:d})))},u.$$arity=-3),e.const_set(m[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),e.const_set(m[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),e.const_set(m[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),e.const_set(m[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),e.def(n,"$initialize",x=function(B,y){var o,h,v,d,a,k,A,O,te=this;if(null==y)y=z([],{});else if(!y.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return null==(o=y.$$smap.rtt)&&(o=_),null==(h=y.$$smap.rct)&&(h=_),null==(v=y.$$smap.rttn)&&(v=_),null==(d=y.$$smap.rtt_format)&&(d=V(m,"DEFAULT_RTT")),null==(a=y.$$smap.rct_format)&&(a=V(m,"DEFAULT_RCT")),null==(k=y.$$smap.rttn_format)&&(k=V(m,"DEFAULT_RTTN")),null==(A=y.$$smap.s_format)&&(A=V(m,"DEFAULT_S")),te.categories=t(B.$map(),"with_index",[1],((O=function(ve,ge){var Re,Te,be;return null==ve&&(ve=_),null==ge&&(ge=_),Te=null==(Re=e.to_ary(ve))[0]?_:Re[0],be=null==Re[1]?_:Re[1],s(V(m,"SaiFicSkillTable"),"Category").$new(Te,be,ge,A)}).$$s=te,O.$$arity=2,O.$$has_top_level_mlhs_arg=!0,O)),te.rtt=o,te.rct=h,te.rttn=v.$to_a(),te.rtt_format=d,te.rct_format=a,te.rttn_format=k},x.$$arity=-2),e.const_set(m[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),n.$attr_reader("categories"),e.def(n,"$roll_command",E=function(B,y){var h,o=this,v=_,d=_,a=_;return i(["RTT",o.rtt]["$include?"](h=y))?o.$format_skill(o.rtt_format,o.$roll_skill(B)):i(["RCT",o.rct]["$include?"](h))?(v=o.$roll_category(B),o.$format(o.rct_format,z(["category_dice","category_name"],{category_dice:v.$dice(),category_name:v.$name()}))):i(i(d=a=V(m,"RTTN").$index(h))?d:a=o.rttn.$index(h))?o.$format_skill(o.rttn_format,o.categories["$[]"](a).$roll(B)):_},E.$$arity=2),e.def(n,"$roll_category",c=function(B){return this.categories["$[]"]("number"==typeof(P=B.$roll_once(6))?P-1:P["$-"](1));var P},c.$$arity=1),e.def(n,"$roll_skill",l=function(B){return this.$roll_category(B).$roll(B)},l.$$arity=1),e.def(n,"$prefixes",p=function(){var B=this;return function(P,G){return"number"==typeof P&&"number"==typeof G?P+G:P["$+"](G)}(["RTT[1-6]?","RCT",B.rtt,B.rct],B.rttn).$compact()},p.$$arity=0),n.$private(),void e.def(n,"$format_skill",q=function(B,y){return this.$format(B,z(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:y.$category_dice(),row_dice:y.$row_dice(),category_name:y.$category_name(),skill_name:y.$name(),text:y.$to_s()}))},q.$$arity=2)},Opal.modules["bcdice/dice_table/table"]=function(e){var N,b,Q,g,n,m,u,U,I,j,P,w=[],r=e.nil,s=e.$$,V=e.module,f=e.klass,F=e.hash2,z=e.truthy;return N=w,b=P=[V(w[0],"BCDice")].concat(N),Q=j=[V(P[0],"DiceTable")].concat(b),U=f(j[0],null,"Table"),I=[U].concat(Q),U.$$prototype.times=U.$$prototype.sides=U.$$prototype.name=U.$$prototype.items=r,e.defs(U,"$from_i18n",g=function(E,c){var p=r;return p=s(I,"I18n").$t(E,F(["locale"],{locale:c})),this.$new(p["$[]"]("name"),p["$[]"]("type"),p["$[]"]("items"))},g.$$arity=2),e.def(U,"$initialize",n=function(E,c,l){var p=this,q=r;return p.name=E,p.items=l.$freeze(),q=/(\d+)D(\d+)/i.$match(c),z(q)||p.$raise(s(I,"ArgumentError"),"Unexpected table type: "+c),p.times=q["$[]"](1).$to_i(),p.sides=q["$[]"](2).$to_i()},n.$$arity=3),e.def(U,"$roll",m=function(E){var l,c=this;return l=E.$roll_sum(c.times,c.sides),c.$choice(l)},m.$$arity=1),void e.def(U,"$choice",u=function(E){var l,c=this;return l=function(t,N){return"number"==typeof t&&"number"==typeof N?t-N:t["$-"](N)}(E,c.times),s(I,"RollResult").$new(c.name,E,c.items["$[]"](l))},u.$$arity=1)},Opal.modules["bcdice/dice_table"]=function(e){var H=e.top;return H.$require("bcdice/dice_table/roll_result"),H.$require("bcdice/dice_table/chain_table"),H.$require("bcdice/dice_table/d66_grid_table"),H.$require("bcdice/dice_table/d66_half_grid_table"),H.$require("bcdice/dice_table/d66_one_third_table"),H.$require("bcdice/dice_table/d66_left_range_table"),H.$require("bcdice/dice_table/d66_parity_table"),H.$require("bcdice/dice_table/d66_range_table"),H.$require("bcdice/dice_table/d66_table"),H.$require("bcdice/dice_table/range_table"),H.$require("bcdice/dice_table/sai_fic_skill_table"),H.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var f,N,P,z,X=[],s=e.module;return f=X,N=z=[s(X[0],"BCDice")].concat(f),P=[s(z[0],"D66SortType")].concat(N),e.const_set(P[0],"NO_SORT","no_sort"),e.const_set(P[0],"ASC","asc"),e.const_set(P[0],"DESC","desc"),void function(t,N){var P=[s(t,"RoundType")].concat(N);e.const_set(P[0],"CEIL","ceil"),e.const_set(P[0],"FLOOR","floor"),e.const_set(P[0],"ROUND","round")}(z[0],z)},Opal.modules["bcdice/translate"]=function(e){var z,P,S,G,b,N,X=[],w=e.nil,_=e.$$,s=e.module,V=e.hash2;return z=X,P=N=[s(X[0],"BCDice")].concat(z),G=s(N[0],"Translate"),b=[G].concat(P),void e.def(G,"$translate",S=function(C,R){var Q,U=this;if(null==U.locale&&(U.locale=w),null==R)R=V([],{});else if(!R.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return Q=e.kwrestargs(R,{}),_(b,"I18n").$translate(C,V(["locale","raise"],{locale:U.locale,raise:!0}).$merge(e.to_hash(Q)))},S.$$arity=-2)},Opal.modules["bcdice/result"]=function(e){function H(z,t){return"number"==typeof z&&"number"==typeof t?z-t:z["$-"](t)}var t,m,E,c,l,p,q,b,C,R,Q,U,I,g,n,S,j,i,w=[],r=e.nil,f=e.klass,F=e.send;return t=w,b=i=[(0,e.module)(w[0],"BCDice")].concat(t),j=[S=f(i[0],null,"Result")].concat(b),S.$$prototype.secret=S.$$prototype.success=S.$$prototype.failure=S.$$prototype.critical=S.$$prototype.fumble=r,[m=e.get_singleton_class(S)].concat(j),e.def(m,"$success",E=function(B){var y;return F(this.$new(),"tap",[],((y=function(h){function v(d){return h.apply(this,arguments)}return v.toString=function(){return h.toString()},v}(function(h){var d=r;return null==h&&(h=r),F(h,"text=",e.to_a(d=[B])),H(d.length,1),F(h,"success=",e.to_a(d=[!0])),d[H(d.length,1)]})).$$s=this,y.$$arity=1,y))},E.$$arity=1),e.def(m,"$failure",c=function(B){var y;return F(this.$new(),"tap",[],((y=function(v){var a=r;return null==v&&(v=r),F(v,"text=",e.to_a(a=[B])),H(a.length,1),F(v,"failure=",e.to_a(a=[!0])),a[H(a.length,1)]}).$$s=this,y.$$arity=1,y))},c.$$arity=1),e.def(m,"$critical",l=function(B){var y;return F(this.$new(),"tap",[],((y=function(v){var a=r;return null==v&&(v=r),F(v,"text=",e.to_a(a=[B])),H(a.length,1),F(v,"critical=",e.to_a(a=[!0])),H(a.length,1),F(v,"success=",e.to_a(a=[!0])),a[H(a.length,1)]}).$$s=this,y.$$arity=1,y))},l.$$arity=1),e.def(m,"$fumble",p=function(B){var y;return F(this.$new(),"tap",[],((y=function(v){var a=r;return null==v&&(v=r),F(v,"text=",e.to_a(a=[B])),H(a.length,1),F(v,"fumble=",e.to_a(a=[!0])),H(a.length,1),F(v,"failure=",e.to_a(a=[!0])),a[H(a.length,1)]}).$$s=this,y.$$arity=1,y))},p.$$arity=1),e.def(m,"$nothing",q=function(){return"nothing"},q.$$arity=0),e.def(S,"$initialize",C=function(u){var x=this;return null==u&&(u=r),x.text=u,x.rands=r,x.detailed_rands=r,x.secret=!1,x.success=!1,x.failure=!1,x.critical=!1,x.fumble=!1},C.$$arity=-1),S.$attr_accessor("text","rands","detailed_rands"),S.$attr_writer("secret","success","failure","critical","fumble"),e.def(S,"$secret?",R=function(){return this.secret},R.$$arity=0),e.def(S,"$success?",Q=function(){return this.success},Q.$$arity=0),e.def(S,"$failure?",U=function(){return this.failure},U.$$arity=0),e.def(S,"$critical?",I=function(){return this.critical},I.$$arity=0),e.def(S,"$fumble?",g=function(){return this.fumble},g.$$arity=0),void e.def(S,"$condition=",n=function(u){return this.success=u,this.failure=u["$!"]()},n.$$arity=1)},Opal.modules["racc/parser"]=function(e){function H(C,R){return"number"==typeof C&&"number"==typeof R?C<R:C["$<"](R)}function X(C,R){return"number"==typeof C&&"number"==typeof R?C-R:C["$-"](R)}function w(C,R){return"number"==typeof C&&"number"==typeof R?C+R:C["$+"](R)}function r(C,R){return"number"==typeof C&&"number"==typeof R?C>=R:C["$>="](R)}function _(C,R){return"number"==typeof C&&"number"==typeof R?C>R:C["$>"](R)}function s(C,R){return"number"==typeof C&&"number"==typeof R?C<=R:C["$<="](R)}var I,g,n,R,U,z=[],t=e.nil,N=e.$$$,i=e.$$,P=e.module,G=e.klass,b=e.truthy,S=e.gvars,j=e.send;return R=z,I=(U=[P(z[0],"Racc")].concat(R))[0],g=i(U,"StandardError"),n=U,[G(I,g,"ParseError")].concat(n),b(N("::","ParseError","skip_raise")?"constant":t)||e.const_set(z[0],"ParseError",N(i(z,"Racc"),"ParseError")),function(C,R){var m,E,c,l,p,q,Z,B,y,o,h,v,d,a,k,A,O,te,de,ve,ge,qe,Re,Ee,Te,u,x,U=[P(C,"Racc")].concat(R);b(i(U,"Racc_No_Extensions","skip_raise")?"constant":t)||e.const_set(U[0],"Racc_No_Extensions",!1),m=U,u=G(U[0],null,"Parser"),x=[u].concat(m),u.$$prototype.yydebug=u.$$prototype.racc_debug_out=u.$$prototype.racc_error_status=u.$$prototype.racc_t=u.$$prototype.racc_vstack=u.$$prototype.racc_val=u.$$prototype.racc_state=u.$$prototype.racc_tstack=t,e.const_set(x[0],"Racc_Runtime_Version","1.4.6"),e.const_set(x[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),e.const_set(x[0],"Racc_Runtime_Core_Version_R","1.4.6"),e.const_set(x[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),e.const_set(x[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),e.const_set(x[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),e.const_set(x[0],"Racc_Runtime_Core_Version",i(x,"Racc_Runtime_Core_Version_R")),e.const_set(x[0],"Racc_Runtime_Core_Revision",i(x,"Racc_Runtime_Core_Revision_R")),e.const_set(x[0],"Racc_Runtime_Type","ruby"),e.defs(i(x,"Parser"),"$racc_runtime_type",E=function(){return i(x,"Racc_Runtime_Type")},E.$$arity=0),e.def(u,"$_racc_setup",c=function(){var J,re,$=this,W=t,L=t,D=t;return null==S.stderr&&(S.stderr=t),b(N($.$class(),"Racc_debug_parser"))||($.yydebug=!1),b(null!=(J=$.yydebug)&&J!==t?"instance-variable":t)||($.yydebug=!1),b($.yydebug)&&(b(null!=(re=$.racc_debug_out)&&re!==t?"instance-variable":t)||($.racc_debug_out=S.stderr),$.racc_debug_out=b(W=$.racc_debug_out)?W:S.stderr),L=N($.$class(),"Racc_arg"),b(H(L.$size(),14))&&(j(L,"[]=",e.to_a(D=[13,!0])),X(D.length,1)),L},c.$$arity=0),e.def(u,"$_racc_init_sysvars",l=function(){var J=this;return J.racc_state=[0],J.racc_tstack=[],J.racc_vstack=[],J.racc_t=t,J.racc_val=t,J.racc_read_next=!0,J.racc_user_yyerror=!1,J.racc_error_status=0},l.$$arity=0),e.def(u,"$do_parse",p=function(){return this.$__send__(i(x,"Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)},p.$$arity=0),e.def(u,"$next_token",q=function(){return this.$raise(i(x,"NotImplementedError"),this.$class()+"#next_token is not defined")},q.$$arity=0),e.def(u,"$_racc_do_parse_rb",Z=function(J,re){var $,L,D=this,ne=t,$e=t,ce=t,xe=t,fe=t,he=t,Se=t,le=t;return $=e.to_ary(J),ne=null==$[0]?t:$[0],$e=null==$[1]?t:$[1],ce=null==$[2]?t:$[2],xe=null==$[3]?t:$[3],fe=null==$[10]?t:$[10],D.$_racc_init_sysvars(),he=Se=le=t,j(D,"catch",["racc_end_parse"],((L=function(){var Fe,Ue,me=null==L.$$s?this:L.$$s,Ie=t,Ge=t,He=t;for(null==me.racc_state&&(me.racc_state=t),null==me.racc_read_next&&(me.racc_read_next=t),null==me.racc_t&&(me.racc_t=t),null==me.yydebug&&(me.yydebug=t),null==me.racc_val&&(me.racc_val=t);b(!0);)for(b(le=xe["$[]"](me.racc_state["$[]"](-1)))?(b(me.racc_read_next)&&b(me.racc_t["$!="](0))&&(Ue=me.$next_token(),Fe=e.to_ary(Ue),he=null==Fe[0]?t:Fe[0],me.racc_val=null==Fe[1]?t:Fe[1],me.racc_t=b(he)?b(Ie=fe["$[]"](he))?Ie:1:0,b(me.yydebug)&&me.$racc_read_token(me.racc_t,he,me.racc_val),me.racc_read_next=!1),le=w(le,me.racc_t),b(b(Ge=b(He=r(le,0))?Se=ne["$[]"](le):He)?$e["$[]"](le)["$=="](me.racc_state["$[]"](-1)):Ge)||(Se=ce["$[]"](me.racc_state["$[]"](-1)))):Se=ce["$[]"](me.racc_state["$[]"](-1));b(Se=me.$_racc_evalact(Se,J)););}).$$s=D,L.$$arity=0,L))},Z.$$arity=2),e.def(u,"$yyparse",B=function(J,re){return this.$__send__(i(x,"Racc_YY_Parse_Method"),J,re,this.$_racc_setup(),!0)},B.$$arity=2),e.def(u,"$_racc_yyparse_rb",y=function(J,re,$,W){var L,ne,ce=t,xe=t,oe=t,fe=t,Se=t,le=t,De=t;return L=e.to_ary($),ce=null==L[0]?t:L[0],xe=null==L[1]?t:L[1],oe=null==L[2]?t:L[2],fe=null==L[3]?t:L[3],Se=null==L[10]?t:L[10],this.$_racc_init_sysvars(),le=t,De=t,j(this,"catch",["racc_end_parse"],((ne=function(){var Ie,Ae=null==ne.$$s?this:ne.$$s;for(null==Ae.racc_state&&(Ae.racc_state=t);!b(De=fe["$[]"](Ae.racc_state["$[]"](-1)));)for(;b(le=Ae.$_racc_evalact(oe["$[]"](Ae.racc_state["$[]"](-1)),$)););return j(J,"__send__",[re],((Ie=function(He,Me){var ee,K,Ne=null==Ie.$$s?this:Ie.$$s,ke=t,ye=t,Pe=t,_e=t,ae=t,T=t,ie=t;for(null==Ne.racc_t&&(Ne.racc_t=t),null==Ne.racc_state&&(Ne.racc_state=t),null==Ne.racc_read_next&&(Ne.racc_read_next=t),null==He&&(He=t),null==Me&&(Me=t),Ne.racc_t=b(He)?b(ke=Se["$[]"](He))?ke:1:0,Ne.racc_val=Me,Ne.racc_read_next=!1,De=w(De,Ne.racc_t),b(b(ee=b(K=r(De,0))?le=ce["$[]"](De):K)?xe["$[]"](De)["$=="](Ne.racc_state["$[]"](-1)):ee)||(le=oe["$[]"](Ne.racc_state["$[]"](-1)));b(le=Ne.$_racc_evalact(le,$)););for(;b(b(ye=b(Pe=(De=fe["$[]"](Ne.racc_state["$[]"](-1)))["$!"]())?Pe:Ne.racc_read_next["$!"]())?ye:Ne.racc_t["$=="](0));)for(b(b(_e=b(ae=b(T=b(ie=De)?De=w(De,Ne.racc_t):ie)?r(De,0):T)?le=ce["$[]"](De):ae)?xe["$[]"](De)["$=="](Ne.racc_state["$[]"](-1)):_e)||(le=oe["$[]"](Ne.racc_state["$[]"](-1)));b(le=Ne.$_racc_evalact(le,$)););}).$$s=Ae,Ie.$$arity=2,Ie))}).$$s=this,ne.$$arity=0,ne))},y.$$arity=4),e.def(u,"$_racc_evalact",o=function(J,re){var $,L,oe,he,D=this,ne=t,$e=t,xe=t,fe=t,Se=t,le=t,De=t,me=t,Ae=t,Fe=t;if(ne=null==($=e.to_ary(re))[0]?t:$[0],$e=null==$[1]?t:$[1],xe=null==$[3]?t:$[3],oe=null==$[11]?t:$[11],fe=null==$[12]?t:$[12],b(b(he=_(J,0))?H(J,oe):he))b(_(D.racc_error_status,0))&&(D.racc_t["$=="](1)||(D.racc_error_status=X(D.racc_error_status,1))),D.racc_vstack.$push(D.racc_val),D.racc_state.$push(J),D.racc_read_next=!0,b(D.yydebug)&&(D.racc_tstack.$push(D.racc_t),D.$racc_shift(D.racc_t,D.racc_tstack,D.racc_vstack));else if(b(b(Se=H(J,0))?_(J,fe["$-@"]()):Se)){if(le=j(D,"catch",["racc_jump"],((L=function(){var Ie=null==L.$$s?this:L.$$s;return null==Ie.racc_state&&(Ie.racc_state=t),Ie.racc_state.$push(Ie.$_racc_do_reduce(re,J)),!1}).$$s=D,L.$$arity=0,L)),b(le)){if(1["$==="](De=le))return D.racc_user_yyerror=!0,fe["$-@"]();if(2["$==="](De))return oe;D.$raise("[Racc Bug] unknown jump code")}}else if(J["$=="](oe))b(D.yydebug)&&D.$racc_accept(),D.$throw("racc_end_parse",D.racc_vstack["$[]"](0));else{if(J["$=="](fe["$-@"]())){for((0)["$==="](De=D.racc_error_status)?b(re["$[]"](21))||D.$on_error(D.racc_t,D.racc_val,D.racc_vstack):3["$==="](De)&&(D.racc_t["$=="](0)&&D.$throw("racc_end_parse",t),D.racc_read_next=!0),D.racc_user_yyerror=!1,D.racc_error_status=3;b(!0)&&(!b(me=xe["$[]"](D.racc_state["$[]"](-1)))||(me=w(me,1),!b(b(Ae=b(Fe=r(me,0))?J=ne["$[]"](me):Fe)?$e["$[]"](me)["$=="](D.racc_state["$[]"](-1)):Ae)));)b(s(D.racc_state.$size(),1))&&D.$throw("racc_end_parse",t),D.racc_state.$pop(),D.racc_vstack.$pop(),b(D.yydebug)&&(D.racc_tstack.$pop(),D.$racc_e_pop(D.racc_state,D.racc_tstack,D.racc_vstack));return J}D.$raise("[Racc Bug] unknown action "+J.$inspect())}return b(D.yydebug)&&D.$racc_next_state(D.racc_state["$[]"](-1),D.racc_state),t},o.$$arity=2),e.def(u,"$_racc_do_reduce",h=function(J,re){var $,oe,he,Fe,Ue,Ie,Ne,L=this,ne=t,$e=t,ce=t,xe=t,fe=t,Se=t,le=t,De=t,me=t,Ae=t,Ge=t,He=t,Me=t,ze=t,se=t,ke=t;return ne=null==($=e.to_ary(J))[4]?t:$[4],$e=null==$[5]?t:$[5],ce=null==$[6]?t:$[6],xe=null==$[7]?t:$[7],oe=null==$[8]?t:$[8],fe=null==$[9]?t:$[9],he=null==$[13]?t:$[13],Se=L.racc_state,le=L.racc_vstack,De=L.racc_tstack,me=function(C,R){return"number"==typeof C?-3*C:C["$*"](-3)}(re),Ae=fe["$[]"](me),Fe=fe["$[]"](w(me,1)),Ue=fe["$[]"](w(me,2)),Ie=[],b(L.yydebug)&&(Ge=De["$[]"](Ae["$-@"](),Ae)),He=le["$[]"](Ae["$-@"](),Ae),b(L.yydebug)&&(Me=[Ae["$-@"](),Ae,Ie],j(De,"[]=",e.to_a(Me)),X(Me.length,1)),Me=[Ae["$-@"](),Ae,Ie],j(le,"[]=",e.to_a(Me)),X(Me.length,1),Me=[Ae["$-@"](),Ae,Ie],j(Se,"[]=",e.to_a(Me)),X(Me.length,1),b(he)?le.$push(L.$__send__(Ue,He,le,He["$[]"](0))):le.$push(L.$__send__(Ue,He,le)),De.$push(Fe),b(L.yydebug)&&L.$racc_reduce(Ge,Fe,De,le),Ne=X(Fe,oe),b(me=xe["$[]"](Ne))&&(me=w(me,Se["$[]"](-1)),b(b(ze=b(se=r(me,0))?ke=ne["$[]"](me):se)?$e["$[]"](me)["$=="](Ne):ze))?ke:ce["$[]"](Ne)},h.$$arity=2),e.def(u,"$on_error",v=function(J,re,$){var L,W=this;return W.$raise(i(x,"ParseError"),W.$sprintf("\nparse error on value %s (%s)",re.$inspect(),b(L=W.$token_to_str(J))?L:"?"))},v.$$arity=3),e.def(u,"$yyerror",d=function(){return this.$throw("racc_jump",1)},d.$$arity=0),e.def(u,"$yyaccept",a=function(){return this.$throw("racc_jump",2)},a.$$arity=0),e.def(u,"$yyerrok",k=function(){return this.racc_error_status=0},k.$$arity=0),e.def(u,"$racc_read_token",A=function(J,re,$){var W=this;return W.racc_debug_out.$print("read    "),W.racc_debug_out.$print(re.$inspect(),"(",W.$racc_token2str(J),") "),W.racc_debug_out.$puts($.$inspect()),W.racc_debug_out.$puts()},A.$$arity=3),e.def(u,"$racc_shift",O=function(J,re,$){var W=this;return W.racc_debug_out.$puts("shift   "+W.$racc_token2str(J)),W.$racc_print_stacks(re,$),W.racc_debug_out.$puts()},O.$$arity=3),e.def(u,"$racc_reduce",te=function(J,re,$,W){var L,D=this,ne=t;return(ne=D.racc_debug_out).$print("reduce "),b(J["$empty?"]())?ne.$print(" <none>"):j(J,"each",[],((L=function(ce){return null==ce&&(ce=t),ne.$print(" ",(null==L.$$s?this:L.$$s).$racc_token2str(ce))}).$$s=D,L.$$arity=1,L)),ne.$puts(" --\x3e "+D.$racc_token2str(re)),D.$racc_print_stacks($,W),D.racc_debug_out.$puts()},te.$$arity=4),e.def(u,"$racc_accept",de=function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()},de.$$arity=0),e.def(u,"$racc_e_pop",ve=function(J,re,$){var W=this;return W.racc_debug_out.$puts("error recovering mode: pop token"),W.$racc_print_states(J),W.$racc_print_stacks(re,$),W.racc_debug_out.$puts()},ve.$$arity=3),e.def(u,"$racc_next_state",ge=function(J,re){var $=this;return $.racc_debug_out.$puts("goto    "+J),$.$racc_print_states(re),$.racc_debug_out.$puts()},ge.$$arity=2),e.def(u,"$racc_print_stacks",qe=function(J,re){var $,L=t;return(L=this.racc_debug_out).$print("        ["),j(J,"each_index",[],(($=function(ne){return null==ne&&(ne=t),L.$print(" (",(null==$.$$s?this:$.$$s).$racc_token2str(J["$[]"](ne))," ",re["$[]"](ne).$inspect(),")")}).$$s=this,$.$$arity=1,$)),L.$puts(" ]")},qe.$$arity=2),e.def(u,"$racc_print_states",Re=function(J){var re,W=t;return(W=this.racc_debug_out).$print("        ["),j(J,"each",[],((re=function(D){return null==D&&(D=t),W.$print(" ",D)}).$$s=this,re.$$arity=1,re)),W.$puts(" ]")},Re.$$arity=1),e.def(u,"$racc_token2str",Ee=function(J){var $;return b($=N(this.$class(),"Racc_token_to_s_table")["$[]"](J))?$:this.$raise("[Racc Bug] can't convert token "+J+" to string")},Ee.$$arity=1),e.def(u,"$token_to_str",Te=function(J){return N(this.$class(),"Racc_token_to_s_table")["$[]"](J)},Te.$$arity=1)}(z[0],z)},Opal.modules["bcdice/arithmetic/node"]=function(e){function H(z,t){return"number"==typeof z&&"number"==typeof t?z/t:z["$/"](t)}var t,G,C,U,I,g,u,x,E,c,l,p,n,m,Q,S,i,w=[],r=e.nil,_=e.$$$,s=e.$$,V=e.module,f=e.klass,F=e.send2;return t=w,G=i=[V(w[0],"BCDice")].concat(t),C=S=[V(i[0],"Arithmetic")].concat(G),function(U,I,g){var u,x,E,c,l,n=f(U,null,"BinaryOp");[n].concat(g),n.$$prototype.lhs=n.$$prototype.rhs=n.$$prototype.op=r,e.def(n,"$initialize",u=function(q,Z,B){var y=this;return y.lhs=q,y.op=Z,y.rhs=B},u.$$arity=3),e.def(n,"$eval",x=function(q){var y,Z=this,B=r;return B=Z.lhs.$eval(q),y=Z.rhs.$eval(q),B.$send(Z.op,y)},x.$$arity=1),e.def(n,"$output",E=function(){var q=this;return""+q.lhs.$output()+q.op+q.rhs.$output()},E.$$arity=0),e.def(n,"$s_exp",c=function(){var q=this;return"("+q.$op_for_s_exp()+" "+q.lhs.$s_exp()+" "+q.rhs.$s_exp()+")"},c.$$arity=0),e.def(n,"$op_for_s_exp",l=function(){return this.op},l.$$arity=0)}((Q=[V(S[0],"Node")].concat(C))[0],0,Q),U=Q[0],I=s(Q,"BinaryOp"),g=Q,n=f(U,I,"DivideBase"),m=[n].concat(g),n.$$prototype.lhs=n.$$prototype.rhs=n.$$prototype.op=r,e.def(n,"$initialize",u=function(Z,B){return u.$$p&&(u.$$p=null),F(this,e.find_super_dispatcher(this,"initialize",u,!1,!0),"initialize",[Z,"/",B],null)},u.$$arity=2),e.def(n,"$eval",x=function(Z){var y,B=this,o=r;return y=B.lhs.$eval(Z),(o=B.rhs.$eval(Z))["$=="](0)&&B.$raise(s(m,"ZeroDivisionError")),B.$divide_and_round(y,o,Z)},x.$$arity=1),e.def(n,"$output",E=function(){var Z=E.$$p,y=this,o=r,h=r,v=r;for(Z&&(E.$$p=null),h=0,v=arguments.length,o=new Array(v);h<v;h++)o[h]=arguments[h];return""+F(y,e.find_super_dispatcher(y,"output",E,!1,!0),"output",o,Z)+y.$rounding_method()},E.$$arity=0),n.$private(),e.def(n,"$rounding_method",c=function(){return _(this.$class(),"ROUNDING_METHOD")},c.$$arity=0),e.def(n,"$op_for_s_exp",l=function(){return""+this.op+this.$rounding_method()},l.$$arity=0),e.def(n,"$divide_and_round",p=function(Z,B,y){return this.$raise(s(m,"NotImplementedError"))},p.$$arity=3),function(U,I,g){var u,n=f(U,I,"DivideWithGameSystemDefault"),m=[n].concat(g);e.const_set(m[0],"ROUNDING_METHOD",""),n.$private(),e.def(n,"$divide_and_round",u=function(E,c,l){var q;return q=l,_(s(m,"RoundType"),"CEIL")["$==="](q)?H(E.$to_f(),c).$ceil():_(s(m,"RoundType"),"ROUND")["$==="](q)?H(E.$to_f(),c).$round():H(E,c).$to_i()},u.$$arity=3)}(Q[0],s(Q,"DivideBase"),Q),function(U,I,g){var u,n=f(U,I,"DivideWithCeil"),m=[n].concat(g);e.const_set(m[0],"ROUNDING_METHOD","C"),n.$private(),e.def(n,"$divide_and_round",u=function(E,c,l){return H(E.$to_f(),c).$ceil()},u.$$arity=3)}(Q[0],s(Q,"DivideBase"),Q),function(U,I,g){var u,n=f(U,I,"DivideWithRound"),m=[n].concat(g);e.const_set(m[0],"ROUNDING_METHOD","R"),n.$private(),e.def(n,"$divide_and_round",u=function(E,c,l){return H(E.$to_f(),c).$round()},u.$$arity=3)}(Q[0],s(Q,"DivideBase"),Q),function(U,I,g){var u,n=f(U,I,"DivideWithFloor"),m=[n].concat(g);e.const_set(m[0],"ROUNDING_METHOD","F"),n.$private(),e.def(n,"$divide_and_round",u=function(E,c,l){return H(E,c).$to_i()},u.$$arity=3)}(Q[0],s(Q,"DivideBase"),Q),function(U,I,g){var u,x,E,c,n=f(U,null,"Negative");[n].concat(g),n.$$prototype.body=r,e.def(n,"$initialize",u=function(p){return this.body=p},u.$$arity=1),e.def(n,"$eval",x=function(p){return this.body.$eval(p)["$-@"]()},x.$$arity=1),e.def(n,"$output",E=function(){return"-"+this.body.$output()},E.$$arity=0),e.def(n,"$s_exp",c=function(){return"(- "+this.body.$s_exp()+")"},c.$$arity=0)}(Q[0],0,Q),function(U,I,g){var u,x,E,c,n=f(U,null,"Parenthesis");[n].concat(g),n.$$prototype.expr=r,e.def(n,"$initialize",u=function(p){return this.expr=p},u.$$arity=1),e.def(n,"$eval",x=function(p){return this.expr.$eval(p)},x.$$arity=1),e.def(n,"$output",E=function(){return"("+this.expr.$output()+")"},E.$$arity=0),e.def(n,"$s_exp",c=function(){return"(Parenthesis "+this.expr.$s_exp()+")"},c.$$arity=0)}(Q[0],0,Q),void function(U,I,g){var u,x,E,n=f(U,null,"Number");[n].concat(g),n.$$prototype.value=r,e.def(n,"$initialize",u=function(l){return this.value=l},u.$$arity=1),e.def(n,"$eval",x=function(l){return this.value},x.$$arity=1),e.def(n,"$output",E=function(){return this.value.$to_s()},E.$$arity=0),e.alias(n,"s_exp","output")}(Q[0],0,Q)},Opal.modules.strscan=function(e){var N,G,b,S,j,C,R,Q,U,I,g,n,m,u,x,E,c,l,p,q,Z,B,y,o,h,v,i,P,w=[],r=e.nil,s=e.$$,f=e.truthy,F=e.send;return N=w,i=(0,e.klass)(w[0],null,"StringScanner"),P=[i].concat(N),i.$$prototype.pos=i.$$prototype.string=i.$$prototype.working=i.$$prototype.matched=i.$$prototype.prev_pos=i.$$prototype.match=r,i.$attr_reader("pos"),i.$attr_reader("matched"),e.def(i,"$initialize",G=function(a){var k=this;return k.string=a,k.pos=0,k.matched=r,k.working=a,k.match=[]},G.$$arity=1),i.$attr_reader("string"),e.def(i,"$beginning_of_line?",b=function(){var a=this;return 0===a.pos||"\n"===a.string.charAt(a.pos-1)},b.$$arity=0),e.alias(i,"bol?","beginning_of_line?"),e.def(i,"$scan",S=function(a){var k=this,A=(a=k.$anchor(a)).exec(k.working);return null==A?k.matched=r:"object"==typeof A?(k.prev_pos=k.pos,k.pos+=A[0].length,k.working=k.working.substring(A[0].length),k.matched=A[0],k.match=A,A[0]):"string"==typeof A?(k.pos+=A.length,k.working=k.working.substring(A.length),A):r},S.$$arity=1),e.def(i,"$scan_until",j=function(a){var k=this;a=k.$anchor(a);for(var te,A=k.pos,O=k.working;;){if(te=a.exec(O),A+=1,O=O.substr(1),null!=te)return k.matched=k.string.substr(k.pos,A-k.pos-1+te[0].length),k.match=te,k.prev_pos=A-1,k.pos=A,k.working=O.substr(te[0].length),k.matched;if(0===O.length)return k.match=[],k.matched=r}},j.$$arity=1),e.def(i,"$[]",C=function(a){var A;if(f(this.match["$empty?"]()))return r;A=a,s(P,"Symbol")["$==="](A)?a=a.$to_s():s(P,"String")["$==="](A)||(a=s(P,"Opal")["$coerce_to!"](a,s(P,"Integer"),"to_int"));var O=this.match;return a<0&&(a+=O.length),a<0||a>=O.length||null==O[a]?r:O[a]},C.$$arity=1),e.def(i,"$check",R=function(a){var k=this,A=(a=k.$anchor(a)).exec(k.working);return k.matched=null==A?r:A[0]},R.$$arity=1),e.def(i,"$check_until",Q=function(a){var k=this,A=k.prev_pos,O=k.pos,te=k.$scan_until(a);return te!==r&&(k.matched=te.substr(-1),k.working=k.string.substr(O)),k.prev_pos=A,k.pos=O,te},Q.$$arity=1),e.def(i,"$peek",U=function(a){return this.working.substring(0,a)},U.$$arity=1),e.def(i,"$eos?",I=function(){return 0===this.working.length},I.$$arity=0),e.def(i,"$exist?",g=function(a){var A=a.exec(this.working);return null==A?r:0==A.index?0:A.index+1},g.$$arity=1),e.def(i,"$skip",n=function(a){var k=this,A=(a=k.$anchor(a)).exec(k.working);if(null==A)return k.match=[],k.matched=r;var O=A[0],te=O.length;return k.matched=O,k.match=A,k.prev_pos=k.pos,k.pos+=te,k.working=k.working.substring(te),te},n.$$arity=1),e.def(i,"$skip_until",m=function(a){var A=this.$scan_until(a);return A===r?r:(this.matched=A.substr(-1),A.length)},m.$$arity=1),e.def(i,"$get_byte",u=function(){var a=this,k=r;return a.pos<a.string.length?(a.prev_pos=a.pos,a.pos+=1,k=a.matched=a.working.substring(0,1),a.working=a.working.substring(1)):a.matched=r,k},u.$$arity=0),e.alias(i,"getch","get_byte"),e.def(i,"$match?",x=function(a){var k=this,A=(a=k.$anchor(a)).exec(k.working);return null==A?r:(k.prev_pos=k.pos,A[0].length)},x.$$arity=1),e.def(i,"$pos=",E=function(a){var k=this;return a<0&&(a+=k.string.$length()),k.pos=a,k.working=k.string.slice(a)},E.$$arity=1),e.def(i,"$matched_size",c=function(){return this.matched===r?r:this.matched.length},c.$$arity=0),e.def(i,"$post_match",l=function(){var a=this;return a.matched===r?r:a.string.substr(a.pos)},l.$$arity=0),e.def(i,"$pre_match",p=function(){var a=this;return a.matched===r?r:a.string.substr(0,a.prev_pos)},p.$$arity=0),e.def(i,"$reset",q=function(){var a=this;return a.working=a.string,a.matched=r,a.pos=0},q.$$arity=0),e.def(i,"$rest",Z=function(){return this.working},Z.$$arity=0),e.def(i,"$rest?",B=function(){return 0!==this.working.length},B.$$arity=0),e.def(i,"$rest_size",y=function(){return this.$rest().$size()},y.$$arity=0),e.def(i,"$terminate",o=function(){var k,z,a=this;return a.match=r,k=[a.string.$length()],F(a,"pos=",e.to_a(k)),k[(z=k.length,"number"==typeof z?z-1:z["$-"](1))]},o.$$arity=0),e.def(i,"$unscan",h=function(){var a=this;return a.pos=a.prev_pos,a.prev_pos=r,a.match=r,a},h.$$arity=0),i.$private(),e.def(i,"$anchor",v=function(a){var A=a.toString().match(/\/([^\/]+)$/);return A=A?A[1]:void 0,new RegExp("^(?:"+a.source+")",A)},v.$$arity=1),r&&"anchor"},Opal.modules["bcdice/normalize"]=function(e){var N,G,b,i,f,z,X=[],w=e.nil,s=e.module;return f=X,N=z=[s(X[0],"BCDice")].concat(f),[i=s(z[0],"Normalize")].concat(N),i.$module_function(),e.def(i,"$comparison_operator",G=function(j){var R;return/<=|=</["$==="](R=j)?"<=":/>=|=>/["$==="](R)?">=":/<>|!=|=!/["$==="](R)?"!=":/</["$==="](R)?"<":/>/["$==="](R)?">":/=/["$==="](R)?"==":w},G.$$arity=1),void e.def(i,"$target_number",b=function(j){return j["$=="]("?")?j:j.$to_i()},b.$$arity=1)},Opal.modules["bcdice/command/lexer"]=function(e){var N,b,Q,g,n,m,U,I,j,P,H=e.top,X=[],w=e.nil,_=e.$$,s=e.module,V=e.klass,f=e.hash2,F=e.truthy,z=e.send;return H.$require("strscan"),H.$require("bcdice/normalize"),N=X,b=P=[s(X[0],"BCDice")].concat(N),Q=j=[s(P[0],"Command")].concat(b),U=V(j[0],null,"Lexer"),I=[U].concat(Q),U.$$prototype.scanner=U.$$prototype.notations=w,e.const_set(I[0],"SYMBOLS",f(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),e.def(U,"$initialize",g=function(x,E){var c,l,p,Z,q=this;return x=F(Z=(l=(c=x)===w||null==c?w:z(c,"split",[" ",2]))===w||null==l?w:z(l,"first",[]))?Z:"",q.scanner=_(I,"StringScanner").$new(x),q.notations=z(E,"map",[],((p=function(B){function y(o){return B.apply(this,arguments)}return y.toString=function(){return B.toString()},y}(function(B){return null==B&&(B=w),F(B["$is_a?"](_(I,"String")))?_(I,"Regexp").$new(B):B})).$$s=q,p.$$arity=1,p))},g.$$arity=2),e.def(U,"$next_token",n=function(){try{var x,E=this,c=w,l=w,q=w,Z=w;return F(E.scanner["$eos?"]())?[!1,"$"]:(z(E.notations,"each",[],((x=function(y){var h,o=null==x.$$s?this:x.$$s;if(null==o.scanner&&(o.scanner=w),null==y&&(y=w),h=o.scanner.$scan(y),!F(h))return w;e.ret(["NOTATION",h])}).$$s=E,x.$$arity=1,x)),F(c=E.scanner.$scan(/\d+/))?["NUMBER",c.$to_i()]:F(l=E.scanner.$scan(/[<>!=]+/))?(l=_(I,"Normalize").$comparison_operator(l),[F(l)?"CMP_OP":"ILLEGAL",l]):(q=E.scanner.$getch().$upcase(),[F(Z=_(I,"SYMBOLS")["$[]"](q))?Z:q.$to_sym(),q]))}catch(B){if(B===e.returner)return B.$v;throw B}},n.$$arity=0),void e.def(U,"$source",m=function(){return this.scanner.$string()},m.$$arity=0)},Opal.modules["bcdice/command/parsed"]=function(e){var z,P,C,U,I,g,R,Q,b,N,X=[],w=e.nil,_=e.$$,s=e.module,V=e.klass,f=e.truthy;return z=X,P=N=[s(X[0],"BCDice")].concat(z),C=b=[s(N[0],"Command")].concat(P),R=V(b[0],null,"Parsed"),Q=[R].concat(C),R.$$prototype.question_target=R.$$prototype.critical=R.$$prototype.fumble=R.$$prototype.dollar=R.$$prototype.modify_number=R.$$prototype.target_number=R.$$prototype.prefix_number=R.$$prototype.command=R.$$prototype.suffix_number=R.$$prototype.cmp_op=w,R.$attr_accessor("command"),R.$attr_accessor("prefix_number"),R.$attr_accessor("suffix_number"),R.$attr_accessor("critical"),R.$attr_accessor("fumble"),R.$attr_accessor("dollar"),R.$attr_accessor("modify_number"),R.$attr_accessor("cmp_op"),R.$attr_accessor("target_number"),R.$attr_writer("question_target"),e.def(R,"$initialize",U=function(){var m=this;return m.prefix_number=w,m.suffix_number=w,m.critical=w,m.fumble=w,m.dollar=w,m.cmp_op=w,m.target_number=w,m.question_target=!1},U.$$arity=0),e.def(R,"$question_target?",I=function(){return this.question_target},I.$$arity=0),void e.def(R,"$to_s",g=function(m){var q,u=this,x=w,E=w,c=w,l=w,p=w;return null==m&&(m="after_command"),x=f(u.critical)?"@"+u.critical:w,E=f(u.fumble)?"#"+u.fumble:w,c=f(u.dollar)?"$"+u.dollar:w,l=_(Q,"Format").$modifier(u.modify_number),p=f(u.question_target)?"?":u.target_number,"after_command"["$==="](q=m)?[u.prefix_number,u.command,u.suffix_number,x,E,c,l,u.cmp_op,p].$join():"after_modify_number"["$==="](q)?[u.prefix_number,u.command,u.suffix_number,l,x,E,c,u.cmp_op,p].$join():"after_target_number"["$==="](q)?[u.prefix_number,u.command,u.suffix_number,l,u.cmp_op,p,x,E,c].$join():w},g.$$arity=-1)},Opal.modules["bcdice/command/parser"]=function(e){function H(P,G){return"number"==typeof P&&"number"==typeof G?P-G:P["$-"](G)}var G,C,U,I,g,u,x,E,c,l,p,q,Z,B,y,o,h,v,d,a,k,A,O,te,de,ve,ge,qe,Re,Ee,Te,be,J,re,$,W,L,D,ne,$e,ce,xe,oe,fe,he,Se,le,De,me,Ae,Fe,Ue,Ie,Ge,He,Me,Ne,ze,se,ke,ye,n,m,Q,S,X=e.top,w=[],r=e.nil,_=e.$$$,s=e.$$,V=e.klass,f=e.module,F=e.hash2,z=e.send2,t=e.send,N=e.hash,i=e.truthy;return X.$require("racc/parser.rb"),X.$require("bcdice/arithmetic/node"),X.$require("bcdice/command/lexer"),X.$require("bcdice/command/parsed"),function(P,G,b){[V(P,G,"Parser")].concat(b)}(_(s(w,"BCDice"),"Command"),_(s(w,"Racc"),"Parser"),w),G=w,C=S=[f(w[0],"BCDice")].concat(G),U=(Q=[f(S[0],"Command")].concat(C))[0],I=_(s(Q,"Racc"),"Parser"),g=Q,n=V(U,I,"Parser"),m=[n].concat(g),n.$$prototype.notations=n.$$prototype.lexer=n.$$prototype.modifier=n.$$prototype.prefix_number=n.$$prototype.suffix_number=n.$$prototype.need_suffix_number=n.$$prototype.need_prefix_number=n.$$prototype.critical=n.$$prototype.fumble=n.$$prototype.dollar=n.$$prototype.allowed_cmp_op=n.$$prototype.question_target=r,e.def(n,"$initialize",u=function(T,ie){var M,Y,ue,Le,Ce=u.$$p,we=this;if(Ce&&(u.$$p=null),M=e.slice.call(arguments,0,arguments.length),null==(Y=e.extract_kwargs(M)))Y=F([],{});else if(!Y.$$is_hash)throw e.ArgumentError.$new("expected kwargs");if(ue=M,!e.hasOwnProperty.call(Y.$$smap,"round_type"))throw e.ArgumentError.$new("missing keyword: round_type");return Le=Y.$$smap.round_type,z(we,e.find_super_dispatcher(we,"initialize",u,!1,!0),"initialize",[],null),we.notations=ue,we.round_type=Le,we.prefix_number=!1,we.suffix_number=!1,we.need_prefix_number=!1,we.need_suffix_number=!1,we.modifier=!0,we.critical=!1,we.fumble=!1,we.dollar=!1,we.allowed_cmp_op=[r,">=",">","<=","<","==","!="],we.question_target=!1},u.$$arity=-2),e.def(n,"$disable_modifier",x=function(){return this.modifier=!1,this},x.$$arity=0),e.def(n,"$enable_prefix_number",E=function(){return this.prefix_number=!0,this},E.$$arity=0),e.def(n,"$enable_suffix_number",c=function(){return this.suffix_number=!0,this},c.$$arity=0),e.def(n,"$has_prefix_number",l=function(){var T=this;return T.prefix_number=!0,T.need_prefix_number=!0,T},l.$$arity=0),e.def(n,"$has_suffix_number",p=function(){var T=this;return T.suffix_number=!0,T.need_suffix_number=!0,T},p.$$arity=0),e.def(n,"$enable_critical",q=function(){return this.critical=!0,this},q.$$arity=0),e.def(n,"$enable_fumble",Z=function(){return this.fumble=!0,this},Z.$$arity=0),e.def(n,"$enable_dollar",B=function(){return this.dollar=!0,this},B.$$arity=0),e.def(n,"$restrict_cmp_op_to",y=function(T){var ie,Y=this;return ie=e.slice.call(arguments,0,arguments.length),Y.allowed_cmp_op=ie,Y},y.$$arity=-1),e.def(n,"$enable_question_target",o=function(){return this.question_target=!0,this},o.$$arity=0),e.def(n,"$parse",h=function(T){try{return this.lexer=s(m,"Lexer").$new(T,this.notations),this.$do_parse()}catch(M){if(!e.rescue(M,[s(m,"ParseError"),s(m,"ZeroDivisionError")]))throw M;try{return r}finally{e.pop_exception()}}},h.$$arity=1),n.$private(),e.def(n,"$parsed",v=function(T,ie,M,Y){var ue;return t(s(m,"Parsed").$new(),"tap",[],((ue=function(Be){var We,Ke,je,Ye,Ve,Qe,we=null==ue.$$s?this:ue.$$s,pe=r;return null==we.round_type&&(we.round_type=r),null==Be&&(Be=r),pe=[T["$[]"]("command")],t(Be,"command=",e.to_a(pe)),H(pe.length,1),pe=[(We=T["$[]"]("prefix"),We===r||null==We?r:t(We,"eval",[we.round_type]))],t(Be,"prefix_number=",e.to_a(pe)),H(pe.length,1),pe=[(Ke=T["$[]"]("suffix"),Ke===r||null==Ke?r:t(Ke,"eval",[we.round_type]))],t(Be,"suffix_number=",e.to_a(pe)),H(pe.length,1),pe=[(je=ie["$[]"]("critical"),je===r||null==je?r:t(je,"eval",[we.round_type]))],t(Be,"critical=",e.to_a(pe)),H(pe.length,1),pe=[(Ye=ie["$[]"]("fumble"),Ye===r||null==Ye?r:t(Ye,"eval",[we.round_type]))],t(Be,"fumble=",e.to_a(pe)),H(pe.length,1),pe=[(Ve=ie["$[]"]("dollar"),Ve===r||null==Ve?r:t(Ve,"eval",[we.round_type]))],t(Be,"dollar=",e.to_a(pe)),H(pe.length,1),pe=[M.$eval(we.round_type)],t(Be,"modify_number=",e.to_a(pe)),H(pe.length,1),pe=[Y["$[]"]("cmp_op")],t(Be,"cmp_op=",e.to_a(pe)),H(pe.length,1),Y["$[]"]("target")["$=="]("?")?(t(Be,"question_target=",e.to_a(pe=[!0])),H(pe.length,1),t(Be,"target_number=",e.to_a(pe=[0])),pe[H(pe.length,1)]):(t(Be,"question_target=",e.to_a(pe=[!1])),H(pe.length,1),pe=[(Qe=Y["$[]"]("target"),Qe===r||null==Qe?r:t(Qe,"eval",[we.round_type]))],t(Be,"target_number=",e.to_a(pe)),pe[H(pe.length,1)])}).$$s=this,ue.$$arity=1,ue))},v.$$arity=4),e.def(n,"$next_token",d=function(){return this.lexer.$next_token()},d.$$arity=0),Ue=[6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,33,34,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,r,r,17,18,6,r,5,r,r,17,18,r,r,5,23,24,25,26,56,54,55,57],Ie=[0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,r,17,15,15,18,18,23,r,18,30,30,23,23,24,r,23,31,31,24,24,25,r,24,44,44,25,25,28,r,25,47,47,28,28,29,r,28,48,48,29,29,33,r,29,49,49,33,33,34,r,33,50,50,34,34,36,r,34,r,r,36,36,37,r,36,r,r,37,37,r,r,37,27,27,27,27,52,52,52,52],Ge=[-2,4,16,-3,-1,11,r,33,13,35,23,30,1,r,28,40,r,37,44,r,r,-2,r,51,58,65,0,106,72,79,47,54,r,86,93,r,100,107,r,r,r,r,r,r,63,r,r,68,75,82,89,r,120,r,r,r,r,r],He=[-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29],Me=[30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,r,r,21,47,48,40,51,52,49,50,44,46,3,r,r,r,13,r,r,r,r,r,r,r,32],Ne=[8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,r,r,4,8,8,5,7,7,8,8,9,5,6,r,r,r,6,r,r,r,r,r,r,r,6],ze=[r,6,13,3,9,-1,27,-15,-10,-1,-38],se=[r,r,r,r,r,r,19,16,15,r,r],ke=[0,0,"racc_error",4,20,"_reduce_1",4,20,"_reduce_2",3,20,"_reduce_3",3,21,"_reduce_4",2,21,"_reduce_5",2,21,"_reduce_6",1,21,"_reduce_7",0,22,"_reduce_8",3,22,"_reduce_9",3,22,"_reduce_10",3,22,"_reduce_11",2,23,"_reduce_12",2,23,"_reduce_13",3,23,"_reduce_14",3,23,"_reduce_15",0,24,"_reduce_16",2,24,"_reduce_17",2,24,"_reduce_18",3,28,"_reduce_19",3,28,"_reduce_20",1,28,"_reduce_none",3,27,"_reduce_22",4,27,"_reduce_23",1,27,"_reduce_none",0,29,"_reduce_25",1,29,"_reduce_26",1,29,"_reduce_27",1,29,"_reduce_28",1,29,"_reduce_29",2,26,"_reduce_30",2,26,"_reduce_31",1,26,"_reduce_none",3,25,"_reduce_33",1,25,"_reduce_34"],ye=N(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),e.const_set(m[0],"Racc_arg",[Ue,Ie,He,Ge,Me,Ne,se,ze,19,ke,ye,58,35,!0]),e.const_set(m[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),e.const_set(m[0],"Racc_debug_parser",!1),e.def(n,"$_reduce_1",a=function(T,ie,M){var Y;return i(this.modifier)||this.$raise(s(m,"ParseError")),Y=e.to_ary(T),this.$parsed(null==Y[0]?r:Y[0],null==Y[1]?r:Y[1],null==Y[2]?r:Y[2],null==Y[3]?r:Y[3])},a.$$arity=3),e.def(n,"$_reduce_2",k=function(T,ie,M){var Y;return i(this.modifier)||this.$raise(s(m,"ParseError")),Y=e.to_ary(T),this.$parsed(null==Y[0]?r:Y[0],null==Y[2]?r:Y[2],null==Y[1]?r:Y[1],null==Y[3]?r:Y[3])},k.$$arity=3),e.def(n,"$_reduce_3",A=function(T,ie,M){var Y,we;return we=null==(Y=e.to_ary(T))[2]?r:Y[2],this.$parsed(null==Y[0]?r:Y[0],null==Y[1]?r:Y[1],_(_(s(m,"Arithmetic"),"Node"),"Number").$new(0),we)},A.$$arity=3),e.def(n,"$_reduce_4",O=function(T,ie,M){var ue,Y=this;return i(i(ue=Y.prefix_number)?Y.suffix_number:ue)||Y.$raise(s(m,"ParseError")),F(["command","prefix","suffix"],{command:T["$[]"](1),prefix:T["$[]"](0),suffix:T["$[]"](2)})},O.$$arity=3),e.def(n,"$_reduce_5",te=function(T,ie,M){var Y=this;return i(Y.prefix_number)||Y.$raise(s(m,"ParseError")),i(Y.need_suffix_number)&&Y.$raise(s(m,"ParseError")),F(["command","prefix"],{command:T["$[]"](1),prefix:T["$[]"](0)})},te.$$arity=3),e.def(n,"$_reduce_6",de=function(T,ie,M){var Y=this;return i(Y.suffix_number)||Y.$raise(s(m,"ParseError")),i(Y.need_prefix_number)&&Y.$raise(s(m,"ParseError")),F(["command","suffix"],{command:T["$[]"](0),suffix:T["$[]"](1)})},de.$$arity=3),e.def(n,"$_reduce_7",ve=function(T,ie,M){var ue,Y=this;return i(i(ue=Y.need_prefix_number)?ue:Y.need_suffix_number)&&Y.$raise(s(m,"ParseError")),F(["command"],{command:T["$[]"](0)})},ve.$$arity=3),e.def(n,"$_reduce_8",ge=function(T,ie,M){return F([],{})},ge.$$arity=3),e.def(n,"$_reduce_9",qe=function(T,ie,M){var Y,we,Ke,We,Ce=r;return Ce=null==(Y=e.to_ary(T))[0]?r:Y[0],we=null==Y[2]?r:Y[2],i(i(We=this.critical)?Ce["$[]"]("critical")["$nil?"]():We)||this.$raise(s(m,"ParseError")),t(Ce,"[]=",e.to_a(Ke=["critical",we])),H(Ke.length,1),Ce},qe.$$arity=3),e.def(n,"$_reduce_10",Re=function(T,ie,M){var Y,we,Ke,We,Ce=r;return Ce=null==(Y=e.to_ary(T))[0]?r:Y[0],we=null==Y[2]?r:Y[2],i(i(We=this.fumble)?Ce["$[]"]("fumble")["$nil?"]():We)||this.$raise(s(m,"ParseError")),t(Ce,"[]=",e.to_a(Ke=["fumble",we])),H(Ke.length,1),Ce},Re.$$arity=3),e.def(n,"$_reduce_11",Ee=function(T,ie,M){var Y,we,Ke,We,Ce=r;return Ce=null==(Y=e.to_ary(T))[0]?r:Y[0],we=null==Y[2]?r:Y[2],i(i(We=this.dollar)?Ce["$[]"]("dollar")["$nil?"]():We)||this.$raise(s(m,"ParseError")),t(Ce,"[]=",e.to_a(Ke=["dollar",we])),H(Ke.length,1),Ce},Ee.$$arity=3),e.def(n,"$_reduce_12",Te=function(T,ie,M){return T["$[]"](1)},Te.$$arity=3),e.def(n,"$_reduce_13",be=function(T,ie,M){return _(_(s(m,"Arithmetic"),"Node"),"Negative").$new(T["$[]"](1))},be.$$arity=3),e.def(n,"$_reduce_14",J=function(T,ie,M){return _(_(s(m,"Arithmetic"),"Node"),"BinaryOp").$new(T["$[]"](0),"+",T["$[]"](2))},J.$$arity=3),e.def(n,"$_reduce_15",re=function(T,ie,M){return _(_(s(m,"Arithmetic"),"Node"),"BinaryOp").$new(T["$[]"](0),"-",T["$[]"](2))},re.$$arity=3),e.def(n,"$_reduce_16",$=function(T,ie,M){return i(this.allowed_cmp_op["$include?"](r))||this.$raise(s(m,"ParseError")),F([],{})},$.$$arity=3),e.def(n,"$_reduce_17",W=function(T,ie,M){var Y,Ce,Be;return Be=null==(Y=e.to_ary(T))[1]?r:Y[1],i(this.allowed_cmp_op["$include?"](Ce=null==Y[0]?r:Y[0]))||this.$raise(s(m,"ParseError")),F(["cmp_op","target"],{cmp_op:Ce,target:Be})},W.$$arity=3),e.def(n,"$_reduce_18",L=function(T,ie,M){var ue,Y=this;return ue=T["$[]"](0),i(Y.question_target)||Y.$raise(s(m,"ParseError")),i(Y.allowed_cmp_op["$include?"](ue))||Y.$raise(s(m,"ParseError")),F(["cmp_op","target"],{cmp_op:ue,target:"?"})},L.$$arity=3),e.def(n,"$_reduce_19",D=function(T,ie,M){return _(_(s(m,"Arithmetic"),"Node"),"BinaryOp").$new(T["$[]"](0),"+",T["$[]"](2))},D.$$arity=3),e.def(n,"$_reduce_20",ne=function(T,ie,M){return _(_(s(m,"Arithmetic"),"Node"),"BinaryOp").$new(T["$[]"](0),"-",T["$[]"](2))},ne.$$arity=3),e.def(n,"$_reduce_22",$e=function(T,ie,M){return _(_(s(m,"Arithmetic"),"Node"),"BinaryOp").$new(T["$[]"](0),"*",T["$[]"](2))},$e.$$arity=3),e.def(n,"$_reduce_23",ce=function(T,ie,M){return T["$[]"](3).$new(T["$[]"](0),T["$[]"](2))},ce.$$arity=3),e.def(n,"$_reduce_25",xe=function(T,ie,M){return _(_(s(m,"Arithmetic"),"Node"),"DivideWithGameSystemDefault")},xe.$$arity=3),e.def(n,"$_reduce_26",oe=function(T,ie,M){return _(_(s(m,"Arithmetic"),"Node"),"DivideWithCeil")},oe.$$arity=3),e.def(n,"$_reduce_27",fe=function(T,ie,M){return _(_(s(m,"Arithmetic"),"Node"),"DivideWithCeil")},fe.$$arity=3),e.def(n,"$_reduce_28",he=function(T,ie,M){return _(_(s(m,"Arithmetic"),"Node"),"DivideWithRound")},he.$$arity=3),e.def(n,"$_reduce_29",Se=function(T,ie,M){return _(_(s(m,"Arithmetic"),"Node"),"DivideWithFloor")},Se.$$arity=3),e.def(n,"$_reduce_30",le=function(T,ie,M){return T["$[]"](1)},le.$$arity=3),e.def(n,"$_reduce_31",De=function(T,ie,M){return _(_(s(m,"Arithmetic"),"Node"),"Negative").$new(T["$[]"](1))},De.$$arity=3),e.def(n,"$_reduce_33",me=function(T,ie,M){return T["$[]"](1)},me.$$arity=3),e.def(n,"$_reduce_34",Ae=function(T,ie,M){return _(_(s(m,"Arithmetic"),"Node"),"Number").$new(T["$[]"](0))},Ae.$$arity=3),void e.def(n,"$_reduce_none",Fe=function(T,ie,M){return T["$[]"](0)},Fe.$$arity=3)},Opal.modules["bcdice/deprecated/checker"]=function(e){var z,P,j,Q,U,I,g,n,m,C,R,b,N,X=[],w=e.nil,_=e.$$,s=e.module,V=e.send,f=e.truthy;return z=X,P=N=[s(X[0],"BCDice")].concat(z),j=b=[s(N[0],"Deprecated")].concat(P),C=s(b[0],"Checker"),R=[C].concat(j),C.$private(),e.def(C,"$check_result_legacy",Q=function(x,E,c,l){var B,h,p=this,q=w,Z=w,y=w,o=w,v=w;return q=V(E,"map",[],"sides".$to_proc()),B=(Z=V(E,"map",[],"value".$to_proc())).$sum(),y=[100]["$==="](o=q)?p.$check_1D100(x,B,c,l):[20]["$==="](o)?p.$check_1D20(x,B,c,l):[6,6]["$==="](o)?p.$check_2D6(x,B,Z,c,l):w,f(f(h=y["$nil?"]())?h:y["$empty?"]())&&(o=q.$uniq(),y=[10]["$==="](o)?p.$check_nD10(x,B,Z,c,l):[6]["$==="](o)?p.$check_nD6(x,B,Z,c,l):w,f(f(v=y["$nil?"]())?v:y["$empty?"]()))?w:_(R,"Result").$new(y.$delete_prefix(" \uff1e "))},Q.$$arity=4),e.def(C,"$check_1D100",U=function(x,E,c,l){return w},U.$$arity=4),e.def(C,"$check_1D20",I=function(x,E,c,l){return w},I.$$arity=4),e.def(C,"$check_nD10",g=function(x,E,c,l,p){return w},g.$$arity=5),e.def(C,"$check_2D6",n=function(x,E,c,l,p){return w},n.$$arity=5),void e.def(C,"$check_nD6",m=function(x,E,c,l,p){return w},m.$$arity=5)},Opal.modules["bcdice/base"]=function(e){function H(S,j){return"number"==typeof S&&"number"==typeof j?S+j:S["$+"](j)}function X(S,j){return"number"==typeof S&&"number"==typeof j?S-j:S["$-"](j)}var j,I,m,u,x,E,c,l,p,q,Z,B,y,o,h,v,d,a,k,A,O,te,de,ve,ge,qe,Re,Ee,Te,be,J,re,L,D,ne,$e,ce,W,g,n,R,s=e.top,V=[],f=e.nil,F=e.$$$,z=e.$$,t=e.module,N=e.klass,i=e.truthy,P=e.send,G=e.range,b=f;return s.$require("i18n"),s.$require("i18n/backend/fallbacks"),s.$require("bcdice/randomizer"),s.$require("bcdice/dice_table"),s.$require("bcdice/enum"),s.$require("bcdice/translate"),s.$require("bcdice/result"),s.$require("bcdice/command/parser"),s.$require("bcdice/deprecated/checker"),j=V,I=R=[t(V[0],"BCDice")].concat(j),g=N(R[0],null,"Base"),n=[g].concat(I),g.$$prototype.sort_add_dice=g.$$prototype.sort_barabara_dice=g.$$prototype.enabled_d9=g.$$prototype.raw_input=g.$$prototype.randomizer=g.$$prototype.enabled_upcase_input=g.$$prototype.debug=f,re=e.get_singleton_class(g),W=[re].concat(n),re.$attr_reader("prefixes"),e.def(re,"$register_prefix",L=function(oe){var he,Se=this,le=f;return null==Se.prefixes&&(Se.prefixes=f),he=e.slice.call(arguments,0,arguments.length),Se.prefixes=i(le=Se.prefixes)?le:[],Se.prefixes.$concat(he.$flatten())},L.$$arity=-1),e.def(re,"$register_prefix_from_super_class",D=function(){return this.$register_prefix(this.$superclass().$prefixes())},D.$$arity=0),e.def(re,"$prefixes_pattern",ne=function(){var fe,oe=this,he=f;return null==oe.prefixes_pattern&&(oe.prefixes_pattern=f),null==oe.prefixes&&(oe.prefixes=f),oe.prefixes_pattern=i(fe=oe.prefixes_pattern)?fe:f,i(oe.prefixes_pattern)?oe.prefixes_pattern:(oe.prefixes=i(he=oe.prefixes)?he:[],oe.prefixes.$freeze(),oe.prefixes_pattern=(i(oe.prefixes["$empty?"]())?/(?!)/:e.regexp(["^(S)?(",oe.prefixes.$join("|"),")"],"i")).$freeze())},ne.$$arity=0),e.def(re,"$command_pattern",$e=function(){var oe,he,fe=this,Se=f,le=f;return null==fe.command_pattern&&(fe.command_pattern=f),null==fe.prefixes&&(fe.prefixes=f),fe.command_pattern=i(he=fe.command_pattern)?he:f,i(fe.command_pattern)?fe.command_pattern:(fe.prefixes=i(Se=fe.prefixes)?Se:[],fe.prefixes.$freeze(),le=H(P(F(z(W,"CommonCommand"),"COMMANDS"),"map",[],((oe=function(me){return null==me&&(me=f),F(me,"PREFIX_PATTERN").$source()}).$$s=fe,oe.$$arity=1,oe)),fe.prefixes),fe.command_pattern=e.regexp(["^S?(",le.$join("|"),")"],"i").$freeze())},$e.$$arity=0),e.def(re,"$eval",ce=function(oe){return this.$new(oe).$eval()},ce.$$arity=1),g.$include(z(n,"Translate")),g.$include(F(z(n,"Deprecated"),"Checker")),e.def(g,"$initialize",m=function($){var W=this;return W.raw_input=$,W.sort_add_dice=!1,W.sort_barabara_dice=!1,W.d66_sort_type=F(z(n,"D66SortType"),"NO_SORT"),W.enabled_d9=!1,W.round_type=F(z(n,"RoundType"),"FLOOR"),W.sides_implicit_d=6,W.upper_dice_reroll_threshold=f,W.reroll_dice_reroll_threshold=f,W.default_cmp_op=f,W.default_target_number=f,W.enabled_upcase_input=!0,W.locale="ja_jp",W.randomizer=F(z(n,"BCDice"),"Randomizer").$new(),W.debug=!1},m.$$arity=1),g.$attr_accessor("randomizer"),g.$attr_reader("d66_sort_type"),g.$attr_reader("round_type"),g.$attr_reader("sides_implicit_d"),g.$attr_reader("upper_dice_reroll_threshold"),g.$attr_reader("reroll_dice_reroll_threshold"),g.$attr_reader("default_cmp_op"),g.$attr_reader("default_target_number"),e.def(g,"$sort_add_dice?",u=function(){return this.sort_add_dice},u.$$arity=0),e.def(g,"$sort_barabara_dice?",x=function(){return this.sort_barabara_dice},x.$$arity=0),e.def(g,"$enabled_d9?",E=function(){return this.enabled_d9},E.$$arity=0),e.def(g,"$enable_debug",c=function(){return this.debug=!0},c.$$arity=0),e.def(g,"$eval",l=function(){var W,L,D,$=this,ne=f;return W=F(z(n,"BCDice"),"Preprocessor").$process($.raw_input,$),L=i(D=$.$dice_command(W))?D:$.$eval_common_command($.raw_input),i(L)?(ne=[$.randomizer.$rand_results()],P(L,"rands=",e.to_a(ne)),X(ne.length,1),ne=[$.randomizer.$detailed_rand_results()],P(L,"detailed_rands=",e.to_a(ne)),X(ne.length,1),L):f},l.$$arity=0),e.def(g,"$change_text",p=function($){return $},p.$$arity=1),e.def(g,"$check_result",q=function($,W,L,D){var ne=this,$e=f,ce=f,xe=f,oe=f,fe=f;return $e=ne.$check_result_legacy($,W,L,D),i($e)?$e:(ce=P(W,"map",[],"sides".$to_proc()),oe=(xe=P(W,"map",[],"value".$to_proc())).$sum(),($e=[100]["$==="](fe=ce)?ne.$result_1d100($,oe,L,D):[20]["$==="](fe)?ne.$result_1d20($,oe,L,D):[6,6]["$==="](fe)?ne.$result_2d6($,oe,xe,L,D):f)["$=="](z(n,"Result").$nothing())?f:i($e)?$e:(fe=ce.$uniq(),($e=[10]["$==="](fe)?ne.$result_nd10($,oe,xe,L,D):[6]["$==="](fe)?ne.$result_nd6($,oe,xe,L,D):f)["$=="](z(n,"Result").$nothing())?f:i($e)?$e:ne.$result_ndx($,L,D)))},q.$$arity=4),e.def(g,"$grich_text",Z=function($,W,L){return f},Z.$$arity=3),g.$private(),e.def(g,"$eval_common_command",B=function($){try{var W;return $=this.$change_text($),P(F(z(n,"CommonCommand"),"COMMANDS"),"each",[],((W=function(ne){var ce,$e=null==W.$$s?this:W.$$s;if(null==$e.randomizer&&($e.randomizer=f),null==ne&&(ne=f),ce=ne.$eval($,$e,$e.randomizer),!i(ce))return f;e.ret(ce)}).$$s=this,W.$$arity=1,W)),f}catch(D){if(D===e.returner)return D.$v;throw D}},B.$$arity=1),e.def(g,"$dice_command",y=function($){var W,L=this,D=f,ne=f,$e=f,ce=f,xe=f,oe=f,fe=f;return i(L.enabled_upcase_input)&&($=$.$upcase()),D=L.$class().$prefixes_pattern().$match($),i(D)?(ne=D["$[]"](1)["$nil?"]()["$!"](),i(ne)&&($=$["$[]"](G(1,-1,!1))),$e=L.$eval_game_system_specific_command($),i($e["$is_a?"](z(n,"Result")))?(ce=[i(xe=$e["$secret?"]())?xe:ne],P($e,"secret=",e.to_a(ce)),X(ce.length,1),$e):i(i(oe=i(fe=$e["$nil?"]())?fe:$e["$empty?"]())?oe:$e["$=="]("1"))?f:P(z(n,"Result").$new(),"tap",[],((W=function(Se){return null==Se&&(Se=f),ce=[$e.$to_s()],P(Se,"text=",e.to_a(ce)),X(ce.length,1),P(Se,"secret=",e.to_a(ce=[ne])),ce[X(ce.length,1)]}).$$s=L,W.$$arity=1,W))):f},y.$$arity=1),e.def(g,"$eval_game_system_specific_command",o=function($){return f},o.$$arity=1),e.def(g,"$result_ndx",h=function($,W,L){return i(L["$is_a?"](z(n,"String")))?f:i($.$send(W,L))?z(n,"Result").$success(this.$translate("success")):z(n,"Result").$failure(this.$translate("failure"))},h.$$arity=3),e.def(g,"$result_1d100",v=function($,W,L,D){return f},v.$$arity=4),e.def(g,"$result_1d20",d=function($,W,L,D){return f},d.$$arity=4),e.def(g,"$result_nd10",a=function($,W,L,D,ne){return f},a.$$arity=5),e.def(g,"$result_2d6",k=function($,W,L,D,ne){return f},k.$$arity=5),e.def(g,"$result_nd6",A=function($,W,L,D,ne){return f},A.$$arity=5),e.def(g,"$get_table_by_2d6",O=function($){return this.$get_table_by_nD6($,2)},O.$$arity=1),e.def(g,"$get_table_by_1d6",te=function($){return this.$get_table_by_nD6($,1)},te.$$arity=1),e.def(g,"$get_table_by_nD6",de=function($,W){return this.$get_table_by_nDx($,W,6)},de.$$arity=2),e.def(g,"$get_table_by_nDx",ve=function($,W,L){var ne,$e=f;return ne=this.randomizer.$roll_sum(W,L),$e=this.$get_table_value($["$[]"](X(ne,W))),i($e["$nil?"]())?["1",0]:[$e,ne]},ve.$$arity=3),e.def(g,"$get_table_by_1d3",ge=function($){var D,ne,S,W=this,$e=f;return W.$debug("get_table_by_1d3"),D=W.randomizer.$roll_sum(1,6),W.$debug("num",D),ne=(S=X(D,1),"number"==typeof S?S/2:S["$/"](2)).$to_i(),W.$debug("index",ne),$e=$["$[]"](ne),i($e["$nil?"]())?["1",0]:[$e,D]},ge.$$arity=1),e.def(g,"$get_table_by_d66_swap",qe=function($){var L;return L=this.randomizer.$roll_d66(F(z(n,"D66SortType"),"ASC")),[this.$get_table_by_number(L,$),L]},qe.$$arity=1),e.def(g,"$get_table_by_d66",Re=function($){var L,D,ne,ce,S,$e=f;return L=this.randomizer.$roll_once(6),D=this.randomizer.$roll_once(6),ne=H("number"==typeof(S=X(L,1))?6*S:S["$*"](6),X(D,1)),$e=$["$[]"](ne),ce=""+L+D,i($e["$nil?"]())?["1",ce]:[$e,ce]},Re.$$arity=1),e.def(g,"$get_table_by_number",Ee=function($,W,L){try{var D;return null==L&&(L="1"),P(W,"each",[],((D=function(ce){var oe,xe=null==D.$$s?this:D.$$s;if(null==ce&&(ce=f),oe=ce["$[]"](0),!i(function(S,j){return"number"==typeof S&&"number"==typeof j?S>=j:S["$>="](j)}(oe,$)))return f;e.ret(xe.$get_table_value(ce["$[]"](1)))}).$$s=this,D.$$arity=1,D)),this.$get_table_value(L)}catch($e){if($e===e.returner)return $e.$v;throw $e}},Ee.$$arity=-3),e.def(g,"$get_table_value",Te=function($){return i($["$is_a?"](z(n,"Proc")))?$.$call():$},Te.$$arity=1),e.def(g,"$roll_tables",be=function($,W){var D=f;return D=W["$[]"]($),i(D)?D.$roll(this.randomizer).$to_s():f},be.$$arity=2),e.def(g,"$debug",J=function($,W){var D,ne,$e=this,ce=f,xe=f;return D=e.slice.call(arguments,1,arguments.length),i($e.debug)?(ce=i($["$is_a?"](z(n,"String")))?$:$.$inspect(),i(D["$empty?"]())?$e.$warn(ce):(xe=P(D,"map",[],((ne=function(fe){return null==fe&&(fe=f),i(fe["$is_a?"](z(n,"String")))?'"'+fe+'"':fe.$inspect()}).$$s=$e,ne.$$arity=1,ne)),$e.$warn(ce+": "+xe.$join(", ")))):f},J.$$arity=-2),F(F(z(V,"I18n"),"Backend"),"Simple").$include(F(F(z(V,"I18n"),"Backend"),"Fallbacks")),z(V,"I18n").$load_path()["$<<"](z(V,"Dir")["$[]"](z(V,"File").$join(s.$__dir__(),"../../i18n/**/*.yml"))),b=["ja_jp"],P(z(V,"I18n"),"default_locale=",e.to_a(b)),X(b.length,1),b=[["ja_jp"]],P(z(V,"I18n").$fallbacks(),"defaults=",e.to_a(b)),b[X(b.length,1)]},Opal.modules["bcdice/game_system/sword_world/rating_lexer"]=function(e){var N,b,Q,m,E,c,l,u,x,I,j,P,X=[],w=e.nil,_=e.$$,s=e.module,V=e.klass,f=e.hash2,F=e.truthy,z=e.send;return e.top.$require("strscan"),N=X,b=P=[s(X[0],"BCDice")].concat(N),Q=j=[s(P[0],"GameSystem")].concat(b),m=I=[V(j[0],_(j,"Base"),"SwordWorld")].concat(Q),u=V(I[0],null,"RatingLexer"),x=[u].concat(m),u.$$prototype.scanner=w,e.const_set(x[0],"SYMBOLS",f(["+","-","*","/","(",")","[","]","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","[":"BRACKETL","]":"BRACKETR","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),e.def(u,"$initialize",E=function(q){var Z,B,o;return q=F(o=(B=(Z=q)===w||null==Z?w:z(Z,"split",[" ",2]))===w||null==B?w:z(B,"first",[]))?o:"",this.scanner=_(x,"StringScanner").$new(q)},E.$$arity=1),e.def(u,"$next_token",c=function(){var q=this,Z=w,B=w,o=w;return F(q.scanner["$eos?"]())?[!1,"$"]:F(Z=q.scanner.$scan(/\d+/))?["NUMBER",Z.$to_i()]:(B=q.scanner.$getch().$upcase(),[F(o=_(x,"SYMBOLS")["$[]"](B))?o:B.$to_sym(),B])},c.$$arity=0),void e.def(u,"$source",l=function(){return this.scanner.$string()},l.$$arity=0)},Opal.modules["bcdice/game_system/sword_world/rating_parsed"]=function(e){function H(t,N){return"number"==typeof t&&"number"==typeof N?t<N:t["$<"](N)}function X(t,N){return"number"==typeof t&&"number"==typeof N?t+N:t["$+"](N)}var N,b,Q,m,E,c,l,p,q,Z,B,y,o,u,x,I,j,P,r=[],_=e.nil,V=e.$$,f=e.module,F=e.klass,z=e.truthy;return N=r,b=P=[f(r[0],"BCDice")].concat(N),Q=j=[f(P[0],"GameSystem")].concat(b),m=I=[F(j[0],V(j,"Base"),"SwordWorld")].concat(Q),u=F(I[0],null,"RatingParsed"),x=[u].concat(m),u.$$prototype.modifier_after_half=u.$$prototype.critical=u.$$prototype.first_modify=u.$$prototype.first_to=u.$$prototype.rateup=u.$$prototype.kept_modify=u.$$prototype.rate=u.$$prototype.greatest_fortune=u.$$prototype.modifier=_,u.$attr_accessor("rate"),u.$attr_writer("critical"),u.$attr_writer("kept_modify"),u.$attr_writer("first_to"),u.$attr_writer("first_modify"),u.$attr_writer("rateup"),u.$attr_accessor("greatest_fortune"),u.$attr_accessor("modifier"),u.$attr_writer("modifier_after_half"),e.def(u,"$initialize",E=function(){var v=this;return v.critical=_,v.kept_modify=_,v.first_to=_,v.first_modify=_,v.greatest_fortune=!1,v.rateup=_},E.$$arity=0),e.def(u,"$half",c=function(){return this.modifier_after_half["$nil?"]()["$!"]()},c.$$arity=0),e.def(u,"$critical",l=function(){var a,d=_;return d=z(a=this.critical)?a:z(this.$half())?13:10,z(H(d,3))&&(d=3),d},l.$$arity=0),e.def(u,"$first_modify",p=function(){var d;return z(d=this.first_modify)?d:0},p.$$arity=0),e.def(u,"$first_to",q=function(){var d;return z(d=this.first_to)?d:0},q.$$arity=0),e.def(u,"$rateup",Z=function(){var d;return z(d=this.rateup)?d:0},Z.$$arity=0),e.def(u,"$kept_modify",B=function(){var d;return z(d=this.kept_modify)?d:0},B.$$arity=0),e.def(u,"$modifier_after_half",y=function(){var d;return z(d=this.modifier_after_half)?d:0},y.$$arity=0),void e.def(u,"$to_s",o=function(){var v=this,d=_;return d="KeyNo."+v.rate,z(H(v.$critical(),13))&&(d=X(d,"c["+v.$critical()+"]")),z(v.$first_modify()["$!="](0))&&(d=X(d,"m["+V(x,"Format").$modifier(v.$first_modify())+"]")),z(v.$first_to()["$!="](0))&&(d=X(d,"m["+v.$first_to()+"]")),z(v.$rateup()["$!="](0))&&(d=X(d,"r["+v.$rateup()+"]")),z(v.greatest_fortune)&&(d=X(d,"gf")),z(v.$kept_modify()["$!="](0))&&(d=X(d,"a["+V(x,"Format").$modifier(v.$kept_modify())+"]")),z(v.modifier["$!="](0))&&(d=X(d,V(x,"Format").$modifier(v.modifier))),d},o.$$arity=0)},Opal.modules["bcdice/game_system/sword_world/rating_parser"]=function(e){function H(P,G){return"number"==typeof P&&"number"==typeof G?P-G:P["$-"](G)}var G,C,g,E,p,q,Z,B,y,o,h,v,d,a,k,A,O,te,de,ve,ge,qe,Re,Ee,Te,be,J,re,$,W,L,D,ne,$e,ce,xe,oe,fe,he,Se,le,De,me,Ae,Fe,Ue,He,c,l,m,Q,S,X=e.top,w=[],r=e.nil,_=e.$$$,s=e.$$,V=e.module,f=e.klass,F=e.hash2,z=e.send2,t=e.send,N=e.hash,i=e.truthy;return X.$require("racc/parser.rb"),X.$require("bcdice/arithmetic/node"),X.$require("bcdice/enum"),X.$require("bcdice/game_system/sword_world/rating_lexer"),X.$require("bcdice/game_system/sword_world/rating_parsed"),G=w,C=S=[V(w[0],"BCDice")].concat(G),g=Q=[V(S[0],"GameSystem")].concat(C),E=m=[f(Q[0],s(Q,"Base"),"SwordWorld")].concat(g),c=f(m[0],_(s(m,"Racc"),"Parser"),"RatingParser"),l=[c].concat(E),c.$$prototype.lexer=c.$$prototype.version=r,e.def(c,"$initialize",p=function(se){var ke,ee;if(p.$$p&&(p.$$p=null),null==se)se=F([],{});else if(!se.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return null==(ke=se.$$smap.version)&&(ke="v1_0"),null==(ee=se.$$smap.round_type)&&(ee=_(s(l,"RoundType"),"CEIL")),z(this,e.find_super_dispatcher(this,"initialize",p,!1,!0),"initialize",[],null),this.version=ke,this.round_type=ee},p.$$arity=-1),e.def(c,"$set_debug",q=function(){return this.yydebug=!0,this},q.$$arity=0),e.def(c,"$parse",Z=function(se){try{return this.lexer=s(l,"RatingLexer").$new(se),this.$do_parse()}catch(ee){if(!e.rescue(ee,[s(l,"ParseError"),s(l,"ZeroDivisionError")]))throw ee;try{return r}finally{e.pop_exception()}}},Z.$$arity=1),c.$private(),e.def(c,"$parsed",B=function(se,ke,ee){var K;return t(s(l,"RatingParsed").$new(),"tap",[],((K=function(_e){var T,ie,M,Y,ae=null==K.$$s?this:K.$$s,ue=r;return null==ae.round_type&&(ae.round_type=r),null==_e&&(_e=r),t(_e,"rate=",e.to_a(ue=[se])),H(ue.length,1),ue=[(T=ee["$[]"]("critical"),T===r||null==T?r:t(T,"eval",[ae.round_type]))],t(_e,"critical=",e.to_a(ue)),H(ue.length,1),ue=[(ie=ee["$[]"]("kept_modify"),ie===r||null==ie?r:t(ie,"eval",[ae.round_type]))],t(_e,"kept_modify=",e.to_a(ue)),H(ue.length,1),ue=[ee["$[]"]("first_to")],t(_e,"first_to=",e.to_a(ue)),H(ue.length,1),ue=[ee["$[]"]("first_modify")],t(_e,"first_modify=",e.to_a(ue)),H(ue.length,1),ue=[(M=ee["$[]"]("rateup"),M===r||null==M?r:t(M,"eval",[ae.round_type]))],t(_e,"rateup=",e.to_a(ue)),H(ue.length,1),ue=[ee.$fetch("greatest_fortune",!1)],t(_e,"greatest_fortune=",e.to_a(ue)),H(ue.length,1),ue=[ke.$eval(ae.round_type)],t(_e,"modifier=",e.to_a(ue)),H(ue.length,1),ue=[(Y=ee["$[]"]("modifier_after_half"),Y===r||null==Y?r:t(Y,"eval",[ae.round_type]))],t(_e,"modifier_after_half=",e.to_a(ue)),ue[H(ue.length,1)]}).$$s=this,K.$$arity=1,K))},B.$$arity=3),e.def(c,"$next_token",y=function(){return this.lexer.$next_token()},y.$$arity=0),fe=[15,14,16,5,18,19,51,52,21,22,11,53,12,17,13,15,14,16,4,18,19,4,8,3,28,11,28,12,17,13,24,25,24,25,27,28,27,28,49,50,9,24,25,24,25,27,28,27,28,49,50,35,24,25,24,25,27,28,27,28,49,50,42,24,25,24,25,27,28,27,28,49,50,47,24,25,24,25,27,28,27,28,49,50,48,24,25,24,25,27,28,27,28,49,50,r,24,25,24,25,27,28,27,28,49,50,r,24,25,24,25,27,30,27,r,r,r,r,31,32],he=[6,6,6,1,6,6,45,45,10,10,6,45,6,6,6,20,20,20,3,20,20,0,4,0,11,20,12,20,20,20,11,11,12,12,11,14,12,15,37,37,5,14,14,15,15,14,17,15,18,39,39,16,17,17,18,18,17,19,18,21,40,40,23,19,19,21,21,19,22,21,24,41,41,31,22,22,24,24,22,25,24,27,46,46,32,25,25,27,27,25,49,27,50,56,56,r,49,49,50,50,49,51,50,52,57,57,r,51,51,52,52,51,13,52,r,r,r,r,13,13],Se=[18,3,r,15,20,40,-4,r,r,r,0,22,24,110,33,35,44,44,46,55,11,57,66,47,68,77,r,79,r,r,r,71,82,r,r,r,r,28,r,39,50,61,r,r,r,-2,72,r,r,88,90,99,101,r,r,r,83,94],le=[-31,-31,-4,-31,-31,-31,-1,-4,-3,58,-5,-31,-31,-31,-11,-31,-31,-31,-31,-31,-2,-31,-31,-31,-31,-31,-28,-31,-30,-7,-8,-31,-31,-12,-13,-14,-15,-16,-25,-17,-18,-19,-6,-26,-27,-31,-22,-9,-10,-31,-31,-31,-31,-29,-23,-24,-20,-21],De=[23,29,2,33,34,7,36,37,39,1,40,41,6,43,44,45,46,20,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,54,55,56,57],me=[5,5,2,5,5,2,5,6,6,1,6,6,3,5,5,7,6,3,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,5,5,6,6],Ae=[r,9,2,10,r,-11,-11,-12,r],Fe=[r,r,r,r,10,38,r,r,26],Ue=[0,0,"racc_error",2,20,"_reduce_1",3,20,"_reduce_2",2,21,"_reduce_3",0,22,"_reduce_4",2,22,"_reduce_5",4,22,"_reduce_6",3,22,"_reduce_7",3,22,"_reduce_8",4,22,"_reduce_9",4,22,"_reduce_10",2,22,"_reduce_11",3,22,"_reduce_12",3,22,"_reduce_13",3,22,"_reduce_14",3,22,"_reduce_15",2,23,"_reduce_16",2,23,"_reduce_17",3,23,"_reduce_18",3,23,"_reduce_19",3,26,"_reduce_20",3,26,"_reduce_21",1,26,"_reduce_none",3,25,"_reduce_23",3,25,"_reduce_24",1,25,"_reduce_none",2,24,"_reduce_26",2,24,"_reduce_27",1,24,"_reduce_none",3,27,"_reduce_29",1,27,"_reduce_30"],He=N(!1,0,"error",1,"NUMBER",2,"K",3,"R",4,"H",5,"G",6,"F",7,"PLUS",8,"MINUS",9,"ASTERISK",10,"SLASH",11,"PARENL",12,"PARENR",13,"BRACKETL",14,"BRACKETR",15,"AT",16,"SHARP",17,"DOLLAR",18),e.const_set(l[0],"Racc_arg",[fe,he,le,Se,De,me,Fe,Ae,19,Ue,He,58,31,!0]),e.const_set(l[0],"Racc_token_to_s_table",["$end","error","NUMBER","K","R","H","G","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","BRACKETL","BRACKETR","AT","SHARP","DOLLAR","$start","expr","rate","option","modifier","unary","mul","add","term"]),e.const_set(l[0],"Racc_debug_parser",!1),e.def(c,"$_reduce_1",o=function(se,ke,ee){var K,_e,T,ie,ae=r;return _e=null==(K=e.to_ary(se))[0]?r:K[0],T=i(ie=(ae=null==K[1]?r:K[1])["$[]"]("modifier"))?ie:_(_(s(l,"Arithmetic"),"Node"),"Number").$new(0),this.$parsed(_e,T,ae)},o.$$arity=3),e.def(c,"$_reduce_2",h=function(se,ke,ee){var K,ae,Y,ue,T=r,M=r;return ae=null==(K=e.to_ary(se))[1]?r:K[1],i((T=null==K[2]?r:K[2])["$[]"]("modifier_after_half"))||(M=["modifier_after_half",_(_(s(l,"Arithmetic"),"Node"),"Number").$new(0)],t(T,"[]=",e.to_a(M)),H(M.length,1)),Y=i(ue=T["$[]"]("modifier"))?ue:_(_(s(l,"Arithmetic"),"Node"),"Number").$new(0),this.$parsed(ae,Y,T)},h.$$arity=3),e.def(c,"$_reduce_3",v=function(se,ke,ee){return se["$[]"](1).$to_i()},v.$$arity=3),e.def(c,"$_reduce_4",d=function(se,ke,ee){return F([],{})},d.$$arity=3),e.def(c,"$_reduce_5",a=function(se,ke,ee){var K,ae,T,_e=r;return ae=null==(K=e.to_ary(se))[1]?r:K[1],i((_e=null==K[0]?r:K[0])["$[]"]("modifier")["$nil?"]())||this.$raise(s(l,"ParseError")),t(_e,"[]=",e.to_a(T=["modifier",ae])),H(T.length,1),_e},a.$$arity=3),e.def(c,"$_reduce_6",k=function(se,ke,ee){var K,T,ie,_e=r;return T=null==(K=e.to_ary(se))[2]?r:K[2],i((_e=null==K[0]?r:K[0])["$[]"]("critical")["$nil?"]())||this.$raise(s(l,"ParseError")),t(_e,"[]=",e.to_a(ie=["critical",T])),H(ie.length,1),_e},k.$$arity=3),e.def(c,"$_reduce_7",A=function(se,ke,ee){var K,T,ie,_e=r;return T=null==(K=e.to_ary(se))[2]?r:K[2],i((_e=null==K[0]?r:K[0])["$[]"]("critical")["$nil?"]())||this.$raise(s(l,"ParseError")),t(_e,"[]=",e.to_a(ie=["critical",T])),H(ie.length,1),_e},A.$$arity=3),e.def(c,"$_reduce_8",O=function(se,ke,ee){var K,M,ie,_e=r,T=r;return T=null==(K=e.to_ary(se))[2]?r:K[2],i(i(ie=(_e=null==K[0]?r:K[0])["$[]"]("first_to")["$nil?"]())?_e["$[]"]("first_modify")["$nil?"]():ie)||this.$raise(s(l,"ParseError")),M=["first_to",T.$to_i()],t(_e,"[]=",e.to_a(M)),H(M.length,1),_e},O.$$arity=3),e.def(c,"$_reduce_9",te=function(se,ke,ee){var K,M,ie,_e=r,T=r;return T=null==(K=e.to_ary(se))[3]?r:K[3],i(i(ie=(_e=null==K[0]?r:K[0])["$[]"]("first_to")["$nil?"]())?_e["$[]"]("first_modify")["$nil?"]():ie)||this.$raise(s(l,"ParseError")),M=["first_modify",T.$to_i()],t(_e,"[]=",e.to_a(M)),H(M.length,1),_e},te.$$arity=3),e.def(c,"$_reduce_10",de=function(se,ke,ee){var K,M,ie,_e=r,T=r;return T=null==(K=e.to_ary(se))[3]?r:K[3],i(i(ie=(_e=null==K[0]?r:K[0])["$[]"]("first_to")["$nil?"]())?_e["$[]"]("first_modify")["$nil?"]():ie)||this.$raise(s(l,"ParseError")),M=["first_modify",T.$to_i()["$-@"]()],t(_e,"[]=",e.to_a(M)),H(M.length,1),_e},de.$$arity=3),e.def(c,"$_reduce_11",ve=function(se,ke,ee){var K,T,_e=r;return K=e.to_ary(se),i((_e=null==K[0]?r:K[0])["$[]"]("modifier_after_half")["$nil?"]())||this.$raise(s(l,"ParseError")),T=["modifier_after_half",_(_(s(l,"Arithmetic"),"Node"),"Number").$new(0)],t(_e,"[]=",e.to_a(T)),H(T.length,1),_e},ve.$$arity=3),e.def(c,"$_reduce_12",ge=function(se,ke,ee){var K,T,ie,_e=r;return T=null==(K=e.to_ary(se))[2]?r:K[2],i((_e=null==K[0]?r:K[0])["$[]"]("modifier_after_half")["$nil?"]())||this.$raise(s(l,"ParseError")),t(_e,"[]=",e.to_a(ie=["modifier_after_half",T])),H(ie.length,1),_e},ge.$$arity=3),e.def(c,"$_reduce_13",qe=function(se,ke,ee){var K,T,M,ie,_e=r;return _e=null==(K=e.to_ary(se))[0]?r:K[0],T=null==K[2]?r:K[2],i(i(ie=["v2_5","v2_0"]["$include?"](this.version))?_e["$[]"]("rateup")["$nil?"]():ie)||this.$raise(s(l,"ParseError")),t(_e,"[]=",e.to_a(M=["rateup",T])),H(M.length,1),_e},qe.$$arity=3),e.def(c,"$_reduce_14",Re=function(se,ke,ee){var K,ie,T,_e=r;return _e=null==(K=e.to_ary(se))[0]?r:K[0],i(i(T=["v2_5","v2_0"]["$include?"](this.version))?_e["$[]"]("greatest_fortune")["$nil?"]():T)||this.$raise(s(l,"ParseError")),t(_e,"[]=",e.to_a(ie=["greatest_fortune",!0])),H(ie.length,1),_e},Re.$$arity=3),e.def(c,"$_reduce_15",Ee=function(se,ke,ee){var K,T,M,ie,_e=r;return _e=null==(K=e.to_ary(se))[0]?r:K[0],T=null==K[2]?r:K[2],i(i(ie=this.version["$=="]("v2_5"))?_e["$[]"]("kept_modify")["$nil?"]():ie)||this.$raise(s(l,"ParseError")),t(_e,"[]=",e.to_a(M=["kept_modify",T])),H(M.length,1),_e},Ee.$$arity=3),e.def(c,"$_reduce_16",Te=function(se,ke,ee){return se["$[]"](1)},Te.$$arity=3),e.def(c,"$_reduce_17",be=function(se,ke,ee){return _(_(s(l,"Arithmetic"),"Node"),"Negative").$new(se["$[]"](1))},be.$$arity=3),e.def(c,"$_reduce_18",J=function(se,ke,ee){return _(_(s(l,"Arithmetic"),"Node"),"BinaryOp").$new(se["$[]"](0),"+",se["$[]"](2))},J.$$arity=3),e.def(c,"$_reduce_19",re=function(se,ke,ee){return _(_(s(l,"Arithmetic"),"Node"),"BinaryOp").$new(se["$[]"](0),"-",se["$[]"](2))},re.$$arity=3),e.def(c,"$_reduce_20",$=function(se,ke,ee){return _(_(s(l,"Arithmetic"),"Node"),"BinaryOp").$new(se["$[]"](0),"+",se["$[]"](2))},$.$$arity=3),e.def(c,"$_reduce_21",W=function(se,ke,ee){return _(_(s(l,"Arithmetic"),"Node"),"BinaryOp").$new(se["$[]"](0),"-",se["$[]"](2))},W.$$arity=3),e.def(c,"$_reduce_23",L=function(se,ke,ee){return _(_(s(l,"Arithmetic"),"Node"),"BinaryOp").$new(se["$[]"](0),"*",se["$[]"](2))},L.$$arity=3),e.def(c,"$_reduce_24",D=function(se,ke,ee){return _(_(s(l,"Arithmetic"),"Node"),"DivideWithGameSystemDefault").$new(se["$[]"](0),se["$[]"](2))},D.$$arity=3),e.def(c,"$_reduce_26",ne=function(se,ke,ee){return se["$[]"](1)},ne.$$arity=3),e.def(c,"$_reduce_27",$e=function(se,ke,ee){return _(_(s(l,"Arithmetic"),"Node"),"Negative").$new(se["$[]"](1))},$e.$$arity=3),e.def(c,"$_reduce_29",ce=function(se,ke,ee){return se["$[]"](1)},ce.$$arity=3),e.def(c,"$_reduce_30",xe=function(se,ke,ee){return _(_(s(l,"Arithmetic"),"Node"),"Number").$new(se["$[]"](0))},xe.$$arity=3),void e.def(c,"$_reduce_none",oe=function(se,ke,ee){return se["$[]"](0)},oe.$$arity=3)},Opal.modules["bcdice/game_system/SwordWorld"]=function(e){function H(C,R){return"number"==typeof C&&"number"==typeof R?C>=R:C["$>="](R)}function X(C,R){return"number"==typeof C&&"number"==typeof R?C<=R:C["$<="](R)}function w(C,R){return"number"==typeof C&&"number"==typeof R?C-R:C["$-"](R)}function r(C,R){return"number"==typeof C&&"number"==typeof R?C>R:C["$>"](R)}function _(C,R){return"number"==typeof C&&"number"==typeof R?C+R:C["$+"](R)}function V(C,R){return"number"==typeof C&&"number"==typeof R?C*R:C["$*"](R)}var R,g,E,p,q,Z,B,y,o,h,v,d,c,l,m,U,F=e.top,z=[],t=e.nil,i=e.$$,P=e.module,G=e.klass,b=e.send2,S=e.truthy,j=e.send;return F.$require("bcdice/base"),F.$require("bcdice/game_system/sword_world/rating_parser"),R=z,g=U=[P(z[0],"BCDice")].concat(R),E=m=[P(U[0],"GameSystem")].concat(g),c=G(m[0],i(m,"Base"),"SwordWorld"),l=[c].concat(E),c.$$prototype.rating_table=c.$$prototype.randomizer=t,e.const_set(l[0],"ID","SwordWorld"),e.const_set(l[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c9RPG"),e.const_set(l[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u3068"),e.const_set(l[0],"HELP_MESSAGE","\u30fbSW\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx[c]+m$f) (x:\u30ad\u30fc, c:\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024, m:\u30dc\u30fc\u30ca\u30b9, f:\u51fa\u76ee\u4fee\u6b63)\n"),c.$register_prefix("H?K"),e.def(c,"$initialize",p=function(k){return p.$$p&&(p.$$p=null),b(this,e.find_super_dispatcher(this,"initialize",p,!1,!0),"initialize",[k],null),this.rating_table=0},p.$$arity=1),e.def(c,"$result_2d6",q=function(k,A,O,te,de){var ge=t;return S(H(A,12))?i(l,"Result").$critical("\u81ea\u52d5\u7684\u6210\u529f"):S(X(A,2))?i(l,"Result").$fumble("\u81ea\u52d5\u7684\u5931\u6557"):S(S(ge=te["$!="](">="))?ge:de["$=="]("?"))?t:S(H(k,de))?i(l,"Result").$success("\u6210\u529f"):i(l,"Result").$failure("\u5931\u6557")},q.$$arity=5),e.def(c,"$eval_game_system_specific_command",Z=function(k){return this.$rating(k)},Z.$$arity=1),c.$private(),e.def(c,"$rating_parser",B=function(){return i(l,"RatingParser").$new()},B.$$arity=0),e.def(c,"$rating",y=function(k){var A,O,te,de,ve=this,ge=t,qe=t,Re=t,Ee=t,Te=t,be=t,J=t,re=t,$=t,W=t,L=t,D=t,ne=t,$e=t,xe=t,oe=t;return ve.$debug("rating string",k),ge=ve.$rating_parser().$parse(k),S(ge)?(qe=ve.$getSW2_0_RatingTable(),Re=w(qe.$length(),1),ve.$debug("keyMax",Re),S(r(ge.$rate(),Re))?"\u30ad\u30fc\u30ca\u30f3\u30d0\u30fc\u306f"+Re+"\u307e\u3067\u3067\u3059":(Ee=ve.$getNewRates(qe),Te=ge+" \uff1e ",be=[],J=[],re=[],$=0,W=0,L=0,D=0,ne=ge.$first_to(),$e=ge.$first_modify(),function(){var fe=e.new_brk();try{j(ve,"loop",[],((A=function(){var le,De,Ue,Ie,Fe,C,Se=null==A.$$s?this:A.$$s,me=t,Ae=t;if(De=Se.$rollDice(ge),Ae=null==(le=e.to_ary(De))[1]?t:le[1],$=me=null==le[0]?t:le[0],S(ne["$!="](0))?($=me=ne,ne=0):S($e["$!="](0))&&($=_($,$e),$e=0),S(X(me,2))&&(be["$<<"](me.$to_s()),J["$<<"](Ae.$to_s()),re["$<<"]("**"),D=_(D,1),e.brk(t,fe)),S(S(Fe=ge.$kept_modify()["$!="](0))?$["$!="](2):Fe)&&($=_($,ge.$kept_modify())),S("number"==typeof(C=$)?C<2:C["$<"](2))&&($=2),S(r($,12))&&($=12),Ue=[_(ge.$rate(),V(D,ge.$rateup())),Re].$min(),Se.$debug("currentKey",Ue),Ie=Ee["$[]"]($)["$[]"](Ue),Se.$debug("rateValue",Ie),L=_(L,Ie),W=_(W,$),be["$<<"]($.$to_s()),J["$<<"](Ae.$to_s()),re["$<<"](S(r($,2))?Ie:"**"),D=_(D,1),S(H($,ge.$critical())))return t;e.brk(t,fe)}).$$s=ve,A.$$brk=fe,A.$$arity=0,A))}catch(he){if(he===fe)return he.$v;throw he}}(),te=ve.$getResultText(L,ge,J,be,re,W,D),O=e.to_ary(te),xe=null==O[1]?t:O[1],oe=null==O[2]?t:O[2],Te=_(Te,null==O[0]?t:O[0]),j(i(l,"Result").$new(),"tap",[],((de=function(he){var le=t;return null==he&&(he=t),j(he,"text=",e.to_a(le=[Te])),w(le.length,1),j(he,"critical=",e.to_a(le=[xe])),w(le.length,1),j(he,"fumble=",e.to_a(le=[oe])),le[w(le.length,1)]}).$$s=ve,de.$$arity=1,de)))):(ve.$debug("not matched"),"1")},y.$$arity=1),e.def(c,"$getSW2_0_RatingTable",o=function(){return["*,0,0,0,1,2,2,3,3,4,4","*,0,0,0,1,2,3,3,3,4,4","*,0,0,0,1,2,3,4,4,4,4","*,0,0,1,1,2,3,4,4,4,5","*,0,0,1,2,2,3,4,4,5,5","*,0,1,1,2,2,3,4,5,5,5","*,0,1,1,2,3,3,4,5,5,5","*,0,1,1,2,3,4,4,5,5,6","*,0,1,2,2,3,4,4,5,6,6","*,0,1,2,3,3,4,4,5,6,7","*,1,1,2,3,3,4,5,5,6,7","*,1,2,2,3,3,4,5,6,6,7","*,1,2,2,3,4,4,5,6,6,7","*,1,2,3,3,4,4,5,6,7,7","*,1,2,3,4,4,4,5,6,7,8","*,1,2,3,4,4,5,5,6,7,8","*,1,2,3,4,4,5,6,7,7,8","*,1,2,3,4,5,5,6,7,7,8","*,1,2,3,4,5,6,6,7,7,8","*,1,2,3,4,5,6,7,7,8,9","*,1,2,3,4,5,6,7,8,9,10","*,1,2,3,4,6,6,7,8,9,10","*,1,2,3,5,6,6,7,8,9,10","*,2,2,3,5,6,7,7,8,9,10","*,2,3,4,5,6,7,7,8,9,10","*,2,3,4,5,6,7,8,8,9,10","*,2,3,4,5,6,8,8,9,9,10","*,2,3,4,6,6,8,8,9,9,10","*,2,3,4,6,6,8,9,9,10,10","*,2,3,4,6,7,8,9,9,10,10","*,2,4,4,6,7,8,9,10,10,10","*,2,4,5,6,7,8,9,10,10,11","*,3,4,5,6,7,8,10,10,10,11","*,3,4,5,6,8,8,10,10,10,11","*,3,4,5,6,8,9,10,10,11,11","*,3,4,5,7,8,9,10,10,11,12","*,3,5,5,7,8,9,10,11,11,12","*,3,5,6,7,8,9,10,11,12,12","*,3,5,6,7,8,10,10,11,12,13","*,4,5,6,7,8,10,11,11,12,13","*,4,5,6,7,9,10,11,11,12,13","*,4,6,6,7,9,10,11,12,12,13","*,4,6,7,7,9,10,11,12,13,13","*,4,6,7,8,9,10,11,12,13,14","*,4,6,7,8,10,10,11,12,13,14","*,4,6,7,9,10,10,11,12,13,14","*,4,6,7,9,10,10,12,13,13,14","*,4,6,7,9,10,11,12,13,13,15","*,4,6,7,9,10,12,12,13,13,15","*,4,6,7,10,10,12,12,13,14,15","*,4,6,8,10,10,12,12,13,15,15","*,5,7,8,10,10,12,12,13,15,15","*,5,7,8,10,11,12,12,13,15,15","*,5,7,9,10,11,12,12,14,15,15","*,5,7,9,10,11,12,13,14,15,16","*,5,7,10,10,11,12,13,14,16,16","*,5,8,10,10,11,12,13,15,16,16","*,5,8,10,11,11,12,13,15,16,17","*,5,8,10,11,12,12,13,15,16,17","*,5,9,10,11,12,12,14,15,16,17","*,5,9,10,11,12,13,14,15,16,18","*,5,9,10,11,12,13,14,16,17,18","*,5,9,10,11,13,13,14,16,17,18","*,5,9,10,11,13,13,15,17,17,18","*,5,9,10,11,13,14,15,17,17,18","*,5,9,10,12,13,14,15,17,18,18","*,5,9,10,12,13,15,15,17,18,19","*,5,9,10,12,13,15,16,17,19,19","*,5,9,10,12,14,15,16,17,19,19","*,5,9,10,12,14,16,16,17,19,19","*,5,9,10,12,14,16,17,18,19,19","*,5,9,10,13,14,16,17,18,19,20","*,5,9,10,13,15,16,17,18,19,20","*,5,9,10,13,15,16,17,19,20,21","*,6,9,10,13,15,16,18,19,20,21","*,6,9,10,13,16,16,18,19,20,21","*,6,9,10,13,16,17,18,19,20,21","*,6,9,10,13,16,17,18,20,21,22","*,6,9,10,13,16,17,19,20,22,23","*,6,9,10,13,16,18,19,20,22,23","*,6,9,10,13,16,18,20,21,22,23","*,6,9,10,13,17,18,20,21,22,23","*,6,9,10,14,17,18,20,21,22,24","*,6,9,11,14,17,18,20,21,23,24","*,6,9,11,14,17,19,20,21,23,24","*,6,9,11,14,17,19,21,22,23,24","*,7,10,11,14,17,19,21,22,23,25","*,7,10,12,14,17,19,21,22,24,25","*,7,10,12,14,18,19,21,22,24,25","*,7,10,12,15,18,19,21,22,24,26","*,7,10,12,15,18,19,21,23,25,26","*,7,11,13,15,18,19,21,23,25,26","*,7,11,13,15,18,20,21,23,25,27","*,8,11,13,15,18,20,22,23,25,27","*,8,11,13,16,18,20,22,23,25,28","*,8,11,14,16,18,20,22,23,26,28","*,8,11,14,16,19,20,22,23,26,28","*,8,12,14,16,19,20,22,24,26,28","*,8,12,15,16,19,20,22,24,27,28","*,8,12,15,17,19,20,22,24,27,29","*,8,12,15,18,19,20,22,24,27,30"]},o.$$arity=0),e.def(c,"$getNewRates",h=function(k){var A,te=t,de=t,ve=t,ge=t,qe=t,Re=t,Ee=t,Te=t,be=t,J=t,re=t,$=t;return te=[],de=[],ve=[],ge=[],qe=[],Re=[],Ee=[],Te=[],be=[],J=[],re=[],j(k,"each",[],((A=function(D){var $e=t;return null==D&&(D=t),$e=D.$split(/,/),re.$push(0),te.$push($e["$[]"](1).$to_i()),de.$push($e["$[]"](2).$to_i()),ve.$push($e["$[]"](3).$to_i()),ge.$push($e["$[]"](4).$to_i()),qe.$push($e["$[]"](5).$to_i()),Re.$push($e["$[]"](6).$to_i()),Ee.$push($e["$[]"](7).$to_i()),Te.$push($e["$[]"](8).$to_i()),be.$push($e["$[]"](9).$to_i()),J.$push($e["$[]"](10).$to_i())}).$$s=this,A.$$arity=1,A)),this.rating_table["$=="](1)&&($=[31,($=[32,($=[33,10],j(J,"[]=",e.to_a($)),$[w($.length,1)])],j(J,"[]=",e.to_a($)),$[w($.length,1)])],j(J,"[]=",e.to_a($)),w($.length,1)),[re,re,re,te,de,ve,ge,qe,Re,Ee,Te,be,J]},h.$$arity=1),e.def(c,"$rollDice",v=function(k){var O=t;return[(O=this.randomizer.$roll_barabara(2,6)).$sum(),O.$join(",")]},v.$$arity=1),void e.def(c,"$getResultText",d=function(k,A,O,te,de,ve,ge){var C,Re=t,Ee=t,Te=t,be=t,J=t,re=t;return(Re=[]).$push("2D:["+O.$join(" ")+"]="+te.$join(",")),S(X(ve,2))?(Re.$push(de.$join(",")),Re.$push("\u81ea\u52d5\u7684\u5931\u6557"),[Re.$join(" \uff1e "),!1,!0]):(S(S(Ee=r(de.$size(),1))?Ee:A.$modifier()["$!="](0))?(Te=_(de.$join(","),i(l,"Format").$modifier(A.$modifier())),S(A.$half())&&(Te="("+Te+")/2",S(A.$modifier_after_half()["$!="](0))&&(Te=_(Te,i(l,"Format").$modifier(A.$modifier_after_half())))),Re.$push(Te)):S(A.$half())&&(Te=de.$first()+"/2",S(A.$modifier_after_half()["$!="](0))&&(Te=_(Te,i(l,"Format").$modifier(A.$modifier_after_half()))),Re.$push(Te)),S(r(ge,1))&&(be=w(ge,1)+"\u56de\u8ee2",Re.$push(be)),J=_(k,A.$modifier()),S(A.$half())&&(J=(C=J,"number"==typeof C?C/2:C["$/"](2)).$ceil(),S(A.$modifier_after_half()["$!="](0))&&(J=_(J,A.$modifier_after_half()))),re=J.$to_s(),Re.$push(re),[Re.$join(" \uff1e "),r(ge,1),!1])},d.$$arity=7)},Opal.modules["bcdice/game_system/sword_world/transcendent_test"]=function(e){function X(G,b){return"number"==typeof G&&"number"==typeof b?G>=b:G["$>="](b)}function r(G,b){return"number"==typeof G&&"number"==typeof b?G-b:G["$-"](b)}var b,R,n,c,q,Z,B,y,o,h,l,p,u,U,j,s=[],V=e.nil,F=e.$$,z=e.module,t=e.klass,N=e.hash2,i=e.truthy,P=e.send;return e.top.$require("bcdice/result"),b=s,R=j=[z(s[0],"BCDice")].concat(b),n=U=[z(j[0],"GameSystem")].concat(R),c=u=[t(U[0],F(U,"SwordWorld"),"SwordWorld2_0")].concat(n),l=t(u[0],null,"TranscendentTest"),p=[l].concat(c),l.$$prototype.modifier=l.$$prototype.critical_value=l.$$prototype.expression=l.$$prototype.modifier_str=l.$$prototype.target=l.$$prototype.cmp_op=V,e.const_set(p[0],"RESULT_STR",N(["success","failure","super_success","critical","fumble"],{success:"\u6210\u529f",failure:"\u5931\u6557",super_success:"\u8d85\u6210\u529f",critical:"\u81ea\u52d5\u7684\u6210\u529f",fumble:"\u81ea\u52d5\u7684\u5931\u6557"}).$freeze()),e.def(l,"$initialize",q=function(d,a,k,A){var O=this;return O.critical_value=d,O.modifier=a,O.cmp_op=k,O.target=A,O.modifier_str=F(p,"Format").$modifier(O.modifier),O.expression=O.$node_expression()},q.$$arity=4),e.def(l,"$execute",Z=function(d){var k,qe,ge,G,A=this,O=V,te=V,de=V,ve=V,Re=V,Ee=V,Te=V;if(i("number"==typeof(G=A.critical_value)?G<3:G["$<"](3)))return"("+A.expression+") \uff1e \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u304c\u5c0f\u3055\u3059\u304e\u307e\u3059\u30023\u4ee5\u4e0a\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002";if(te=[O=d.$roll_barabara(2,6)],de=O["$=="]([1,1]),ve=O["$=="]([6,6]),i(i(ge=de["$!"]())?ve["$!"]():ge))for(;i(X(A.$sum_of_dice(te.$last()),A.critical_value));)te.$push(d.$roll_barabara(2,6));return Re=function(G,b){return"number"==typeof G&&"number"==typeof b?G+b:G["$+"](b)}(qe=A.$sum_of_dice(te),A.modifier),Ee=A.$result_status(Re,te.$length(),de,ve),Te=["("+A.expression+")",""+A.$dice_str(te,qe)+A.modifier_str,Re,F(p,"RESULT_STR")["$[]"](Ee)].$compact(),P(F(p,"Result").$new(),"tap",[],((k=function(J){var $=V;return null==J&&(J=V),$=[Te.$join(" \uff1e ")],P(J,"text=",e.to_a($)),r($.length,1),$=[Ee["$=="]("fumble")],P(J,"fumble=",e.to_a($)),r($.length,1),$=[Ee["$=="]("critical")],P(J,"critical=",e.to_a($)),r($.length,1),$=[["success","super_success","critical"]["$include?"](Ee)],P(J,"success=",e.to_a($)),r($.length,1),$=[["failure","fumble"]["$include?"](Ee)],P(J,"failure=",e.to_a($)),$[r($.length,1)]}).$$s=A,k.$$arity=1,k))},Z.$$arity=1),l.$private(),e.def(l,"$node_expression",B=function(){var a,d=this;return a="2D6@"+d.critical_value+d.modifier_str,i(d.target)?""+a+d.cmp_op+d.target:a},B.$$arity=0),e.def(l,"$sum_of_dice",y=function(d){return d.$flatten().$sum()},y.$$arity=1),e.def(l,"$dice_str",o=function(d,a){var k;return""+a+P(d,"map",[],(k=function(de){return null==de&&(de=V),"["+de.$join(",")+"]"},k.$$s=this,k.$$arity=1,k)).$join()},o.$$arity=2),void e.def(l,"$result_status",h=function(d,a,k,A){var O=this,te=V;return i(O.target)?i(k)?"fumble":i(A)?"critical":i(d.$send(O.cmp_op,O.target))?i(i(te=X(a,2))?X(d,41):te)?"super_success":"success":"failure":"no_target"},h.$$arity=4)},function(e){function H(P,G){return"number"==typeof P&&"number"==typeof G?P*G:P["$*"](G)}var G,C,g,u,x,E,c,l,p,q,Z,B,n,m,Q,S,w=e.top,r=[],_=e.nil,s=e.$$$,V=e.$$,f=e.module,F=e.klass,z=e.send2,t=e.truthy,N=e.hash2,i=e.send;w.$require("bcdice/arithmetic_evaluator"),w.$require("bcdice/game_system/SwordWorld"),w.$require("bcdice/game_system/sword_world/transcendent_test"),G=r,C=S=[f(r[0],"BCDice")].concat(G),g=Q=[f(S[0],"GameSystem")].concat(C),n=F(Q[0],V(Q,"SwordWorld"),"SwordWorld2_0"),m=[n].concat(g),n.$$prototype.randomizer=_,e.const_set(m[0],"ID","SwordWorld2.0"),e.const_set(m[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c92.0"),e.const_set(m[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u30682.0"),e.const_set(m[0],"HELP_MESSAGE",'\u81ea\u52d5\u7684\u6210\u529f\u3001\u6210\u529f\u3001\u5931\u6557\u3001\u81ea\u52d5\u7684\u5931\u6557\u306e\u81ea\u52d5\u5224\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx)\n\u3000"K\u30ad\u30fc\u30ca\u30f3\u30d0\u30fc+\u30dc\u30fc\u30ca\u30b9"\u306e\u5f62\u3067\u8a18\u5165\u3057\u307e\u3059\u3002\n\u3000\u30dc\u30fc\u30ca\u30b9\u306e\u90e8\u5206\u306b\u300cK20+K30\u300d\u306e\u3088\u3046\u306b\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u53d6\u308b\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3002\n\u3000\u307e\u305f\u3001\u30dc\u30fc\u30ca\u30b9\u306f\u8907\u6570\u53d6\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3082\u30c0\u30a4\u30b9\u30ed\u30fc\u30eb\u3068\u540c\u69d8\u306b\u3001\u4ed6\u306e\u30d7\u30ec\u30a4\u30e4\u30fc\u306b\u96a0\u308c\u3066\u30ed\u30fc\u30eb\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20\u3000\u3000\u3000K10+5\u3000\u3000\u3000k30\u3000\u3000\u3000k10+10\u3000\u3000\u3000Sk10-1\u3000\u3000\u3000k10+5+2\n\n\u30fb\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306e\u8a2d\u5b9a\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306f"[\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024]"\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3000\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502410\u3068\u3057\u307e\u3059\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u51e6\u7406\u304c\u5fc5\u8981\u306a\u3044\u3068\u304d\u306f13\u306a\u3069\u3068\u3057\u3066\u304f\u3060\u3055\u3044\u3002(\u9632\u5fa1\u6642\u306a\u3069\u306e\u5bfe\u5fdc)\n\u3000\u307e\u305f\u30bf\u30a4\u30d7\u306e\u8efd\u6e1b\u5316\u306e\u305f\u3081\u306b\u672b\u5c3e\u306b\u300c@\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u300d\u3067\u3082\u51e6\u7406\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u3000\u4f8b\uff09K20[10]\u3000\u3000\u3000K10+5[9]\u3000\u3000\u3000k30[10]\u3000\u3000\u3000k10[9]+10\u3000\u3000\u3000k10-5@9\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u534a\u6e1b (HKx, KxH+N)\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u5148\u982d\u307e\u305f\u306f\u672b\u5c3e\u306b"H"\u3092\u3064\u3051\u308b\u3068\u3001\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3092\u632f\u3063\u3066\u6700\u7d42\u7d50\u679c\u3092\u534a\u6e1b\u3055\u305b\u307e\u3059\u3002\n\u3000\u672b\u5c3e\u306b\u3064\u3051\u305f\u5834\u5408\u3001\u76f4\u5f8c\u306b\u4fee\u6b63\u3092\u3092\u3064\u3051\u308b\u3053\u3068\u3067\u3001\u534a\u6e1b\u5f8c\u306e\u52a0\u6e1b\u7b97\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3000\u3053\u306e\u969b\u3001\u8907\u6570\u306e\u9805\u306b\u3088\u308b\u4fee\u6b63\u306b\u306f\u30ab\u30c3\u30b3\u3067\u56f2\u3046\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\uff08\u30ab\u30c3\u30b3\u304c\u306a\u3044\u3068\u30d1\u30fc\u30b9\u306b\u5931\u6557\u3057\u307e\u3059\uff09\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u306a\u3057\u3068\u6271\u308f\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff09HK20\u3000\u3000K20h\u3000\u3000HK10-5@9\u3000\u3000K10-5@9H\u3000\u3000K20gfH\u3000\u3000K20+8H+2\u3000\u3000K20+8H(1+1)\n\n\u30fb\u30c0\u30a4\u30b9\u76ee\u306e\u4fee\u6b63\uff08\u904b\u547d\u5909\u8ee2\u3084\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u30ec\u30a4\u7528\uff09\n\u3000\u672b\u5c3e\u306b\u300c$\u4fee\u6b63\u5024\u300d\u3067\u30c0\u30a4\u30b9\u76ee\u306b\u4fee\u6b63\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u3000$\uff0b\uff11\u3068\u4fee\u6b63\u8868\u8a18\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u306b\uff0b\u4fee\u6b63\u3001\uff04\uff19\u306e\u3088\u3046\u306b\u56fa\u5b9a\u5024\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u3092\u305d\u306e\u51fa\u76ee\u306b\u5dee\u3057\u66ff\u3048\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3057\u305f\u5834\u5408\u3067\u3082\u56fa\u5b9a\u5024\u3084\u4fee\u6b63\u5024\u306e\u9069\u7528\u306f\u6700\u521d\u306e\u4e00\u56de\u3060\u3051\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20$+1\u3000\u3000\u3000K10+5$9\u3000\u3000\u3000k10-5@9$+2\u3000\u3000\u3000k10[9]+10$9\n\n\u30fb\u9996\u5207\u308a\u5200\u7528\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u4e0a\u6607 r10\n\u3000\u4f8b\uff09K20r10\u3000K30+24@8R10\u3000K40+24@8$12r10\n\n\u30fb\u30b0\u30ec\u30a4\u30c6\u30b9\u30c8\u30d5\u30a9\u30fc\u30c1\u30e5\u30f3\u306f\u672b\u5c3e\u306b gf\n\u3000\u4f8b\uff09K20gf\u3000K30+24@8GF\u3000K40+24@8$12r10gf\n\n\u30fb\u8d85\u8d8a\u5224\u5b9a\u7528\u306b2d6\u30ed\u30fc\u30eb\u306b 2D6@10 \u66f8\u5f0f\u3067\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u4ed8\u4e0e\u304c\u53ef\u80fd\u306b\u3002\n\u3000\u4f8b\uff092D6@10\u30002D6@10+11>=30\n\n\u30fb\u6210\u9577\u3000(Gr)\n\u3000\u672b\u5c3e\u306b\u6570\u5b57\u3092\u4ed8\u52a0\u3059\u308b\u3053\u3068\u3067\u3001\u8907\u6570\u56de\u306e\u6210\u9577\u3092\u307e\u3068\u3081\u3066\u884c\u3048\u307e\u3059\u3002\n\u3000\u4f8b\uff09Gr3\n\n\u30fb\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3000(FT)\n\u3000\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30fb\u7d61\u307f\u52b9\u679c\u8868\u3000(TT)\n\u3000\u7d61\u307f\u52b9\u679c\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n'),n.$register_prefix("H?K","Gr","2D6?@\\d+","FT","TT"),e.def(n,"$initialize",u=function(o){var d=this;return u.$$p&&(u.$$p=null),z(d,e.find_super_dispatcher(d,"initialize",u,!1,!0),"initialize",[o],null),d.rating_table=2},u.$$arity=1),e.def(n,"$eval_game_system_specific_command",x=function(o){var a,d=this,A=_;return x.$$p&&(x.$$p=null),/^Gr(\d+)?/i["$==="](a=o)?t(o["$=~"](/^Gr(\d+)/i))?d.$growth(V(m,"Regexp").$last_match(1).$to_i()):d.$growth():/^2D6?@\d+/i["$==="](a)?(A=s(V(m,"Command"),"Parser").$new(/2D6?/i,N(["round_type"],{round_type:s(s(V(m,"BCDice"),"RoundType"),"CEIL")})).$enable_critical().$restrict_cmp_op_to(_,">=",">").$parse(o),t(A)?V(m,"TranscendentTest").$new(A.$critical(),A.$modify_number(),A.$cmp_op(),A.$target_number()).$execute(d.randomizer):_):"FT"["$==="](a)?d.$get_fumble_table():"TT"["$==="](a)?d.$get_tangle_table():z(d,e.find_super_dispatcher(d,"eval_game_system_specific_command",x,!1,!0),"eval_game_system_specific_command",[o],null)},x.$$arity=1),e.def(n,"$rating_parser",E=function(){return V(m,"RatingParser").$new(N(["version"],{version:"v2_0"}))},E.$$arity=0),e.def(n,"$rollDice",c=function(o){var d=this,a=_;return c.$$p&&(c.$$p=null),t(o.$greatest_fortune())?[H(a=d.randomizer.$roll_once(6),2),a+","+a]:z(d,e.find_super_dispatcher(d,"rollDice",c,!1,!0),"rollDice",[o],null)},c.$$arity=1),e.def(n,"$growth",l=function(o){var h;return null==o&&(o=1),i(e.Range.$new(1,o,!1),"map",[],(h=function(){return(null==h.$$s?this:h.$$s).$growth_step()},h.$$s=this,h.$$arity=0,h)).$join(" | ")},l.$$arity=-1),e.def(n,"$growth_step",p=function(){var h,v,a,o=this,d=_;return h=o.randomizer.$roll_once(6),v=o.randomizer.$roll_once(6),d=o.$get_ability_by_dice(h),a=o.$get_ability_by_dice(v),t(d["$!="](a))?"["+h+","+v+"]->("+d+" or "+a+")":"["+h+","+v+"]->("+d+")"},p.$$arity=0),e.def(n,"$get_ability_by_dice",q=function(o){return["\u5668\u7528\u5ea6","\u654f\u6377\u5ea6","\u7b4b\u529b","\u751f\u547d\u529b","\u77e5\u529b","\u7cbe\u795e\u529b"]["$[]"]("number"==typeof(P=o)?P-1:P["$-"](1));var P},q.$$arity=1),e.def(n,"$get_fumble_table",Z=function(){var o,h;return h=this.$get_table_by_1d6(["\u3053\u306e\u8868\u30922\u56de\u632f\u308a\u3001\u305d\u306e\u4e21\u65b9\u3092\u9069\u7528\u3059\u308b\u3002\uff08\u540c\u3058\u51fa\u76ee\u306b\u3088\u308b\u5f71\u97ff\u306f\u7d2f\u7a4d\u3057\u306a\u3044\uff09\u3002\u3053\u306e\u81ea\u52d5\u5931\u6557\u306b\u3088\u308a\u5f97\u3089\u308c\u308b\u7d4c\u9a13\u70b9\u306f\u3001+50\u70b9\u3055\u308c\u308b","\u30c0\u30e1\u30fc\u30b8\u306b\u3001\u653b\u6483\u8005\u3092\u5f37\u5316\u3057\u3066\u3044\u308b\u300c\u5263\u306e\u304b\u3051\u3089\u300d\u306e\u6570\u304c\u8ffd\u52a0\u3055\u308c\u308b","\u30c0\u30e1\u30fc\u30b8\u306b\u3001\u653b\u6483\u8005\u306e\u300c\u30ec\u30d9\u30eb\u300d\u304c\u8ffd\u52a0\u3055\u308c\u308b","\u30c0\u30e1\u30fc\u30b8\u6c7a\u5b9a\u30922\u56de\u884c\u3044\u3001\u3088\u308a\u9ad8\u3044\u65b9\u3092\u63a1\u7528\u3059\u308b","\u5408\u7b97\u30c0\u30e1\u30fc\u30b8\u30922\u500d\u3059\u308b","\u9632\u8b77\u70b9\u7121\u52b9"]),"\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868("+(null==(o=e.to_ary(h))[1]?_:o[1])+") \u2192 "+(null==o[0]?_:o[0])},Z.$$arity=0),e.def(n,"$get_tangle_table",B=function(){var o,h;return h=this.$get_table_by_1d6(["\u982d\u3084\u9854\uff1a\u7259\u3084\u565b\u307f\u3064\u304d\u306a\u3069\u306b\u304a\u3051\u308b\u547d\u4e2d\u529b\u5224\u5b9a\u53ca\u3073\u3001\u9b54\u6cd5\u306e\u884c\u4f7f\u3084\u30d6\u30ec\u30b9\u306b-2\u306e\u30da\u30ca\u30eb\u30c6\u30a3\u4fee\u6b63\u3092\u53d7\u3051\u308b","\u6b66\u5668\u3084\u76fe\uff1a\u6b66\u5668\u306e\u4f7f\u7528\u4e0d\u53ef\u3001\u53c8\u306f\u76fe\u306e\u56de\u907f\u529b\u4fee\u6b63\u53ca\u3073\u9632\u8b77\u70b9\u3092\u7121\u52b9\u5316\u3059\u308b","\u8155\u3084\u624b\uff1a\u6b66\u5668\u3084\u722a\u306a\u3069\u306b\u304a\u3051\u308b\u547d\u4e2d\u529b\u5224\u5b9a\u306b-2\u306e\u30da\u30ca\u30eb\u30c6\u30a3\u4fee\u6b63\u3001\u76fe\u3092\u6301\u3064\u8155\u65b9\u306e\u8155\u306a\u3089\u305d\u306e\u76fe\u306e\u56de\u907f\u529b\u4fee\u6b63\u53ca\u3073\u9632\u8b77\u70b9\u3092\u7121\u52b9\u5316\u3059\u308b","\u811a\u3084\u8db3\uff1a\u79fb\u52d5\u4e0d\u53ef\u3001\u66f4\u306b\u56de\u907f\u529b\u5224\u5b9a\u306b-2\u306e\u30da\u30ca\u30eb\u30c6\u30a3\u4fee\u6b63\u3092\u53d7\u3051\u308b \u203b\u4e21\u8db3\u306b\u7d61\u3093\u3067\u3082\u7d2f\u7a4d\u3057\u306a\u3044","\u80f4\u4f53\uff1a\u751f\u547d\u30fb\u7cbe\u795e\u62b5\u6297\u529b\u3092\u57fa\u6e96\u5024\u306b\u7528\u3044\u308b\u5224\u5b9a\u3092\u9664\u304d\u3001\u3042\u3089\u3086\u308b\u884c\u70ba\u5224\u5b9a\u306b-1\u306e\u30da\u30ca\u30eb\u30c6\u30a3\u4fee\u6b63\u3092\u53d7\u3051\u308b","\u7279\u6b8a\uff1a\u5c3b\u5c3e\u3084\u7ffc\u306a\u3069\u306b\u547d\u4e2d\u3002\u7d61\u3081\u3089\u308c\u305f\u90e8\u4f4d\u3092\u4f7f\u7528\u3059\u308b\u5224\u5b9a\u306b\u304a\u3044\u3066-2\u306e\u30da\u30ca\u30eb\u30c6\u30a3\u4fee\u6b63\u3001\u307e\u305f\u306f\u305d\u3053\u304c\u4f7f\u3048\u3066\u3044\u305f\u3053\u3068\u306b\u3088\u308b\u30dc\u30fc\u30ca\u30b9\u4fee\u6b63\u3092\u5931\u3046 \u203b\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306f\u6c7a\u3081\u76f4\u3057"]),"\u7d61\u307f\u52b9\u679c\u8868("+(null==(o=e.to_ary(h))[1]?_:o[1])+") \u2192 "+(null==o[0]?_:o[0])},B.$$arity=0)}(Opal)}}]);